import{s as m,e as w,j as b,m as p}from"./index-DelvhCwg.js";const f=function(){const e="prod",t={dev:"https://www.tianqiapi.com",prod:"https://www.tianqiapi.com"};return{get requestTimeout(){return 8e3},get apiUrl(){return t[e]},get isDev(){return e==="dev"}}}();function h(e){const t=new XMLHttpRequest,o=e.method,r=e.timeout||0;let u=e.url,d="",a="";const i=w(e.data);if(o==="GET"){if(i==="object")for(const s in e.data)a+="&"+s+"="+e.data[s];else console.warn("ajax 传参处理 GET 传参有误，需要的请求参数应为 object 类型");a&&(a="?"+a.slice(1),u+=a)}else d=i==="object"?JSON.stringify(e.data):e.data;if(t.onreadystatechange=function(){t.readyState===4&&(t.status===200||t.status===304?e.success&&e.success(t.response,t):e.fail&&e.fail(t))},e.onProgress&&t.upload.addEventListener("progress",e.onProgress),t.responseType=e.responseType,t.open(o,u,!0),e.method!=="GET")switch(i){case"object":t.setRequestHeader("Content-Type","application/json");break;case"string":t.setRequestHeader("Content-Type","application/x-www-form-urlencoded");break}if(e.headers)for(const s in e.headers){const n=e.headers[s];n&&t.setRequestHeader(s,n)}r>0&&(t.timeout=r,t.ontimeout=function(){t.abort(),e.onTimeout&&e.onTimeout(t)}),t.send(d)}function l(e,t){const o={code:-1,msg:"网络出错了",data:null};switch(e.statusCode){case f.requestTimeout:o.msg="网络超时了";break;case 200:o.code=w(e.data.code)==="number"?e.data.code:1,o.msg=e.data.message||"ok",o.data=e.data;break;case 400:o.msg="接口传参不正确";break;case 401:o.msg="登录已过期";break;case 404:o.msg="接口不存在";break}return e.statusCode>=500&&(o.msg="服务器闹脾气了"),o}function y(e,t,o,r={}){const{headers:u={},responseType:d="json",timeout:a,onProgress:i}=r;return new Promise(function(s){h({url:f.apiUrl+t,method:e,headers:{authorization:m.user.info.token,...u},responseType:d,data:o||{},timeout:a||f.requestTimeout,success(n,g){const c=l({statusCode:g.status,data:n});s(c)},fail(n){const g=w(n.response)==="string"?b(n.response):n.response,c=l({statusCode:n.status,data:g});c.code!==1&&p.error(c.msg),s(c)},onTimeout(){console.warn("XMLHttpRequest 请求超时 !!!");const n=l({statusCode:f.requestTimeout,data:{}});p.warning("网络请求超时！"),s(n)},onProgress:i})})}function T(e){let t="";return window.URL?t=window.URL.createObjectURL(e):window.webkitURL&&(t=window.webkitURL.createObjectURL(e)),t}function R(e){const t=e.get("file");return new Promise(function(o){setTimeout(function(){o({code:1,data:{url:T(t)},msg:"上传成功"})},500)})}function q(e){return y("GET","/free/day",{appid:"56761788",appsecret:"ti3hP8y9",city:encodeURIComponent(e)},{headers:{authorization:""}})}async function j(e){return new Promise(function(t){const o={id:Math.random().toString(36).substr(10),type:"",name:"",avatar:"",token:Math.random().toString(36).substr(2),account:e.account,password:e.password};setTimeout(()=>{switch(e.account){case"admin":o.type=0,o.name="超级管理员",o.avatar="https://p3-passport.byteacctimg.com/img/user-avatar/6332ece850859ade07f7e6a1394f7c34~300x300.image",m.user.update(o),t({code:1,msg:"ok",data:o});break;case"normal":o.type=1,o.name="普通成员",m.user.update(o),t({code:1,msg:"ok",data:o});break;default:t({code:-1,msg:"账户不存在",data:null});break}},600)})}export{q as g,j as l,R as u};
