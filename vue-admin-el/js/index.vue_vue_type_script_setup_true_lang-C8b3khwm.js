import{h as ae,s as z,i as ye,c as t,b as C,A as ge,F as R,o as Le,B as q,az as Ge,d as B,e as n,n as _e,u as V,l as j,m as F,f as o,t as le,y as se,aA as Se,O as we,D as ne,g as b,r as ie,w as he,j as Oe,T as Ze,L as Xe,K as Ye}from"./element-plus-Bi-D7rwj.js";import{a as Qe,S as et,F as Me}from"./index-Drdl1D8t.js";import{s as We,i as Ve,d as ve,f as ce,u as Ee,c as me,e as Ne,h as Ue,b as Te,j as te,k as Ce,a as pe,g as ue,l as Be,m as Ae,n as tt,p as lt}from"./index.vue_vue_type_style_index_0_lang-B8ClEU5U.js";import{k as ee,f as Ie,e as ot,l as re,i as Fe,u as $e,b as fe,n as qe,a as de,g as nt,c as je,p as at}from"./index-BbG1w_TF.js";import{_ as be}from"./index.vue_vue_type_style_index_0_lang-LU_EFORo.js";import{v as it,s as st}from"./dom-D4K-_gXQ.js";import{r as rt}from"./common-B2oSDqYI.js";function ut(m){return typeof m=="function"||Object.prototype.toString.call(m)==="[object Object]"&&!Ge(m)}function Je(m){const S=m.onAction||(()=>{});return t(R,null,[t(C("el-button"),{onClick:()=>S("exit")},{default:()=>[q("退 出")]}),t(C("el-button"),{type:"success",plain:!0,onClick:()=>S("copy")},{default:()=>[t("i",{class:"el-icon-document-copy el-icon--left"},null),q("复制JSON")]}),t(C("el-button"),{type:"primary",onClick:()=>S("complete")},{default:()=>[q("保 存")]})])}function De(m){const S=m.onClose||(()=>{}),e=m.onSubmit||(()=>{});return t(R,null,[t(C("el-button"),{onClick:S},{default:()=>[q("取 消")]}),t(C("el-button"),{type:"primary",loading:m.loading,disabled:m.disabledSubmit,onClick:e},{default:()=>[q("确 认")]})])}function ct(m){const S={};return m.imageWidth&&(S.width=`${m.imageWidth}px`),m.imageHeight&&(S.height=`${m.imageHeight}px`),S}function Pe(m){function S(){ot({urls:m.previewList?m.previewList:[m.src]})}return m.column.cellType==="image"?t(C("el-image"),{class:"the-table-image",style:ct(m.column),src:m.src,onClick:S,fit:"cover"},null):null}const dt=ae({props:{value:{type:[String,Function],default:""}},emits:["update:value"],setup(m,{emit:S}){const e=z({get(){return typeof m.value=="function"?"":m.value},set(u){S("update:value",u)}}),A="https://element.eleme.cn/#/zh-CN/component/icon";return()=>t("div",{class:"f-vertical w-full"},[t(C("el-input"),{modelValue:e.value,"onUpdate:modelValue":u=>e.value=u,placeholder:"请输入图标 class",class:"mgr-10",clearable:!0},null),t(C("el-button"),{type:"primary",link:!0},{default:()=>[t("a",{href:A,target:"_blank"},[q("去官网复制")])]})])}}),pt=ae({props:{config:{type:Object,required:!0},disabled:{type:Boolean}},emits:["change"],setup(m,{emit:S}){let e=[];const A="the-date-shortcut-selected";function u(){const f=document.querySelector(`.${A}`);f&&f.classList.remove(A);const d=m.config;if(["daterange","datetimerange"].includes(d.dateType)){const T=d.value;T&&new Date(T[0]).getTime()===new Date(T[1]).getTime()&&(d.value[1]=new Date(Ie(T[1],"Y-M-D 23:59:59")))}S("change")}function p(f){f.classList.add(A)}return Le(function(){const f=m.config;if(f.type==="date"){const d=`.${f.id} .el-picker-panel__sidebar`,T=document.querySelector(d);if(!T)return console.warn("找不到日期快捷面板节点！");e=Array.from(T.children),e.forEach(v=>{v.addEventListener("click",()=>p(v))});const h=f.shortcutIndex;ee(h,"number")&&h>=0&&p(e[h])}}),()=>t(R,null,[t(C("el-date-picker"),{modelValue:m.config.value,"onUpdate:modelValue":f=>m.config.value=f,placeholder:m.config.placeholder,type:m.config.dateType,format:m.config.formatShow,shortcuts:We[m.config.dateType],disabled:m.disabled,"popper-class":m.config.id.toString(),"range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",class:"the-curd-field",onChange:u},null)])}}),ft=ae({props:{config:{type:Object,required:!0},setting:{type:Object,required:!0},disabled:{type:Boolean}},emits:["change"],setup(m,{emit:S}){const e=z({get(){return m.config.value},set(d){m.config.value=d,S("change",d)}}),A=ye(""),u=z(()=>{const d=m.config.options||[],T=m.config.joinShow,h=A.value;return h?d.filter(v=>{var I,k;const J=((I=v[m.setting.label])==null?void 0:I.toString())||"",G=((k=v[m.setting.value])==null?void 0:k.toString())||"";return T?J.includes(h)||G.includes(h):J.includes(h)}):d});function p(){const d=m.config,T=d.type==="select-multiple";return{placeholder:d.placeholder,disabled:m.disabled,multiple:d.type==="select-multiple",clearable:!0,filterable:!0,collapseTags:!0,class:`field-item${T?" is-multiple-select":""}`,filterMethod(h){A.value=h}}}function f(d){const T=m.config,h=m.setting;return T.joinShow?`${d[h.label]}-${d[h.value]}`:`${d[h.label]}`}return()=>{let d;return t(R,null,[m.config.options.length>36?t(C("el-select-v2"),ge({modelValue:e.value,"onUpdate:modelValue":T=>e.value=T,options:u.value,props:m.setting},p()),{default:({item:T})=>t("span",{title:f(T)},[f(T)])}):t(C("el-select"),ge({modelValue:e.value,"onUpdate:modelValue":T=>e.value=T},p()),ut(d=u.value.map(T=>t(C("el-option"),{key:T[m.setting.value],value:T[m.setting.value],label:f(T)},null)))?d:{default:()=>[d]})])}}});function mt(){const m=Array.from({length:6}).map((S,e)=>({id:e}));return t("div",{class:"the-thumbnail-search flex"},[t("div",{class:"the-thumbnail-search-content f1"},[m.map(S=>t("div",{key:S.id,class:"the-thumbnail-search-item"},null))]),t("div",{class:"the-thumbnail-search-btn f-vertical"},[t("i",{class:"el-icon-search"},null)])])}function yt(){return t("section",{class:"the-thumbnail-table"},[t("svg",{width:280,height:180,viewBox:`0 0 ${280*1} ${180*1}`,fill:"none",xmlns:"http://www.w3.org/2000/svg","data-v-d2b0a988":"",class:"the-thumbnail-table-svg"},[t("rect",{width:280,height:180,fill:""},null),t("g",{filter:"url(#filter0_d_13550_224439)"},[t("path",{d:"M65 60C65 58.8954 65.8954 58 67 58H213C214.105 58 215 58.8954 215 60V132C215 133.105 214.105 134 213 134H67C65.8954 134 65 133.105 65 132V60Z",fill:"var(--el-fill-color-blank)"},null),t("path",{d:"M67 57.7C65.7297 57.7 64.7 58.7297 64.7 60V132C64.7 133.27 65.7297 134.3 67 134.3H213C214.27 134.3 215.3 133.27 215.3 132V60C215.3 58.7297 214.27 57.7 213 57.7H67Z",stroke:"var(--el-border-color-dark)","stroke-width":.6*1},null)]),[76,92,108,124].map((A,u)=>t("rect",{key:u,x:71*1,y:A*1,width:16*1,height:4*1,rx:2*1,fill:"var(--el-color-primary)"},null)),[107,143,197].map((A,u)=>[76,92,108,124].map((p,f)=>t("rect",{key:`${u}-${f}`,x:A*1,y:p*1,width:u===2?12*1:20*1,height:4*1,rx:2*1,fill:"var(--el-border-color-dark)"},null))),t("path",{d:"M65 60C65 58.8954 65.8954 58 67 58H213C214.105 58 215 58.8954 215 60V70H65V60Z",fill:"var(--el-border-color-light)"},null),[71,107,143,199].map(A=>t("rect",{key:A,x:A*1,y:63*1,width:10*1,height:2*1,rx:1*1,fill:"var(--el-border-color-dark)"},null)),[85.75,101.75,117.75].map((A,u)=>t("line",{key:u,x1:65*1,y1:A*1,x2:215*1,y2:A*1,stroke:"var(--el-border-color-light)","stroke-width":.5*1},null)),t("defs",null,[t("filter",{id:"filter0_d_13550_224439",x:"51.0666",y:"44.0671",width:177.867*1,height:103.866*1,filterUnits:"userSpaceOnUse","color-interpolation-filters":"sRGB"},[t("feFlood",{"flood-opacity":"0",result:"BackgroundImageFix"},null),t("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"},null),t("feOffset",null,null),t("feGaussianBlur",{stdDeviation:6.66667*1},null),t("feComposite",{in2:"hardAlpha",operator:"out"},null),t("feColorMatrix",{type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.05 0"},null),t("feBlend",{mode:"normal",in2:"BackgroundImageFix",result:"effect1_dropShadow_13550_224439"},null),t("feBlend",{mode:"normal",in:"SourceGraphic",in2:"effect1_dropShadow_13550_224439",result:"shape"},null)])])])])}const ht={name:"Field"},ke=ae({...ht,props:{fieldData:{type:Object,required:!0},editMode:Boolean,readonly:Boolean,disabled:Boolean},emits:["change"],setup(m,{emit:S}){const e=m,A=S;Ve(e.fieldData);function u(k){let s=k||e.fieldData.value;ee(s,"array")&&(s=re(s)),A("change",s)}const p=z(()=>e.fieldData),f=z(()=>{const k=e.fieldData.optionSetting||{};return{value:k.value||"value",label:k.label||"label"}}),d=z(()=>{const k=e.fieldData,s=k.optionSetting;return{multiple:k.multiple,checkStrictly:k.checkStrictly,value:s.value||"value",label:s.label||"label",children:s.children||"children"}});function T(k){const s=p.value.placeholder;return{disabled:e.disabled,readonly:e.readonly,clearable:!0,placeholder:ee(k,"number")?s[k]:s}}function h(k){const s=e.fieldData;s.valueType==="number"?(s.value=Fe(k,!0,!0),u(Number(s.value))):(s.value=k,u())}function v(k,s){const w=e.fieldData;w.valueType==="array<number>"?(w.value[s]=Fe(k,!0,!0),u(w.value.map(N=>Number(N)))):(w.value[s]=k,u())}const J=["-",".","",null,void 0];function G(){const k=e.fieldData;k.valueType==="number"&&(J.includes(k.value)?k.value="":k.value=Number(k.value))}function I(k){const s=e.fieldData;if(s.valueType==="array<number>"){const w=s.value[k];J.includes(w)?s.value[k]="":s.value[k]=Number(w)}}return(k,s)=>{const w=C("el-input"),N=C("el-text"),c=C("el-checkbox"),Z=C("el-checkbox-group"),X=C("el-radio"),Y=C("el-radio-group"),oe=C("el-switch"),P=C("el-cascader");return n(),B("div",{class:"the-curd-form-field f-vertical short-value",style:_e({width:V(ve)(p.value.valueWidth)})},[p.value.type==="input"?(n(),j(w,ge({key:0,"model-value":p.value.value},T(),{class:"the-curd-field",onInput:h,onBlur:G}),null,16,["model-value"])):F("",!0),p.value.type==="textarea"?(n(),j(w,{key:1,modelValue:p.value.value,"onUpdate:modelValue":s[0]||(s[0]=M=>p.value.value=M),readonly:e.readonly,disabled:e.disabled,placeholder:p.value.placeholder,type:"textarea",class:"the-curd-field",onInput:s[1]||(s[1]=M=>u())},null,8,["modelValue","readonly","disabled","placeholder"])):F("",!0),p.value.type==="input-between"?(n(),B(R,{key:2},[t(w,ge({"model-value":p.value.value[0]},T(0),{class:"f1",onInput:s[2]||(s[2]=M=>v(M,0)),onBlur:s[3]||(s[3]=M=>I(0))}),null,16,["model-value"]),t(N,{style:{padding:"0 6px"}},{default:o(()=>[q(le(p.value.separator),1)]),_:1}),t(w,ge({"model-value":p.value.value[1]},T(1),{class:"f1",onInput:s[4]||(s[4]=M=>v(M,1)),onBlur:s[5]||(s[5]=M=>I(1))}),null,16,["model-value"])],64)):F("",!0),p.value.type==="select"||p.value.type==="select-multiple"?(n(),j(V(ft),{key:3,config:p.value,setting:f.value,disabled:e.disabled,onChange:s[6]||(s[6]=M=>u())},null,8,["config","setting","disabled"])):F("",!0),p.value.type==="checkbox"?(n(),B(R,{key:4},[t(Z,{modelValue:p.value.value,"onUpdate:modelValue":s[7]||(s[7]=M=>p.value.value=M),disabled:e.disabled,onChange:s[8]||(s[8]=M=>u())},{default:o(()=>[(n(!0),B(R,null,se(p.value.options,M=>(n(),j(c,{key:M[f.value.value],value:M[f.value.value]},{default:o(()=>[q(le(M[f.value.label]),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue","disabled"]),e.editMode&&!p.value.options.length?(n(),j(N,{key:0,type:"primary"},{default:o(()=>[q(le(V(ce).checkbox)+"（空数据） ",1)]),_:1})):F("",!0)],64)):F("",!0),p.value.type==="radio"?(n(),B(R,{key:5},[t(Y,{modelValue:p.value.value,"onUpdate:modelValue":s[9]||(s[9]=M=>p.value.value=M),disabled:e.disabled,onChange:s[10]||(s[10]=M=>u())},{default:o(()=>[(n(!0),B(R,null,se(p.value.options,M=>(n(),j(X,{key:M[f.value.value],value:M[f.value.value]},{default:o(()=>[q(le(M[f.value.label]),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue","disabled"]),e.editMode&&!p.value.options.length?(n(),j(N,{key:0,type:"primary"},{default:o(()=>[q(le(V(ce).radio)+"（空数据） ",1)]),_:1})):F("",!0)],64)):F("",!0),p.value.type==="switch"?(n(),j(oe,{key:6,modelValue:p.value.value,"onUpdate:modelValue":s[11]||(s[11]=M=>p.value.value=M),"inline-prompt":"","active-text":"是","inactive-text":"否",onChange:s[12]||(s[12]=M=>u())},null,8,["modelValue"])):F("",!0),p.value.type==="cascader"?(n(),j(P,{key:7,modelValue:p.value.value,"onUpdate:modelValue":s[13]||(s[13]=M=>p.value.value=M),options:p.value.options,props:d.value,placeholder:p.value.placeholder,disabled:e.disabled,clearable:"","collapse-tags":"","collapse-tags-tooltip":"",filterable:"",class:"the-curd-field",onChange:s[14]||(s[14]=M=>u())},null,8,["modelValue","options","props","placeholder","disabled"])):F("",!0),e.fieldData.type==="date"?(n(),j(V(pt),{key:8,config:e.fieldData,disabled:e.disabled,onChange:s[15]||(s[15]=M=>u())},null,8,["config","disabled"])):F("",!0)],4)}}}),gt={key:0,class:"el-icon-rank el-icon--left"},bt={style:{"line-height":"1"}},vt={key:0,class:"the-curd-edit-mask f-vertical f-right"},_t=b("i",{class:"el-icon-delete el-icon--left"},null,-1),kt=b("i",{class:"el-icon-edit el-icon--left"},null,-1),wt=b("i",{class:"el-icon-plus"},null,-1),$t={name:"Search"},xt=ae({...$t,props:{data:{type:Object,required:!0}},emits:["search"],setup(m,{emit:S}){const e=m,A=S,u=Ee(),p=z(()=>u.editor.type==="search"&&!u.editor.show);function f(I){const k=e.data.list[I].label||e.data.list[I].key;fe({title:"操作提示",content:`是否删除【${k}】？`,cancelText:"取消",confirm(){e.data.list.splice(I,1)}})}function d(I){u.editor.index=I,u.editor.action="edit",u.editor.show=!0}function T(I){return u.editor.index===I&&u.editor.type==="search"&&u.editor.show}function h(){u.editor.index=-1,u.editor.action="add",u.editor.show=!0}const{onDragStart:v,onDragMove:J,onDropEnd:G}=$e({list:()=>e.data.list,key:"id",findLevel:5});return(I,k)=>{const s=C("el-button"),w=C("el-text");return n(),j(V(Qe),{class:"the-curd-search","label-right":e.data.labelRight,"label-width":V(ve)(e.data.labelWidth)||"auto"},Se({content:o(()=>[t(we,{name:"the-group",tag:"div",class:"the-filter-content f1"},{default:o(()=>[(n(!0),B(R,null,se(e.data.list,(N,c)=>(n(),j(V(Me),{key:N.id,"data-key":N.id,class:ne([{"the-curd-selected":T(c)},N.id]),label:N.label,"label-width":V(ve)(N.labelWidth),required:N.required,draggable:p.value,onDragstart:Z=>V(v)(c),onDragover:Z=>V(J)(Z,c),onDrop:k[0]||(k[0]=Z=>V(G)())},Se({default:o(()=>[t(ke,{"field-data":N,disabled:V(u).loading},null,8,["field-data","disabled"]),p.value?(n(),B("div",vt,[t(s,{link:"",type:"danger",onClick:Z=>f(c)},{default:o(()=>[_t,q(" 删除 ")]),_:2},1032,["onClick"]),t(s,{link:"",type:"success",onClick:Z=>d(c)},{default:o(()=>[kt,q(" 编辑 ")]),_:2},1032,["onClick"])])):F("",!0)]),_:2},[V(u).editor.type==="search"?{name:"label",fn:o(()=>[p.value?(n(),B("i",gt)):F("",!0),b("span",bt,le(N.label),1)]),key:"0"}:void 0]),1032,["data-key","class","label","label-width","required","draggable","onDragstart","onDragover"]))),128)),p.value?(n(),j(V(Me),{key:0},{default:o(()=>[e.data.list.length?F("",!0):(n(),j(w,{key:0,type:"info",style:{"margin-right":"12px"}},{default:o(()=>[q(" 请添加筛选条件~ ")]),_:1})),t(s,{type:"primary",circle:"",onClick:k[1]||(k[1]=N=>h())},{default:o(()=>[wt]),_:1})]),_:1})):F("",!0)]),_:1})]),_:2},[V(u).editor.type?void 0:{name:"right",fn:o(()=>[t(V(et),{loading:V(u).loading,onSearch:k[2]||(k[2]=N=>A("search",N))},null,8,["loading"])]),key:"0"}]),1032,["label-right","label-width"])}}}),Dt={class:"w-full f-vertical mgb-10"},Ct=b("div",{class:"f1"},null,-1),St=b("i",{class:"el-icon--left el-icon-delete"},null,-1),Tt=b("i",{class:"el-icon--left el-icon-plus"},null,-1),Vt=b("i",{class:"el-icon--left el-icon-download"},null,-1),Et=b("i",{class:"el-icon--left el-icon-setting"},null,-1),Ot={class:"f-vertical f-between mgb-10"},Mt=b("i",{class:"el-icon--left el-icon-refresh-left"},null,-1),Nt={key:0,class:"el-icon--left el-icon-rank"},Bt={class:"f1"},At={name:"TableOperation"},Re=ae({...At,props:{config:{type:Object,required:!0},editMode:{type:Boolean},disabled:{type:Boolean}},emits:["action"],setup(m,{emit:S}){const e=m,A=S;function u(w){A("action",w)}const p={on:"el-icon-success",off:"el-icon-remove-outline"},f=z(()=>{const w=e.config;return{add:w.formAdd&&w.formAdd.fields.length>0,edit:w.formEdit&&w.formEdit.fields.length>0,delete:!!w.selectKey}}),d=z(()=>{const w=f.value.delete,N=f.value.add,c=f.value.edit;return[{type:"delete",text:w?"修改删除":"配置删除",icon:w?p.on:p.off,style:w?"primary":"info"},{type:"add",text:N?"修改新增表单":"配置新增表单",icon:N?p.on:p.off,style:N?"primary":"info"},{type:"edit",text:c?"修改编辑表单":"配置编辑表单",icon:c?p.on:p.off,style:c?"primary":"info"}]}),T=[{label:"固定左边",value:"left"},{label:"默认",value:!1},{label:"固定右边",value:"right"}],{onDragStart:h,onDragMove:v,onDropEnd:J}=$e({list:()=>e.config.columns,key:"prop"});function G(w,N){const c=w.prop===me,Z=w.prop;return{"data-key":Z,key:Z,draggable:c?void 0:!0,title:c?"操作栏不可排序，只能显示隐藏操作":void 0,onDragstart:c?void 0:()=>h(N),onDragover:c?void 0:X=>v(X,N),onDrop:c?void 0:J}}const I=ie({showFixed:!1});let k=[];function s(){e.config.columns=k}return he(()=>e.config.columns,function(w){e.editMode||(k=re(w))},{immediate:!0}),(w,N)=>{const c=C("el-button"),Z=C("el-checkbox"),X=C("el-radio-button"),Y=C("el-radio-group"),oe=C("el-switch"),P=C("el-empty"),M=C("el-popover");return n(),B("div",Dt,[e.editMode?(n(!0),B(R,{key:0},se(d.value,O=>(n(),j(c,{key:O.type,type:O.style,link:"",onClick:D=>u(O.type)},{default:o(()=>[b("i",{class:ne(["el-icon--left",O.icon])},null,2),q(" "+le(O.text),1)]),_:2},1032,["type","onClick"]))),128)):F("",!0),Oe(w.$slots,"left"),e.editMode?F("",!0):(n(),B(R,{key:1},[Ct,Oe(w.$slots,"right"),f.value.delete?(n(),j(c,{key:0,type:"danger",link:"",disabled:e.disabled,onClick:N[0]||(N[0]=O=>u("delete"))},{default:o(()=>[St,q(" 删除 ")]),_:1},8,["disabled"])):F("",!0),f.value.add?(n(),j(c,{key:1,type:"primary",link:"",disabled:e.disabled,onClick:N[1]||(N[1]=O=>u("add"))},{default:o(()=>[Tt,q(" 新增 ")]),_:1},8,["disabled"])):F("",!0),t(c,{type:"primary",link:"",disabled:e.disabled,onClick:N[2]||(N[2]=O=>u("export"))},{default:o(()=>[Vt,q(" 导出 ")]),_:1},8,["disabled"]),t(M,{placement:"bottom-start",width:I.showFixed?500:300,transition:"el-zoom-in-top",trigger:"click"},{reference:o(()=>[t(c,{type:"primary",link:"",disabled:e.disabled},{default:o(()=>[Et,q(" 表格列设置 ")]),_:1},8,["disabled"])]),default:o(()=>[b("div",Ot,[t(Z,{modelValue:I.showFixed,"onUpdate:modelValue":N[3]||(N[3]=O=>I.showFixed=O),label:"配置固定列"},null,8,["modelValue"]),t(c,{type:"primary",link:"",onClick:N[4]||(N[4]=O=>s())},{default:o(()=>[Mt,q(" 重置 ")]),_:1})]),t(we,{name:"the-group",tag:"div",class:"the-curd-setting-list the-curd-scrollbar"},{default:o(()=>[(n(!0),B(R,null,se(e.config.columns,(O,D)=>(n(),B("div",ge({class:"the-curd-option-item f-vertical"},G(O,D)),[O.prop!==V(me)?(n(),B("i",Nt)):F("",!0),b("span",Bt,le(O.title),1),I.showFixed?(n(),j(Y,{key:1,modelValue:O.fixed,"onUpdate:modelValue":l=>O.fixed=l,size:"small",class:"mgr-10"},{default:o(()=>[(n(),B(R,null,se(T,l=>t(X,{key:l.value.toString(),value:l.value},{default:o(()=>[q(le(l.label),1)]),_:2},1032,["value"])),64))]),_:2},1032,["modelValue","onUpdate:modelValue"])):F("",!0),t(oe,{modelValue:O.visible,"onUpdate:modelValue":l=>O.visible=l,"inline-prompt":"","active-text":"显示","inactive-text":"隐藏"},null,8,["modelValue","onUpdate:modelValue"])],16))),256)),e.config.columns.length?F("",!0):(n(),j(P,{key:"empty","image-size":120,description:"暂无可以设置的表格列"}))]),_:1})]),_:1},8,["width"])],64))])}}}),Ft={key:0,class:"el-icon-rank el-icon--left",style:{"line-height":"32px"}},qt={class:"f-vertical w-full"},jt=b("i",{class:"el-icon-edit"},null,-1),Lt=b("i",{class:"el-icon-delete"},null,-1),Wt=b("i",{class:"el-icon--left el-icon-plus"},null,-1),Ut=b("i",{class:"el-icon--left el-icon-plus"},null,-1),It={key:"bottom-setting"},Jt=b("i",{class:"el-icon--left el-icon-delete"},null,-1),Pt=b("i",{class:"el-icon--left el-icon-check"},null,-1),Rt={name:"TableForm"},He=ae({...Rt,props:{config:{type:Object,default:()=>Ne()},type:{type:String},editMode:{type:Boolean},disabled:{type:Boolean}},emits:["change"],setup(m,{expose:S,emit:e}){const A=m,u=e,p=ye(),f=Ne(),d=ie({config:f,form:{},rules:{}}),T=Ee(),h=z(()=>A.type==="add"?"新增":"编辑"),v=z(()=>T.editor.show);function J(O){N(),T.editor.action=O>=0?"edit":"add",T.editor.form=d.config,T.editor.index=O,T.editor.show=!0}function G(O){const D=d.config.fields;N(),fe({title:"操作提示",content:`是否删除【${D[O].label}】？`,cancelText:"取消",confirm(){D.splice(O,1)}})}function I(){fe({title:"操作提示",content:`是否移除【${h.value}】表单？移除后将不会出现对应功能按钮。`,cancelText:"取消",confirm(){d.config.fields=[]}})}function k(){u("change")}function s(){const O=A.type==="add"?"编辑":"新增";fe({title:"操作提示",content:`是否将表单数据同步到【${O}】表单？`,cancelText:"不同步",confirmText:"同步",cancel(){u("change",d.config)},confirm(){u("change",d.config,!0)}})}function w(O){var D;(D=p.value)==null||D.validate(l=>{if(l&&O){const a=P.value,E={};M.value.forEach(r=>{E[r.key]=a[r.key]}),O(a,E)}})}function N(){var O;(O=p.value)==null||O.clearValidate()}function c(){d.config.fields.forEach(Ve)}function Z(O){d.config.fields.forEach(D=>{if(Object.prototype.hasOwnProperty.call(O,D.key)){const l=O[D.key];if(!l)return;switch(D.type){case"date":ee(l,"array")?D.value=l.map(a=>new Date(a)):D.value=new Date(l);break;default:D.value=l;break}}})}const{onDragStart:X,onDragMove:Y,onDropEnd:oe}=$e({list:()=>d.config.fields,key:"id",findLevel:10});he(()=>A.config,function(O){O&&(d.config=re(O))},{immediate:!0}),he(()=>d.config.fields,function(O){const D={},l={},a=["input","input-between","textarea"];O&&O.forEach(E=>{D[E.key]=E.value,E.required&&(l[E.key]=[{required:!0,validator(r,y,W){const _=[void 0,null,""];if(E.type==="input-between"&&!E.value[0]&&!E.value[1]){W(new Error("请输入两个范围字段"));return}if(E.valueType==="array"&&!E.value.length){W(new Error(E.placeholder||"请选择"));return}if(E.valueType!=="boolean"&&_.includes(E.value)){const U=a.includes(E.type)?"请输入内容":"请选择";W(new Error(E.placeholder||U));return}W()},trigger:a.includes(E.type)?"blur":"change"}])}),d.form=D,d.rules=l,setTimeout(N)},{immediate:!0});const P=z(()=>{const O={};return d.config.fields.forEach(D=>{O[D.key]=Ue(D).value}),O}),M=z(()=>d.config.fields.filter(O=>{const D=O.show;if(!D)return!0;if(ee(D,"function"))return D(P.value);if(D.includes("return"))try{return new Function("formData",D)(P.value)}catch(l){console.warn("解析表单展示逻辑代码错误 >>",l)}return!0}));return S({clear:N,validate:w,reset:c,setFormData:Z}),(O,D)=>{const l=C("el-button"),a=C("el-form-item"),E=C("el-empty"),r=C("el-form");return n(),j(r,{ref_key:"formRef",ref:p,model:d.form,rules:d.rules,labelWidth:V(ve)(d.config.labelWidth),labelPosition:d.config.labelPosition,disabled:A.disabled,style:_e(A.editMode?{width:V(ve)(d.config.width)}:null),class:ne([{"is-edit-form":A.editMode}])},{default:o(()=>[A.editMode?(n(),B(R,{key:0},[t(we,{name:"the-group",tag:"div"},{default:o(()=>[(n(!0),B(R,null,se(d.config.fields,(y,W)=>(n(),j(a,{class:ne([{"the-curd-selected":V(T).editor.index===W&&v.value}]),prop:y.key,key:y.id,"data-key":y.id,draggable:d.config.fields.length>1&&!V(T).editor.show?!0:null,onDragstart:_=>V(X)(W),onDragover:_=>V(Y)(_,W),onDrop:V(oe)},{label:o(()=>[d.config.fields.length>1&&!V(T).editor.show?(n(),B("i",Ft)):F("",!0),b("span",null,le(y.label),1)]),default:o(()=>[b("div",qt,[t(ke,{class:"mgr-10",fieldData:y,editMode:""},null,8,["fieldData"]),t(l,{link:"",type:"success",disabled:v.value,onClick:_=>J(W)},{default:o(()=>[jt]),_:2},1032,["disabled","onClick"]),t(l,{link:"",type:"danger",disabled:v.value,onClick:_=>G(W)},{default:o(()=>[Lt]),_:2},1032,["disabled","onClick"])])]),_:2},1032,["class","prop","data-key","draggable","onDragstart","onDragover","onDrop"]))),128))]),_:1}),d.config.fields.length?F("",!0):(n(),j(E,{key:0,description:`当前没有表单项，当没有表单项时【${h.value}】功能按钮不会出现~`},{default:o(()=>[v.value?F("",!0):(n(),j(l,{key:0,type:"primary",onClick:D[0]||(D[0]=y=>J(-1))},{default:o(()=>[Wt,q(" 添加表单项 ")]),_:1}))]),_:1},8,["description"])),v.value?F("",!0):(n(),B(R,{key:1},[d.config.fields.length?(n(),j(a,{key:"bottom-add"},{default:o(()=>[t(l,{type:"primary",onClick:D[1]||(D[1]=y=>J(-1))},{default:o(()=>[Ut,q(" 继续添加 ")]),_:1})]),_:1})):F("",!0),b("div",It,[t(l,{link:"",onClick:D[2]||(D[2]=y=>k())},{default:o(()=>[q(" 退出编辑 ")]),_:1}),t(l,{type:"danger",link:"",disabled:!d.config.fields.length,onClick:D[3]||(D[3]=y=>I())},{default:o(()=>[Jt,q(" 清空表单 ")]),_:1},8,["disabled"]),t(l,{type:"success",link:"",onClick:D[4]||(D[4]=y=>s())},{default:o(()=>[Pt,q(" 保存表单 ")]),_:1})])],64))],64)):F("",!0),!A.editMode&&d.config&&d.config.fields?(n(!0),B(R,{key:1},se(M.value,y=>(n(),j(a,{label:y.label,prop:y.key,key:y.id},{default:o(()=>[t(ke,{fieldData:y},null,8,["fieldData"])]),_:2},1032,["label","prop"]))),128)):F("",!0)]),_:1},8,["model","rules","labelWidth","labelPosition","disabled","style","class"])}}}),Ht={key:1,class:"the-curd-table-header f-vertical w-full"},zt={class:"the-curd-table-header-title"},Kt={key:1,class:"the-curd-table-header-title"},Gt={key:2,style:{"padding-left":"6px"}},Zt={name:"TableHeader"},ze=ae({...Zt,props:{column:{type:Object,required:!0}},emits:["sort"],setup(m,{emit:S}){const e=m,A=S,u=z(()=>!e.column.sort&&!e.column.iconTips);function p(f){e.column.sort===f&&(f=!0),A("sort",e.column.prop,f)}return(f,d)=>{const T=C("el-tooltip");return u.value?(n(),B(R,{key:0},[q(le(e.column.title),1)],64)):(n(),B("div",Ht,[e.column.iconTips?(n(),j(T,{key:0,effect:"dark",content:e.column.iconTips,placement:"top"},{default:o(()=>[b("span",zt,le(e.column.title),1)]),_:1},8,["content"])):(n(),B("span",Kt,le(e.column.title),1)),e.column.sort?(n(),B("div",Gt,[b("div",{class:ne(["the-sort-icon top",{"is-select":e.column.sort==="asc"}]),onClick:d[0]||(d[0]=h=>p("asc"))},null,2),b("div",{class:ne(["the-sort-icon bottom",{"is-select":e.column.sort==="desc"}]),onClick:d[1]||(d[1]=h=>p("desc"))},null,2)])):F("",!0)]))}}}),Xt={name:"TableColumnConfig"},Yt=ae({...Xt,props:{show:{type:Boolean,required:!0},type:{type:String,required:!0},keys:{type:Array,required:!0},form:Object},emits:["update:show","submit"],setup(m,{emit:S}){const e=m,A=S,u=ie({show:!1,form:Te("","")}),p=z(()=>({add:"新增",edit:"编辑",copy:"复制"})[e.type]+"表格列"),f=ye(),d={title:{required:!0,message:"请输入表格列标题",trigger:"blur"},prop:{required:!0,validator(k,s,w){s?e.keys.includes(u.form.prop)?w(new Error("已经存在相同的值！")):w():w(new Error("输入字段不能为空！"))},trigger:"blur"},cellType:{required:!0,message:"请选择展示类型",trigger:"change"},sort:{required:!0,message:"请选择排序操作",trigger:"change"},jsCode:{required:!0,validator(k,s,w){s?s.includes("return")?w():w(new Error('代码片段必须带有返回字段 "return"')):w(new Error("代码片段不能为空！"))},trigger:"blur"}},T=[{label:"默认普通文本",value:"text"},{label:"图片预览组件",value:"image"},{label:"自定义 js 代码",value:"js"}],h=[{label:"不可排序",value:!1},{label:"可排序",value:!0},{label:"默认升序",value:"asc"},{label:"默认降序",value:"desc"}],v=`
<p>函数代码片段：</p>
<p>第一个参数${te("cellValue")}是表格值;</p>
<p>第二个参数${te("row")}是完整对象;</p>
<p>例如：${te("return cellValue + row.id;")};</p>
<p>也可以是HTML：${te("return `html 标签`")};</p>
`,J=[{label:"表格列标题",prop:"title",type:"input",placeholder:d.title.message},{label:"表格列键值",prop:"prop",type:"input",placeholder:"请输入表格列键值"},{label:"表格列宽度",prop:"width",type:"number",placeholder:"请输入表格列宽度，例如：120（默认自适应）"},{label:"表格列最小宽度",prop:"minWidth",type:"number",placeholder:"请输入表格列最小宽度，例如：120（默认自适应）"},{label:"表格列展示类型",prop:"cellType",type:"select",options:T},{label:"图片宽度",prop:"imageWidth",type:"number",placeholder:"请输入数字（默认80px）",show:()=>u.form.cellType==="image"},{label:"图片高度",prop:"imageHeight",type:"number",placeholder:"请输入数字（默认80px）",show:()=>u.form.cellType==="image"},{label:"js代码",prop:"jsCode",type:"textarea",placeholder:"请输入代码片段",tooltip:v,tips:'例如：return `<span class="the-tag blue">${cellValue || "-"}<span>`;',show:()=>u.form.cellType==="js"},{label:"表格列排序操作",prop:"sort",type:"select",options:h},{label:"表格列排版",prop:"align",type:"select",options:[{label:"靠左对齐(默认)",value:"left"},{label:"居中对齐",value:"center"},{label:"靠右对齐",value:"right"}]},{label:"表头提示文字",prop:"iconTips",type:"input",placeholder:"请输入提示文字",tooltip:"鼠标放到表格头时出现提示文案"},{label:"内容溢出截断",prop:"tooltip",type:"switch"},{label:"表格列默认展示",prop:"visible",type:"switch",inactiveText:"隐藏",activeText:"显示"}];function G(){A("update:show",!1)}function I(){var k;(k=f.value)==null||k.validate(s=>{if(!s)return;const w=re(u.form);["width","minWidth","imageWidth","imageHeight"].forEach(c=>{w[c]&&(w[c]=Number(w[c]))}),w.cellType==="image"&&(w.slot=w.prop),(w.sort||w.iconTips)&&(w.slotHead=`header-${w.prop}`),A("submit",w),G()})}return he(()=>e.show,function(k){u.show=k,k&&(e.type==="add"?u.form=Te("",""):(u.form=re(e.form),e.type==="copy"&&(u.form.prop="")),setTimeout(()=>{var s;return(s=f.value)==null?void 0:s.clearValidate()}))},{immediate:!0}),(k,s)=>{const w=C("el-form"),N=C("base-dialog");return n(),j(N,{show:u.show,"onUpdate:show":s[0]||(s[0]=c=>u.show=c),title:p.value,width:"580px",onClose:G},{footer:o(()=>[t(V(De),{onClose:G,onSubmit:I})]),default:o(()=>[t(w,{ref_key:"formRef",ref:f,model:u.form,rules:d,"label-position":"right","label-width":"130px"},{default:o(()=>[t(V(be),{data:u.form,list:J},null,8,["data"])]),_:1},8,["model"])]),_:1},8,["show","title"])}}}),Qt=b("p",{class:"mgb-10"},"表格数据中的字段，例如表格数：",-1),el=b("p",{class:"mgb-10"},"则键值可以为 id",-1),tl=b("p",null,[b("i",{class:"el-icon-info el-icon--left"}),q(" 不填则没有删除功能 ")],-1),ll={name:"TableDeleteConfig"},ol=ae({...ll,props:{show:{type:Boolean,default:!1},selectKey:{type:String,default:""}},emits:["update:show","submit"],setup(m,{emit:S}){const e=m,A=S,u='[{ id: 1, name: "名称", status: 2 }]',p=ie({show:!1,keyword:""});function f(){A("update:show",!1)}function d(){f(),A("submit",p.keyword)}return he(()=>e.show,function(T){p.show=T,T&&(p.keyword=e.selectKey||"")},{immediate:!0}),(T,h)=>{const v=C("el-input"),J=C("el-form-item"),G=C("el-form"),I=C("base-dialog");return n(),j(I,{show:p.show,"onUpdate:show":h[1]||(h[1]=k=>p.show=k),title:"配置表格删除功能",width:"400px",onClose:f},{footer:o(()=>[t(V(De),{onClose:f,onSubmit:d})]),default:o(()=>[t(G,{labelPosition:"right",labelWidth:"120px"},{default:o(()=>[t(J,{label:"数据键值"},{default:o(()=>[t(v,{class:"mgb-10",modelValue:p.keyword,"onUpdate:modelValue":h[0]||(h[0]=k=>p.keyword=k),placeholder:"请输入数据键值",clearable:""},null,8,["modelValue"]),b("div",{class:"the-tag blue"},[Qt,b("p",{class:"mgb-10"},le(u)),el,tl])]),_:1})]),_:1})]),_:1},8,["show"])}}}),nl={class:"flex"},al={class:"f1"},il={class:"f-right w-full"},sl=b("i",{class:"el-icon--left el-icon-finished"},null,-1),rl=b("i",{class:"el-icon--left el-icon-plus"},null,-1),ul=["data-key","draggable","onDragstart","onDragover"],cl={key:0,class:"el-icon--left el-icon-rank"},dl=b("div",{class:"f1"},null,-1),pl=b("i",{class:"el-icon-delete"},null,-1),fl=b("i",{class:"el-icon-edit"},null,-1),ml={key:1,class:"w-full f-right"},yl=b("i",{class:"el-icon--left el-icon-plus"},null,-1),hl={name:"TableActionConfig"},gl=ae({...hl,props:{show:{type:Boolean,default:!1},list:{type:Array,required:!0},columnWidth:{type:Number},actionMax:{type:Number}},emits:["update:show","submit"],setup(m,{emit:S}){const e=m,A=S,u=`
<p>可以输入代码片段，</p>
<p>以${te("return")}关键字为函数标记，</p>
<p>函数第一个参数${te("row")}是表格对象值</p>
<p>例如：${te('return row.status === 1 ? "下架" : "上架";')}</p>
`,p=`
<p>函数代码片段，点击的时候运行</p>
<p>函数第一个参数${te("row")}是表格对象值</p>
<p>第二个参数${te("index")}是当前索引</p>
<p>例如：${te("console.log(row, index);")}</p>
`,f=`
<p>可以输入代码片段，</p>
<p>以${te("return")}关键字为函数标记，</p>
<p>函数第一个参数${te("row")}是表格对象值</p>
<p>例如：${te("return row.status === 1;")}返回布尔值进行判断</p>
`,d=ye(),T=ye(),h=ie({show:!1,list:[],index:-1,hasEdit:!1,formEdit:!1}),v=ie({btn:Ce(),column:{width:160,max:3}}),J={width:{required:!0,message:"请输入表格列宽度，例如：160",trigger:"blur"},max:{required:!1,message:"请输入数量，超出用“更多”下拉展示",trigger:"blur"}},G=[{label:"操作列宽度",prop:"width",type:"number",placeholder:J.width.message},{label:"操作按钮限制",prop:"max",type:"number",min:2,placeholder:J.max.message}],I={text:{required:!0,message:"请输入按钮文字",trigger:"blur"},click:{required:!0,message:"请输入按钮操作代码",trigger:"blur"},icon:{required:!1,message:"请输入图标 class",trigger:"blur"},type:{required:!1,message:"请选择按钮类型",trigger:"change"}},k=[{label:"按钮文字",prop:"text",type:"textarea",placeholder:I.text.message,tooltip:u},{label:"按钮功能代码",prop:"click",type:"textarea",placeholder:"请输入代码片段",tooltip:p},{label:"按钮显示条件",prop:"show",type:"textarea",placeholder:"请输入条件代码，为空则默认显示",tooltip:f},{label:"按钮禁用条件",prop:"disabled",type:"textarea",placeholder:"请输入条件代码，为空则默认不禁用",tooltip:f},{label:"按钮图标",prop:"icon",type:"slot",slotName:"iconInput"},{label:"按钮类型",prop:"type",type:"select",options:[{label:"默认（蓝色）",value:"primary"},{label:"成功（绿色）",value:"success"},{label:"警告（橙色）",value:"warning"},{label:"危险（红色）",value:"danger"},{label:"文本（灰色）",value:"info"}]}];function s(){A("update:show",!1)}function w(){T.value.validate(D=>{if(!D)return;s();const{width:l,max:a}=v.column;A("submit",re(h.list),l,a)})}function N(D){d.value.validate(l=>{if(!l)return;const a=re(v.btn);D==="add"?h.list.push(a):h.list[h.index]=v.btn,c()})}function c(){h.index=-1,v.btn=Ce(),h.formEdit=!1,setTimeout(()=>{var D;return(D=d.value)==null?void 0:D.clearValidate()})}function Z(D){const l=h.list[D];v.btn=JSON.parse(JSON.stringify(l)),h.index=D,h.formEdit=!0}function X(D){h.list.splice(D,1)}he(()=>e.show,function(D){h.show=D,D&&(h.list=re(e.list),h.hasEdit=h.list.some(l=>l.key===pe),h.index=-1,v.btn=Ce(),v.column={width:e.columnWidth,max:e.actionMax},setTimeout(()=>{var l,a;(l=d.value)==null||l.clearValidate(),(a=T.value)==null||a.clearValidate()}))},{immediate:!0});const{onDragStart:Y,onDragMove:oe,onDropEnd:P}=$e({list:()=>h.list,key:"key"});function M(D){if(D.key!=pe&&h.list.length>1&&h.index===-1)return!0}function O(D){const l=D.text;if(ee(l,"string")){if(!l.includes("return"))return l;let a="文字配置有误";try{a=new Function("row",l)({})}catch(E){console.warn("解析按钮文字代码错误 >>",E)}return a}return ee(l,"function")?l({}):"未设置按钮"}return(D,l)=>{const a=C("el-text"),E=C("el-divider"),r=C("el-form"),y=C("el-button"),W=C("el-form-item"),_=C("el-popconfirm"),U=C("el-empty"),$=C("base-dialog");return n(),j($,{show:h.show,"onUpdate:show":l[6]||(l[6]=i=>h.show=i),title:"配置操作列按钮功能",width:"880px",onClose:s},{footer:o(()=>[t(V(De),{disabledSubmit:h.formEdit,onClose:s,onSubmit:w},null,8,["disabledSubmit"])]),default:o(()=>[b("div",nl,[b("section",al,[t(E,{"content-position":"left","border-style":"dashed"},{default:o(()=>[t(a,{type:"info"},{default:o(()=>[q("操作列配置")]),_:1})]),_:1}),t(r,{ref_key:"formColumn",ref:T,model:v.column,rules:J,labelPosition:"right",labelWidth:"128px"},{default:o(()=>[t(V(be),{data:v.column,list:G},null,8,["data"])]),_:1},8,["model"]),t(E,{"content-position":"left","border-style":"dashed"},{default:o(()=>[t(a,{type:"info"},{default:o(()=>[q("操作按钮配置")]),_:1})]),_:1}),t(r,{ref_key:"formBtn",ref:d,model:v.btn,rules:I,labelPosition:"right",labelWidth:"128px",class:ne({"the-filter-mask":!h.formEdit}),"data-tips":"待新增或编辑操作"},{default:o(()=>[t(V(be),{data:v.btn,list:k},{iconInput:o(()=>[t(V(dt),{value:v.btn.icon,"onUpdate:value":l[0]||(l[0]=i=>v.btn.icon=i)},null,8,["value"])]),_:1},8,["data"]),t(W,null,{default:o(()=>[b("div",il,[t(y,{onClick:l[1]||(l[1]=i=>c())},{default:o(()=>[q("取 消")]),_:1}),h.index>-1?(n(),j(y,{key:0,type:"primary",plain:"",onClick:l[2]||(l[2]=i=>N("edit"))},{default:o(()=>[sl,q(" 确认修改 ")]),_:1})):(n(),j(y,{key:1,type:"primary",plain:"",onClick:l[3]||(l[3]=i=>N("add"))},{default:o(()=>[rl,q(" 确认新增 ")]),_:1}))])]),_:1})]),_:1},8,["model","class"])]),t(we,{name:"the-group",tag:"div",class:"the-curd-option-list f1"},{default:o(()=>[(n(!0),B(R,null,se(h.list,(i,g)=>(n(),B("div",{class:ne(["the-curd-option-item f-vertical",{"the-curd-selected":g===h.index}]),key:i.key,"data-key":i.key!==V(pe)?i.key:null,draggable:M(i),onDragstart:x=>V(Y)(g),onDragover:x=>V(oe)(x,g),onDrop:l[4]||(l[4]=(...x)=>V(P)&&V(P)(...x))},[h.index===-1&&i.key!==V(pe)?(n(),B("i",cl)):F("",!0),t(y,{type:i.type,link:""},{default:o(()=>[i.icon?(n(),B("i",{key:0,class:ne(["el-icon--left",i.icon])},null,2)):F("",!0),q(" "+le(O(i)),1)]),_:2},1032,["type"]),dl,i.key===V(pe)?(n(),j(a,{key:1,type:"info",size:"small"},{default:o(()=>[q("编辑按钮不可删除、拖拽等操作，且处于首位")]),_:1})):(n(),B(R,{key:2},[t(_,{width:"186px",title:"是否删除该按钮功能？",onConfirm:x=>X(g)},{reference:o(()=>[t(y,{link:"",type:"danger",disabled:h.index>-1},{default:o(()=>[pl]),_:1},8,["disabled"])]),_:2},1032,["onConfirm"]),t(y,{link:"",type:"success",onClick:x=>Z(g)},{default:o(()=>[fl]),_:2},1032,["onClick"])],64))],42,ul))),128)),h.list.length?F("",!0):(n(),j(U,{key:"empty","image-size":120,description:"请添加操作列功能按钮"})),h.formEdit?F("",!0):(n(),B("div",ml,[h.formEdit?F("",!0):(n(),j(y,{key:0,type:"primary",plain:"",onClick:l[5]||(l[5]=i=>h.formEdit=!0)},{default:o(()=>[yl,q(" 新增功能按钮 ")]),_:1}))]))]),_:1})])]),_:1},8,["show"])}}}),bl={class:"the-curd-table-model the-curd-scrollbar"},vl=["data-key","draggable","onDragstart","onDragover"],_l=b("i",{class:"el-icon-rank el-icon--left"},null,-1),kl=b("i",{class:"el-icon-arrow-down el-icon--right"},null,-1),wl={key:1,class:"the-tag blue"},$l=b("div",{class:"fake-table-head fvc"},"操作",-1),xl={class:"fake-table-cell operation fvc"},Dl=b("i",{class:"el-icon-setting"},null,-1),Cl=b("i",{class:"el-icon-delete"},null,-1),Sl={class:"fake-table-cell disabled"},Tl={class:"f-vertical",key:"right-setting"},Vl=b("i",{class:"el-icon-plus el-icon--left"},null,-1),El={key:0},Ol=b("i",{class:"el-icon-plus el-icon--left"},null,-1),Ml={key:1},Nl={key:0,class:"the-tag blue mgl-10"},Bl=b("i",{class:"el-icon--left el-icon-info"},null,-1),Al={name:"TableModel"},Fl=ae({...Al,props:{config:{type:Object,required:!0}},emits:["action"],setup(m,{emit:S}){const e=m,A=S,u="https://fuss10.elemecdn.com/e/5d/4a731a90594a4af544c0c25941171jpeg.jpeg",p=[{key:"edit",label:"编辑列",icon:"el-icon-edit",click(r){T("edit",r)}},{key:"copy",label:"复制列",icon:"el-icon-document-copy",click(r){T("copy",r)}},{key:"delete",label:"删除列",icon:"el-icon-delete",click(r){v(r)}}],f=ie({show:!1,type:"add",index:-1,form:void 0,keys:[]}),d=z(()=>{const r=e.config.columns,y=[],W=[];for(let _=0;_<r.length;_++){const U=r[_];U.prop===me?W.push(U):y.push(U)}return{drag:y,action:W}});function T(r,y){f.keys=e.config.columns.map(_=>_.prop),{add(){f.form=void 0},edit(){const _=e.config.columns[y];f.keys=f.keys.filter(U=>U!==_.prop),f.index=y,f.form=_},copy(){const _=e.config.columns[y];f.form=_}}[r](),f.type=r,f.show=!0}function h(r){const y=e.config;if(["add","copy"].includes(f.type)){const W=re(d.value.drag);W.push(r),y.columns=W.concat(d.value.action)}else y.columns[f.index]=r}function v(r){const y=d.value.drag[r];fe({title:"操作提示",content:`是否删除【${y.title}】列？`,cancelText:"取消",confirm(){const W=e.config.columns.findIndex(_=>_.prop===y.prop);e.config.columns.splice(W,1)}})}const{onDragStart:J,onDragMove:G,onDropEnd:I}=$e({list:()=>e.config.columns,key:"prop",findLevel:5});function k(r){const y={};return r&&r.width&&(y.width=`${r.width}px`),r&&r.minWidth&&(y.minWidth=`${r.minWidth}px`),y}const s=z(function(){const r=e.config.columns;if(r.length>0&&r[r.length-1].prop===me)return r[r.length-1]});function w(){const r=Te(me,"操作");r.minWidth=120,r.width=160,e.config.columns.push(r)}function N(){const r=e.config.columns;fe({title:"操作提示",content:"是否删除操作列？删除之后需要重新配置。",cancelText:"取消",confirm(){r.splice(r.length-1,1),e.config.actions=[],e.config.formEdit&&(e.config.formEdit=void 0)}})}const c=ie({show:!1,keyword:""});function Z(){const r=e.config.selectKey;c.keyword=r?r.toString():"",c.show=!0}function X(r){e.config.selectKey=r}const Y=ie({show:!1,columnWidth:0,actionMax:0});function oe(){Y.show=!0,Y.columnWidth=s.value.width,Y.actionMax=e.config.actionMax}function P(r,y){e.config.actions=r;const W=e.config.columns.find(_=>_.prop===me);W.width=y}const M=ie({show:!1,form:null,type:"add"});function O(r){M.type=r,r==="add"&&e.config.formAdd&&(M.form=e.config.formAdd),r==="edit"&&e.config.formEdit&&(M.form=e.config.formEdit),M.show=!0}function D(r,y){const W=e.config,_=W.actions;function U(){const $=_.length>0&&_[0].key===pe;r&&r.fields.length>0?(s.value||w(),$||_.unshift({key:pe,text:"编辑",type:"success",icon:"el-icon-edit"})):$&&_.splice(0,1)}r&&(M.type==="add"?(W.formAdd=r,y&&(W.formEdit=re(r),U())):(W.formEdit=r,y&&(W.formAdd=re(r)),U())),M.show=!1,M.form=null}function l(r){switch(r){case"delete":Z();break;case"add":O("add");break;case"edit":O("edit");break}}const a=z(()=>d.value.drag.some(r=>!r.width&&!r.minWidth));function E(r){if(r==="complete"&&a.value){const y=Array.from(document.querySelectorAll(".fake-table-head")),W={};y.forEach(_=>{const U=_.dataset.head||"";U&&(W[U]=Math.round(_.clientWidth))}),e.config.columns.forEach(_=>{Object.prototype.hasOwnProperty.call(W,_.prop)&&(_.minWidth=W[_.prop])})}A("action",r)}return(r,y)=>{const W=C("el-empty"),_=C("el-button"),U=C("el-dropdown-item"),$=C("el-dropdown-menu"),i=C("el-dropdown"),g=C("el-tooltip"),x=C("base-table-actions"),Q=C("el-text");return n(),B(R,null,[M.show?F("",!0):(n(),j(Re,{key:0,editMode:!0,config:e.config,onAction:l},null,8,["config"])),b("div",bl,[M.show?(n(),j(He,{key:0,config:M.form,type:M.type,editMode:!0,onChange:D},null,8,["config","type"])):(n(),j(we,{key:1,name:"the-group",tag:"div",class:"fake-table"},{default:o(()=>[e.config.columns.length?F("",!0):(n(),j(W,{key:"empty",style:{padding:"10px 40px"},"image-size":120,description:"请添加表格列"})),(n(!0),B(R,null,se(d.value.drag,(L,K)=>(n(),B("div",{key:L.prop,"data-key":L.prop,class:"fake-table-item",draggable:d.value.drag.length>1,style:_e(k(L)),onDragstart:H=>V(J)(K),onDragover:H=>V(G)(H,K),onDrop:y[0]||(y[0]=H=>V(I)())},[b("div",{class:"fake-table-head f-vertical",style:_e({"text-align":L.align})},[_l,t(ze,{column:L},null,8,["column"])],4),b("div",{class:ne(["fake-table-cell operation f-vertical",[L.align?`f-${L.align}`:void 0]])},[t(i,{trigger:"click"},{dropdown:o(()=>[t($,null,{default:o(()=>[(n(),B(R,null,se(p,H=>t(U,{key:H.key,onClick:xe=>H.click(K)},{default:o(()=>[b("i",{class:ne(["el-icon--left",H.icon])},null,2),q(" "+le(H.label),1)]),_:2},1032,["onClick"])),64))]),_:2},1024)]),default:o(()=>[t(_,{link:"",type:"primary"},{default:o(()=>[q(" 配置列 "),kl]),_:1})]),_:2},1024)],2),b("div",{class:ne(["fake-table-cell f-vertical",[L.align?`f-${L.align}`:void 0]])},[L.cellType==="text"?(n(),B(R,{key:0},[q("文本内容")],64)):L.cellType==="js"?(n(),B("span",wl,"自定义代码")):F("",!0),t(V(Pe),{column:L,src:u},null,8,["column"])],2)],44,vl))),128)),s.value?(n(),B("div",{style:_e(k(s.value)),key:V(me),class:"fake-table-item"},[$l,b("div",xl,[t(g,{effect:"dark",content:"配置【操作按钮】和【操作列】的宽度",placement:"top"},{default:o(()=>[t(_,{circle:"",plain:"",type:"primary",size:"small",onClick:y[1]||(y[1]=L=>oe())},{default:o(()=>[Dl]),_:1})]),_:1}),t(_,{circle:"",plain:"",type:"danger",size:"small",onClick:y[2]||(y[2]=L=>N())},{default:o(()=>[Cl]),_:1})]),b("div",Sl,[e.config.actions.length?(n(),j(x,{key:0,row:{},index:1,actions:e.config.actions},null,8,["actions"])):(n(),j(Q,{key:1,type:"info"},{default:o(()=>[q("待添加操作~")]),_:1}))])],4)):F("",!0),b("div",Tl,[b("div",null,[b("p",null,[t(_,{type:"primary",text:"",onClick:y[3]||(y[3]=L=>T("add"))},{default:o(()=>[Vl,q(" 添加内容列 ")]),_:1})]),s.value?F("",!0):(n(),B("p",El,[t(_,{type:"primary",text:"",onClick:y[4]||(y[4]=L=>w())},{default:o(()=>[Ol,q(" 添加操作列 ")]),_:1})]))])])]),_:1}))]),M.show?F("",!0):(n(),B("div",Ml,[t(V(Je),{type:M.type,onAction:E},null,8,["type"]),a.value?(n(),B("span",Nl,[Bl,q(" 当前表格列配置中存在没配置【宽度/最小宽度】，保存时将自动设置最小宽度，提高表格美观性。 ")])):F("",!0)])),t(Yt,{show:f.show,"onUpdate:show":y[5]||(y[5]=L=>f.show=L),type:f.type,keys:f.keys,form:f.form,onSubmit:h},null,8,["show","type","keys","form"]),t(ol,{show:c.show,"onUpdate:show":y[6]||(y[6]=L=>c.show=L),"select-key":c.keyword,onSubmit:X},null,8,["show","select-key"]),t(gl,{show:Y.show,"onUpdate:show":y[7]||(y[7]=L=>Y.show=L),columnWidth:Y.columnWidth,actionMax:Y.actionMax,list:e.config.actions,onSubmit:P},null,8,["show","columnWidth","actionMax","list"])],64)}}}),ql={class:"the-curd-example"},jl={name:"Example"},Ll=ae({...jl,props:{selected:{type:String},type:{type:String}},emits:["choose"],setup(m,{emit:S}){const e=m,A=S,u=[{...ue("input"),placeholder:ce.input},{...ue("select"),placeholder:ce.select},{...ue("select-multiple"),placeholder:ce["select-multiple"]},{...ue("cascader"),placeholder:ce.cascader},{...ue("date"),placeholder:ce.date},{...ue("checkbox"),options:[{label:"多选-A",value:1},{label:"多选-B",value:2}],defaultValue:[1]},{...ue("radio"),options:[{label:"单选-A",value:"radio-1"},{label:"单选-B",value:"radio-2"}],defaultValue:"radio-1"},{...ue("switch"),defaultValue:!0},{...ue("textarea"),placeholder:ce.textarea},{...ue("input-between"),placeholder:["范围区间操作","范围区间操作"]}],p=["radio","checkbox","textarea","switch"],f=z(()=>e.type==="search"?u.filter(d=>!p.includes(d.type)):u);return(d,T)=>(n(),B("div",ql,[(n(!0),B(R,null,se(f.value,h=>(n(),j(ke,{key:h.type,"field-data":h,class:ne(["the-curd-example-item fvc",{"the-curd-selected":e.selected===h.type}]),readonly:"",onClick:v=>A("choose",h.type)},null,8,["field-data","class","onClick"]))),128))]))}}),Wl={key:0,class:"the-curd-editor-content"},Ul=b("h2",{class:"the-title mgb-20"},"基础设置",-1),Il={class:"f-vertical f-between mgb-20"},Jl=b("h2",{class:"the-title"},"第1步：点击选取组件",-1),Pl={class:"f-vertical mgb-20"},Rl={class:"the-title"},Hl=b("div",{class:"f1"},null,-1),zl={key:0,class:"the-curd-target-box"},Kl=b("a",{href:"https://www.json.cn/",target:"_blank"}," JSON编辑工具 ",-1),Gl={class:"f-right"},Zl=b("i",{class:"el-icon--left el-icon-plus"},null,-1),Xl=b("i",{class:"el-icon--left el-icon-edit"},null,-1),Yl={name:"Editor"},Ql=ae({...Yl,props:{show:{type:Boolean,default:!1},config:{type:Object,required:!0}},emits:["update:show"],setup(m,{emit:S}){const e=m,A=S;function u(){A("update:show",!1)}const p=["checkbox","radio","switch"],f=["select","select-multiple","radio","checkbox","cascader"],d=["input","textarea","select","radio"],T=["input-between","select-multiple","checkbox","cascader"],h=["input","select","radio"],v=h.concat(T),J=`<p>参考 src/utils/index.ts 中的${te("formatDate")}函数</p>`,G=`
<p>动态表单项的条件显示逻辑函数；</p>
<p>返回${te("false")}则不展示对应项；</p>
<p>函数有一个参数：${te("formData")}为当前表单的数据值；</p>
<p>以${te("return")}为函数代码片段标记；</p>
<p>例如：${te("return formData.type !== 2")}</p>
`,I=Ee(),k=z(()=>I.editor.action==="add"),s=z(()=>{let $=[];return c.formData&&c.formData.type==="date"&&($=We[c.formData.dateType].map((g,x)=>({label:g.text,value:x}))),$.unshift({label:"将预览组件中的值设为默认",value:-1}),$}),w=[{label:"整体文字宽度",prop:"labelWidth",type:"number",placeholder:"例如：120(px)"},{label:"文字靠右对齐",prop:"labelRight",type:"switch"}],N=[{label:"表单宽度",prop:"width",type:"number",placeholder:"例如：500(px)"},{label:"文字宽度",prop:"labelWidth",type:"number",placeholder:"例如：140(px)"},{label:"文字靠右排版",prop:"labelPosition",type:"switch",inactiveValue:"left",activeValue:"right"}],c=ie({step:0,formData:void 0});function Z($){c.step=$}const X={label:{required:!0,message:"请输入功能标题",trigger:"blur"},key:{required:!0,trigger:"blur",validator($,i,g){i?_.includes(i)?g(new Error("当前键值已经被占用！")):g():g(new Error("绑定的键值不能为空"))}},format:{required:!0,message:"格式化规则不能为空",trigger:"blur"},separator:{required:!0,message:"请输入串联符号",trigger:"blur"},defaultValue:{required:!0,trigger:"blur",validator($,i,g){const x=D();x===!0?g():g(new Error(x)),g()}},options:{required:!0,trigger:"blur",validator($,i,g){const x=l();x===!0?g():g(new Error(x))}},show:{trigger:"blur",validator($,i,g){if(i&&!i.includes("return")){g(new Error("逻辑代码必须包含 return 关键字"));return}g()}}},Y=z(()=>{const $=c.formData?c.formData.type:"",i=[{label:"组件标题",prop:"label",type:"input",placeholder:X.label.message},{label:"绑定的键值",prop:"key",type:"input",placeholder:"请输入绑定的键值"},{label:"标题宽度",prop:"labelWidth",type:"number",placeholder:"例如：120(px)"},{label:"组件宽度",prop:"valueWidth",type:"number",placeholder:"例如：140(px)",show:()=>!p.includes($)},{label:"提示/规则文字",prop:"placeholder",type:"slot",slotName:"ruleText"},{label:"是否必填",prop:"required",type:"switch"}];if(v.includes($)){const g={label:"绑定值为数字类型",prop:"valueType",type:"switch",activeValue:"number",inactiveValue:"string"};T.includes($)&&(g.activeValue="array<number>",g.inactiveValue="array"),f.includes($)&&(g.tips="设为数字类型之后，将会在保存时校验选项数据"),i.push(g)}if($!=="date"&&i.push({label:"组件默认值",prop:"defaultValue",type:"slot",slotName:"defaultValue"}),$==="input-between"&&i.push({label:"串联符号",prop:"separator",type:"input",placeholder:X.separator.message}),f.includes($)){const g=[{label:"选项数据",prop:"options",type:"slot",slotName:"options"},{label:"数据展示字段",prop:"optionSetting.label",type:"input",placeholder:"不填则使用 label"},{label:"数据值字段",prop:"optionSetting.value",type:"input",placeholder:"不填则使用 value"}];if($==="cascader"){const x=[{label:"下级字段",prop:"optionSetting.children",type:"input",placeholder:"不填则使用 children"},{label:"是否多选",prop:"multiple",type:"switch"},{label:"允许只选中某一项",prop:"checkStrictly",type:"switch"}];g.push(...x)}["select","select-multiple"].includes($)&&g.push({label:"串联显示名称",prop:"joinShow",type:"switch",tips:"例如【英雄联盟-12】"}),i.push(...g)}if($==="date"){const g=[{label:"日期类型",prop:"dateType",type:"select",options:Be,noClear:!0,onChange:r},{label:"日期默认值",prop:"shortcutIndex",type:"select",options:s.value,placeholder:"请选择"},{label:"格式化规则",prop:"format",type:"input",tooltip:J}];i.push(...g)}return I.editor.type==="table"&&i.push({label:"表单显示逻辑",prop:"show",type:"textarea",placeholder:"请输入条件代码，为空则默认展示",tooltip:G}),i}),oe=ye(),P=ie({options:"",defaultValue:""});function M($){$.type!=="date"&&(P.defaultValue=JSON.stringify({value:$.defaultValue})),f.includes($.type)&&(P.options=JSON.stringify($.options))}function O($){var x;const i=I.editor,g=ue($,"",i.type==="search");c.formData=g,M(g),(x=oe.value)==null||x.clearValidate(),Z(1)}function D(){const $='输入的格式必须为 { "value": "input value" }',i=P.defaultValue;if(!i)return $;const g=c.formData.type,x=c.formData.valueType,Q=ce[g];try{const L=JSON.parse(i);if(!ee(L,"object"))return $;if(g==="switch"&&!ee(L.value,"boolean"))return`${Q}的绑定值应该为 boolean 类型`;if(T.includes(g)){if(!ee(L.value,"array"))return`${Q}的绑定值应该为 array 类型`;if(x==="array<number>"&&L.value.some(K=>K!==""&&!ee(K,"number")))return"数组中只能出现数字"}if(d.includes(g)&&!["string","number"].includes(qe(L.value)))return`${Q}的绑定值应该为 string/number 类型`;if(g==="date"){const K=c.formData;if(Ae.includes(K.dateType)){if(!ee(L.value,"array"))return"范围日期绑定值应该为 array 类型"}else if(!ee(L.value,"string"))return"日期类型绑定值应该为 string 类型"}if(h.includes(g)&&x==="number"&&L.value!==""&&!ee(L.value,"number"))return`${Q}的绑定值应该为 number 类型`}catch(L){return console.warn("checkDefaultValue >>",L),$}return!0}function l(){const $=P.options;if(!$)return"选项数据不能为空！";try{const i=JSON.parse($);if(!ee(i,"array"))return"选项数据格式不正确，需要为数组类型！";const g=c.formData,x=g.optionSetting.value||"value",Q=[void 0,null];for(let L=0;L<i.length;L++){const K=i[L];if(!ee(K,"object"))return"数组项必须为对象！";if(Q.includes(K[x]))return`数组项的值不能为${Q.join("/")}`;if(["array<number>","number"].includes(g.valueType)&&!ee(K[x],"number")&&K[x]!=="")return"数组项的值必须为 number 类型"}return!0}catch(i){return console.warn("checkOptions >>",i),"不合法的JSON,注意使用双引号,结尾不能为逗号等"}}function a(){l()===!0&&(c.formData.options=JSON.parse(P.options))}function E(){if(D()===!0){const i=c.formData,g=JSON.parse(P.defaultValue).value;i.type!=="date"&&(i.defaultValue=g)}}function r($){const i=Be.find(x=>x.value===$),g=c.formData;g.shortcutIndex="",Ae.includes(i.value)?(g.value=[],g.valueType="array"):(g.value="",g.valueType="string"),g.formatShow=i.formatShow,g.format=i.format}function y($){return/^[+-]?(\d|([1-9]\d+))(\.\d+)?$/.test($)}function W(){var $;($=oe.value)==null||$.validate(i=>{if(it("#the-editor-form",i),!i)return;E(),f.includes(c.formData.type)&&a();const g=I.editor,x=JSON.parse(JSON.stringify(c.formData));if(f.includes(x.type)&&a(),x.valueType||(x.valueType=qe(x.defaultValue)),f.includes(x.type)&&["number","array<number>"].includes(x.valueType)){let L=x.optionSetting.value;L||(L="value",x.optionSetting.value=L);for(let K=0;K<x.options.length;K++){const H=x.options[K],xe=H[L];if([null,void 0].includes(xe))return de.error("数据值字段与选项数据不匹配，请检查！");if(y(xe.toString()))H[L]=Number(xe);else{const Ke=H[x.optionSetting.label];return de.error(`选项数据中【${Ke}】的值应该为数字！`)}}}x.type==="date"&&(x.shortcutIndex===-1&&(x.shortcutDate=x.value),x.value=x.valueType==="array"?[]:""),{search(L){L?e.config.search.list.push(x):e.config.search.list[g.index]=x},table(L){if(L){const K=JSON.parse(JSON.stringify(g.form.fields));K.push(x),g.form.fields=K}else{const K=JSON.parse(JSON.stringify(g.form.fields));K[g.index]=x,g.form.fields=K}}}[g.type](k.value),u()})}let _=[];function U($){const i=I.editor;_=[],{search(){_=e.config.search.list.map(x=>x.key)},table(){_=i.form.fields.map(x=>x.key)}}[i.type](),$&&(_=_.filter(x=>x!==$))}return he(()=>e.show,function($){if(!$){c.formData=void 0;return}const i=I.editor;if(i.action==="add")c.step=0,c.formData=void 0,U();else{const g=i.index;({search(){c.formData=JSON.parse(JSON.stringify(e.config.search.list[g]))},table(){var Q;c.formData=JSON.parse(JSON.stringify((Q=i.form)==null?void 0:Q.fields[g]))}})[i.type](),M(c.formData),U(c.formData.key),c.step=1}}),($,i)=>{const g=C("el-form"),x=C("el-button"),Q=C("el-input"),L=C("el-text");return n(),B("section",{class:ne(["the-curd-editor the-curd-scrollbar",{"is-show":e.show}])},[t(Ze,{name:"the-curd-editor-move"},{default:o(()=>{var K;return[e.show?(n(),B("div",Wl,[Ul,t(g,{"label-position":"right","label-width":"120px"},{default:o(()=>[V(I).editor.type==="search"?(n(),j(V(be),{key:0,data:e.config.search,list:w},null,8,["data"])):F("",!0),V(I).editor.type==="table"&&V(I).editor.form?(n(),j(V(be),{key:1,data:V(I).editor.form,list:N},null,8,["data"])):F("",!0)]),_:1}),c.step===0?(n(),B(R,{key:0},[b("div",Il,[Jl,t(x,{link:"",type:"primary",onClick:i[0]||(i[0]=H=>u())},{default:o(()=>[q("退出编辑")]),_:1})]),t(Ll,{selected:(K=c.formData)==null?void 0:K.type,type:V(I).editor.type,onChoose:O},null,8,["selected","type"])],64)):F("",!0),c.step===1?(n(),B(R,{key:1},[b("div",Pl,[b("h2",Rl,"第2步：配置"+le(V(ce)[c.formData.type]),1),Hl,t(x,{link:"",type:"success",onClick:i[1]||(i[1]=H=>Z(0))},{default:o(()=>[q("上一步")]),_:1}),t(x,{link:"",type:"primary",onClick:i[2]||(i[2]=H=>u())},{default:o(()=>[q("退出编辑")]),_:1})]),c.formData?(n(),B("div",zl,[t(ke,{"field-data":c.formData,"edit-mode":""},null,8,["field-data"])])):F("",!0),c.formData?(n(),j(g,{key:1,id:"the-editor-form",ref_key:"formRef",ref:oe,model:c.formData,rules:X,"label-position":"right","label-width":"128px"},{default:o(()=>[t(V(be),{data:c.formData,list:Y.value},{ruleText:o(()=>[c.formData.type==="input-between"?(n(),B(R,{key:0},[t(Q,{modelValue:c.formData.placeholder[0],"onUpdate:modelValue":i[3]||(i[3]=H=>c.formData.placeholder[0]=H),class:"f1",clearable:"",placeholder:"请输入提示-1"},null,8,["modelValue"]),t(L,{style:{padding:"0 6px"}},{default:o(()=>[q("-")]),_:1}),t(Q,{modelValue:c.formData.placeholder[1],"onUpdate:modelValue":i[4]||(i[4]=H=>c.formData.placeholder[1]=H),class:"f1",clearable:"",placeholder:"请输入提示-2"},null,8,["modelValue"])],64)):(n(),j(Q,{key:1,modelValue:c.formData.placeholder,"onUpdate:modelValue":i[5]||(i[5]=H=>c.formData.placeholder=H),clearable:"",placeholder:"请输入规则提示/输入框提示文字"},null,8,["modelValue"]))]),defaultValue:o(()=>[t(Q,{modelValue:P.defaultValue,"onUpdate:modelValue":i[6]||(i[6]=H=>P.defaultValue=H),type:"textarea",clearable:"",placeholder:"请输入JSON，值为 value",onBlur:i[7]||(i[7]=H=>E())},null,8,["modelValue"])]),options:o(()=>[t(Q,{modelValue:P.options,"onUpdate:modelValue":i[8]||(i[8]=H=>P.options=H),type:"textarea",placeholder:"请输入数组JSON",style:{"margin-bottom":"4px"},onBlur:i[9]||(i[9]=H=>a())},null,8,["modelValue"]),t(x,{link:"",type:"primary"},{default:o(()=>[Kl]),_:1})]),_:1},8,["data","list"]),b("div",Gl,[t(x,{onClick:i[10]||(i[10]=H=>u())},{default:o(()=>[q("关闭")]),_:1}),k.value?(n(),j(x,{key:0,type:"primary",onClick:i[11]||(i[11]=H=>W())},{default:o(()=>[Zl,q(" 新增 ")]),_:1})):(n(),j(x,{key:1,type:"success",onClick:i[12]||(i[12]=H=>W())},{default:o(()=>[Xl,q(" 确认 ")]),_:1}))])]),_:1},8,["model"])):F("",!0)],64)):F("",!0)])):F("",!0)]}),_:1})],2)}}}),eo={class:"the-curd-main-page"},to={key:2},lo={key:0,class:"the-tag blue"},oo=b("i",{class:"el-icon-arrow-left"},null,-1),no=b("p",{class:"mgb-10"},"配置筛选相关功能",-1),ao=b("p",null,"配置表格相关功能",-1),io={name:"Curd"},yo=ae({...io,props:{data:{type:Object,required:!0},action:{type:Object,required:!0}},setup(m){const S=m,e=ie({loading:!1,editor:{show:!1,type:void 0,form:void 0,action:"add",index:-1},showEntrance:!1}),A=z(()=>{const l=e.editor.type;return l==="search"||!l&&S.data.search.list.length>0});Ye(lt,e);let u;function p(l){e.editor.type=l,e.editor.show=!1,e.editor.index=-1,e.showEntrance=!1,u={[l]:re(S.data[l])}}function f(l){const a=e.editor.type;l&&u&&(S.data[a]=u[a]),e.editor.index=-1,e.editor.show=!1,e.editor.type=void 0,e.editor.form=void 0,u=void 0}function d(){f()}function T(){je(JSON.stringify(S.data),()=>de.success("复制成功！"))}function h(l){l&&S.data.search.list.forEach(Ve),v.pageInfo.currentPage=1,v.selectList=[],P()}const v=ie({selectList:[],data:[],pageInfo:nt(),formShow:!1,formType:"add",formLoading:!1}),J=z(()=>S.data.table),G=z(()=>J.value.columns.filter(a=>a.visible).map(a=>{const E={...a};return E.cellType==="js"&&E.jsCode&&(E.rawContent=function(r,y){let W="";try{W=new Function("cellValue","row",E.jsCode)(r,y)}catch(_){console.warn("解析 rawContent 代码错误 >>",_),W="-"}return W}),E})),I=z(()=>J.value.actions.map(a=>{const E={...a};return E.key===pe&&(E.click=Z),E})),k=z(()=>{const l=[],a=[];return G.value.forEach(E=>{E.slotHead&&l.push(E.slotHead),E.slot&&a.push(E.slot)}),{head:l,cell:a}});function s(l){return J.value.columns.find(E=>E.prop===l)||{}}const w=ye(),N=z(()=>{const l=J.value,a={title:"编辑表单",config:l.formEdit||{}};return v.formType==="add"&&(a.title="新增表单",a.config=l.formAdd||{}),a});let c=null;function Z(l){l?(v.formType="edit",c=l):v.formType="add",v.formShow=!0,setTimeout(()=>{var a;return(a=w.value)==null?void 0:a.clear()}),Xe(()=>{var a;return c&&((a=w.value)==null?void 0:a.setFormData(c))})}function X(){var l;v.formShow=!1,(l=w.value)==null||l.reset(),c=null}function Y(){var l;(l=w.value)==null||l.validate(async(a,E)=>{if(v.formType==="add"&&S.action.onAdd){v.formLoading=!0;const r=await S.action.onAdd(a,E);if(v.formLoading=!1,r.code!==1)return;X(),P()}if(v.formType==="edit"&&S.action.onEdit){v.formLoading=!0;const r=await S.action.onEdit(a,E);if(v.formLoading=!1,r.code!==1)return;X(),P()}})}function oe(l){const a=S.data.search.list,E={};for(let _=0;_<a.length;_++){const U=a[_],$=Ue(U);if(U.required&&ee($.result,"string"))return st(document.querySelector(`.${U.id}`)),de.error($.result),l&&l.key==="page"&&(v.pageInfo=l.before),null;$.result===!0&&(E[U.key]=$.value)}const r=J.value.columns,y=[],W=[];return l&&l.key==="sort"?r.forEach(_=>{_.sort&&(_.prop===l.prop?_.sort=l.action:_.sort=!0),_.sort==="asc"&&y.push(_.prop),_.sort==="desc"&&W.push(_.prop)}):r.forEach(_=>{_.sort==="asc"&&y.push(_.prop),_.sort==="desc"&&W.push(_.prop)}),y.length&&(E.asc=y.toString()),W.length&&(E.desc=W.toString()),E}async function P(l){const a=oe(l);if(!a)return;const E=JSON.parse(JSON.stringify(v.pageInfo));e.loading=!0;const r=await S.action.getTableData(a,E);e.loading=!1,r.code===1&&(v.pageInfo.total=r.data.total,v.data=r.data.list||[])}function M(l){const a=v.selectList;switch(l){case"add":Z();break;case"delete":if(!a.length)return de.warning("请选择要删除的列表再进行操作~");fe({title:"操作提示",content:`是否删除选中的 ${a.length} 条数据？`,cancelText:"取消",async confirm(){S.action.onDelete?(e.loading=!0,(await S.action.onDelete(JSON.parse(JSON.stringify(v.selectList)))).code===1?(de.success("删除成功！"),v.selectList=[],P()):e.loading=!1):de.info("请设置 action.onDelete 删除逻辑")}});break;case"export":S.action.onExport?S.action.onExport():de.info("请设置 action.onExport 导出逻辑");break}}function O(l){({exit:()=>f(!0),copy:T,complete:d})[l]()}function D(l){e.loading=l}return tt({formatDate:Ie,copyText:je,messageBox:fe,message:de,jsonToPath:at,request:rt,getData:P,setLoading:D}),Le(function(){S.action.created&&J.value.columns.length&&S.action.created(P)}),(l,a)=>{const E=C("base-table"),r=C("base-pagination"),y=C("el-button"),W=C("el-empty"),_=C("base-dialog");return n(),B("div",eo,[b("section",{class:ne([e.editor.show?"f1":"the-curd-content"])},[A.value?(n(),j(xt,{key:0,data:S.data.search,onSearch:h},null,8,["data"])):F("",!0),e.editor.type==="table"?(n(),j(Fl,{key:1,config:J.value,onAction:O},null,8,["config"])):e.editor.type==="search"?(n(),B("div",to,[t(V(Je),{onAction:O})])):(n(),B(R,{key:3},[J.value.columns.length>0?(n(),B(R,{key:0},[t(Re,{config:J.value,disabled:e.loading,onAction:M},{left:o(()=>[J.value.selectKey?(n(),B("span",lo," 已选择 "+le(v.selectList.length)+" 条数据 ",1)):F("",!0)]),_:1},8,["config","disabled"]),t(E,{class:"f1","select-list":v.selectList,"onUpdate:selectList":a[1]||(a[1]=U=>v.selectList=U),data:v.data,columns:G.value,actions:I.value,actionMax:J.value.actionMax,loading:e.loading,"select-key":J.value.selectKey},Se({_:2},[se(k.value.head,U=>({name:U,fn:o(({$index:$})=>[t(ze,{column:G.value[J.value.selectKey?$-1:$],onSort:a[0]||(a[0]=(i,g)=>P({key:"sort",prop:i,action:g}))},null,8,["column"])])})),se(k.value.cell,U=>({name:U,fn:o(({row:$})=>[t(V(Pe),{column:s(U),src:$[U],previewList:k.value.cell.map(i=>$[i])},null,8,["column","src","previewList"])])}))]),1032,["select-list","data","columns","actions","actionMax","loading","select-key"]),t(r,{disabled:e.loading,pageInfo:v.pageInfo,onChange:a[2]||(a[2]=U=>P({key:"page",...U}))},null,8,["disabled","pageInfo"])],64)):(n(),j(W,{key:1,description:"当前页面没有表格配置数据，请配置后再操作~"},{default:o(()=>[t(y,{type:"primary",onClick:a[3]||(a[3]=U=>p("table"))},{default:o(()=>[q("去配置")]),_:1})]),_:1}))],64))],2),t(Ql,{show:e.editor.show,"onUpdate:show":a[4]||(a[4]=U=>e.editor.show=U),config:S.data},null,8,["show","config"]),t(_,{show:v.formShow,"onUpdate:show":a[7]||(a[7]=U=>v.formShow=U),title:N.value.title,width:V(ve)(N.value.config.width),onClose:a[8]||(a[8]=U=>X())},{footer:o(()=>[t(V(De),{loading:v.formLoading,onClose:a[5]||(a[5]=U=>X()),onSubmit:a[6]||(a[6]=U=>Y())},null,8,["loading"])]),default:o(()=>[t(He,{ref_key:"formRef",ref:w,config:N.value.config,type:v.formType,disabled:v.formLoading},null,8,["config","type","disabled"])]),_:1},8,["show","title","width"]),!e.showEntrance&&!e.editor.type?(n(),j(y,{key:0,class:"the-curd-entrance",type:"primary",size:"small",onClick:a[9]||(a[9]=U=>e.showEntrance=!0)},{default:o(()=>[oo]),_:1})):F("",!0),t(_,{show:e.showEntrance,"onUpdate:show":a[13]||(a[13]=U=>e.showEntrance=U),title:"请选择配置操作",width:"600px"},{footer:o(()=>[t(y,{onClick:a[12]||(a[12]=U=>e.showEntrance=!1)},{default:o(()=>[q("关 闭")]),_:1})]),default:o(()=>[b("div",{class:"the-curd-entrance-item",onClick:a[10]||(a[10]=U=>p("search"))},[no,t(V(mt))]),b("div",{class:"the-curd-entrance-item",onClick:a[11]||(a[11]=U=>p("table"))},[ao,t(V(yt))])]),_:1},8,["show"])])}}});export{yo as _};
