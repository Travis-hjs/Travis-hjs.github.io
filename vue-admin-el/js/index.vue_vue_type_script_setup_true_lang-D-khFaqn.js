import{h as re,s as Q,o as We,b as _,d as O,e as o,n as ke,u as V,l as M,m as B,A as ge,F as X,c as t,f as n,B as A,t as le,g as f,y as ae,az as Ve,O as $e,D as ie,r as se,w as he,j as Me,i as be,T as Ke,L as Ge,K as Ze}from"./element-plus-BDbIiGck.js";import{a as Xe,S as Qe,F as Ne}from"./index-DBZFnIE4.js";import{i as Ee,d as _e,f as ce,s as je,u as Oe,c as ye,e as Be,h as Ue,b as Te,j as ne,k as Se,a as fe,g as de,l as Ae,m as Ye,p as et}from"./index.vue_vue_type_style_index_0_lang-CSxBxI_C.js";import{k as oe,l as ue,i as Fe,u as xe,b as me,e as tt,n as Le,a as pe,g as lt,c as qe,p as ot,f as nt}from"./index-BviKljmW.js";import{_ as ve}from"./index.vue_vue_type_style_index_0_lang-en206lCN.js";import{v as at,s as it}from"./dom-D4K-_gXQ.js";import{r as st}from"./common-BhiIx4xY.js";const rt=["title"],ut={name:"Field"},we=re({...ut,props:{fieldData:{type:Object,required:!0},editMode:Boolean,readonly:Boolean,disabled:Boolean},emits:["change"],setup(q,{emit:T}){const e=q,j=T;Ee(e.fieldData);function d(D){let u=D||e.fieldData.value;oe(u,"array")&&(u=ue(u)),j("change",u)}const s=Q(()=>e.fieldData),g=Q(()=>{const D=e.fieldData.optionSetting||{};return{value:D.value||"value",label:D.label||"label"}}),$=Q(()=>{const D=e.fieldData,u=D.optionSetting;return{multiple:D.multiple,checkStrictly:D.checkStrictly,value:u.value||"value",label:u.label||"label",children:u.children||"children"}});function I(D){const u=s.value.placeholder;return{disabled:e.disabled,readonly:e.readonly,clearable:!0,placeholder:oe(D,"number")?u[D]:u}}function C(D){const u=e.fieldData;u.valueType==="number"?(u.value=Fe(D,!0,!0),d(Number(u.value))):(u.value=D,d())}function v(D,u){const K=e.fieldData;K.valueType==="array<number>"?(K.value[u]=Fe(D,!0,!0),d(K.value.map(H=>Number(H)))):(K.value[u]=D,d())}const R=["-",".","",null,void 0];function Y(){const D=e.fieldData;D.valueType==="number"&&(R.includes(D.value)?D.value="":D.value=Number(D.value))}function z(D){const u=e.fieldData;if(u.valueType==="array<number>"){const K=u.value[D];R.includes(K)?u.value[D]="":u.value[D]=Number(K)}}function F(D){const u=D.type==="select-multiple";return{placeholder:D.placeholder,disabled:e.disabled,multiple:D.type==="select-multiple",clearable:!0,filterable:!0,collapseTags:!0,class:`field-item${u?" is-multiple-select":""}`}}function J(D,u){const K=g.value;return D.joinShow?`${u[K.label]}-${u[K.value]}`:`${u[K.label]}`}let x=[];const N="the-date-shortcut-selected";function W(){const D=document.querySelector(`.${N}`);D&&D.classList.remove(N),d()}function w(D){D.classList.add(N)}return We(function(){const D=e.fieldData;if(D.type==="date"){const u=`.${D.id} .el-picker-panel__sidebar`,K=document.querySelector(u);if(!K)return console.warn("找不到日期快捷面板节点！");x=Array.from(K.children),x.forEach(P=>{P.addEventListener("click",()=>w(P))});const H=D.shortcutIndex;oe(H,"number")&&H>=0&&w(x[H])}}),(D,u)=>{const K=_("el-input"),H=_("el-text"),P=_("el-select-v2"),S=_("el-option"),b=_("el-select"),l=_("el-checkbox"),a=_("el-checkbox-group"),k=_("el-radio"),r=_("el-radio-group"),p=_("el-switch"),L=_("el-cascader"),h=_("el-date-picker");return o(),O("div",{class:"the-curd-form-field f-vertical short-value",style:ke({width:V(_e)(s.value.valueWidth)})},[s.value.type==="input"?(o(),M(K,ge({key:0,"model-value":s.value.value},I(),{class:"the-curd-field",onInput:C,onBlur:Y}),null,16,["model-value"])):B("",!0),s.value.type==="textarea"?(o(),M(K,{key:1,modelValue:s.value.value,"onUpdate:modelValue":u[0]||(u[0]=i=>s.value.value=i),readonly:e.readonly,disabled:e.disabled,placeholder:s.value.placeholder,type:"textarea",class:"the-curd-field",onInput:u[1]||(u[1]=i=>d())},null,8,["modelValue","readonly","disabled","placeholder"])):B("",!0),s.value.type==="input-between"?(o(),O(X,{key:2},[t(K,ge({"model-value":s.value.value[0]},I(0),{class:"f1",onInput:u[2]||(u[2]=i=>v(i,0)),onBlur:u[3]||(u[3]=i=>z(0))}),null,16,["model-value"]),t(H,{style:{padding:"0 6px"}},{default:n(()=>[A(le(s.value.separator),1)]),_:1}),t(K,ge({"model-value":s.value.value[1]},I(1),{class:"f1",onInput:u[4]||(u[4]=i=>v(i,1)),onBlur:u[5]||(u[5]=i=>z(1))}),null,16,["model-value"])],64)):B("",!0),s.value.type==="select"||s.value.type==="select-multiple"?(o(),O(X,{key:3},[s.value.options.length>50?(o(),M(P,ge({key:0,modelValue:s.value.value,"onUpdate:modelValue":u[6]||(u[6]=i=>s.value.value=i),options:s.value.options,props:g.value},F(s.value),{onChange:u[7]||(u[7]=i=>d())}),{default:n(({item:i})=>[f("span",{title:J(s.value,i)},le(J(s.value,i)),9,rt)]),_:1},16,["modelValue","options","props"])):(o(),M(b,ge({key:1,modelValue:s.value.value,"onUpdate:modelValue":u[8]||(u[8]=i=>s.value.value=i)},F(s.value),{onChange:u[9]||(u[9]=i=>d())}),{default:n(()=>[(o(!0),O(X,null,ae(s.value.options,i=>(o(),M(S,{key:i[g.value.value],value:i[g.value.value],label:J(s.value,i)},null,8,["value","label"]))),128))]),_:1},16,["modelValue"]))],64)):B("",!0),s.value.type==="checkbox"?(o(),O(X,{key:4},[t(a,{modelValue:s.value.value,"onUpdate:modelValue":u[10]||(u[10]=i=>s.value.value=i),disabled:e.disabled,onChange:u[11]||(u[11]=i=>d())},{default:n(()=>[(o(!0),O(X,null,ae(s.value.options,i=>(o(),M(l,{key:i[g.value.value],value:i[g.value.value]},{default:n(()=>[A(le(i[g.value.label]),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue","disabled"]),e.editMode&&!s.value.options.length?(o(),M(H,{key:0,type:"primary"},{default:n(()=>[A(le(V(ce).checkbox)+"（空数据） ",1)]),_:1})):B("",!0)],64)):B("",!0),s.value.type==="radio"?(o(),O(X,{key:5},[t(r,{modelValue:s.value.value,"onUpdate:modelValue":u[12]||(u[12]=i=>s.value.value=i),disabled:e.disabled,onChange:u[13]||(u[13]=i=>d())},{default:n(()=>[(o(!0),O(X,null,ae(s.value.options,i=>(o(),M(k,{key:i[g.value.value],value:i[g.value.value]},{default:n(()=>[A(le(i[g.value.label]),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue","disabled"]),e.editMode&&!s.value.options.length?(o(),M(H,{key:0,type:"primary"},{default:n(()=>[A(le(V(ce).radio)+"（空数据） ",1)]),_:1})):B("",!0)],64)):B("",!0),s.value.type==="switch"?(o(),M(p,{key:6,modelValue:s.value.value,"onUpdate:modelValue":u[14]||(u[14]=i=>s.value.value=i),"inline-prompt":"","active-text":"是","inactive-text":"否",onChange:u[15]||(u[15]=i=>d())},null,8,["modelValue"])):B("",!0),s.value.type==="cascader"?(o(),M(L,{key:7,modelValue:s.value.value,"onUpdate:modelValue":u[16]||(u[16]=i=>s.value.value=i),options:s.value.options,props:$.value,placeholder:s.value.placeholder,disabled:e.disabled,clearable:"","collapse-tags":"","collapse-tags-tooltip":"",filterable:"",class:"the-curd-field",onChange:u[17]||(u[17]=i=>d())},null,8,["modelValue","options","props","placeholder","disabled"])):B("",!0),s.value.type==="date"?(o(),M(h,{key:8,modelValue:s.value.value,"onUpdate:modelValue":u[18]||(u[18]=i=>s.value.value=i),placeholder:s.value.placeholder,type:s.value.dateType,format:s.value.formatShow,shortcuts:V(je)[s.value.dateType],disabled:e.disabled,"popper-class":s.value.id.toString(),"range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",class:"the-curd-field",onChange:W},null,8,["modelValue","placeholder","type","format","shortcuts","disabled","popper-class"])):B("",!0)],4)}}}),dt={key:0,class:"el-icon-rank el-icon--left"},ct={style:{"line-height":"1"}},pt={key:0,class:"the-curd-edit-mask f-vertical f-right"},ft=f("i",{class:"el-icon-delete el-icon--left"},null,-1),mt=f("i",{class:"el-icon-edit el-icon--left"},null,-1),yt=f("i",{class:"el-icon-plus"},null,-1),ht={name:"Search"},gt=re({...ht,props:{data:{type:Object,required:!0}},emits:["search"],setup(q,{emit:T}){const e=q,j=T,d=Oe(),s=Q(()=>d.editor.type==="search"&&!d.editor.show);function g(z){const F=e.data.list[z].label||e.data.list[z].key;me({title:"操作提示",content:`是否删除【${F}】？`,cancelText:"取消",confirm(){e.data.list.splice(z,1)}})}function $(z){d.editor.index=z,d.editor.action="edit",d.editor.show=!0}function I(z){return d.editor.index===z&&d.editor.type==="search"&&d.editor.show}function C(){d.editor.index=-1,d.editor.action="add",d.editor.show=!0}const{onDragStart:v,onDragMove:R,onDropEnd:Y}=xe({list:()=>e.data.list,key:"id",findLevel:5});return(z,F)=>{const J=_("el-button"),x=_("el-text");return o(),M(V(Xe),{class:"the-curd-search","label-right":e.data.labelRight,"label-width":V(_e)(e.data.labelWidth)||"auto"},Ve({content:n(()=>[t($e,{name:"the-group",tag:"div",class:"the-filter-content f1"},{default:n(()=>[(o(!0),O(X,null,ae(e.data.list,(N,W)=>(o(),M(V(Ne),{key:N.id,"data-key":N.id,class:ie([{"the-curd-selected":I(W)},N.id]),label:N.label,"label-width":V(_e)(N.labelWidth),required:N.required,draggable:s.value,onDragstart:w=>V(v)(W),onDragover:w=>V(R)(w,W),onDrop:F[0]||(F[0]=w=>V(Y)())},Ve({default:n(()=>[t(we,{"field-data":N,disabled:V(d).loading},null,8,["field-data","disabled"]),s.value?(o(),O("div",pt,[t(J,{link:"",type:"danger",onClick:w=>g(W)},{default:n(()=>[ft,A(" 删除 ")]),_:2},1032,["onClick"]),t(J,{link:"",type:"success",onClick:w=>$(W)},{default:n(()=>[mt,A(" 编辑 ")]),_:2},1032,["onClick"])])):B("",!0)]),_:2},[V(d).editor.type==="search"?{name:"label",fn:n(()=>[s.value?(o(),O("i",dt)):B("",!0),f("span",ct,le(N.label),1)]),key:"0"}:void 0]),1032,["data-key","class","label","label-width","required","draggable","onDragstart","onDragover"]))),128)),s.value?(o(),M(V(Ne),{key:0},{default:n(()=>[e.data.list.length?B("",!0):(o(),M(x,{key:0,type:"info",style:{"margin-right":"12px"}},{default:n(()=>[A(" 请添加筛选条件~ ")]),_:1})),t(J,{type:"primary",circle:"",onClick:F[1]||(F[1]=N=>C())},{default:n(()=>[yt]),_:1})]),_:1})):B("",!0)]),_:1})]),_:2},[V(d).editor.type?void 0:{name:"right",fn:n(()=>[t(V(Qe),{loading:V(d).loading,onSearch:F[2]||(F[2]=N=>j("search",N))},null,8,["loading"])]),key:"0"}]),1032,["label-right","label-width"])}}});function Ie(q){const T=q.onAction||(()=>{});return t(X,null,[t(_("el-button"),{onClick:()=>T("exit")},{default:()=>[A("退 出")]}),t(_("el-button"),{type:"success",plain:!0,onClick:()=>T("copy")},{default:()=>[t("i",{class:"el-icon-document-copy el-icon--left"},null),A("复制JSON")]}),t(_("el-button"),{type:"primary",onClick:()=>T("complete")},{default:()=>[A("保 存")]})])}function Ce(q){const T=q.onClose||(()=>{}),e=q.onSubmit||(()=>{});return t(X,null,[t(_("el-button"),{onClick:T},{default:()=>[A("取 消")]}),t(_("el-button"),{type:"primary",loading:q.loading,disabled:q.disabledSubmit,onClick:e},{default:()=>[A("确 认")]})])}function vt(q){const T={};return q.imageWidth&&(T.width=`${q.imageWidth}px`),q.imageHeight&&(T.height=`${q.imageHeight}px`),T}function Je(q){function T(){tt({urls:q.previewList?q.previewList:[q.src]})}return q.column.cellType==="image"?t(_("el-image"),{class:"the-table-image",style:vt(q.column),src:q.src,onClick:T,fit:"cover"},null):null}const bt=re({props:{value:{type:[String,Function],default:""}},emits:["update:value"],setup(q,{emit:T}){const e=Q({get(){return typeof q.value=="function"?"":q.value},set(d){T("update:value",d)}}),j="https://element.eleme.cn/#/zh-CN/component/icon";return()=>t("div",{class:"f-vertical w-full"},[t(_("el-input"),{modelValue:e.value,"onUpdate:modelValue":d=>e.value=d,placeholder:"请输入图标 class",class:"mgr-10",clearable:!0},null),t(_("el-button"),{type:"primary",link:!0},{default:()=>[t("a",{href:j,target:"_blank"},[A("去官网复制")])]})])}});function _t(){const q=Array.from({length:6}).map((T,e)=>({id:e}));return t("div",{class:"the-thumbnail-search flex"},[t("div",{class:"the-thumbnail-search-content f1"},[q.map(T=>t("div",{key:T.id,class:"the-thumbnail-search-item"},null))]),t("div",{class:"the-thumbnail-search-btn f-vertical"},[t("i",{class:"el-icon-search"},null)])])}function kt(){return t("section",{class:"the-thumbnail-table"},[t("svg",{width:280,height:180,viewBox:`0 0 ${280*1} ${180*1}`,fill:"none",xmlns:"http://www.w3.org/2000/svg","data-v-d2b0a988":"",class:"the-thumbnail-table-svg"},[t("rect",{width:280,height:180,fill:""},null),t("g",{filter:"url(#filter0_d_13550_224439)"},[t("path",{d:"M65 60C65 58.8954 65.8954 58 67 58H213C214.105 58 215 58.8954 215 60V132C215 133.105 214.105 134 213 134H67C65.8954 134 65 133.105 65 132V60Z",fill:"var(--el-fill-color-blank)"},null),t("path",{d:"M67 57.7C65.7297 57.7 64.7 58.7297 64.7 60V132C64.7 133.27 65.7297 134.3 67 134.3H213C214.27 134.3 215.3 133.27 215.3 132V60C215.3 58.7297 214.27 57.7 213 57.7H67Z",stroke:"var(--el-border-color-dark)","stroke-width":.6*1},null)]),[76,92,108,124].map((j,d)=>t("rect",{key:d,x:71*1,y:j*1,width:16*1,height:4*1,rx:2*1,fill:"var(--el-color-primary)"},null)),[107,143,197].map((j,d)=>[76,92,108,124].map((s,g)=>t("rect",{key:`${d}-${g}`,x:j*1,y:s*1,width:d===2?12*1:20*1,height:4*1,rx:2*1,fill:"var(--el-border-color-dark)"},null))),t("path",{d:"M65 60C65 58.8954 65.8954 58 67 58H213C214.105 58 215 58.8954 215 60V70H65V60Z",fill:"var(--el-border-color-light)"},null),[71,107,143,199].map(j=>t("rect",{key:j,x:j*1,y:63*1,width:10*1,height:2*1,rx:1*1,fill:"var(--el-border-color-dark)"},null)),[85.75,101.75,117.75].map((j,d)=>t("line",{key:d,x1:65*1,y1:j*1,x2:215*1,y2:j*1,stroke:"var(--el-border-color-light)","stroke-width":.5*1},null)),t("defs",null,[t("filter",{id:"filter0_d_13550_224439",x:"51.0666",y:"44.0671",width:177.867*1,height:103.866*1,filterUnits:"userSpaceOnUse","color-interpolation-filters":"sRGB"},[t("feFlood",{"flood-opacity":"0",result:"BackgroundImageFix"},null),t("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"},null),t("feOffset",null,null),t("feGaussianBlur",{stdDeviation:6.66667*1},null),t("feComposite",{in2:"hardAlpha",operator:"out"},null),t("feColorMatrix",{type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.05 0"},null),t("feBlend",{mode:"normal",in2:"BackgroundImageFix",result:"effect1_dropShadow_13550_224439"},null),t("feBlend",{mode:"normal",in:"SourceGraphic",in2:"effect1_dropShadow_13550_224439",result:"shape"},null)])])])])}const wt={class:"w-full f-vertical mgb-10"},$t=f("div",{class:"f1"},null,-1),xt=f("i",{class:"el-icon--left el-icon-delete"},null,-1),Ct=f("i",{class:"el-icon--left el-icon-plus"},null,-1),Dt=f("i",{class:"el-icon--left el-icon-download"},null,-1),St=f("i",{class:"el-icon--left el-icon-setting"},null,-1),Vt={class:"f-vertical f-between mgb-10"},Tt=f("i",{class:"el-icon--left el-icon-refresh-left"},null,-1),Et={key:0,class:"el-icon--left el-icon-rank"},Ot={class:"f1"},Mt={name:"TableOperation"},Pe=re({...Mt,props:{config:{type:Object,required:!0},editMode:{type:Boolean},disabled:{type:Boolean}},emits:["action"],setup(q,{emit:T}){const e=q,j=T;function d(x){j("action",x)}const s={on:"el-icon-success",off:"el-icon-remove-outline"},g=Q(()=>{const x=e.config;return{add:x.formAdd&&x.formAdd.fields.length>0,edit:x.formEdit&&x.formEdit.fields.length>0,delete:!!x.selectKey}}),$=Q(()=>{const x=g.value.delete,N=g.value.add,W=g.value.edit;return[{type:"delete",text:x?"修改删除":"配置删除",icon:x?s.on:s.off,style:x?"primary":"info"},{type:"add",text:N?"修改新增表单":"配置新增表单",icon:N?s.on:s.off,style:N?"primary":"info"},{type:"edit",text:W?"修改编辑表单":"配置编辑表单",icon:W?s.on:s.off,style:W?"primary":"info"}]}),I=[{label:"固定左边",value:"left"},{label:"默认",value:!1},{label:"固定右边",value:"right"}],{onDragStart:C,onDragMove:v,onDropEnd:R}=xe({list:()=>e.config.columns,key:"prop"});function Y(x,N){const W=x.prop===ye,w=x.prop;return{"data-key":w,key:w,draggable:W?void 0:!0,title:W?"操作栏不可排序，只能显示隐藏操作":void 0,onDragstart:W?void 0:()=>C(N),onDragover:W?void 0:D=>v(D,N),onDrop:W?void 0:R}}const z=se({showFixed:!1});let F=[];function J(){e.config.columns=F}return he(()=>e.config.columns,function(x){e.editMode||(F=ue(x))},{immediate:!0}),(x,N)=>{const W=_("el-button"),w=_("el-checkbox"),D=_("el-radio-button"),u=_("el-radio-group"),K=_("el-switch"),H=_("el-empty"),P=_("el-popover");return o(),O("div",wt,[e.editMode?(o(!0),O(X,{key:0},ae($.value,S=>(o(),M(W,{key:S.type,type:S.style,link:"",onClick:b=>d(S.type)},{default:n(()=>[f("i",{class:ie(["el-icon--left",S.icon])},null,2),A(" "+le(S.text),1)]),_:2},1032,["type","onClick"]))),128)):B("",!0),Me(x.$slots,"left"),e.editMode?B("",!0):(o(),O(X,{key:1},[$t,Me(x.$slots,"right"),g.value.delete?(o(),M(W,{key:0,type:"danger",link:"",disabled:e.disabled,onClick:N[0]||(N[0]=S=>d("delete"))},{default:n(()=>[xt,A(" 删除 ")]),_:1},8,["disabled"])):B("",!0),g.value.add?(o(),M(W,{key:1,type:"primary",link:"",disabled:e.disabled,onClick:N[1]||(N[1]=S=>d("add"))},{default:n(()=>[Ct,A(" 新增 ")]),_:1},8,["disabled"])):B("",!0),t(W,{type:"primary",link:"",disabled:e.disabled,onClick:N[2]||(N[2]=S=>d("export"))},{default:n(()=>[Dt,A(" 导出 ")]),_:1},8,["disabled"]),t(P,{placement:"bottom-start",width:z.showFixed?500:300,transition:"el-zoom-in-top",trigger:"click"},{reference:n(()=>[t(W,{type:"primary",link:"",disabled:e.disabled},{default:n(()=>[St,A(" 表格列设置 ")]),_:1},8,["disabled"])]),default:n(()=>[f("div",Vt,[t(w,{modelValue:z.showFixed,"onUpdate:modelValue":N[3]||(N[3]=S=>z.showFixed=S),label:"配置固定列"},null,8,["modelValue"]),t(W,{type:"primary",link:"",onClick:N[4]||(N[4]=S=>J())},{default:n(()=>[Tt,A(" 重置 ")]),_:1})]),t($e,{name:"the-group",tag:"div",class:"the-curd-setting-list the-curd-scrollbar"},{default:n(()=>[(o(!0),O(X,null,ae(e.config.columns,(S,b)=>(o(),O("div",ge({class:"the-curd-option-item f-vertical"},Y(S,b)),[S.prop!==V(ye)?(o(),O("i",Et)):B("",!0),f("span",Ot,le(S.title),1),z.showFixed?(o(),M(u,{key:1,modelValue:S.fixed,"onUpdate:modelValue":l=>S.fixed=l,size:"small",class:"mgr-10"},{default:n(()=>[(o(),O(X,null,ae(I,l=>t(D,{key:l.value.toString(),value:l.value},{default:n(()=>[A(le(l.label),1)]),_:2},1032,["value"])),64))]),_:2},1032,["modelValue","onUpdate:modelValue"])):B("",!0),t(K,{modelValue:S.visible,"onUpdate:modelValue":l=>S.visible=l,"inline-prompt":"","active-text":"显示","inactive-text":"隐藏"},null,8,["modelValue","onUpdate:modelValue"])],16))),256)),e.config.columns.length?B("",!0):(o(),M(H,{key:"empty","image-size":120,description:"暂无可以设置的表格列"}))]),_:1})]),_:1},8,["width"])],64))])}}}),Nt={key:0,class:"el-icon-rank el-icon--left",style:{"line-height":"32px"}},Bt={class:"f-vertical w-full"},At=f("i",{class:"el-icon-edit"},null,-1),Ft=f("i",{class:"el-icon-delete"},null,-1),Lt=f("i",{class:"el-icon--left el-icon-plus"},null,-1),qt=f("i",{class:"el-icon--left el-icon-plus"},null,-1),Wt={key:"bottom-setting"},jt=f("i",{class:"el-icon--left el-icon-delete"},null,-1),Ut=f("i",{class:"el-icon--left el-icon-check"},null,-1),It={name:"TableForm"},Re=re({...It,props:{config:{type:Object,default:()=>Be()},type:{type:String},editMode:{type:Boolean},disabled:{type:Boolean}},emits:["change"],setup(q,{expose:T,emit:e}){const j=q,d=e,s=be(),g=Be(),$=se({config:g,form:{},rules:{}}),I=Oe(),C=Q(()=>j.type==="add"?"新增":"编辑"),v=Q(()=>I.editor.show);function R(S){N(),I.editor.action=S>=0?"edit":"add",I.editor.form=$.config,I.editor.index=S,I.editor.show=!0}function Y(S){const b=$.config.fields;N(),me({title:"操作提示",content:`是否删除【${b[S].label}】？`,cancelText:"取消",confirm(){b.splice(S,1)}})}function z(){me({title:"操作提示",content:`是否移除【${C.value}】表单？移除后将不会出现对应功能按钮。`,cancelText:"取消",confirm(){$.config.fields=[]}})}function F(){d("change")}function J(){const S=j.type==="add"?"编辑":"新增";me({title:"操作提示",content:`是否将表单数据同步到【${S}】表单？`,cancelText:"不同步",confirmText:"同步",cancel(){d("change",$.config)},confirm(){d("change",$.config,!0)}})}function x(S){var b;(b=s.value)==null||b.validate(l=>{if(l&&S){const a=H.value,k={};P.value.forEach(r=>{k[r.key]=a[r.key]}),S(a,k)}})}function N(){var S;(S=s.value)==null||S.clearValidate()}function W(){$.config.fields.forEach(Ee)}function w(S){$.config.fields.forEach(b=>{if(Object.prototype.hasOwnProperty.call(S,b.key)){const l=S[b.key];if(!l)return;switch(b.type){case"date":oe(l,"array")?b.value=l.map(a=>new Date(a)):b.value=new Date(l);break;default:b.value=l;break}}})}const{onDragStart:D,onDragMove:u,onDropEnd:K}=xe({list:()=>$.config.fields,key:"id",findLevel:10});he(()=>j.config,function(S){S&&($.config=ue(S))},{immediate:!0}),he(()=>$.config.fields,function(S){const b={},l={},a=["input","input-between","textarea"];S&&S.forEach(k=>{b[k.key]=k.value,k.required&&(l[k.key]=[{required:!0,validator(r,p,L){const h=[void 0,null,""];if(k.type==="input-between"&&!k.value[0]&&!k.value[1]){L(new Error("请输入两个范围字段"));return}if(k.valueType==="array"&&!k.value.length){L(new Error(k.placeholder||"请选择"));return}if(k.valueType!=="boolean"&&h.includes(k.value)){const i=a.includes(k.type)?"请输入内容":"请选择";L(new Error(k.placeholder||i));return}L()},trigger:a.includes(k.type)?"blur":"change"}])}),$.form=b,$.rules=l,setTimeout(N)},{immediate:!0});const H=Q(()=>{const S={};return $.config.fields.forEach(b=>{S[b.key]=Ue(b).value}),S}),P=Q(()=>$.config.fields.filter(S=>{const b=S.show;if(!b)return!0;if(oe(b,"function"))return b(H.value);if(b.includes("return"))try{return new Function("formData",b)(H.value)}catch(l){console.warn("解析表单展示逻辑代码错误 >>",l)}return!0}));return T({clear:N,validate:x,reset:W,setFormData:w}),(S,b)=>{const l=_("el-button"),a=_("el-form-item"),k=_("el-empty"),r=_("el-form");return o(),M(r,{ref_key:"formRef",ref:s,model:$.form,rules:$.rules,labelWidth:V(_e)($.config.labelWidth),labelPosition:$.config.labelPosition,disabled:j.disabled,style:ke(j.editMode?{width:V(_e)($.config.width)}:null),class:ie([{"is-edit-form":j.editMode}])},{default:n(()=>[j.editMode?(o(),O(X,{key:0},[t($e,{name:"the-group",tag:"div"},{default:n(()=>[(o(!0),O(X,null,ae($.config.fields,(p,L)=>(o(),M(a,{class:ie([{"the-curd-selected":V(I).editor.index===L&&v.value}]),prop:p.key,key:p.id,"data-key":p.id,draggable:$.config.fields.length>1&&!V(I).editor.show?!0:null,onDragstart:h=>V(D)(L),onDragover:h=>V(u)(h,L),onDrop:V(K)},{label:n(()=>[$.config.fields.length>1&&!V(I).editor.show?(o(),O("i",Nt)):B("",!0),f("span",null,le(p.label),1)]),default:n(()=>[f("div",Bt,[t(we,{class:"mgr-10",fieldData:p,editMode:""},null,8,["fieldData"]),t(l,{link:"",type:"success",disabled:v.value,onClick:h=>R(L)},{default:n(()=>[At]),_:2},1032,["disabled","onClick"]),t(l,{link:"",type:"danger",disabled:v.value,onClick:h=>Y(L)},{default:n(()=>[Ft]),_:2},1032,["disabled","onClick"])])]),_:2},1032,["class","prop","data-key","draggable","onDragstart","onDragover","onDrop"]))),128))]),_:1}),$.config.fields.length?B("",!0):(o(),M(k,{key:0,description:`当前没有表单项，当没有表单项时【${C.value}】功能按钮不会出现~`},{default:n(()=>[v.value?B("",!0):(o(),M(l,{key:0,type:"primary",onClick:b[0]||(b[0]=p=>R(-1))},{default:n(()=>[Lt,A(" 添加表单项 ")]),_:1}))]),_:1},8,["description"])),v.value?B("",!0):(o(),O(X,{key:1},[$.config.fields.length?(o(),M(a,{key:"bottom-add"},{default:n(()=>[t(l,{type:"primary",onClick:b[1]||(b[1]=p=>R(-1))},{default:n(()=>[qt,A(" 继续添加 ")]),_:1})]),_:1})):B("",!0),f("div",Wt,[t(l,{link:"",onClick:b[2]||(b[2]=p=>F())},{default:n(()=>[A(" 退出编辑 ")]),_:1}),t(l,{type:"danger",link:"",disabled:!$.config.fields.length,onClick:b[3]||(b[3]=p=>z())},{default:n(()=>[jt,A(" 清空表单 ")]),_:1},8,["disabled"]),t(l,{type:"success",link:"",onClick:b[4]||(b[4]=p=>J())},{default:n(()=>[Ut,A(" 保存表单 ")]),_:1})])],64))],64)):B("",!0),!j.editMode&&$.config&&$.config.fields?(o(!0),O(X,{key:1},ae(P.value,p=>(o(),M(a,{label:p.label,prop:p.key,key:p.id},{default:n(()=>[t(we,{fieldData:p},null,8,["fieldData"])]),_:2},1032,["label","prop"]))),128)):B("",!0)]),_:1},8,["model","rules","labelWidth","labelPosition","disabled","style","class"])}}}),Jt={key:1,class:"the-curd-table-header f-vertical w-full"},Pt={class:"the-curd-table-header-title"},Rt={key:1,class:"the-curd-table-header-title"},Ht={key:2,style:{"padding-left":"6px"}},zt={name:"TableHeader"},He=re({...zt,props:{column:{type:Object,required:!0}},emits:["sort"],setup(q,{emit:T}){const e=q,j=T,d=Q(()=>!e.column.sort&&!e.column.iconTips);function s(g){e.column.sort===g&&(g=!0),j("sort",e.column.prop,g)}return(g,$)=>{const I=_("el-tooltip");return d.value?(o(),O(X,{key:0},[A(le(e.column.title),1)],64)):(o(),O("div",Jt,[e.column.iconTips?(o(),M(I,{key:0,effect:"dark",content:e.column.iconTips,placement:"top"},{default:n(()=>[f("span",Pt,le(e.column.title),1)]),_:1},8,["content"])):(o(),O("span",Rt,le(e.column.title),1)),e.column.sort?(o(),O("div",Ht,[f("div",{class:ie(["the-sort-icon top",{"is-select":e.column.sort==="asc"}]),onClick:$[0]||($[0]=C=>s("asc"))},null,2),f("div",{class:ie(["the-sort-icon bottom",{"is-select":e.column.sort==="desc"}]),onClick:$[1]||($[1]=C=>s("desc"))},null,2)])):B("",!0)]))}}}),Kt={name:"TableColumnConfig"},Gt=re({...Kt,props:{show:{type:Boolean,required:!0},type:{type:String,required:!0},keys:{type:Array,required:!0},form:Object},emits:["update:show","submit"],setup(q,{emit:T}){const e=q,j=T,d=se({show:!1,form:Te("","")}),s=Q(()=>({add:"新增",edit:"编辑",copy:"复制"})[e.type]+"表格列"),g=be(),$={title:{required:!0,message:"请输入表格列标题",trigger:"blur"},prop:{required:!0,validator(F,J,x){J?e.keys.includes(d.form.prop)?x(new Error("已经存在相同的值！")):x():x(new Error("输入字段不能为空！"))},trigger:"blur"},cellType:{required:!0,message:"请选择展示类型",trigger:"change"},sort:{required:!0,message:"请选择排序操作",trigger:"change"},jsCode:{required:!0,validator(F,J,x){J?J.includes("return")?x():x(new Error('代码片段必须带有返回字段 "return"')):x(new Error("代码片段不能为空！"))},trigger:"blur"}},I=[{label:"默认普通文本",value:"text"},{label:"图片预览组件",value:"image"},{label:"自定义 js 代码",value:"js"}],C=[{label:"不可排序",value:!1},{label:"可排序",value:!0},{label:"默认升序",value:"asc"},{label:"默认降序",value:"desc"}],v=`
<p>函数代码片段：</p>
<p>第一个参数${ne("cellValue")}是表格值;</p>
<p>第二个参数${ne("row")}是完整对象;</p>
<p>例如：${ne("return cellValue + row.id;")};</p>
<p>也可以是HTML：${ne("return `html 标签`")};</p>
`,R=[{label:"表格列标题",prop:"title",type:"input",placeholder:$.title.message},{label:"表格列键值",prop:"prop",type:"input",placeholder:"请输入表格列键值"},{label:"表格列宽度",prop:"width",type:"number",placeholder:"请输入表格列宽度，例如：120（默认自适应）"},{label:"表格列最小宽度",prop:"minWidth",type:"number",placeholder:"请输入表格列最小宽度，例如：120（默认自适应）"},{label:"表格列展示类型",prop:"cellType",type:"select",options:I},{label:"图片宽度",prop:"imageWidth",type:"number",placeholder:"请输入数字（默认80px）",show:()=>d.form.cellType==="image"},{label:"图片高度",prop:"imageHeight",type:"number",placeholder:"请输入数字（默认80px）",show:()=>d.form.cellType==="image"},{label:"js代码",prop:"jsCode",type:"textarea",placeholder:"请输入代码片段",tooltip:v,tips:'例如：return `<span class="the-tag blue">${cellValue || "-"}<span>`;',show:()=>d.form.cellType==="js"},{label:"表格列排序操作",prop:"sort",type:"select",options:C},{label:"表格列排版",prop:"align",type:"select",options:[{label:"靠左对齐(默认)",value:"left"},{label:"居中对齐",value:"center"},{label:"靠右对齐",value:"right"}]},{label:"表头提示文字",prop:"iconTips",type:"input",placeholder:"请输入提示文字",tooltip:"鼠标放到表格头时出现提示文案"},{label:"内容溢出截断",prop:"tooltip",type:"switch"},{label:"表格列默认展示",prop:"visible",type:"switch",inactiveText:"隐藏",activeText:"显示"}];function Y(){j("update:show",!1)}function z(){var F;(F=g.value)==null||F.validate(J=>{if(!J)return;const x=ue(d.form);["width","minWidth","imageWidth","imageHeight"].forEach(W=>{x[W]&&(x[W]=Number(x[W]))}),x.cellType==="image"&&(x.slot=x.prop),(x.sort||x.iconTips)&&(x.slotHead=`header-${x.prop}`),j("submit",x),Y()})}return he(()=>e.show,function(F){d.show=F,F&&(e.type==="add"?d.form=Te("",""):(d.form=ue(e.form),e.type==="copy"&&(d.form.prop="")),setTimeout(()=>{var J;return(J=g.value)==null?void 0:J.clearValidate()}))},{immediate:!0}),(F,J)=>{const x=_("el-form"),N=_("base-dialog");return o(),M(N,{show:d.show,"onUpdate:show":J[0]||(J[0]=W=>d.show=W),title:s.value,width:"580px",onClose:Y},{footer:n(()=>[t(V(Ce),{onClose:Y,onSubmit:z})]),default:n(()=>[t(x,{ref_key:"formRef",ref:g,model:d.form,rules:$,"label-position":"right","label-width":"130px"},{default:n(()=>[t(V(ve),{data:d.form,list:R},null,8,["data"])]),_:1},8,["model"])]),_:1},8,["show","title"])}}}),Zt=f("p",{class:"mgb-10"},"表格数据中的字段，例如表格数：",-1),Xt=f("p",{class:"mgb-10"},"则键值可以为 id",-1),Qt=f("p",null,[f("i",{class:"el-icon-info el-icon--left"}),A(" 不填则没有删除功能 ")],-1),Yt={name:"TableDeleteConfig"},el=re({...Yt,props:{show:{type:Boolean,default:!1},selectKey:{type:String,default:""}},emits:["update:show","submit"],setup(q,{emit:T}){const e=q,j=T,d='[{ id: 1, name: "名称", status: 2 }]',s=se({show:!1,keyword:""});function g(){j("update:show",!1)}function $(){g(),j("submit",s.keyword)}return he(()=>e.show,function(I){s.show=I,I&&(s.keyword=e.selectKey||"")},{immediate:!0}),(I,C)=>{const v=_("el-input"),R=_("el-form-item"),Y=_("el-form"),z=_("base-dialog");return o(),M(z,{show:s.show,"onUpdate:show":C[1]||(C[1]=F=>s.show=F),title:"配置表格删除功能",width:"400px",onClose:g},{footer:n(()=>[t(V(Ce),{onClose:g,onSubmit:$})]),default:n(()=>[t(Y,{labelPosition:"right",labelWidth:"120px"},{default:n(()=>[t(R,{label:"数据键值"},{default:n(()=>[t(v,{class:"mgb-10",modelValue:s.keyword,"onUpdate:modelValue":C[0]||(C[0]=F=>s.keyword=F),placeholder:"请输入数据键值",clearable:""},null,8,["modelValue"]),f("div",{class:"the-tag blue"},[Zt,f("p",{class:"mgb-10"},le(d)),Xt,Qt])]),_:1})]),_:1})]),_:1},8,["show"])}}}),tl={class:"flex"},ll={class:"f1"},ol={class:"f-right w-full"},nl=f("i",{class:"el-icon--left el-icon-finished"},null,-1),al=f("i",{class:"el-icon--left el-icon-plus"},null,-1),il=["data-key","draggable","onDragstart","onDragover"],sl={key:0,class:"el-icon--left el-icon-rank"},rl=f("div",{class:"f1"},null,-1),ul=f("i",{class:"el-icon-delete"},null,-1),dl=f("i",{class:"el-icon-edit"},null,-1),cl={key:1,class:"w-full f-right"},pl=f("i",{class:"el-icon--left el-icon-plus"},null,-1),fl={name:"TableActionConfig"},ml=re({...fl,props:{show:{type:Boolean,default:!1},list:{type:Array,required:!0},columnWidth:{type:Number},actionMax:{type:Number}},emits:["update:show","submit"],setup(q,{emit:T}){const e=q,j=T,d=`
<p>可以输入代码片段，</p>
<p>以${ne("return")}关键字为函数标记，</p>
<p>函数第一个参数${ne("row")}是表格对象值</p>
<p>例如：${ne('return row.status === 1 ? "下架" : "上架";')}</p>
`,s=`
<p>函数代码片段，点击的时候运行</p>
<p>函数第一个参数${ne("row")}是表格对象值</p>
<p>第二个参数${ne("index")}是当前索引</p>
<p>例如：${ne("console.log(row, index);")}</p>
`,g=`
<p>可以输入代码片段，</p>
<p>以${ne("return")}关键字为函数标记，</p>
<p>函数第一个参数${ne("row")}是表格对象值</p>
<p>例如：${ne("return row.status === 1;")}返回布尔值进行判断</p>
`,$=be(),I=be(),C=se({show:!1,list:[],index:-1,hasEdit:!1,formEdit:!1}),v=se({btn:Se(),column:{width:160,max:3}}),R={width:{required:!0,message:"请输入表格列宽度，例如：160",trigger:"blur"},max:{required:!1,message:"请输入数量，超出用“更多”下拉展示",trigger:"blur"}},Y=[{label:"操作列宽度",prop:"width",type:"number",placeholder:R.width.message},{label:"操作按钮限制",prop:"max",type:"number",min:2,placeholder:R.max.message}],z={text:{required:!0,message:"请输入按钮文字",trigger:"blur"},click:{required:!0,message:"请输入按钮操作代码",trigger:"blur"},icon:{required:!1,message:"请输入图标 class",trigger:"blur"},type:{required:!1,message:"请选择按钮类型",trigger:"change"}},F=[{label:"按钮文字",prop:"text",type:"textarea",placeholder:z.text.message,tooltip:d},{label:"按钮功能代码",prop:"click",type:"textarea",placeholder:"请输入代码片段",tooltip:s},{label:"按钮显示条件",prop:"show",type:"textarea",placeholder:"请输入条件代码，为空则默认显示",tooltip:g},{label:"按钮禁用条件",prop:"disabled",type:"textarea",placeholder:"请输入条件代码，为空则默认不禁用",tooltip:g},{label:"按钮图标",prop:"icon",type:"slot",slotName:"iconInput"},{label:"按钮类型",prop:"type",type:"select",options:[{label:"默认（蓝色）",value:"primary"},{label:"成功（绿色）",value:"success"},{label:"警告（橙色）",value:"warning"},{label:"危险（红色）",value:"danger"},{label:"文本（灰色）",value:"info"}]}];function J(){j("update:show",!1)}function x(){I.value.validate(b=>{if(!b)return;J();const{width:l,max:a}=v.column;j("submit",ue(C.list),l,a)})}function N(b){$.value.validate(l=>{if(!l)return;const a=ue(v.btn);b==="add"?C.list.push(a):C.list[C.index]=v.btn,W()})}function W(){C.index=-1,v.btn=Se(),C.formEdit=!1,setTimeout(()=>{var b;return(b=$.value)==null?void 0:b.clearValidate()})}function w(b){const l=C.list[b];v.btn=JSON.parse(JSON.stringify(l)),C.index=b,C.formEdit=!0}function D(b){C.list.splice(b,1)}he(()=>e.show,function(b){C.show=b,b&&(C.list=ue(e.list),C.hasEdit=C.list.some(l=>l.key===fe),C.index=-1,v.btn=Se(),v.column={width:e.columnWidth,max:e.actionMax},setTimeout(()=>{var l,a;(l=$.value)==null||l.clearValidate(),(a=I.value)==null||a.clearValidate()}))},{immediate:!0});const{onDragStart:u,onDragMove:K,onDropEnd:H}=xe({list:()=>C.list,key:"key"});function P(b){if(b.key!=fe&&C.list.length>1&&C.index===-1)return!0}function S(b){const l=b.text;if(oe(l,"string")){if(!l.includes("return"))return l;let a="文字配置有误";try{a=new Function("row",l)({})}catch(k){console.warn("解析按钮文字代码错误 >>",k)}return a}return oe(l,"function")?l({}):"未设置按钮"}return(b,l)=>{const a=_("el-text"),k=_("el-divider"),r=_("el-form"),p=_("el-button"),L=_("el-form-item"),h=_("el-popconfirm"),i=_("el-empty"),te=_("base-dialog");return o(),M(te,{show:C.show,"onUpdate:show":l[6]||(l[6]=m=>C.show=m),title:"配置操作列按钮功能",width:"880px",onClose:J},{footer:n(()=>[t(V(Ce),{disabledSubmit:C.formEdit,onClose:J,onSubmit:x},null,8,["disabledSubmit"])]),default:n(()=>[f("div",tl,[f("section",ll,[t(k,{"content-position":"left","border-style":"dashed"},{default:n(()=>[t(a,{type:"info"},{default:n(()=>[A("操作列配置")]),_:1})]),_:1}),t(r,{ref_key:"formColumn",ref:I,model:v.column,rules:R,labelPosition:"right",labelWidth:"128px"},{default:n(()=>[t(V(ve),{data:v.column,list:Y},null,8,["data"])]),_:1},8,["model"]),t(k,{"content-position":"left","border-style":"dashed"},{default:n(()=>[t(a,{type:"info"},{default:n(()=>[A("操作按钮配置")]),_:1})]),_:1}),t(r,{ref_key:"formBtn",ref:$,model:v.btn,rules:z,labelPosition:"right",labelWidth:"128px",class:ie({"the-filter-mask":!C.formEdit}),"data-tips":"待新增或编辑操作"},{default:n(()=>[t(V(ve),{data:v.btn,list:F},{iconInput:n(()=>[t(V(bt),{value:v.btn.icon,"onUpdate:value":l[0]||(l[0]=m=>v.btn.icon=m)},null,8,["value"])]),_:1},8,["data"]),t(L,null,{default:n(()=>[f("div",ol,[t(p,{onClick:l[1]||(l[1]=m=>W())},{default:n(()=>[A("取 消")]),_:1}),C.index>-1?(o(),M(p,{key:0,type:"primary",plain:"",onClick:l[2]||(l[2]=m=>N("edit"))},{default:n(()=>[nl,A(" 确认修改 ")]),_:1})):(o(),M(p,{key:1,type:"primary",plain:"",onClick:l[3]||(l[3]=m=>N("add"))},{default:n(()=>[al,A(" 确认新增 ")]),_:1}))])]),_:1})]),_:1},8,["model","class"])]),t($e,{name:"the-group",tag:"div",class:"the-curd-option-list f1"},{default:n(()=>[(o(!0),O(X,null,ae(C.list,(m,c)=>(o(),O("div",{class:ie(["the-curd-option-item f-vertical",{"the-curd-selected":c===C.index}]),key:m.key,"data-key":m.key!==V(fe)?m.key:null,draggable:P(m),onDragstart:y=>V(u)(c),onDragover:y=>V(K)(y,c),onDrop:l[4]||(l[4]=(...y)=>V(H)&&V(H)(...y))},[C.index===-1&&m.key!==V(fe)?(o(),O("i",sl)):B("",!0),t(p,{type:m.type,link:""},{default:n(()=>[m.icon?(o(),O("i",{key:0,class:ie(["el-icon--left",m.icon])},null,2)):B("",!0),A(" "+le(S(m)),1)]),_:2},1032,["type"]),rl,m.key===V(fe)?(o(),M(a,{key:1,type:"info",size:"small"},{default:n(()=>[A("编辑按钮不可删除、拖拽等操作，且处于首位")]),_:1})):(o(),O(X,{key:2},[t(h,{width:"186px",title:"是否删除该按钮功能？",onConfirm:y=>D(c)},{reference:n(()=>[t(p,{link:"",type:"danger",disabled:C.index>-1},{default:n(()=>[ul]),_:1},8,["disabled"])]),_:2},1032,["onConfirm"]),t(p,{link:"",type:"success",onClick:y=>w(c)},{default:n(()=>[dl]),_:2},1032,["onClick"])],64))],42,il))),128)),C.list.length?B("",!0):(o(),M(i,{key:"empty","image-size":120,description:"请添加操作列功能按钮"})),C.formEdit?B("",!0):(o(),O("div",cl,[C.formEdit?B("",!0):(o(),M(p,{key:0,type:"primary",plain:"",onClick:l[5]||(l[5]=m=>C.formEdit=!0)},{default:n(()=>[pl,A(" 新增功能按钮 ")]),_:1}))]))]),_:1})])]),_:1},8,["show"])}}}),yl={class:"the-curd-table-model the-curd-scrollbar"},hl=["data-key","draggable","onDragstart","onDragover"],gl=f("i",{class:"el-icon-rank el-icon--left"},null,-1),vl=f("i",{class:"el-icon-arrow-down el-icon--right"},null,-1),bl={key:1,class:"the-tag blue"},_l=f("div",{class:"fake-table-head fvc"},"操作",-1),kl={class:"fake-table-cell operation fvc"},wl=f("i",{class:"el-icon-setting"},null,-1),$l=f("i",{class:"el-icon-delete"},null,-1),xl={class:"fake-table-cell disabled"},Cl={class:"f-vertical",key:"right-setting"},Dl=f("i",{class:"el-icon-plus el-icon--left"},null,-1),Sl={key:0},Vl=f("i",{class:"el-icon-plus el-icon--left"},null,-1),Tl={key:1},El={key:0,class:"the-tag blue mgl-10"},Ol=f("i",{class:"el-icon--left el-icon-info"},null,-1),Ml={name:"TableModel"},Nl=re({...Ml,props:{config:{type:Object,required:!0}},emits:["action"],setup(q,{emit:T}){const e=q,j=T,d="https://fuss10.elemecdn.com/e/5d/4a731a90594a4af544c0c25941171jpeg.jpeg",s=[{key:"edit",label:"编辑列",icon:"el-icon-edit",click(r){I("edit",r)}},{key:"copy",label:"复制列",icon:"el-icon-document-copy",click(r){I("copy",r)}},{key:"delete",label:"删除列",icon:"el-icon-delete",click(r){v(r)}}],g=se({show:!1,type:"add",index:-1,form:void 0,keys:[]}),$=Q(()=>{const r=e.config.columns,p=[],L=[];for(let h=0;h<r.length;h++){const i=r[h];i.prop===ye?L.push(i):p.push(i)}return{drag:p,action:L}});function I(r,p){g.keys=e.config.columns.map(h=>h.prop),{add(){g.form=void 0},edit(){const h=e.config.columns[p];g.keys=g.keys.filter(i=>i!==h.prop),g.index=p,g.form=h},copy(){const h=e.config.columns[p];g.form=h}}[r](),g.type=r,g.show=!0}function C(r){const p=e.config;if(["add","copy"].includes(g.type)){const L=ue($.value.drag);L.push(r),p.columns=L.concat($.value.action)}else p.columns[g.index]=r}function v(r){const p=$.value.drag[r];me({title:"操作提示",content:`是否删除【${p.title}】列？`,cancelText:"取消",confirm(){const L=e.config.columns.findIndex(h=>h.prop===p.prop);e.config.columns.splice(L,1)}})}const{onDragStart:R,onDragMove:Y,onDropEnd:z}=xe({list:()=>e.config.columns,key:"prop",findLevel:5});function F(r){const p={};return r&&r.width&&(p.width=`${r.width}px`),r&&r.minWidth&&(p.minWidth=`${r.minWidth}px`),p}const J=Q(function(){const r=e.config.columns;if(r.length>0&&r[r.length-1].prop===ye)return r[r.length-1]});function x(){const r=Te(ye,"操作");r.minWidth=120,r.width=160,e.config.columns.push(r)}function N(){const r=e.config.columns;me({title:"操作提示",content:"是否删除操作列？删除之后需要重新配置。",cancelText:"取消",confirm(){r.splice(r.length-1,1),e.config.actions=[],e.config.formEdit&&(e.config.formEdit=void 0)}})}const W=se({show:!1,keyword:""});function w(){const r=e.config.selectKey;W.keyword=r?r.toString():"",W.show=!0}function D(r){e.config.selectKey=r}const u=se({show:!1,columnWidth:0,actionMax:0});function K(){u.show=!0,u.columnWidth=J.value.width,u.actionMax=e.config.actionMax}function H(r,p){e.config.actions=r;const L=e.config.columns.find(h=>h.prop===ye);L.width=p}const P=se({show:!1,form:null,type:"add"});function S(r){P.type=r,r==="add"&&e.config.formAdd&&(P.form=e.config.formAdd),r==="edit"&&e.config.formEdit&&(P.form=e.config.formEdit),P.show=!0}function b(r,p){const L=e.config,h=L.actions;function i(){const te=h.length>0&&h[0].key===fe;r&&r.fields.length>0?(J.value||x(),te||h.unshift({key:fe,text:"编辑",type:"success",icon:"el-icon-edit"})):te&&h.splice(0,1)}r&&(P.type==="add"?(L.formAdd=r,p&&(L.formEdit=ue(r),i())):(L.formEdit=r,p&&(L.formAdd=ue(r)),i())),P.show=!1,P.form=null}function l(r){switch(r){case"delete":w();break;case"add":S("add");break;case"edit":S("edit");break}}const a=Q(()=>$.value.drag.some(r=>!r.width&&!r.minWidth));function k(r){if(r==="complete"&&a.value){const p=Array.from(document.querySelectorAll(".fake-table-head")),L={};p.forEach(h=>{const i=h.dataset.head||"";i&&(L[i]=Math.round(h.clientWidth))}),e.config.columns.forEach(h=>{Object.prototype.hasOwnProperty.call(L,h.prop)&&(h.minWidth=L[h.prop])})}j("action",r)}return(r,p)=>{const L=_("el-empty"),h=_("el-button"),i=_("el-dropdown-item"),te=_("el-dropdown-menu"),m=_("el-dropdown"),c=_("el-tooltip"),y=_("base-table-actions"),E=_("el-text");return o(),O(X,null,[P.show?B("",!0):(o(),M(Pe,{key:0,editMode:!0,config:e.config,onAction:l},null,8,["config"])),f("div",yl,[P.show?(o(),M(Re,{key:0,config:P.form,type:P.type,editMode:!0,onChange:b},null,8,["config","type"])):(o(),M($e,{key:1,name:"the-group",tag:"div",class:"fake-table"},{default:n(()=>[e.config.columns.length?B("",!0):(o(),M(L,{key:"empty",style:{padding:"10px 40px"},"image-size":120,description:"请添加表格列"})),(o(!0),O(X,null,ae($.value.drag,(U,G)=>(o(),O("div",{key:U.prop,"data-key":U.prop,class:"fake-table-item",draggable:$.value.drag.length>1,style:ke(F(U)),onDragstart:Z=>V(R)(G),onDragover:Z=>V(Y)(Z,G),onDrop:p[0]||(p[0]=Z=>V(z)())},[f("div",{class:"fake-table-head f-vertical",style:ke({"text-align":U.align})},[gl,t(He,{column:U},null,8,["column"])],4),f("div",{class:ie(["fake-table-cell operation f-vertical",[U.align?`f-${U.align}`:void 0]])},[t(m,{trigger:"click"},{dropdown:n(()=>[t(te,null,{default:n(()=>[(o(),O(X,null,ae(s,Z=>t(i,{key:Z.key,onClick:ee=>Z.click(G)},{default:n(()=>[f("i",{class:ie(["el-icon--left",Z.icon])},null,2),A(" "+le(Z.label),1)]),_:2},1032,["onClick"])),64))]),_:2},1024)]),default:n(()=>[t(h,{link:"",type:"primary"},{default:n(()=>[A(" 配置列 "),vl]),_:1})]),_:2},1024)],2),f("div",{class:ie(["fake-table-cell f-vertical",[U.align?`f-${U.align}`:void 0]])},[U.cellType==="text"?(o(),O(X,{key:0},[A("文本内容")],64)):U.cellType==="js"?(o(),O("span",bl,"自定义代码")):B("",!0),t(V(Je),{column:U,src:d},null,8,["column"])],2)],44,hl))),128)),J.value?(o(),O("div",{style:ke(F(J.value)),key:V(ye),class:"fake-table-item"},[_l,f("div",kl,[t(c,{effect:"dark",content:"配置【操作按钮】和【操作列】的宽度",placement:"top"},{default:n(()=>[t(h,{circle:"",plain:"",type:"primary",size:"small",onClick:p[1]||(p[1]=U=>K())},{default:n(()=>[wl]),_:1})]),_:1}),t(h,{circle:"",plain:"",type:"danger",size:"small",onClick:p[2]||(p[2]=U=>N())},{default:n(()=>[$l]),_:1})]),f("div",xl,[e.config.actions.length?(o(),M(y,{key:0,row:{},index:1,actions:e.config.actions},null,8,["actions"])):(o(),M(E,{key:1,type:"info"},{default:n(()=>[A("待添加操作~")]),_:1}))])],4)):B("",!0),f("div",Cl,[f("div",null,[f("p",null,[t(h,{type:"primary",text:"",onClick:p[3]||(p[3]=U=>I("add"))},{default:n(()=>[Dl,A(" 添加内容列 ")]),_:1})]),J.value?B("",!0):(o(),O("p",Sl,[t(h,{type:"primary",text:"",onClick:p[4]||(p[4]=U=>x())},{default:n(()=>[Vl,A(" 添加操作列 ")]),_:1})]))])])]),_:1}))]),P.show?B("",!0):(o(),O("div",Tl,[t(V(Ie),{type:P.type,onAction:k},null,8,["type"]),a.value?(o(),O("span",El,[Ol,A(" 当前表格列配置中存在没配置【宽度/最小宽度】，保存时将自动设置最小宽度，提高表格美观性。 ")])):B("",!0)])),t(Gt,{show:g.show,"onUpdate:show":p[5]||(p[5]=U=>g.show=U),type:g.type,keys:g.keys,form:g.form,onSubmit:C},null,8,["show","type","keys","form"]),t(el,{show:W.show,"onUpdate:show":p[6]||(p[6]=U=>W.show=U),"select-key":W.keyword,onSubmit:D},null,8,["show","select-key"]),t(ml,{show:u.show,"onUpdate:show":p[7]||(p[7]=U=>u.show=U),columnWidth:u.columnWidth,actionMax:u.actionMax,list:e.config.actions,onSubmit:H},null,8,["show","columnWidth","actionMax","list"])],64)}}}),Bl={class:"the-curd-example"},Al={name:"Example"},Fl=re({...Al,props:{selected:{type:String},type:{type:String}},emits:["choose"],setup(q,{emit:T}){const e=q,j=T,d=[{...de("input"),placeholder:ce.input},{...de("select"),placeholder:ce.select},{...de("select-multiple"),placeholder:ce["select-multiple"]},{...de("cascader"),placeholder:ce.cascader},{...de("date"),placeholder:ce.date},{...de("checkbox"),options:[{label:"多选-A",value:1},{label:"多选-B",value:2}],defaultValue:[1]},{...de("radio"),options:[{label:"单选-A",value:"radio-1"},{label:"单选-B",value:"radio-2"}],defaultValue:"radio-1"},{...de("switch"),defaultValue:!0},{...de("textarea"),placeholder:ce.textarea},{...de("input-between"),placeholder:["范围区间操作","范围区间操作"]}],s=["radio","checkbox","textarea","switch"],g=Q(()=>e.type==="search"?d.filter($=>!s.includes($.type)):d);return($,I)=>(o(),O("div",Bl,[(o(!0),O(X,null,ae(g.value,C=>(o(),M(we,{key:C.type,"field-data":C,class:ie(["the-curd-example-item fvc",{"the-curd-selected":e.selected===C.type}]),readonly:"",onClick:v=>j("choose",C.type)},null,8,["field-data","class","onClick"]))),128))]))}}),Ll={key:0,class:"the-curd-editor-content"},ql=f("h2",{class:"the-title mgb-20"},"基础设置",-1),Wl={class:"f-vertical f-between mgb-20"},jl=f("h2",{class:"the-title"},"第1步：点击选取组件",-1),Ul={class:"f-vertical mgb-20"},Il={class:"the-title"},Jl=f("div",{class:"f1"},null,-1),Pl={key:0,class:"the-curd-target-box"},Rl=f("a",{href:"https://www.json.cn/",target:"_blank"}," JSON编辑工具 ",-1),Hl={class:"f-right"},zl=f("i",{class:"el-icon--left el-icon-plus"},null,-1),Kl=f("i",{class:"el-icon--left el-icon-edit"},null,-1),Gl={name:"Editor"},Zl=re({...Gl,props:{show:{type:Boolean,default:!1},config:{type:Object,required:!0}},emits:["update:show"],setup(q,{emit:T}){const e=q,j=T;function d(){j("update:show",!1)}const s=["checkbox","radio","switch"],g=["select","select-multiple","radio","checkbox","cascader"],$=["input","textarea","select","radio"],I=["input-between","select-multiple","checkbox","cascader"],C=["input","select","radio"],v=["daterange","datetimerange"],R=C.concat(I),Y=`<p>参考 src/utils/index.ts 中的${ne("formatDate")}函数</p>`,z=`
<p>动态表单项的条件显示逻辑函数；</p>
<p>返回${ne("false")}则不展示对应项；</p>
<p>函数有一个参数：${ne("formData")}为当前表单的数据值；</p>
<p>以${ne("return")}为函数代码片段标记；</p>
<p>例如：${ne("return formData.type !== 2")}</p>
`,F=Oe(),J=Q(()=>F.editor.action==="add"),x=Q(()=>{let m=[];return w.formData&&w.formData.type==="date"&&(m=je[w.formData.dateType].map((y,E)=>({label:y.text,value:E}))),m.unshift({label:"将预览组件中的值设为默认",value:-1}),m}),N=[{label:"整体文字宽度",prop:"labelWidth",type:"number",placeholder:"例如：120(px)"},{label:"文字靠右对齐",prop:"labelRight",type:"switch"}],W=[{label:"表单宽度",prop:"width",type:"number",placeholder:"例如：500(px)"},{label:"文字宽度",prop:"labelWidth",type:"number",placeholder:"例如：140(px)"},{label:"文字靠右排版",prop:"labelPosition",type:"switch",inactiveValue:"left",activeValue:"right"}],w=se({step:0,formData:void 0});function D(m){w.step=m}const u={label:{required:!0,message:"请输入功能标题",trigger:"blur"},key:{required:!0,trigger:"blur",validator(m,c,y){c?i.includes(c)?y(new Error("当前键值已经被占用！")):y():y(new Error("绑定的键值不能为空"))}},format:{required:!0,message:"格式化规则不能为空",trigger:"blur"},separator:{required:!0,message:"请输入串联符号",trigger:"blur"},defaultValue:{required:!0,trigger:"blur",validator(m,c,y){const E=l();E===!0?y():y(new Error(E)),y()}},options:{required:!0,trigger:"blur",validator(m,c,y){const E=a();E===!0?y():y(new Error(E))}},show:{trigger:"blur",validator(m,c,y){if(c&&!c.includes("return")){y(new Error("逻辑代码必须包含 return 关键字"));return}y()}}},K=Q(()=>{const m=w.formData?w.formData.type:"",c=[{label:"组件标题",prop:"label",type:"input",placeholder:u.label.message},{label:"绑定的键值",prop:"key",type:"input",placeholder:"请输入绑定的键值"},{label:"标题宽度",prop:"labelWidth",type:"number",placeholder:"例如：120(px)"},{label:"组件宽度",prop:"valueWidth",type:"number",placeholder:"例如：140(px)",show:()=>!s.includes(m)},{label:"提示/规则文字",prop:"placeholder",type:"slot",slotName:"ruleText"},{label:"是否必填",prop:"required",type:"switch"}];if(R.includes(m)){const y={label:"绑定值为数字类型",prop:"valueType",type:"switch",activeValue:"number",inactiveValue:"string"};I.includes(m)&&(y.activeValue="array<number>",y.inactiveValue="array"),g.includes(m)&&(y.tips="设为数字类型之后，将会在保存时校验选项数据"),c.push(y)}if(m!=="date"&&c.push({label:"组件默认值",prop:"defaultValue",type:"slot",slotName:"defaultValue"}),m==="input-between"&&c.push({label:"串联符号",prop:"separator",type:"input",placeholder:u.separator.message}),g.includes(m)){const y=[{label:"选项数据",prop:"options",type:"slot",slotName:"options"},{label:"数据展示字段",prop:"optionSetting.label",type:"input",placeholder:"不填则使用 label"},{label:"数据值字段",prop:"optionSetting.value",type:"input",placeholder:"不填则使用 value"}];if(m==="cascader"){const E=[{label:"下级字段",prop:"optionSetting.children",type:"input",placeholder:"不填则使用 children"},{label:"是否多选",prop:"multiple",type:"switch"},{label:"允许只选中某一项",prop:"checkStrictly",type:"switch"}];y.push(...E)}["select","select-multiple"].includes(m)&&y.push({label:"串联显示名称",prop:"joinShow",type:"switch",tips:"例如【英雄联盟-12】"}),c.push(...y)}if(m==="date"){const y=[{label:"日期类型",prop:"dateType",type:"select",options:Ae,noClear:!0,onChange:p},{label:"日期默认值",prop:"shortcutIndex",type:"select",options:x.value,placeholder:"请选择"},{label:"格式化规则",prop:"format",type:"input",tooltip:Y}];c.push(...y)}return F.editor.type==="table"&&c.push({label:"表单显示逻辑",prop:"show",type:"textarea",placeholder:"请输入条件代码，为空则默认展示",tooltip:z}),c}),H=be(),P=se({options:"",defaultValue:""});function S(m){m.type!=="date"&&(P.defaultValue=JSON.stringify({value:m.defaultValue})),g.includes(m.type)&&(P.options=JSON.stringify(m.options))}function b(m){var E;const c=F.editor,y=de(m,"",c.type==="search");w.formData=y,S(y),(E=H.value)==null||E.clearValidate(),D(1)}function l(){const m='输入的格式必须为 { "value": "input value" }',c=P.defaultValue;if(!c)return m;const y=w.formData.type,E=w.formData.valueType,U=ce[y];try{const G=JSON.parse(c);if(!oe(G,"object"))return m;if(y==="switch"&&!oe(G.value,"boolean"))return`${U}的绑定值应该为 boolean 类型`;if(I.includes(y)){if(!oe(G.value,"array"))return`${U}的绑定值应该为 array 类型`;if(E==="array<number>"&&G.value.some(Z=>Z!==""&&!oe(Z,"number")))return"数组中只能出现数字"}if($.includes(y)&&!["string","number"].includes(Le(G.value)))return`${U}的绑定值应该为 string/number 类型`;if(y==="date"){const Z=w.formData;if(v.includes(Z.dateType)){if(!oe(G.value,"array"))return"范围日期绑定值应该为 array 类型"}else if(!oe(G.value,"string"))return"日期类型绑定值应该为 string 类型"}if(C.includes(y)&&E==="number"&&G.value!==""&&!oe(G.value,"number"))return`${U}的绑定值应该为 number 类型`}catch(G){return console.warn("checkDefaultValue >>",G),m}return!0}function a(){const m=P.options;if(!m)return"选项数据不能为空！";try{const c=JSON.parse(m);if(!oe(c,"array"))return"选项数据格式不正确，需要为数组类型！";const y=w.formData,E=y.optionSetting.value||"value",U=[void 0,null];for(let G=0;G<c.length;G++){const Z=c[G];if(!oe(Z,"object"))return"数组项必须为对象！";if(U.includes(Z[E]))return`数组项的值不能为${U.join("/")}`;if(["array<number>","number"].includes(y.valueType)&&!oe(Z[E],"number")&&Z[E]!=="")return"数组项的值必须为 number 类型"}return!0}catch(c){return console.warn("checkOptions >>",c),"不合法的JSON,注意使用双引号,结尾不能为逗号等"}}function k(){a()===!0&&(w.formData.options=JSON.parse(P.options))}function r(){if(l()===!0){const c=w.formData,y=JSON.parse(P.defaultValue).value;c.type!=="date"&&(c.defaultValue=y)}}function p(m){const c=Ae.find(E=>E.value===m),y=w.formData;y.shortcutIndex="",v.includes(c.value)?(y.value=[],y.valueType="array"):(y.value="",y.valueType="string"),y.formatShow=c.formatShow,y.format=c.format}function L(m){return/^[+-]?(\d|([1-9]\d+))(\.\d+)?$/.test(m)}function h(){var m;(m=H.value)==null||m.validate(c=>{if(at("#the-editor-form",c),!c)return;r(),g.includes(w.formData.type)&&k();const y=F.editor,E=JSON.parse(JSON.stringify(w.formData));if(g.includes(E.type)&&k(),E.valueType||(E.valueType=Le(E.defaultValue)),g.includes(E.type)&&["number","array<number>"].includes(E.valueType)){let G=E.optionSetting.value;G||(G="value",E.optionSetting.value=G);for(let Z=0;Z<E.options.length;Z++){const ee=E.options[Z],De=ee[G];if([null,void 0].includes(De))return pe.error("数据值字段与选项数据不匹配，请检查！");if(L(De.toString()))ee[G]=Number(De);else{const ze=ee[E.optionSetting.label];return pe.error(`选项数据中【${ze}】的值应该为数字！`)}}}E.type==="date"&&(E.shortcutIndex===-1&&(E.shortcutDate=E.value),E.value=E.valueType==="array"?[]:""),{search(G){G?e.config.search.list.push(E):e.config.search.list[y.index]=E},table(G){if(G){const Z=JSON.parse(JSON.stringify(y.form.fields));Z.push(E),y.form.fields=Z}else{const Z=JSON.parse(JSON.stringify(y.form.fields));Z[y.index]=E,y.form.fields=Z}}}[y.type](J.value),d()})}let i=[];function te(m){const c=F.editor;i=[],{search(){i=e.config.search.list.map(E=>E.key)},table(){i=c.form.fields.map(E=>E.key)}}[c.type](),m&&(i=i.filter(E=>E!==m))}return he(()=>e.show,function(m){if(!m){w.formData=void 0;return}const c=F.editor;if(c.action==="add")w.step=0,w.formData=void 0,te();else{const y=c.index;({search(){w.formData=JSON.parse(JSON.stringify(e.config.search.list[y]))},table(){var U;w.formData=JSON.parse(JSON.stringify((U=c.form)==null?void 0:U.fields[y]))}})[c.type](),S(w.formData),te(w.formData.key),w.step=1}}),(m,c)=>{const y=_("el-form"),E=_("el-button"),U=_("el-input"),G=_("el-text");return o(),O("section",{class:ie(["the-curd-editor the-curd-scrollbar",{"is-show":e.show}])},[t(Ke,{name:"the-curd-editor-move"},{default:n(()=>{var Z;return[e.show?(o(),O("div",Ll,[ql,t(y,{"label-position":"right","label-width":"120px"},{default:n(()=>[V(F).editor.type==="search"?(o(),M(V(ve),{key:0,data:e.config.search,list:N},null,8,["data"])):B("",!0),V(F).editor.type==="table"&&V(F).editor.form?(o(),M(V(ve),{key:1,data:V(F).editor.form,list:W},null,8,["data"])):B("",!0)]),_:1}),w.step===0?(o(),O(X,{key:0},[f("div",Wl,[jl,t(E,{link:"",type:"primary",onClick:c[0]||(c[0]=ee=>d())},{default:n(()=>[A("退出编辑")]),_:1})]),t(Fl,{selected:(Z=w.formData)==null?void 0:Z.type,type:V(F).editor.type,onChoose:b},null,8,["selected","type"])],64)):B("",!0),w.step===1?(o(),O(X,{key:1},[f("div",Ul,[f("h2",Il,"第2步：配置"+le(V(ce)[w.formData.type]),1),Jl,t(E,{link:"",type:"success",onClick:c[1]||(c[1]=ee=>D(0))},{default:n(()=>[A("上一步")]),_:1}),t(E,{link:"",type:"primary",onClick:c[2]||(c[2]=ee=>d())},{default:n(()=>[A("退出编辑")]),_:1})]),w.formData?(o(),O("div",Pl,[t(we,{"field-data":w.formData,"edit-mode":""},null,8,["field-data"])])):B("",!0),w.formData?(o(),M(y,{key:1,id:"the-editor-form",ref_key:"formRef",ref:H,model:w.formData,rules:u,"label-position":"right","label-width":"128px"},{default:n(()=>[t(V(ve),{data:w.formData,list:K.value},{ruleText:n(()=>[w.formData.type==="input-between"?(o(),O(X,{key:0},[t(U,{modelValue:w.formData.placeholder[0],"onUpdate:modelValue":c[3]||(c[3]=ee=>w.formData.placeholder[0]=ee),class:"f1",clearable:"",placeholder:"请输入提示-1"},null,8,["modelValue"]),t(G,{style:{padding:"0 6px"}},{default:n(()=>[A("-")]),_:1}),t(U,{modelValue:w.formData.placeholder[1],"onUpdate:modelValue":c[4]||(c[4]=ee=>w.formData.placeholder[1]=ee),class:"f1",clearable:"",placeholder:"请输入提示-2"},null,8,["modelValue"])],64)):(o(),M(U,{key:1,modelValue:w.formData.placeholder,"onUpdate:modelValue":c[5]||(c[5]=ee=>w.formData.placeholder=ee),clearable:"",placeholder:"请输入规则提示/输入框提示文字"},null,8,["modelValue"]))]),defaultValue:n(()=>[t(U,{modelValue:P.defaultValue,"onUpdate:modelValue":c[6]||(c[6]=ee=>P.defaultValue=ee),type:"textarea",clearable:"",placeholder:"请输入JSON，值为 value",onBlur:c[7]||(c[7]=ee=>r())},null,8,["modelValue"])]),options:n(()=>[t(U,{modelValue:P.options,"onUpdate:modelValue":c[8]||(c[8]=ee=>P.options=ee),type:"textarea",placeholder:"请输入数组JSON",style:{"margin-bottom":"4px"},onBlur:c[9]||(c[9]=ee=>k())},null,8,["modelValue"]),t(E,{link:"",type:"primary"},{default:n(()=>[Rl]),_:1})]),_:1},8,["data","list"]),f("div",Hl,[t(E,{onClick:c[10]||(c[10]=ee=>d())},{default:n(()=>[A("关闭")]),_:1}),J.value?(o(),M(E,{key:0,type:"primary",onClick:c[11]||(c[11]=ee=>h())},{default:n(()=>[zl,A(" 新增 ")]),_:1})):(o(),M(E,{key:1,type:"success",onClick:c[12]||(c[12]=ee=>h())},{default:n(()=>[Kl,A(" 确认 ")]),_:1}))])]),_:1},8,["model"])):B("",!0)],64)):B("",!0)])):B("",!0)]}),_:1})],2)}}}),Xl={class:"the-curd-main-page"},Ql={key:2},Yl={key:0,class:"the-tag blue"},eo=f("i",{class:"el-icon-arrow-left"},null,-1),to=f("p",{class:"mgb-10"},"配置筛选相关功能",-1),lo=f("p",null,"配置表格相关功能",-1),oo={name:"Curd"},po=re({...oo,props:{data:{type:Object,required:!0},action:{type:Object,required:!0}},setup(q){const T=q,e=se({loading:!1,editor:{show:!1,type:void 0,form:void 0,action:"add",index:-1},showEntrance:!1}),j=Q(()=>{const l=e.editor.type;return l==="search"||!l&&T.data.search.list.length>0});Ze(et,e);let d;function s(l){e.editor.type=l,e.editor.show=!1,e.editor.index=-1,e.showEntrance=!1,d={[l]:ue(T.data[l])}}function g(l){const a=e.editor.type;l&&d&&(T.data[a]=d[a]),e.editor.index=-1,e.editor.show=!1,e.editor.type=void 0,e.editor.form=void 0,d=void 0}function $(){g()}function I(){qe(JSON.stringify(T.data),()=>pe.success("复制成功！"))}function C(l){l&&T.data.search.list.forEach(Ee),v.pageInfo.currentPage=1,v.selectList=[],H()}const v=se({selectList:[],data:[],pageInfo:lt(),formShow:!1,formType:"add",formLoading:!1}),R=Q(()=>T.data.table),Y=Q(()=>R.value.columns.filter(a=>a.visible).map(a=>{const k={...a};return k.cellType==="js"&&k.jsCode&&(k.rawContent=function(r,p){let L="";try{L=new Function("cellValue","row",k.jsCode)(r,p)}catch(h){console.warn("解析 rawContent 代码错误 >>",h),L="-"}return L}),k})),z=Q(()=>R.value.actions.map(a=>{const k={...a};return k.key===fe&&(k.click=w),k})),F=Q(()=>{const l=[],a=[];return Y.value.forEach(k=>{k.slotHead&&l.push(k.slotHead),k.slot&&a.push(k.slot)}),{head:l,cell:a}});function J(l){return R.value.columns.find(k=>k.prop===l)||{}}const x=be(),N=Q(()=>{const l=R.value,a={title:"编辑表单",config:l.formEdit||{}};return v.formType==="add"&&(a.title="新增表单",a.config=l.formAdd||{}),a});let W=null;function w(l){l?(v.formType="edit",W=l):v.formType="add",v.formShow=!0,setTimeout(()=>{var a;return(a=x.value)==null?void 0:a.clear()}),Ge(()=>{var a;return W&&((a=x.value)==null?void 0:a.setFormData(W))})}function D(){var l;v.formShow=!1,(l=x.value)==null||l.reset(),W=null}function u(){var l;(l=x.value)==null||l.validate(async(a,k)=>{if(v.formType==="add"&&T.action.onAdd){v.formLoading=!0;const r=await T.action.onAdd(a,k);if(v.formLoading=!1,r.code!==1)return;D(),H()}if(v.formType==="edit"&&T.action.onEdit){v.formLoading=!0;const r=await T.action.onEdit(a,k);if(v.formLoading=!1,r.code!==1)return;D(),H()}})}function K(l){const a=T.data.search.list,k={};for(let h=0;h<a.length;h++){const i=a[h],te=Ue(i);if(i.required&&oe(te.result,"string"))return it(document.querySelector(`.${i.id}`)),pe.error(te.result),l&&l.key==="page"&&(v.pageInfo=l.before),null;te.result===!0&&(k[i.key]=te.value)}const r=R.value.columns,p=[],L=[];return l&&l.key==="sort"?r.forEach(h=>{h.sort&&(h.prop===l.prop?h.sort=l.action:h.sort=!0),h.sort==="asc"&&p.push(h.prop),h.sort==="desc"&&L.push(h.prop)}):r.forEach(h=>{h.sort==="asc"&&p.push(h.prop),h.sort==="desc"&&L.push(h.prop)}),p.length&&(k.asc=p.toString()),L.length&&(k.desc=L.toString()),k}async function H(l){const a=K(l);if(!a)return;const k=JSON.parse(JSON.stringify(v.pageInfo));e.loading=!0;const r=await T.action.getTableData(a,k);e.loading=!1,r.code===1&&(v.pageInfo.total=r.data.total,v.data=r.data.list||[])}function P(l){const a=v.selectList;switch(l){case"add":w();break;case"delete":if(!a.length)return pe.warning("请选择要删除的列表再进行操作~");me({title:"操作提示",content:`是否删除选中的 ${a.length} 条数据？`,cancelText:"取消",async confirm(){T.action.onDelete?(e.loading=!0,(await T.action.onDelete(JSON.parse(JSON.stringify(v.selectList)))).code===1?(pe.success("删除成功！"),v.selectList=[],H()):e.loading=!1):pe.info("请设置 action.onDelete 删除逻辑")}});break;case"export":T.action.onExport?T.action.onExport():pe.info("请设置 action.onExport 导出逻辑");break}}function S(l){({exit:()=>g(!0),copy:I,complete:$})[l]()}function b(l){e.loading=l}return Ye({formatDate:nt,copyText:qe,messageBox:me,message:pe,jsonToPath:ot,request:st,getData:H,setLoading:b}),We(function(){T.action.created&&R.value.columns.length&&T.action.created(H)}),(l,a)=>{const k=_("base-table"),r=_("base-pagination"),p=_("el-button"),L=_("el-empty"),h=_("base-dialog");return o(),O("div",Xl,[f("section",{class:ie([e.editor.show?"f1":"the-curd-content"])},[j.value?(o(),M(gt,{key:0,data:T.data.search,onSearch:C},null,8,["data"])):B("",!0),e.editor.type==="table"?(o(),M(Nl,{key:1,config:R.value,onAction:S},null,8,["config"])):e.editor.type==="search"?(o(),O("div",Ql,[t(V(Ie),{onAction:S})])):(o(),O(X,{key:3},[R.value.columns.length>0?(o(),O(X,{key:0},[t(Pe,{config:R.value,disabled:e.loading,onAction:P},{left:n(()=>[R.value.selectKey?(o(),O("span",Yl," 已选择 "+le(v.selectList.length)+" 条数据 ",1)):B("",!0)]),_:1},8,["config","disabled"]),t(k,{class:"f1","select-list":v.selectList,"onUpdate:selectList":a[1]||(a[1]=i=>v.selectList=i),data:v.data,columns:Y.value,actions:z.value,actionMax:R.value.actionMax,loading:e.loading,"select-key":R.value.selectKey},Ve({_:2},[ae(F.value.head,i=>({name:i,fn:n(({$index:te})=>[t(He,{column:Y.value[R.value.selectKey?te-1:te],onSort:a[0]||(a[0]=(m,c)=>H({key:"sort",prop:m,action:c}))},null,8,["column"])])})),ae(F.value.cell,i=>({name:i,fn:n(({row:te})=>[t(V(Je),{column:J(i),src:te[i],previewList:F.value.cell.map(m=>te[m])},null,8,["column","src","previewList"])])}))]),1032,["select-list","data","columns","actions","actionMax","loading","select-key"]),t(r,{disabled:e.loading,pageInfo:v.pageInfo,onChange:a[2]||(a[2]=i=>H({key:"page",...i}))},null,8,["disabled","pageInfo"])],64)):(o(),M(L,{key:1,description:"当前页面没有表格配置数据，请配置后再操作~"},{default:n(()=>[t(p,{type:"primary",onClick:a[3]||(a[3]=i=>s("table"))},{default:n(()=>[A("去配置")]),_:1})]),_:1}))],64))],2),t(Zl,{show:e.editor.show,"onUpdate:show":a[4]||(a[4]=i=>e.editor.show=i),config:T.data},null,8,["show","config"]),t(h,{show:v.formShow,"onUpdate:show":a[7]||(a[7]=i=>v.formShow=i),title:N.value.title,width:V(_e)(N.value.config.width),onClose:a[8]||(a[8]=i=>D())},{footer:n(()=>[t(V(Ce),{loading:v.formLoading,onClose:a[5]||(a[5]=i=>D()),onSubmit:a[6]||(a[6]=i=>u())},null,8,["loading"])]),default:n(()=>[t(Re,{ref_key:"formRef",ref:x,config:N.value.config,type:v.formType,disabled:v.formLoading},null,8,["config","type","disabled"])]),_:1},8,["show","title","width"]),!e.showEntrance&&!e.editor.type?(o(),M(p,{key:0,class:"the-curd-entrance",type:"primary",size:"small",onClick:a[9]||(a[9]=i=>e.showEntrance=!0)},{default:n(()=>[eo]),_:1})):B("",!0),t(h,{show:e.showEntrance,"onUpdate:show":a[13]||(a[13]=i=>e.showEntrance=i),title:"请选择配置操作",width:"600px"},{footer:n(()=>[t(p,{onClick:a[12]||(a[12]=i=>e.showEntrance=!1)},{default:n(()=>[A("关 闭")]),_:1})]),default:n(()=>[f("div",{class:"the-curd-entrance-item",onClick:a[10]||(a[10]=i=>s("search"))},[to,t(V(_t))]),f("div",{class:"the-curd-entrance-item",onClick:a[11]||(a[11]=i=>s("table"))},[lo,t(V(kt))])]),_:1},8,["show"])])}}});export{po as _};
