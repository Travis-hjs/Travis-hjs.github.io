import{B as E,C as U,D as J,E as W,G as te,H as K,I as G,n as z,g as ne,z as oe,J as ae,K as se,L as re,T as ie,M as le,N as ce,a as S,b as H,O as ue,P as fe,c as de,f as pe}from"./index-CS_cX-HZ.js";import{d as Q,x as X,r as I,g as T,b as D,k as F,i as v,u as x,m as _,h as j,j as B,F as Y,l as Z,c as h,o as me,A as ge,C as ye,s as ve,e as be,p as he}from"./element-plus-Bs1OMPt8.js";import{r as _e}from"./common-CiilzZy7.js";import{_ as we}from"./Table.vue_vue_type_script_setup_true_lang-CHAlP1s6.js";const ke={name:"TableForm"},Ce=Q({...ke,props:{config:{type:Object,default:()=>E()},type:{type:String},editMode:{type:Boolean},disabled:{type:Boolean}},setup(V,{expose:q}){const u=V,w=X(),r=I({config:E(),form:{},rules:{}});function L(s){w.value&&w.value.validate(o=>{if(o&&s){let n=k.value,p={};P.value.forEach(f=>{const c=f.valueType==="string"?[void 0]:["",void 0];let b=n[f.key];c.includes(b)&&(b=null),p[f.key]=b}),n=K(n),p=K(p),s(n,p)}})}function N(){setTimeout(()=>{var s;(s=w.value)==null||s.clearValidate()})}function m(){r.config.fields.forEach(G)}function g(s){r.config.fields.forEach(o=>{if(Object.prototype.hasOwnProperty.call(s,o.key)){const n=s[o.key];if(!n)return;switch(o.type){case"date":J(n,"array")?o.value=n.map(p=>new Date(p)):o.value=new Date(n);break;default:o.value=n;break}}o.defaultValue=z(o.value)}),N()}function $(s){r.config=z(s||E());const o=r.config.fields||[],n={},p={},f=["input","input-between","textarea"];o.forEach(c=>{n[c.key]=c.value,c.required&&(p[c.key]=[{required:!0,validator(b,R,C){const y=[void 0,null,""];if(c.type==="input-between"&&!c.value[0]&&!c.value[1]){C(new Error("请输入两个范围字段"));return}if(c.valueType==="array"&&!c.value.length){C(new Error(c.placeholder||"请选择"));return}if(c.valueType!=="boolean"&&y.includes(c.value)){const M=f.includes(c.type)?"请输入内容":"请选择";C(new Error(c.placeholder||M));return}C()},trigger:f.includes(c.type)?"blur":"change"}])}),r.form=n,r.rules=p,N()}const k=T(()=>{const s={};return r.config.fields.forEach(o=>{s[o.key]=U(o).value}),s}),P=T(()=>r.config.fields.filter(s=>{const o=s.show;if(!o)return!0;if(J(o,"function"))return o(k.value);if(o.includes("return"))try{return new Function("formData",o)(k.value)}catch(n){console.warn("解析表单展示逻辑代码错误 >>",n)}return!0}));function A(s){if(typeof s!="string")return s;if(s.includes("return"))try{return new Function("formData",s)(k.value)}catch(o){console.warn("解析表单项禁用代码错误 >>",o)}}return q({update:$,validate:L,reset:m,setFormData:g}),(s,o)=>{const n=D("el-form-item"),p=D("el-form");return v(),F(p,{ref_key:"formRef",ref:w,model:r.form,rules:r.rules,"label-width":x(W)(r.config.labelWidth),"label-position":r.config.labelPosition,disabled:u.disabled},{default:_(()=>[r.config&&r.config.fields?(v(!0),j(Y,{key:0},Z(P.value,f=>(v(),F(n,{key:f.id,label:f.label,prop:f.key},{default:_(()=>[h(te,{fieldData:f,disabled:A(f.disabled)},null,8,["fieldData","disabled"])]),_:2},1032,["label","prop"]))),128)):B("",!0)]),_:1},8,["model","rules","label-width","label-position","disabled"])}}}),Se={class:"the-curd-main-page"},xe=["innerHTML"],Ee=he("i",{class:"el-icon-arrow-left"},null,-1),Oe={name:"Curd"},Ne=Q({...Oe,props:{data:{type:Object,required:!0},action:{type:Object,required:!0}},emits:["update:data"],setup(V,{emit:q}){const u=V,w=q,r=I({loading:!1});function L(t){ce({title:"低代码配置",config:u.data,type:t,callback(e){w("update:data",e)}})}function N(t){t&&u.data.search.list.forEach(G),m.pageInfo.currentPage=1,m.selectList=[],y()}const m=I({selectList:[],data:[],pageInfo:ne()}),g=T(()=>u.data.table);function $(t){return g.value.columns.find(a=>a.prop===t)||{}}function k(t,e){let a="-";const i=$(e);if(!i.jsCode)return a;try{a=new Function("cellValue","row",i.jsCode)(t[e],t)}catch(d){console.warn("解析 rawContent 代码错误 >>",d)}return a}function P(t,e){const a="preview-image-",i=e.replace(a,""),d=[];return s.value.forEach(l=>{l.includes(a)&&d.push(t[l.replace(a,"")])}),{column:$(i),src:t[i],previewList:d}}const A=T(()=>g.value.actions.map(e=>{const a={...e};return a.key===oe&&(a.click=function(i){c(i)}),a})),s=T(()=>{const t=[];return g.value.columns.forEach(e=>{e.slot&&t.push(e.slot)}),t}),o=X(),n=I({type:"add",loading:!1,show:!1,config:E()});let p=function(){},f=null;function c(t,e){var l;f=t?JSON.parse(JSON.stringify(t)):{};const a=g.value,i=a.formAdd||E(),d=a.formEdit||E();J(e,"object")?(n.config=e,n.type="other"):(n.type=t?"edit":"add",n.config=JSON.parse(JSON.stringify(t?d:i))),n.show=!0,(l=o.value)==null||l.update(n.config),JSON.stringify(f)!=="{}"&&o.value?p=function(){var O;(O=o.value)==null||O.setFormData(f)}:p=function(){}}function b(){var t;n.show=!1,(t=o.value)==null||t.reset(),f=null}function R(){var t;(t=o.value)==null||t.validate(async(e,a)=>{let i;if(n.type==="add"&&u.action.onAdd&&(i=u.action.onAdd),n.type==="edit"&&u.action.onEdit&&(i=u.action.onEdit),i){n.loading=!0;const d=await i(e,a);if(n.loading=!1,d.code!==1)return;b(),y()}})}function C(){const t=u.data.search.list,e={};for(let a=0;a<t.length;a++){const i=t[a],d=U(i);if(i.required&&J(d.result,"string"))return ue(document.querySelector(`.${i.id}`)),S.error(d.result),null;d.result===!0&&(e[i.key]=d.value)}return e}async function y(){const t=C();if(!t)return;const e=JSON.parse(JSON.stringify(m.pageInfo));r.loading=!0;const a=await u.action.getTableData(t,e);r.loading=!1,a.code===1&&(m.pageInfo.total=a.data.total,m.data=a.data.list||[])}function M(t){const e=m.selectList;switch(t){case"add":c();break;case"delete":if(!e.length)return S.warning("请选择要删除的列表再进行操作~");H({title:"操作提示",content:`是否删除选中的 ${e.length} 条数据？`,cancelText:"取消",async confirm(){u.action.onDelete?(r.loading=!0,(await u.action.onDelete(JSON.parse(JSON.stringify(m.selectList)))).code===1?(S.success("删除成功！"),m.selectList=[],y()):r.loading=!1):S.info("请设置 action.onDelete 删除逻辑")}});break;case"export":u.action.onExport?u.action.onExport():S.info("请设置 action.onExport 导出逻辑");break}}function ee(t){r.loading=t}return ae({formatDate:pe,copyText:de,messageBox:H,message:S,jsonToPath:fe,request:_e,getData:y,setLoading:ee}),me(function(){u.action.created&&g.value.columns.length&&u.action.created(y)}),(t,e)=>{const a=D("el-button"),i=D("el-empty"),d=D("base-dialog");return v(),j("div",Se,[u.data.search.list.length?(v(),F(se,{key:0,search:u.data.search,loading:r.loading,onSearch:N},null,8,["search","loading"])):B("",!0),g.value.columns.length>0?(v(),j(Y,{key:1},[h(re,{config:g.value,disabled:r.loading,onAction:M},null,8,["config","disabled"]),h(x(we),{class:"f1","select-list":m.selectList,"onUpdate:selectList":e[0]||(e[0]=l=>m.selectList=l),data:m.data,columns:g.value.columns,actions:A.value,"action-max":g.value.actionMax,loading:r.loading,"select-key":g.value.selectKey,"page-info":m.pageInfo,onPage:e[1]||(e[1]=l=>y()),onSort:e[2]||(e[2]=l=>y())},ge({_:2},[Z(s.value,l=>({name:l,fn:_(({row:O})=>[l.includes("preview-image-")?(v(),F(x(ie),ye(ve({key:0},P(O,l))),null,16)):B("",!0),l.includes("render-cell-")?(v(),j("div",{key:1,innerHTML:k(O,l.replace("render-cell-",""))},null,8,xe)):B("",!0)])}))]),1032,["select-list","data","columns","actions","action-max","loading","select-key","page-info"])],64)):(v(),F(i,{key:2,description:"当前页面没有表格配置数据，请配置后再操作~"},{default:_(()=>[h(a,{type:"primary",onClick:e[3]||(e[3]=l=>L("table"))},{default:_(()=>[be("去配置")]),_:1})]),_:1})),h(a,{class:"the-curd-entrance",type:"primary",size:"small",onClick:e[4]||(e[4]=l=>L())},{default:_(()=>[Ee]),_:1}),h(d,{show:n.show,"onUpdate:show":e[7]||(e[7]=l=>n.show=l),title:n.config.title,width:x(W)(n.config.width),onClose:b,onOpened:x(p)},{footer:_(()=>[h(x(le),{loading:n.loading,onClose:e[5]||(e[5]=l=>b()),onSubmit:e[6]||(e[6]=l=>R())},null,8,["loading"])]),default:_(()=>[h(Ce,{ref_key:"formRef",ref:o,disabled:n.loading},null,8,["disabled"])]),_:1},8,["show","title","width","onOpened"])])}}});export{Ne as _};
