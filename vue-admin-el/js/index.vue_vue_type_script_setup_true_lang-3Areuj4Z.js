import{h as re,s as Q,o as We,b as _,d as O,e as n,n as xe,u as V,j as M,l as N,A as ge,F as X,c as t,f as l,B as A,t as ne,g as f,y as ae,az as Ve,O as we,D as se,r as ie,w as he,m as Me,i as be,T as Ke,L as Ge,K as Ze}from"./element-plus-x0cfZ0jw.js";import{a as Xe,S as Qe,F as Ne}from"./index-DU6CGFct.js";import{i as Ee,d as _e,f as ce,s as je,u as Oe,c as ye,e as Be,h as Ue,b as Te,j as le,k as Se,a as fe,g as de,l as Ae,m as Ye,p as et}from"./index.vue_vue_type_style_index_0_lang-Bs4qoZDq.js";import{k as oe,l as ue,i as Fe,u as $e,b as me,e as tt,n as Le,a as pe,g as ot,c as qe,p as lt,f as nt}from"./index-CEK233na.js";import{_ as ve}from"./index.vue_vue_type_style_index_0_lang-BPJps2RK.js";import{v as at,s as it}from"./dom-D4K-_gXQ.js";import{r as st}from"./common-CaEq46RD.js";const rt=["title"],ut={name:"Field"},ke=re({...ut,props:{fieldData:{type:Object,required:!0},editMode:Boolean,readonly:Boolean,disabled:Boolean},emits:["change"],setup(q,{emit:T}){const e=q,j=T;Ee(e.fieldData);function d(D){let u=D||e.fieldData.value;oe(u,"array")&&(u=ue(u)),j("change",u)}const s=Q(()=>e.fieldData),g=Q(()=>{const D=e.fieldData.optionSetting||{};return{value:D.value||"value",label:D.label||"label"}}),$=Q(()=>{const D=e.fieldData,u=D.optionSetting;return{multiple:D.multiple,checkStrictly:D.checkStrictly,value:u.value||"value",label:u.label||"label",children:u.children||"children"}});function U(D){const u=s.value.placeholder;return{disabled:e.disabled,readonly:e.readonly,clearable:!0,placeholder:oe(D,"number")?u[D]:u}}function C(D){const u=e.fieldData;u.valueType==="number"?(u.value=Fe(D,!0,!0),d(Number(u.value))):(u.value=D,d())}function v(D,u){const K=e.fieldData;K.valueType==="array<number>"?(K.value[u]=Fe(D,!0,!0),d(K.value.map(H=>Number(H)))):(K.value[u]=D,d())}const P=["-",".","",null,void 0];function Y(){const D=e.fieldData;D.valueType==="number"&&(P.includes(D.value)?D.value="":D.value=Number(D.value))}function z(D){const u=e.fieldData;if(u.valueType==="array<number>"){const K=u.value[D];P.includes(K)?u.value[D]="":u.value[D]=Number(K)}}function F(D){const u=D.type==="select-multiple";return{placeholder:D.placeholder,disabled:e.disabled,multiple:D.type==="select-multiple",clearable:!0,filterable:!0,collapseTags:!0,class:`field-item${u?" is-multiple-select":""}`}}function I(D,u){const K=g.value;return D.joinShow?`${u[K.label]}-${u[K.value]}`:`${u[K.label]}`}let x=[];const B="the-date-shortcut-selected";function W(){const D=document.querySelector(`.${B}`);D&&D.classList.remove(B),d()}function w(D){D.classList.add(B)}return We(function(){const D=e.fieldData;if(D.type==="date"){const u=`.${D.id} .el-picker-panel__sidebar`,K=document.querySelector(u);if(!K)return console.warn("找不到日期快捷面板节点！");x=Array.from(K.children),x.forEach(J=>{J.addEventListener("click",()=>w(J))});const H=D.shortcutIndex;oe(H,"number")&&H>=0&&w(x[H])}}),(D,u)=>{const K=_("el-input"),H=_("el-text"),J=_("el-select-v2"),S=_("el-option"),b=_("el-select"),o=_("el-checkbox"),a=_("el-checkbox-group"),k=_("el-radio"),r=_("el-radio-group"),p=_("el-switch"),L=_("el-cascader"),h=_("el-date-picker");return n(),O("div",{class:"the-curd-form-field f-vertical short-value",style:xe({width:V(_e)(s.value.valueWidth)})},[s.value.type==="input"?(n(),M(K,ge({key:0,"model-value":s.value.value},U(),{class:"the-curd-field",onInput:C,onBlur:Y}),null,16,["model-value"])):N("",!0),s.value.type==="textarea"?(n(),M(K,{key:1,modelValue:s.value.value,"onUpdate:modelValue":u[0]||(u[0]=i=>s.value.value=i),readonly:e.readonly,disabled:e.disabled,placeholder:s.value.placeholder,type:"textarea",class:"the-curd-field",onInput:u[1]||(u[1]=i=>d())},null,8,["modelValue","readonly","disabled","placeholder"])):N("",!0),s.value.type==="input-between"?(n(),O(X,{key:2},[t(K,ge({"model-value":s.value.value[0]},U(0),{class:"f1",onInput:u[2]||(u[2]=i=>v(i,0)),onBlur:u[3]||(u[3]=i=>z(0))}),null,16,["model-value"]),t(H,{style:{padding:"0 6px"}},{default:l(()=>[A(ne(s.value.separator),1)]),_:1}),t(K,ge({"model-value":s.value.value[1]},U(1),{class:"f1",onInput:u[4]||(u[4]=i=>v(i,1)),onBlur:u[5]||(u[5]=i=>z(1))}),null,16,["model-value"])],64)):N("",!0),s.value.type==="select"||s.value.type==="select-multiple"?(n(),O(X,{key:3},[s.value.options.length>50?(n(),M(J,ge({key:0,modelValue:s.value.value,"onUpdate:modelValue":u[6]||(u[6]=i=>s.value.value=i),options:s.value.options,props:g.value},F(s.value),{onChange:u[7]||(u[7]=i=>d())}),{default:l(({item:i})=>[f("span",{title:I(s.value,i)},ne(I(s.value,i)),9,rt)]),_:1},16,["modelValue","options","props"])):(n(),M(b,ge({key:1,modelValue:s.value.value,"onUpdate:modelValue":u[8]||(u[8]=i=>s.value.value=i)},F(s.value),{onChange:u[9]||(u[9]=i=>d())}),{default:l(()=>[(n(!0),O(X,null,ae(s.value.options,i=>(n(),M(S,{key:i[g.value.value],value:i[g.value.value],label:I(s.value,i)},null,8,["value","label"]))),128))]),_:1},16,["modelValue"]))],64)):N("",!0),s.value.type==="checkbox"?(n(),O(X,{key:4},[t(a,{modelValue:s.value.value,"onUpdate:modelValue":u[10]||(u[10]=i=>s.value.value=i),disabled:e.disabled,onChange:u[11]||(u[11]=i=>d())},{default:l(()=>[(n(!0),O(X,null,ae(s.value.options,i=>(n(),M(o,{key:i[g.value.value],value:i[g.value.value]},{default:l(()=>[A(ne(i[g.value.label]),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue","disabled"]),e.editMode&&!s.value.options.length?(n(),M(H,{key:0,type:"primary"},{default:l(()=>[A(ne(V(ce).checkbox)+"（空数据） ",1)]),_:1})):N("",!0)],64)):N("",!0),s.value.type==="radio"?(n(),O(X,{key:5},[t(r,{modelValue:s.value.value,"onUpdate:modelValue":u[12]||(u[12]=i=>s.value.value=i),disabled:e.disabled,onChange:u[13]||(u[13]=i=>d())},{default:l(()=>[(n(!0),O(X,null,ae(s.value.options,i=>(n(),M(k,{key:i[g.value.value],value:i[g.value.value]},{default:l(()=>[A(ne(i[g.value.label]),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue","disabled"]),e.editMode&&!s.value.options.length?(n(),M(H,{key:0,type:"primary"},{default:l(()=>[A(ne(V(ce).radio)+"（空数据） ",1)]),_:1})):N("",!0)],64)):N("",!0),s.value.type==="switch"?(n(),M(p,{key:6,modelValue:s.value.value,"onUpdate:modelValue":u[14]||(u[14]=i=>s.value.value=i),"inline-prompt":"","active-text":"是","inactive-text":"否",onChange:u[15]||(u[15]=i=>d())},null,8,["modelValue"])):N("",!0),s.value.type==="cascader"?(n(),M(L,{key:7,modelValue:s.value.value,"onUpdate:modelValue":u[16]||(u[16]=i=>s.value.value=i),options:s.value.options,props:$.value,placeholder:s.value.placeholder,disabled:e.disabled,clearable:"","collapse-tags":"","collapse-tags-tooltip":"",filterable:"",class:"the-curd-field",onChange:u[17]||(u[17]=i=>d())},null,8,["modelValue","options","props","placeholder","disabled"])):N("",!0),s.value.type==="date"?(n(),M(h,{key:8,modelValue:s.value.value,"onUpdate:modelValue":u[18]||(u[18]=i=>s.value.value=i),placeholder:s.value.placeholder,type:s.value.dateType,format:s.value.formatShow,shortcuts:V(je)[s.value.dateType],disabled:e.disabled,"popper-class":s.value.id.toString(),"range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",class:"the-curd-field",onChange:W},null,8,["modelValue","placeholder","type","format","shortcuts","disabled","popper-class"])):N("",!0)],4)}}}),dt={key:0,class:"el-icon-rank el-icon--left"},ct={style:{"line-height":"1"}},pt={key:0,class:"the-curd-edit-mask f-vertical f-right"},ft=f("i",{class:"el-icon-delete el-icon--left"},null,-1),mt=f("i",{class:"el-icon-edit el-icon--left"},null,-1),yt=f("i",{class:"el-icon-plus"},null,-1),ht={name:"Search"},gt=re({...ht,props:{data:{type:Object,required:!0}},emits:["search"],setup(q,{emit:T}){const e=q,j=T,d=Oe(),s=Q(()=>d.editor.type==="search"&&!d.editor.show);function g(z){const F=e.data.list[z].label||e.data.list[z].key;me({title:"操作提示",content:`是否删除【${F}】？`,cancelText:"取消",confirm(){e.data.list.splice(z,1)}})}function $(z){d.editor.index=z,d.editor.action="edit",d.editor.show=!0}function U(z){return d.editor.index===z&&d.editor.type==="search"&&d.editor.show}function C(){d.editor.index=-1,d.editor.action="add",d.editor.show=!0}const{onDragStart:v,onDragMove:P,onDropEnd:Y}=$e({list:()=>e.data.list,key:"id",findLevel:5});return(z,F)=>{const I=_("el-button"),x=_("el-text");return n(),M(V(Xe),{class:"the-curd-search","label-right":e.data.labelRight,"label-width":V(_e)(e.data.labelWidth)||"auto"},Ve({content:l(()=>[t(we,{name:"the-group",tag:"div",class:"the-filter-content f1"},{default:l(()=>[(n(!0),O(X,null,ae(e.data.list,(B,W)=>(n(),M(V(Ne),{key:B.id,"data-key":B.id,class:se([{"the-curd-selected":U(W)},B.id]),label:B.label,"label-width":V(_e)(B.labelWidth),required:B.required,draggable:s.value,onDragstart:w=>V(v)(W),onDragover:w=>V(P)(w,W),onDrop:F[0]||(F[0]=w=>V(Y)())},Ve({default:l(()=>[t(ke,{"field-data":B,disabled:V(d).loading},null,8,["field-data","disabled"]),s.value?(n(),O("div",pt,[t(I,{link:"",type:"danger",onClick:w=>g(W)},{default:l(()=>[ft,A(" 删除 ")]),_:2},1032,["onClick"]),t(I,{link:"",type:"success",onClick:w=>$(W)},{default:l(()=>[mt,A(" 编辑 ")]),_:2},1032,["onClick"])])):N("",!0)]),_:2},[V(d).editor.type==="search"?{name:"label",fn:l(()=>[s.value?(n(),O("i",dt)):N("",!0),f("span",ct,ne(B.label),1)]),key:"0"}:void 0]),1032,["data-key","class","label","label-width","required","draggable","onDragstart","onDragover"]))),128)),s.value?(n(),M(V(Ne),{key:0},{default:l(()=>[e.data.list.length?N("",!0):(n(),M(x,{key:0,type:"info",style:{"margin-right":"12px"}},{default:l(()=>[A(" 请添加筛选条件~ ")]),_:1})),t(I,{type:"primary",circle:"",onClick:F[1]||(F[1]=B=>C())},{default:l(()=>[yt]),_:1})]),_:1})):N("",!0)]),_:1})]),_:2},[V(d).editor.type?void 0:{name:"right",fn:l(()=>[t(V(Qe),{loading:V(d).loading,onSearch:F[2]||(F[2]=B=>j("search",B))},null,8,["loading"])]),key:"0"}]),1032,["label-right","label-width"])}}});function Ie(q){const T=q.onAction||(()=>{});return t(X,null,[t(_("el-button"),{onClick:()=>T("exit")},{default:()=>[A("退 出")]}),t(_("el-button"),{type:"success",plain:!0,onClick:()=>T("copy")},{default:()=>[t("i",{class:"el-icon-document-copy el-icon--left"},null),A("复制JSON")]}),t(_("el-button"),{type:"primary",onClick:()=>T("complete")},{default:()=>[A("保 存")]})])}function Ce(q){const T=q.onClose||(()=>{}),e=q.onSubmit||(()=>{});return t(X,null,[t(_("el-button"),{onClick:T},{default:()=>[A("取 消")]}),t(_("el-button"),{type:"primary",loading:q.loading,disabled:q.disabledSubmit,onClick:e},{default:()=>[A("确 认")]})])}function vt(q){const T={};return q.imageWidth&&(T.width=`${q.imageWidth}px`),q.imageHeight&&(T.height=`${q.imageHeight}px`),T}function Je(q){function T(){tt({urls:q.previewList?q.previewList:[q.src]})}return q.column.cellType==="image"?t(_("el-image"),{class:"the-table-image",style:vt(q.column),src:q.src,onClick:T,fit:"cover"},null):null}const bt=re({props:{value:{type:[String,Function],default:""}},emits:["update:value"],setup(q,{emit:T}){const e=Q({get(){return typeof q.value=="function"?"":q.value},set(d){T("update:value",d)}}),j="https://element.eleme.cn/#/zh-CN/component/icon";return()=>t("div",{class:"f-vertical w-full"},[t(_("el-input"),{modelValue:e.value,"onUpdate:modelValue":d=>e.value=d,placeholder:"请输入图标 class",class:"mgr-10",clearable:!0},null),t(_("el-button"),{type:"primary",link:!0},{default:()=>[t("a",{href:j,target:"_blank"},[A("去官网复制")])]})])}});function _t(){const q=Array.from({length:6}).map((T,e)=>({id:e}));return t("div",{class:"the-thumbnail-search flex"},[t("div",{class:"the-thumbnail-search-content f1"},[q.map(T=>t("div",{key:T.id,class:"the-thumbnail-search-item"},null))]),t("div",{class:"the-thumbnail-search-btn f-vertical"},[t("i",{class:"el-icon-search"},null)])])}function kt(){return t("section",{class:"the-thumbnail-table"},[t("svg",{width:280,height:180,viewBox:`0 0 ${280*1} ${180*1}`,fill:"none",xmlns:"http://www.w3.org/2000/svg","data-v-d2b0a988":"",class:"the-thumbnail-table-svg"},[t("rect",{width:280,height:180,fill:""},null),t("g",{filter:"url(#filter0_d_13550_224439)"},[t("path",{d:"M65 60C65 58.8954 65.8954 58 67 58H213C214.105 58 215 58.8954 215 60V132C215 133.105 214.105 134 213 134H67C65.8954 134 65 133.105 65 132V60Z",fill:"var(--el-fill-color-blank)"},null),t("path",{d:"M67 57.7C65.7297 57.7 64.7 58.7297 64.7 60V132C64.7 133.27 65.7297 134.3 67 134.3H213C214.27 134.3 215.3 133.27 215.3 132V60C215.3 58.7297 214.27 57.7 213 57.7H67Z",stroke:"var(--el-border-color-dark)","stroke-width":.6*1},null)]),[76,92,108,124].map((j,d)=>t("rect",{key:d,x:71*1,y:j*1,width:16*1,height:4*1,rx:2*1,fill:"var(--el-color-primary)"},null)),[107,143,197].map((j,d)=>[76,92,108,124].map((s,g)=>t("rect",{key:`${d}-${g}`,x:j*1,y:s*1,width:d===2?12*1:20*1,height:4*1,rx:2*1,fill:"var(--el-border-color-dark)"},null))),t("path",{d:"M65 60C65 58.8954 65.8954 58 67 58H213C214.105 58 215 58.8954 215 60V70H65V60Z",fill:"var(--el-border-color-light)"},null),[71,107,143,199].map(j=>t("rect",{key:j,x:j*1,y:63*1,width:10*1,height:2*1,rx:1*1,fill:"var(--el-border-color-dark)"},null)),[85.75,101.75,117.75].map((j,d)=>t("line",{key:d,x1:65*1,y1:j*1,x2:215*1,y2:j*1,stroke:"var(--el-border-color-light)","stroke-width":.5*1},null)),t("defs",null,[t("filter",{id:"filter0_d_13550_224439",x:"51.0666",y:"44.0671",width:177.867*1,height:103.866*1,filterUnits:"userSpaceOnUse","color-interpolation-filters":"sRGB"},[t("feFlood",{"flood-opacity":"0",result:"BackgroundImageFix"},null),t("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"},null),t("feOffset",null,null),t("feGaussianBlur",{stdDeviation:6.66667*1},null),t("feComposite",{in2:"hardAlpha",operator:"out"},null),t("feColorMatrix",{type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.05 0"},null),t("feBlend",{mode:"normal",in2:"BackgroundImageFix",result:"effect1_dropShadow_13550_224439"},null),t("feBlend",{mode:"normal",in:"SourceGraphic",in2:"effect1_dropShadow_13550_224439",result:"shape"},null)])])])])}const wt={class:"w-full f-vertical mgb-10"},$t=f("div",{class:"f1"},null,-1),xt=f("i",{class:"el-icon--left el-icon-delete"},null,-1),Ct=f("i",{class:"el-icon--left el-icon-plus"},null,-1),Dt=f("i",{class:"el-icon--left el-icon-download"},null,-1),St=f("i",{class:"el-icon--left el-icon-setting"},null,-1),Vt={class:"f-vertical f-between mgb-10"},Tt=f("i",{class:"el-icon--left el-icon-refresh-left"},null,-1),Et={key:0,class:"el-icon--left el-icon-rank"},Ot={class:"f1"},Mt={name:"TableOperation"},Pe=re({...Mt,props:{config:{type:Object,required:!0},editMode:{type:Boolean},disabled:{type:Boolean}},emits:["action"],setup(q,{emit:T}){const e=q,j=T;function d(x){j("action",x)}const s={on:"el-icon-success",off:"el-icon-remove-outline"},g=Q(()=>{const x=e.config;return{add:x.formAdd&&x.formAdd.fields.length>0,edit:x.formEdit&&x.formEdit.fields.length>0,delete:!!x.selectKey}}),$=Q(()=>{const x=g.value.delete,B=g.value.add,W=g.value.edit;return[{type:"delete",text:x?"修改删除":"配置删除",icon:x?s.on:s.off,style:x?"primary":"info"},{type:"add",text:B?"修改新增表单":"配置新增表单",icon:B?s.on:s.off,style:B?"primary":"info"},{type:"edit",text:W?"修改编辑表单":"配置编辑表单",icon:W?s.on:s.off,style:W?"primary":"info"}]}),U=[{label:"固定左边",value:"left"},{label:"默认",value:!1},{label:"固定右边",value:"right"}],{onDragStart:C,onDragMove:v,onDropEnd:P}=$e({list:()=>e.config.columns,key:"prop"});function Y(x,B){const W=x.prop===ye,w=x.prop;return{"data-key":w,key:w,draggable:W?void 0:!0,title:W?"操作栏不可排序，只能显示隐藏操作":void 0,onDragstart:W?void 0:()=>C(B),onDragover:W?void 0:D=>v(D,B),onDrop:W?void 0:P}}const z=ie({showFixed:!1});let F=[];function I(){e.config.columns=F}return he(()=>e.config.columns,function(x){e.editMode||(F=ue(x))},{immediate:!0}),(x,B)=>{const W=_("el-button"),w=_("el-checkbox"),D=_("el-radio-button"),u=_("el-radio-group"),K=_("el-switch"),H=_("el-empty"),J=_("el-popover");return n(),O("div",wt,[e.editMode?(n(!0),O(X,{key:0},ae($.value,S=>(n(),M(W,{key:S.type,type:S.style,link:"",onClick:b=>d(S.type)},{default:l(()=>[f("i",{class:se(["el-icon--left",S.icon])},null,2),A(" "+ne(S.text),1)]),_:2},1032,["type","onClick"]))),128)):N("",!0),Me(x.$slots,"left"),e.editMode?N("",!0):(n(),O(X,{key:1},[$t,Me(x.$slots,"right"),g.value.delete?(n(),M(W,{key:0,type:"danger",link:"",disabled:e.disabled,onClick:B[0]||(B[0]=S=>d("delete"))},{default:l(()=>[xt,A(" 删除 ")]),_:1},8,["disabled"])):N("",!0),g.value.add?(n(),M(W,{key:1,type:"primary",link:"",disabled:e.disabled,onClick:B[1]||(B[1]=S=>d("add"))},{default:l(()=>[Ct,A(" 新增 ")]),_:1},8,["disabled"])):N("",!0),t(W,{type:"primary",link:"",disabled:e.disabled,onClick:B[2]||(B[2]=S=>d("export"))},{default:l(()=>[Dt,A(" 导出 ")]),_:1},8,["disabled"]),t(J,{placement:"bottom-start",width:z.showFixed?500:300,transition:"el-zoom-in-top",trigger:"click"},{reference:l(()=>[t(W,{type:"primary",link:"",disabled:e.disabled},{default:l(()=>[St,A(" 表格列设置 ")]),_:1},8,["disabled"])]),default:l(()=>[f("div",Vt,[t(w,{modelValue:z.showFixed,"onUpdate:modelValue":B[3]||(B[3]=S=>z.showFixed=S),label:"配置固定列"},null,8,["modelValue"]),t(W,{type:"primary",link:"",onClick:B[4]||(B[4]=S=>I())},{default:l(()=>[Tt,A(" 重置 ")]),_:1})]),t(we,{name:"the-group",tag:"div",class:"the-curd-setting-list the-curd-scrollbar"},{default:l(()=>[(n(!0),O(X,null,ae(e.config.columns,(S,b)=>(n(),O("div",ge({class:"the-curd-option-item f-vertical"},Y(S,b)),[S.prop!==V(ye)?(n(),O("i",Et)):N("",!0),f("span",Ot,ne(S.title),1),z.showFixed?(n(),M(u,{key:1,modelValue:S.fixed,"onUpdate:modelValue":o=>S.fixed=o,size:"small",class:"mgr-10"},{default:l(()=>[(n(),O(X,null,ae(U,o=>t(D,{key:o.value.toString(),value:o.value},{default:l(()=>[A(ne(o.label),1)]),_:2},1032,["value"])),64))]),_:2},1032,["modelValue","onUpdate:modelValue"])):N("",!0),t(K,{modelValue:S.visible,"onUpdate:modelValue":o=>S.visible=o,"inline-prompt":"","active-text":"显示","inactive-text":"隐藏"},null,8,["modelValue","onUpdate:modelValue"])],16))),256)),e.config.columns.length?N("",!0):(n(),M(H,{key:"empty","image-size":120,description:"暂无可以设置的表格列"}))]),_:1})]),_:1},8,["width"])],64))])}}}),Nt={key:0,class:"el-icon-rank el-icon--left",style:{"line-height":"32px"}},Bt={class:"f-vertical w-full"},At=f("i",{class:"el-icon-edit"},null,-1),Ft=f("i",{class:"el-icon-delete"},null,-1),Lt=f("i",{class:"el-icon--left el-icon-plus"},null,-1),qt=f("i",{class:"el-icon--left el-icon-plus"},null,-1),Wt={key:"bottom-setting"},jt=f("i",{class:"el-icon--left el-icon-delete"},null,-1),Ut=f("i",{class:"el-icon--left el-icon-check"},null,-1),It={name:"TableForm"},Re=re({...It,props:{config:{type:Object,default:()=>Be()},type:{type:String},editMode:{type:Boolean},disabled:{type:Boolean}},emits:["change"],setup(q,{expose:T,emit:e}){const j=q,d=e,s=be(),g=Be(),$=ie({config:g,form:{},rules:{}}),U=Oe(),C=Q(()=>j.type==="add"?"新增":"编辑"),v=Q(()=>U.editor.show);function P(S){B(),U.editor.action=S>=0?"edit":"add",U.editor.form=$.config,U.editor.index=S,U.editor.show=!0}function Y(S){const b=$.config.fields;B(),me({title:"操作提示",content:`是否删除【${b[S].label}】？`,cancelText:"取消",confirm(){b.splice(S,1)}})}function z(){me({title:"操作提示",content:`是否移除【${C.value}】表单？移除后将不会出现对应功能按钮。`,cancelText:"取消",confirm(){$.config.fields=[]}})}function F(){d("change")}function I(){const S=j.type==="add"?"编辑":"新增";me({title:"操作提示",content:`是否将表单数据同步到【${S}】表单？`,cancelText:"不同步",confirmText:"同步",cancel(){d("change",$.config)},confirm(){d("change",$.config,!0)}})}function x(S){var b;(b=s.value)==null||b.validate(o=>{if(o&&S){const a=H.value,k={};J.value.forEach(r=>{k[r.key]=a[r.key]}),S(a,k)}})}function B(){var S;(S=s.value)==null||S.clearValidate()}function W(){$.config.fields.forEach(Ee)}function w(S){$.config.fields.forEach(b=>{if(Object.prototype.hasOwnProperty.call(S,b.key)){const o=S[b.key];if(!o)return;switch(b.type){case"date":oe(o,"array")?b.value=o.map(a=>new Date(a)):b.value=new Date(o);break;default:b.value=o;break}}})}const{onDragStart:D,onDragMove:u,onDropEnd:K}=$e({list:()=>$.config.fields,key:"id",findLevel:10});he(()=>j.config,function(S){S&&($.config=ue(S))},{immediate:!0}),he(()=>$.config.fields,function(S){const b={},o={},a=["input","input-between","textarea"];S&&S.forEach(k=>{b[k.key]=k.value,k.required&&(o[k.key]=[{required:!0,validator(r,p,L){const h=[void 0,null,""];if(k.type==="input-between"&&!k.value[0]&&!k.value[1]){L(new Error("请输入两个范围字段"));return}if(k.valueType==="array"&&!k.value.length){L(new Error(k.placeholder||"请选择"));return}if(k.valueType!=="boolean"&&h.includes(k.value)){const i=a.includes(k.type)?"请输入内容":"请选择";L(new Error(k.placeholder||i));return}L()},trigger:a.includes(k.type)?"blur":"change"}])}),$.form=b,$.rules=o,setTimeout(B)},{immediate:!0});const H=Q(()=>{const S={};return $.config.fields.forEach(b=>{S[b.key]=Ue(b).value}),S}),J=Q(()=>$.config.fields.filter(S=>{const b=S.show;if(!b)return!0;if(oe(b,"function"))return b(H.value);if(b.includes("return"))try{return new Function("formData",b)(H.value)}catch(o){console.warn("解析表单展示逻辑代码错误 >>",o)}return!0}));return T({clear:B,validate:x,reset:W,setFormData:w}),(S,b)=>{const o=_("el-button"),a=_("el-form-item"),k=_("el-empty"),r=_("el-form");return n(),M(r,{ref_key:"formRef",ref:s,model:$.form,rules:$.rules,labelWidth:V(_e)($.config.labelWidth),labelPosition:$.config.labelPosition,disabled:j.disabled,style:xe(j.editMode?{width:V(_e)($.config.width)}:null),class:se([{"is-edit-form":j.editMode}])},{default:l(()=>[j.editMode?(n(),O(X,{key:0},[t(we,{name:"the-group",tag:"div"},{default:l(()=>[(n(!0),O(X,null,ae($.config.fields,(p,L)=>(n(),M(a,{class:se([{"the-curd-selected":V(U).editor.index===L&&v.value}]),prop:p.key,key:p.id,"data-key":p.id,draggable:$.config.fields.length>1&&!V(U).editor.show?!0:null,onDragstart:h=>V(D)(L),onDragover:h=>V(u)(h,L),onDrop:V(K)},{label:l(()=>[$.config.fields.length>1&&!V(U).editor.show?(n(),O("i",Nt)):N("",!0),f("span",null,ne(p.label),1)]),default:l(()=>[f("div",Bt,[t(ke,{class:"mgr-10",fieldData:p,editMode:""},null,8,["fieldData"]),t(o,{link:"",type:"success",disabled:v.value,onClick:h=>P(L)},{default:l(()=>[At]),_:2},1032,["disabled","onClick"]),t(o,{link:"",type:"danger",disabled:v.value,onClick:h=>Y(L)},{default:l(()=>[Ft]),_:2},1032,["disabled","onClick"])])]),_:2},1032,["class","prop","data-key","draggable","onDragstart","onDragover","onDrop"]))),128))]),_:1}),$.config.fields.length?N("",!0):(n(),M(k,{key:0,description:`当前没有表单项，当没有表单项时【${C.value}】功能按钮不会出现~`},{default:l(()=>[v.value?N("",!0):(n(),M(o,{key:0,type:"primary",onClick:b[0]||(b[0]=p=>P(-1))},{default:l(()=>[Lt,A(" 添加表单项 ")]),_:1}))]),_:1},8,["description"])),v.value?N("",!0):(n(),O(X,{key:1},[$.config.fields.length?(n(),M(a,{key:"bottom-add"},{default:l(()=>[t(o,{type:"primary",onClick:b[1]||(b[1]=p=>P(-1))},{default:l(()=>[qt,A(" 继续添加 ")]),_:1})]),_:1})):N("",!0),f("div",Wt,[t(o,{link:"",onClick:b[2]||(b[2]=p=>F())},{default:l(()=>[A(" 退出编辑 ")]),_:1}),t(o,{type:"danger",link:"",disabled:!$.config.fields.length,onClick:b[3]||(b[3]=p=>z())},{default:l(()=>[jt,A(" 清空表单 ")]),_:1},8,["disabled"]),t(o,{type:"success",link:"",onClick:b[4]||(b[4]=p=>I())},{default:l(()=>[Ut,A(" 保存表单 ")]),_:1})])],64))],64)):N("",!0),!j.editMode&&$.config&&$.config.fields?(n(!0),O(X,{key:1},ae(J.value,p=>(n(),M(a,{label:p.label,prop:p.key,key:p.id},{default:l(()=>[t(ke,{fieldData:p},null,8,["fieldData"])]),_:2},1032,["label","prop"]))),128)):N("",!0)]),_:1},8,["model","rules","labelWidth","labelPosition","disabled","style","class"])}}}),Jt={key:1,class:"f-vertical w-full"},Pt=f("i",{class:"el-icon--right el-icon-question the-tips-icon"},null,-1),Rt={key:1,class:"f1 f-right"},Ht={name:"TableHeader"},He=re({...Ht,props:{column:{type:Object,required:!0}},emits:["sort"],setup(q,{emit:T}){const e=q,j=T,d=Q(()=>!e.column.sort&&!e.column.iconTips);function s(g){e.column.sort===g&&(g=!0),j("sort",e.column.prop,g)}return(g,$)=>{const U=_("el-tooltip");return d.value?(n(),O(X,{key:0},[A(ne(e.column.title),1)],64)):(n(),O("div",Jt,[f("span",null,ne(e.column.title),1),e.column.iconTips?(n(),M(U,{key:0,effect:"dark",content:e.column.iconTips,placement:"top"},{default:l(()=>[Pt]),_:1},8,["content"])):N("",!0),e.column.sort?(n(),O("div",Rt,[f("div",null,[f("div",{class:se(["the-sort-icon top",{"is-select":e.column.sort==="asc"}]),onClick:$[0]||($[0]=C=>s("asc"))},null,2),f("div",{class:se(["the-sort-icon bottom",{"is-select":e.column.sort==="desc"}]),onClick:$[1]||($[1]=C=>s("desc"))},null,2)])])):N("",!0)]))}}}),zt={name:"TableColumnConfig"},Kt=re({...zt,props:{show:{type:Boolean,required:!0},type:{type:String,required:!0},keys:{type:Array,required:!0},form:Object},emits:["update:show","submit"],setup(q,{emit:T}){const e=q,j=T,d=ie({show:!1,form:Te("","")}),s=Q(()=>({add:"新增",edit:"编辑",copy:"复制"})[e.type]+"表格列"),g=be(),$={title:{required:!0,message:"请输入表格列标题",trigger:"blur"},prop:{required:!0,validator(F,I,x){I?e.keys.includes(d.form.prop)?x(new Error("已经存在相同的值！")):x():x(new Error("输入字段不能为空！"))},trigger:"blur"},cellType:{required:!0,message:"请选择展示类型",trigger:"change"},sort:{required:!0,message:"请选择排序操作",trigger:"change"},jsCode:{required:!0,validator(F,I,x){I?I.includes("return")?x():x(new Error('代码片段必须带有返回字段 "return"')):x(new Error("代码片段不能为空！"))},trigger:"blur"}},U=[{label:"默认普通文本",value:"text"},{label:"图片预览组件",value:"image"},{label:"自定义 js 代码",value:"js"}],C=[{label:"不可排序",value:!1},{label:"可排序",value:!0},{label:"默认升序",value:"asc"},{label:"默认降序",value:"desc"}],v=`
<p>函数代码片段：</p>
<p>第一个参数${le("cellValue")}是表格值;</p>
<p>第二个参数${le("row")}是完整对象;</p>
<p>例如：${le("return cellValue + row.id;")};</p>
<p>也可以是HTML：${le("return `html 标签`")};</p>
`,P=[{label:"表格列标题",prop:"title",type:"input",placeholder:$.title.message},{label:"表格列键值",prop:"prop",type:"input",placeholder:"请输入表格列键值"},{label:"表格列宽度",prop:"width",type:"number",placeholder:"请输入表格列宽度，例如：120（默认自适应）"},{label:"表格列最小宽度",prop:"minWidth",type:"number",placeholder:"请输入表格列最小宽度，例如：120（默认自适应）"},{label:"表格列展示类型",prop:"cellType",type:"select",options:U},{label:"图片宽度",prop:"imageWidth",type:"number",placeholder:"请输入数字（默认80px）",show:()=>d.form.cellType==="image"},{label:"图片高度",prop:"imageHeight",type:"number",placeholder:"请输入数字（默认80px）",show:()=>d.form.cellType==="image"},{label:"js代码",prop:"jsCode",type:"textarea",placeholder:"请输入代码片段",tooltip:v,tips:'例如：return `<span class="the-tag blue">${cellValue || "-"}<span>`;',show:()=>d.form.cellType==="js"},{label:"表格列排序操作",prop:"sort",type:"select",options:C},{label:"内容溢出截断",prop:"tooltip",type:"switch"},{label:"表头提示文字",prop:"iconTips",type:"input",placeholder:"请输入提示文字"}];function Y(){j("update:show",!1)}function z(){var F;(F=g.value)==null||F.validate(I=>{if(!I)return;const x=ue(d.form);["width","minWidth","imageWidth","imageHeight"].forEach(W=>{x[W]&&(x[W]=Number(x[W]))}),x.cellType==="image"&&(x.slot=x.prop),(x.sort||x.iconTips)&&(x.slotHead=`header-${x.prop}`),j("submit",x),Y()})}return he(()=>e.show,function(F){d.show=F,F&&(e.type==="add"?d.form=Te("",""):(d.form=ue(e.form),e.type==="copy"&&(d.form.prop="")),setTimeout(()=>{var I;return(I=g.value)==null?void 0:I.clearValidate()}))},{immediate:!0}),(F,I)=>{const x=_("el-form"),B=_("base-dialog");return n(),M(B,{show:d.show,"onUpdate:show":I[0]||(I[0]=W=>d.show=W),title:s.value,width:"580px",onClose:Y},{footer:l(()=>[t(V(Ce),{onClose:Y,onSubmit:z})]),default:l(()=>[t(x,{ref_key:"formRef",ref:g,model:d.form,rules:$,"label-position":"right","label-width":"130px"},{default:l(()=>[t(V(ve),{data:d.form,list:P},null,8,["data"])]),_:1},8,["model"])]),_:1},8,["show","title"])}}}),Gt=f("p",{class:"mgb-10"},"表格数据中的字段，例如表格数：",-1),Zt=f("p",{class:"mgb-10"},"则键值可以为 id",-1),Xt=f("p",null,[f("i",{class:"el-icon-info el-icon--left"}),A(" 不填则没有删除功能 ")],-1),Qt={name:"TableDeleteConfig"},Yt=re({...Qt,props:{show:{type:Boolean,default:!1},selectKey:{type:String,default:""}},emits:["update:show","submit"],setup(q,{emit:T}){const e=q,j=T,d='[{ id: 1, name: "名称", status: 2 }]',s=ie({show:!1,keyword:""});function g(){j("update:show",!1)}function $(){g(),j("submit",s.keyword)}return he(()=>e.show,function(U){s.show=U,U&&(s.keyword=e.selectKey||"")},{immediate:!0}),(U,C)=>{const v=_("el-input"),P=_("el-form-item"),Y=_("el-form"),z=_("base-dialog");return n(),M(z,{show:s.show,"onUpdate:show":C[1]||(C[1]=F=>s.show=F),title:"配置表格删除功能",width:"400px",onClose:g},{footer:l(()=>[t(V(Ce),{onClose:g,onSubmit:$})]),default:l(()=>[t(Y,{labelPosition:"right",labelWidth:"120px"},{default:l(()=>[t(P,{label:"数据键值"},{default:l(()=>[t(v,{class:"mgb-10",modelValue:s.keyword,"onUpdate:modelValue":C[0]||(C[0]=F=>s.keyword=F),placeholder:"请输入数据键值",clearable:""},null,8,["modelValue"]),f("div",{class:"the-tag blue"},[Gt,f("p",{class:"mgb-10"},ne(d)),Zt,Xt])]),_:1})]),_:1})]),_:1},8,["show"])}}}),eo={class:"flex"},to={class:"f1"},oo={class:"f-right w-full"},lo=f("i",{class:"el-icon--left el-icon-finished"},null,-1),no=f("i",{class:"el-icon--left el-icon-plus"},null,-1),ao=["data-key","draggable","onDragstart","onDragover"],io={key:0,class:"el-icon--left el-icon-rank"},so=f("div",{class:"f1"},null,-1),ro=f("i",{class:"el-icon-delete"},null,-1),uo=f("i",{class:"el-icon-edit"},null,-1),co={key:1,class:"w-full f-right"},po=f("i",{class:"el-icon--left el-icon-plus"},null,-1),fo={name:"TableActionConfig"},mo=re({...fo,props:{show:{type:Boolean,default:!1},list:{type:Array,required:!0},columnWidth:{type:Number},actionMax:{type:Number}},emits:["update:show","submit"],setup(q,{emit:T}){const e=q,j=T,d=`
<p>可以输入代码片段，</p>
<p>以${le("return")}关键字为函数标记，</p>
<p>函数第一个参数${le("row")}是表格对象值</p>
<p>例如：${le('return row.status === 1 ? "下架" : "上架";')}</p>
`,s=`
<p>函数代码片段，点击的时候运行</p>
<p>函数第一个参数${le("row")}是表格对象值</p>
<p>第二个参数${le("index")}是当前索引</p>
<p>例如：${le("console.log(row, index);")}</p>
`,g=`
<p>可以输入代码片段，</p>
<p>以${le("return")}关键字为函数标记，</p>
<p>函数第一个参数${le("row")}是表格对象值</p>
<p>例如：${le("return row.status === 1;")}返回布尔值进行判断</p>
`,$=be(),U=be(),C=ie({show:!1,list:[],index:-1,hasEdit:!1,formEdit:!1}),v=ie({btn:Se(),column:{width:160,max:3}}),P={width:{required:!0,message:"请输入表格列宽度，例如：160",trigger:"blur"},max:{required:!1,message:"请输入数量，超出用“更多”下拉展示",trigger:"blur"}},Y=[{label:"操作列宽度",prop:"width",type:"number",placeholder:P.width.message},{label:"操作按钮限制",prop:"max",type:"number",min:2,placeholder:P.max.message}],z={text:{required:!0,message:"请输入按钮文字",trigger:"blur"},click:{required:!0,message:"请输入按钮操作代码",trigger:"blur"},icon:{required:!1,message:"请输入图标 class",trigger:"blur"},type:{required:!1,message:"请选择按钮类型",trigger:"change"}},F=[{label:"按钮文字",prop:"text",type:"textarea",placeholder:z.text.message,tooltip:d},{label:"按钮功能代码",prop:"click",type:"textarea",placeholder:"请输入代码片段",tooltip:s},{label:"按钮显示条件",prop:"show",type:"textarea",placeholder:"请输入条件代码，为空则默认显示",tooltip:g},{label:"按钮禁用条件",prop:"disabled",type:"textarea",placeholder:"请输入条件代码，为空则默认不禁用",tooltip:g},{label:"按钮图标",prop:"icon",type:"slot",slotName:"iconInput"},{label:"按钮类型",prop:"type",type:"select",options:[{label:"默认（蓝色）",value:"primary"},{label:"成功（绿色）",value:"success"},{label:"警告（橙色）",value:"warning"},{label:"危险（红色）",value:"danger"},{label:"文本（灰色）",value:"info"}]}];function I(){j("update:show",!1)}function x(){U.value.validate(b=>{if(!b)return;I();const{width:o,max:a}=v.column;j("submit",ue(C.list),o,a)})}function B(b){$.value.validate(o=>{if(!o)return;const a=ue(v.btn);b==="add"?C.list.push(a):C.list[C.index]=v.btn,W()})}function W(){C.index=-1,v.btn=Se(),C.formEdit=!1,setTimeout(()=>{var b;return(b=$.value)==null?void 0:b.clearValidate()})}function w(b){const o=C.list[b];v.btn=JSON.parse(JSON.stringify(o)),C.index=b,C.formEdit=!0}function D(b){C.list.splice(b,1)}he(()=>e.show,function(b){C.show=b,b&&(C.list=ue(e.list),C.hasEdit=C.list.some(o=>o.key===fe),C.index=-1,v.btn=Se(),v.column={width:e.columnWidth,max:e.actionMax},setTimeout(()=>{var o,a;(o=$.value)==null||o.clearValidate(),(a=U.value)==null||a.clearValidate()}))},{immediate:!0});const{onDragStart:u,onDragMove:K,onDropEnd:H}=$e({list:()=>C.list,key:"key"});function J(b){if(b.key!=fe&&C.list.length>1&&C.index===-1)return!0}function S(b){const o=b.text;if(oe(o,"string")){if(!o.includes("return"))return o;let a="文字配置有误";try{a=new Function("row",o)({})}catch(k){console.warn("解析按钮文字代码错误 >>",k)}return a}return oe(o,"function")?o({}):"未设置按钮"}return(b,o)=>{const a=_("el-text"),k=_("el-divider"),r=_("el-form"),p=_("el-button"),L=_("el-form-item"),h=_("el-popconfirm"),i=_("el-empty"),te=_("base-dialog");return n(),M(te,{show:C.show,"onUpdate:show":o[6]||(o[6]=m=>C.show=m),title:"配置操作列按钮功能",width:"880px",onClose:I},{footer:l(()=>[t(V(Ce),{disabledSubmit:C.formEdit,onClose:I,onSubmit:x},null,8,["disabledSubmit"])]),default:l(()=>[f("div",eo,[f("section",to,[t(k,{"content-position":"left","border-style":"dashed"},{default:l(()=>[t(a,{type:"info"},{default:l(()=>[A("操作列配置")]),_:1})]),_:1}),t(r,{ref_key:"formColumn",ref:U,model:v.column,rules:P,labelPosition:"right",labelWidth:"128px"},{default:l(()=>[t(V(ve),{data:v.column,list:Y},null,8,["data"])]),_:1},8,["model"]),t(k,{"content-position":"left","border-style":"dashed"},{default:l(()=>[t(a,{type:"info"},{default:l(()=>[A("操作按钮配置")]),_:1})]),_:1}),t(r,{ref_key:"formBtn",ref:$,model:v.btn,rules:z,labelPosition:"right",labelWidth:"128px",class:se({"the-filter-mask":!C.formEdit}),"data-tips":"待新增或编辑操作"},{default:l(()=>[t(V(ve),{data:v.btn,list:F},{iconInput:l(()=>[t(V(bt),{value:v.btn.icon,"onUpdate:value":o[0]||(o[0]=m=>v.btn.icon=m)},null,8,["value"])]),_:1},8,["data"]),t(L,null,{default:l(()=>[f("div",oo,[t(p,{onClick:o[1]||(o[1]=m=>W())},{default:l(()=>[A("取 消")]),_:1}),C.index>-1?(n(),M(p,{key:0,type:"primary",plain:"",onClick:o[2]||(o[2]=m=>B("edit"))},{default:l(()=>[lo,A(" 确认修改 ")]),_:1})):(n(),M(p,{key:1,type:"primary",plain:"",onClick:o[3]||(o[3]=m=>B("add"))},{default:l(()=>[no,A(" 确认新增 ")]),_:1}))])]),_:1})]),_:1},8,["model","class"])]),t(we,{name:"the-group",tag:"div",class:"the-curd-option-list f1"},{default:l(()=>[(n(!0),O(X,null,ae(C.list,(m,c)=>(n(),O("div",{class:se(["the-curd-option-item f-vertical",{"the-curd-selected":c===C.index}]),key:m.key,"data-key":m.key!==V(fe)?m.key:null,draggable:J(m),onDragstart:y=>V(u)(c),onDragover:y=>V(K)(y,c),onDrop:o[4]||(o[4]=(...y)=>V(H)&&V(H)(...y))},[C.index===-1&&m.key!==V(fe)?(n(),O("i",io)):N("",!0),t(p,{type:m.type,link:""},{default:l(()=>[m.icon?(n(),O("i",{key:0,class:se(["el-icon--left",m.icon])},null,2)):N("",!0),A(" "+ne(S(m)),1)]),_:2},1032,["type"]),so,m.key===V(fe)?(n(),M(a,{key:1,type:"info",size:"small"},{default:l(()=>[A("编辑按钮不可删除、拖拽等操作，且处于首位")]),_:1})):(n(),O(X,{key:2},[t(h,{width:"186px",title:"是否删除该按钮功能？",onConfirm:y=>D(c)},{reference:l(()=>[t(p,{link:"",type:"danger",disabled:C.index>-1},{default:l(()=>[ro]),_:1},8,["disabled"])]),_:2},1032,["onConfirm"]),t(p,{link:"",type:"success",onClick:y=>w(c)},{default:l(()=>[uo]),_:2},1032,["onClick"])],64))],42,ao))),128)),C.list.length?N("",!0):(n(),M(i,{key:"empty","image-size":120,description:"请添加操作列功能按钮"})),C.formEdit?N("",!0):(n(),O("div",co,[C.formEdit?N("",!0):(n(),M(p,{key:0,type:"primary",plain:"",onClick:o[5]||(o[5]=m=>C.formEdit=!0)},{default:l(()=>[po,A(" 新增功能按钮 ")]),_:1}))]))]),_:1})])]),_:1},8,["show"])}}}),yo={class:"the-curd-table-model the-curd-scrollbar"},ho=["data-key","draggable","onDragstart","onDragover"],go=["data-head"],vo=f("i",{class:"el-icon-rank el-icon--left"},null,-1),bo={class:"fake-table-cell operation f-vertical"},_o=f("i",{class:"el-icon-arrow-down el-icon--right"},null,-1),ko={class:"fake-table-cell f-vertical"},wo={key:1,class:"the-tag blue"},$o=f("div",{class:"fake-table-head fvc"},"操作",-1),xo={class:"fake-table-cell operation fvc"},Co=f("i",{class:"el-icon-setting"},null,-1),Do=f("i",{class:"el-icon-delete"},null,-1),So={class:"fake-table-cell disabled"},Vo={class:"f-vertical",key:"right-setting"},To=f("i",{class:"el-icon-plus el-icon--left"},null,-1),Eo={key:0},Oo=f("i",{class:"el-icon-plus el-icon--left"},null,-1),Mo={key:1},No={key:0,class:"the-tag blue mgl-10"},Bo=f("i",{class:"el-icon--left el-icon-info"},null,-1),Ao={name:"TableModel"},Fo=re({...Ao,props:{config:{type:Object,required:!0}},emits:["action"],setup(q,{emit:T}){const e=q,j=T,d="https://fuss10.elemecdn.com/e/5d/4a731a90594a4af544c0c25941171jpeg.jpeg",s=[{key:"edit",label:"编辑列",icon:"el-icon-edit",click(r){U("edit",r)}},{key:"copy",label:"复制列",icon:"el-icon-document-copy",click(r){U("copy",r)}},{key:"delete",label:"删除列",icon:"el-icon-delete",click(r){v(r)}}],g=ie({show:!1,type:"add",index:-1,form:void 0,keys:[]}),$=Q(()=>{const r=e.config.columns,p=[],L=[];for(let h=0;h<r.length;h++){const i=r[h];i.prop===ye?L.push(i):p.push(i)}return{drag:p,action:L}});function U(r,p){g.keys=e.config.columns.map(h=>h.prop),{add(){g.form=void 0},edit(){const h=e.config.columns[p];g.keys=g.keys.filter(i=>i!==h.prop),g.index=p,g.form=h},copy(){const h=e.config.columns[p];g.form=h}}[r](),g.type=r,g.show=!0}function C(r){const p=e.config;if(["add","copy"].includes(g.type)){const L=ue($.value.drag);L.push(r),p.columns=L.concat($.value.action)}else p.columns[g.index]=r}function v(r){const p=$.value.drag[r];me({title:"操作提示",content:`是否删除【${p.title}】列？`,cancelText:"取消",confirm(){const L=e.config.columns.findIndex(h=>h.prop===p.prop);e.config.columns.splice(L,1)}})}const{onDragStart:P,onDragMove:Y,onDropEnd:z}=$e({list:()=>e.config.columns,key:"prop",findLevel:5});function F(r){const p={};return r&&r.width&&(p.width=`${r.width}px`),r&&r.minWidth&&(p.minWidth=`${r.minWidth}px`),p}const I=Q(function(){const r=e.config.columns;if(r.length>0&&r[r.length-1].prop===ye)return r[r.length-1]});function x(){const r=Te(ye,"操作");r.minWidth=120,r.width=160,e.config.columns.push(r)}function B(){const r=e.config.columns;me({title:"操作提示",content:"是否删除操作列？删除之后需要重新配置。",cancelText:"取消",confirm(){r.splice(r.length-1,1),e.config.actions=[],e.config.formEdit&&(e.config.formEdit=void 0)}})}const W=ie({show:!1,keyword:""});function w(){const r=e.config.selectKey;W.keyword=r?r.toString():"",W.show=!0}function D(r){e.config.selectKey=r}const u=ie({show:!1,columnWidth:0,actionMax:0});function K(){u.show=!0,u.columnWidth=I.value.width,u.actionMax=e.config.actionMax}function H(r,p){e.config.actions=r;const L=e.config.columns.find(h=>h.prop===ye);L.width=p}const J=ie({show:!1,form:null,type:"add"});function S(r){J.type=r,r==="add"&&e.config.formAdd&&(J.form=e.config.formAdd),r==="edit"&&e.config.formEdit&&(J.form=e.config.formEdit),J.show=!0}function b(r,p){const L=e.config,h=L.actions;function i(){const te=h.length>0&&h[0].key===fe;r&&r.fields.length>0?(I.value||x(),te||h.unshift({key:fe,text:"编辑",type:"success",icon:"el-icon-edit"})):te&&h.splice(0,1)}r&&(J.type==="add"?(L.formAdd=r,p&&(L.formEdit=ue(r),i())):(L.formEdit=r,p&&(L.formAdd=ue(r)),i())),J.show=!1,J.form=null}function o(r){switch(r){case"delete":w();break;case"add":S("add");break;case"edit":S("edit");break}}const a=Q(()=>$.value.drag.some(r=>!r.width&&!r.minWidth));function k(r){if(r==="complete"&&a.value){const p=Array.from(document.querySelectorAll(".fake-table-head")),L={};p.forEach(h=>{const i=h.dataset.head||"";i&&(L[i]=Math.round(h.clientWidth))}),e.config.columns.forEach(h=>{Object.prototype.hasOwnProperty.call(L,h.prop)&&(h.minWidth=L[h.prop])})}j("action",r)}return(r,p)=>{const L=_("el-empty"),h=_("el-button"),i=_("el-dropdown-item"),te=_("el-dropdown-menu"),m=_("el-dropdown"),c=_("el-tooltip"),y=_("base-table-actions"),E=_("el-text");return n(),O(X,null,[J.show?N("",!0):(n(),M(Pe,{key:0,editMode:!0,config:e.config,onAction:o},null,8,["config"])),f("div",yo,[J.show?(n(),M(Re,{key:0,config:J.form,type:J.type,editMode:!0,onChange:b},null,8,["config","type"])):(n(),M(we,{key:1,name:"the-group",tag:"div",class:"fake-table"},{default:l(()=>[e.config.columns.length?N("",!0):(n(),M(L,{key:"empty",style:{padding:"10px 40px"},"image-size":120,description:"请添加表格列"})),(n(!0),O(X,null,ae($.value.drag,(R,G)=>(n(),O("div",{key:R.prop,"data-key":R.prop,class:"fake-table-item",draggable:$.value.drag.length>1,style:xe(F(R)),onDragstart:Z=>V(P)(G),onDragover:Z=>V(Y)(Z,G),onDrop:p[0]||(p[0]=Z=>V(z)())},[f("div",{class:"fake-table-head f-vertical","data-head":R.prop},[vo,t(He,{column:R},null,8,["column"])],8,go),f("div",bo,[t(m,{trigger:"click"},{dropdown:l(()=>[t(te,null,{default:l(()=>[(n(),O(X,null,ae(s,Z=>t(i,{key:Z.key,onClick:ee=>Z.click(G)},{default:l(()=>[f("i",{class:se(["el-icon--left",Z.icon])},null,2),A(" "+ne(Z.label),1)]),_:2},1032,["onClick"])),64))]),_:2},1024)]),default:l(()=>[t(h,{link:"",type:"primary"},{default:l(()=>[A(" 配置列 "),_o]),_:1})]),_:2},1024)]),f("div",ko,[R.cellType==="text"?(n(),O(X,{key:0},[A("文本内容")],64)):R.cellType==="js"?(n(),O("span",wo,"自定义代码")):N("",!0),t(V(Je),{column:R,src:d},null,8,["column"])])],44,ho))),128)),I.value?(n(),O("div",{style:xe(F(I.value)),key:V(ye),class:"fake-table-item"},[$o,f("div",xo,[t(c,{effect:"dark",content:"配置【操作按钮】和【操作列】的宽度",placement:"top"},{default:l(()=>[t(h,{circle:"",plain:"",type:"primary",size:"small",onClick:p[1]||(p[1]=R=>K())},{default:l(()=>[Co]),_:1})]),_:1}),t(h,{circle:"",plain:"",type:"danger",size:"small",onClick:p[2]||(p[2]=R=>B())},{default:l(()=>[Do]),_:1})]),f("div",So,[e.config.actions.length?(n(),M(y,{key:0,row:{},index:1,actions:e.config.actions},null,8,["actions"])):(n(),M(E,{key:1,type:"info"},{default:l(()=>[A("待添加操作~")]),_:1}))])],4)):N("",!0),f("div",Vo,[f("div",null,[f("p",null,[t(h,{type:"primary",text:"",onClick:p[3]||(p[3]=R=>U("add"))},{default:l(()=>[To,A(" 添加内容列 ")]),_:1})]),I.value?N("",!0):(n(),O("p",Eo,[t(h,{type:"primary",text:"",onClick:p[4]||(p[4]=R=>x())},{default:l(()=>[Oo,A(" 添加操作列 ")]),_:1})]))])])]),_:1}))]),J.show?N("",!0):(n(),O("div",Mo,[t(V(Ie),{type:J.type,onAction:k},null,8,["type"]),a.value?(n(),O("span",No,[Bo,A(" 当前表格列配置中存在没配置【宽度/最小宽度】，保存时将自动设置最小宽度，提高表格美观性。 ")])):N("",!0)])),t(Kt,{show:g.show,"onUpdate:show":p[5]||(p[5]=R=>g.show=R),type:g.type,keys:g.keys,form:g.form,onSubmit:C},null,8,["show","type","keys","form"]),t(Yt,{show:W.show,"onUpdate:show":p[6]||(p[6]=R=>W.show=R),"select-key":W.keyword,onSubmit:D},null,8,["show","select-key"]),t(mo,{show:u.show,"onUpdate:show":p[7]||(p[7]=R=>u.show=R),columnWidth:u.columnWidth,actionMax:u.actionMax,list:e.config.actions,onSubmit:H},null,8,["show","columnWidth","actionMax","list"])],64)}}}),Lo={class:"the-curd-example"},qo={name:"Example"},Wo=re({...qo,props:{selected:{type:String},type:{type:String}},emits:["choose"],setup(q,{emit:T}){const e=q,j=T,d=[{...de("input"),placeholder:ce.input},{...de("select"),placeholder:ce.select},{...de("select-multiple"),placeholder:ce["select-multiple"]},{...de("cascader"),placeholder:ce.cascader},{...de("date"),placeholder:ce.date},{...de("checkbox"),options:[{label:"多选-A",value:1},{label:"多选-B",value:2}],defaultValue:[1]},{...de("radio"),options:[{label:"单选-A",value:"radio-1"},{label:"单选-B",value:"radio-2"}],defaultValue:"radio-1"},{...de("switch"),defaultValue:!0},{...de("textarea"),placeholder:ce.textarea},{...de("input-between"),placeholder:["范围区间操作","范围区间操作"]}],s=["radio","checkbox","textarea","switch"],g=Q(()=>e.type==="search"?d.filter($=>!s.includes($.type)):d);return($,U)=>(n(),O("div",Lo,[(n(!0),O(X,null,ae(g.value,C=>(n(),M(ke,{key:C.type,"field-data":C,class:se(["the-curd-example-item fvc",{"the-curd-selected":e.selected===C.type}]),readonly:"",onClick:v=>j("choose",C.type)},null,8,["field-data","class","onClick"]))),128))]))}}),jo={key:0,class:"the-curd-editor-content"},Uo=f("h2",{class:"the-title mgb-20"},"基础设置",-1),Io={class:"f-vertical f-between mgb-20"},Jo=f("h2",{class:"the-title"},"第1步：点击选取组件",-1),Po={class:"f-vertical mgb-20"},Ro={class:"the-title"},Ho=f("div",{class:"f1"},null,-1),zo={key:0,class:"the-curd-target-box"},Ko=f("a",{href:"https://www.json.cn/",target:"_blank"}," JSON编辑工具 ",-1),Go={class:"f-right"},Zo=f("i",{class:"el-icon--left el-icon-plus"},null,-1),Xo=f("i",{class:"el-icon--left el-icon-edit"},null,-1),Qo={name:"Editor"},Yo=re({...Qo,props:{show:{type:Boolean,default:!1},config:{type:Object,required:!0}},emits:["update:show"],setup(q,{emit:T}){const e=q,j=T;function d(){j("update:show",!1)}const s=["checkbox","radio","switch"],g=["select","select-multiple","radio","checkbox","cascader"],$=["input","textarea","select","radio"],U=["input-between","select-multiple","checkbox","cascader"],C=["input","select","radio"],v=["daterange","datetimerange"],P=C.concat(U),Y=`<p>参考 src/utils/index.ts 中的${le("formatDate")}函数</p>`,z=`
<p>动态表单项的条件显示逻辑函数；</p>
<p>返回${le("false")}则不展示对应项；</p>
<p>函数有一个参数：${le("formData")}为当前表单的数据值；</p>
<p>以${le("return")}为函数代码片段标记；</p>
<p>例如：${le("return formData.type !== 2")}</p>
`,F=Oe(),I=Q(()=>F.editor.action==="add"),x=Q(()=>{let m=[];return w.formData&&w.formData.type==="date"&&(m=je[w.formData.dateType].map((y,E)=>({label:y.text,value:E}))),m.unshift({label:"将预览组件中的值设为默认",value:-1}),m}),B=[{label:"整体文字宽度",prop:"labelWidth",type:"number",placeholder:"例如：120(px)"},{label:"文字靠右对齐",prop:"labelRight",type:"switch"}],W=[{label:"表单宽度",prop:"width",type:"number",placeholder:"例如：500(px)"},{label:"文字宽度",prop:"labelWidth",type:"number",placeholder:"例如：140(px)"},{label:"文字靠右排版",prop:"labelPosition",type:"switch",inactiveValue:"left",activeValue:"right"}],w=ie({step:0,formData:void 0});function D(m){w.step=m}const u={label:{required:!0,message:"请输入功能标题",trigger:"blur"},key:{required:!0,trigger:"blur",validator(m,c,y){c?i.includes(c)?y(new Error("当前键值已经被占用！")):y():y(new Error("绑定的键值不能为空"))}},format:{required:!0,message:"格式化规则不能为空",trigger:"blur"},separator:{required:!0,message:"请输入串联符号",trigger:"blur"},defaultValue:{required:!0,trigger:"blur",validator(m,c,y){const E=o();E===!0?y():y(new Error(E)),y()}},options:{required:!0,trigger:"blur",validator(m,c,y){const E=a();E===!0?y():y(new Error(E))}},show:{trigger:"blur",validator(m,c,y){if(c&&!c.includes("return")){y(new Error("逻辑代码必须包含 return 关键字"));return}y()}}},K=Q(()=>{const m=w.formData?w.formData.type:"",c=[{label:"组件标题",prop:"label",type:"input",placeholder:u.label.message},{label:"绑定的键值",prop:"key",type:"input",placeholder:"请输入绑定的键值"},{label:"标题宽度",prop:"labelWidth",type:"number",placeholder:"例如：120(px)"},{label:"组件宽度",prop:"valueWidth",type:"number",placeholder:"例如：140(px)",show:()=>!s.includes(m)},{label:"提示/规则文字",prop:"placeholder",type:"slot",slotName:"ruleText"},{label:"是否必填",prop:"required",type:"switch"}];if(P.includes(m)){const y={label:"绑定值为数字类型",prop:"valueType",type:"switch",activeValue:"number",inactiveValue:"string"};U.includes(m)&&(y.activeValue="array<number>",y.inactiveValue="array"),g.includes(m)&&(y.tips="设为数字类型之后，将会在保存时校验选项数据"),c.push(y)}if(m!=="date"&&c.push({label:"组件默认值",prop:"defaultValue",type:"slot",slotName:"defaultValue"}),m==="input-between"&&c.push({label:"串联符号",prop:"separator",type:"input",placeholder:u.separator.message}),g.includes(m)){const y=[{label:"选项数据",prop:"options",type:"slot",slotName:"options"},{label:"数据展示字段",prop:"optionSetting.label",type:"input",placeholder:"不填则使用 label"},{label:"数据值字段",prop:"optionSetting.value",type:"input",placeholder:"不填则使用 value"}];if(m==="cascader"){const E=[{label:"下级字段",prop:"optionSetting.children",type:"input",placeholder:"不填则使用 children"},{label:"是否多选",prop:"multiple",type:"switch"},{label:"允许只选中某一项",prop:"checkStrictly",type:"switch"}];y.push(...E)}["select","select-multiple"].includes(m)&&y.push({label:"串联显示名称",prop:"joinShow",type:"switch",tips:"例如【英雄联盟-12】"}),c.push(...y)}if(m==="date"){const y=[{label:"日期类型",prop:"dateType",type:"select",options:Ae,noClear:!0,onChange:p},{label:"日期默认值",prop:"shortcutIndex",type:"select",options:x.value,placeholder:"请选择"},{label:"格式化规则",prop:"format",type:"input",tooltip:Y}];c.push(...y)}return F.editor.type==="table"&&c.push({label:"表单显示逻辑",prop:"show",type:"textarea",placeholder:"请输入条件代码，为空则默认展示",tooltip:z}),c}),H=be(),J=ie({options:"",defaultValue:""});function S(m){m.type!=="date"&&(J.defaultValue=JSON.stringify({value:m.defaultValue})),g.includes(m.type)&&(J.options=JSON.stringify(m.options))}function b(m){var E;const c=F.editor,y=de(m,"",c.type==="search");w.formData=y,S(y),(E=H.value)==null||E.clearValidate(),D(1)}function o(){const m='输入的格式必须为 { "value": "input value" }',c=J.defaultValue;if(!c)return m;const y=w.formData.type,E=w.formData.valueType,R=ce[y];try{const G=JSON.parse(c);if(!oe(G,"object"))return m;if(y==="switch"&&!oe(G.value,"boolean"))return`${R}的绑定值应该为 boolean 类型`;if(U.includes(y)){if(!oe(G.value,"array"))return`${R}的绑定值应该为 array 类型`;if(E==="array<number>"&&G.value.some(Z=>Z!==""&&!oe(Z,"number")))return"数组中只能出现数字"}if($.includes(y)&&!["string","number"].includes(Le(G.value)))return`${R}的绑定值应该为 string/number 类型`;if(y==="date"){const Z=w.formData;if(v.includes(Z.dateType)){if(!oe(G.value,"array"))return"范围日期绑定值应该为 array 类型"}else if(!oe(G.value,"string"))return"日期类型绑定值应该为 string 类型"}if(C.includes(y)&&E==="number"&&G.value!==""&&!oe(G.value,"number"))return`${R}的绑定值应该为 number 类型`}catch(G){return console.warn("checkDefaultValue >>",G),m}return!0}function a(){const m=J.options;if(!m)return"选项数据不能为空！";try{const c=JSON.parse(m);if(!oe(c,"array"))return"选项数据格式不正确，需要为数组类型！";const y=w.formData,E=y.optionSetting.value||"value",R=[void 0,null];for(let G=0;G<c.length;G++){const Z=c[G];if(!oe(Z,"object"))return"数组项必须为对象！";if(R.includes(Z[E]))return`数组项的值不能为${R.join("/")}`;if(["array<number>","number"].includes(y.valueType)&&!oe(Z[E],"number")&&Z[E]!=="")return"数组项的值必须为 number 类型"}return!0}catch(c){return console.warn("checkOptions >>",c),"不合法的JSON,注意使用双引号,结尾不能为逗号等"}}function k(){a()===!0&&(w.formData.options=JSON.parse(J.options))}function r(){if(o()===!0){const c=w.formData,y=JSON.parse(J.defaultValue).value;c.type!=="date"&&(c.defaultValue=y)}}function p(m){const c=Ae.find(E=>E.value===m),y=w.formData;y.shortcutIndex="",v.includes(c.value)?(y.value=[],y.valueType="array"):(y.value="",y.valueType="string"),y.formatShow=c.formatShow,y.format=c.format}function L(m){return/^[+-]?(\d|([1-9]\d+))(\.\d+)?$/.test(m)}function h(){var m;(m=H.value)==null||m.validate(c=>{if(at("#the-editor-form",c),!c)return;r(),g.includes(w.formData.type)&&k();const y=F.editor,E=JSON.parse(JSON.stringify(w.formData));if(g.includes(E.type)&&k(),E.valueType||(E.valueType=Le(E.defaultValue)),g.includes(E.type)&&["number","array<number>"].includes(E.valueType)){let G=E.optionSetting.value;G||(G="value",E.optionSetting.value=G);for(let Z=0;Z<E.options.length;Z++){const ee=E.options[Z],De=ee[G];if([null,void 0].includes(De))return pe.error("数据值字段与选项数据不匹配，请检查！");if(L(De.toString()))ee[G]=Number(De);else{const ze=ee[E.optionSetting.label];return pe.error(`选项数据中【${ze}】的值应该为数字！`)}}}E.type==="date"&&(E.shortcutIndex===-1&&(E.shortcutDate=E.value),E.value=E.valueType==="array"?[]:""),{search(G){G?e.config.search.list.push(E):e.config.search.list[y.index]=E},table(G){if(G){const Z=JSON.parse(JSON.stringify(y.form.fields));Z.push(E),y.form.fields=Z}else{const Z=JSON.parse(JSON.stringify(y.form.fields));Z[y.index]=E,y.form.fields=Z}}}[y.type](I.value),d()})}let i=[];function te(m){const c=F.editor;i=[],{search(){i=e.config.search.list.map(E=>E.key)},table(){i=c.form.fields.map(E=>E.key)}}[c.type](),m&&(i=i.filter(E=>E!==m))}return he(()=>e.show,function(m){if(!m){w.formData=void 0;return}const c=F.editor;if(c.action==="add")w.step=0,w.formData=void 0,te();else{const y=c.index;({search(){w.formData=JSON.parse(JSON.stringify(e.config.search.list[y]))},table(){var R;w.formData=JSON.parse(JSON.stringify((R=c.form)==null?void 0:R.fields[y]))}})[c.type](),S(w.formData),te(w.formData.key),w.step=1}}),(m,c)=>{const y=_("el-form"),E=_("el-button"),R=_("el-input"),G=_("el-text");return n(),O("section",{class:se(["the-curd-editor the-curd-scrollbar",{"is-show":e.show}])},[t(Ke,{name:"the-curd-editor-move"},{default:l(()=>{var Z;return[e.show?(n(),O("div",jo,[Uo,t(y,{"label-position":"right","label-width":"120px"},{default:l(()=>[V(F).editor.type==="search"?(n(),M(V(ve),{key:0,data:e.config.search,list:B},null,8,["data"])):N("",!0),V(F).editor.type==="table"&&V(F).editor.form?(n(),M(V(ve),{key:1,data:V(F).editor.form,list:W},null,8,["data"])):N("",!0)]),_:1}),w.step===0?(n(),O(X,{key:0},[f("div",Io,[Jo,t(E,{link:"",type:"primary",onClick:c[0]||(c[0]=ee=>d())},{default:l(()=>[A("退出编辑")]),_:1})]),t(Wo,{selected:(Z=w.formData)==null?void 0:Z.type,type:V(F).editor.type,onChoose:b},null,8,["selected","type"])],64)):N("",!0),w.step===1?(n(),O(X,{key:1},[f("div",Po,[f("h2",Ro,"第2步：配置"+ne(V(ce)[w.formData.type]),1),Ho,t(E,{link:"",type:"success",onClick:c[1]||(c[1]=ee=>D(0))},{default:l(()=>[A("上一步")]),_:1}),t(E,{link:"",type:"primary",onClick:c[2]||(c[2]=ee=>d())},{default:l(()=>[A("退出编辑")]),_:1})]),w.formData?(n(),O("div",zo,[t(ke,{"field-data":w.formData,"edit-mode":""},null,8,["field-data"])])):N("",!0),w.formData?(n(),M(y,{key:1,id:"the-editor-form",ref_key:"formRef",ref:H,model:w.formData,rules:u,"label-position":"right","label-width":"128px"},{default:l(()=>[t(V(ve),{data:w.formData,list:K.value},{ruleText:l(()=>[w.formData.type==="input-between"?(n(),O(X,{key:0},[t(R,{modelValue:w.formData.placeholder[0],"onUpdate:modelValue":c[3]||(c[3]=ee=>w.formData.placeholder[0]=ee),class:"f1",clearable:"",placeholder:"请输入提示-1"},null,8,["modelValue"]),t(G,{style:{padding:"0 6px"}},{default:l(()=>[A("-")]),_:1}),t(R,{modelValue:w.formData.placeholder[1],"onUpdate:modelValue":c[4]||(c[4]=ee=>w.formData.placeholder[1]=ee),class:"f1",clearable:"",placeholder:"请输入提示-2"},null,8,["modelValue"])],64)):(n(),M(R,{key:1,modelValue:w.formData.placeholder,"onUpdate:modelValue":c[5]||(c[5]=ee=>w.formData.placeholder=ee),clearable:"",placeholder:"请输入规则提示/输入框提示文字"},null,8,["modelValue"]))]),defaultValue:l(()=>[t(R,{modelValue:J.defaultValue,"onUpdate:modelValue":c[6]||(c[6]=ee=>J.defaultValue=ee),type:"textarea",clearable:"",placeholder:"请输入JSON，值为 value",onBlur:c[7]||(c[7]=ee=>r())},null,8,["modelValue"])]),options:l(()=>[t(R,{modelValue:J.options,"onUpdate:modelValue":c[8]||(c[8]=ee=>J.options=ee),type:"textarea",placeholder:"请输入数组JSON",style:{"margin-bottom":"4px"},onBlur:c[9]||(c[9]=ee=>k())},null,8,["modelValue"]),t(E,{link:"",type:"primary"},{default:l(()=>[Ko]),_:1})]),_:1},8,["data","list"]),f("div",Go,[t(E,{onClick:c[10]||(c[10]=ee=>d())},{default:l(()=>[A("关闭")]),_:1}),I.value?(n(),M(E,{key:0,type:"primary",onClick:c[11]||(c[11]=ee=>h())},{default:l(()=>[Zo,A(" 新增 ")]),_:1})):(n(),M(E,{key:1,type:"success",onClick:c[12]||(c[12]=ee=>h())},{default:l(()=>[Xo,A(" 确认 ")]),_:1}))])]),_:1},8,["model"])):N("",!0)],64)):N("",!0)])):N("",!0)]}),_:1})],2)}}}),el={class:"the-curd-main-page"},tl={key:2},ol={key:0,class:"the-tag blue"},ll=f("i",{class:"el-icon-arrow-left"},null,-1),nl=f("p",{class:"mgb-10"},"配置筛选相关功能",-1),al=f("p",null,"配置表格相关功能",-1),il={name:"Curd"},ml=re({...il,props:{data:{type:Object,required:!0},action:{type:Object,required:!0}},setup(q){const T=q,e=ie({loading:!1,editor:{show:!1,type:void 0,form:void 0,action:"add",index:-1},showEntrance:!1}),j=Q(()=>{const o=e.editor.type;return o==="search"||!o&&T.data.search.list.length>0});Ze(et,e);let d;function s(o){e.editor.type=o,e.editor.show=!1,e.editor.index=-1,e.showEntrance=!1,d={[o]:ue(T.data[o])}}function g(o){const a=e.editor.type;o&&d&&(T.data[a]=d[a]),e.editor.index=-1,e.editor.show=!1,e.editor.type=void 0,e.editor.form=void 0,d=void 0}function $(){g()}function U(){qe(JSON.stringify(T.data),()=>pe.success("复制成功！"))}function C(o){o&&T.data.search.list.forEach(Ee),v.pageInfo.currentPage=1,v.selectList=[],H()}const v=ie({selectList:[],data:[],pageInfo:ot(),formShow:!1,formType:"add",formLoading:!1}),P=Q(()=>T.data.table),Y=Q(()=>P.value.columns.filter(a=>a.visible).map(a=>{const k={...a};return k.cellType==="js"&&k.jsCode&&(k.rawContent=function(r,p){let L="";try{L=new Function("cellValue","row",k.jsCode)(r,p)}catch(h){console.warn("解析 rawContent 代码错误 >>",h),L="-"}return L}),k})),z=Q(()=>P.value.actions.map(a=>{const k={...a};return k.key===fe&&(k.click=w),k})),F=Q(()=>{const o=[],a=[];return Y.value.forEach(k=>{k.slotHead&&o.push(k.slotHead),k.slot&&a.push(k.slot)}),{head:o,cell:a}});function I(o){return P.value.columns.find(k=>k.prop===o)||{}}const x=be(),B=Q(()=>{const o=P.value,a={title:"编辑表单",config:o.formEdit||{}};return v.formType==="add"&&(a.title="新增表单",a.config=o.formAdd||{}),a});let W=null;function w(o){o?(v.formType="edit",W=o):v.formType="add",v.formShow=!0,setTimeout(()=>{var a;return(a=x.value)==null?void 0:a.clear()}),Ge(()=>{var a;return W&&((a=x.value)==null?void 0:a.setFormData(W))})}function D(){var o;v.formShow=!1,(o=x.value)==null||o.reset(),W=null}function u(){var o;(o=x.value)==null||o.validate(async(a,k)=>{if(v.formType==="add"&&T.action.onAdd){v.formLoading=!0;const r=await T.action.onAdd(a,k);if(v.formLoading=!1,r.code!==1)return;D(),H()}if(v.formType==="edit"&&T.action.onEdit){v.formLoading=!0;const r=await T.action.onEdit(a,k);if(v.formLoading=!1,r.code!==1)return;D(),H()}})}function K(o){const a=T.data.search.list,k={};for(let h=0;h<a.length;h++){const i=a[h],te=Ue(i);if(i.required&&oe(te.result,"string"))return it(document.querySelector(`.${i.id}`)),pe.error(te.result),o&&o.key==="page"&&(v.pageInfo=o.before),null;te.result===!0&&(k[i.key]=te.value)}const r=P.value.columns,p=[],L=[];return o&&o.key==="sort"?r.forEach(h=>{h.sort&&(h.prop===o.prop?h.sort=o.action:h.sort=!0),h.sort==="asc"&&p.push(h.prop),h.sort==="desc"&&L.push(h.prop)}):r.forEach(h=>{h.sort==="asc"&&p.push(h.prop),h.sort==="desc"&&L.push(h.prop)}),p.length&&(k.asc=p.toString()),L.length&&(k.desc=L.toString()),k}async function H(o){const a=K(o);if(!a)return;const k=JSON.parse(JSON.stringify(v.pageInfo));e.loading=!0;const r=await T.action.getTableData(a,k);e.loading=!1,r.code===1&&(v.pageInfo.total=r.data.total,v.data=r.data.list||[])}function J(o){const a=v.selectList;switch(o){case"add":w();break;case"delete":if(!a.length)return pe.warning("请选择要删除的列表再进行操作~");me({title:"操作提示",content:`是否删除选中的 ${a.length} 条数据？`,cancelText:"取消",async confirm(){T.action.onDelete?(e.loading=!0,(await T.action.onDelete(JSON.parse(JSON.stringify(v.selectList)))).code===1?(pe.success("删除成功！"),v.selectList=[],H()):e.loading=!1):pe.info("请设置 action.onDelete 删除逻辑")}});break;case"export":T.action.onExport?T.action.onExport():pe.info("请设置 action.onExport 导出逻辑");break}}function S(o){({exit:()=>g(!0),copy:U,complete:$})[o]()}function b(o){e.loading=o}return Ye({formatDate:nt,copyText:qe,messageBox:me,message:pe,jsonToPath:lt,request:st,getData:H,setLoading:b}),We(function(){T.action.created&&P.value.columns.length&&T.action.created(H)}),(o,a)=>{const k=_("base-table"),r=_("base-pagination"),p=_("el-button"),L=_("el-empty"),h=_("base-dialog");return n(),O("div",el,[f("section",{class:se([e.editor.show?"f1":"the-curd-content"])},[j.value?(n(),M(gt,{key:0,data:T.data.search,onSearch:C},null,8,["data"])):N("",!0),e.editor.type==="table"?(n(),M(Fo,{key:1,config:P.value,onAction:S},null,8,["config"])):e.editor.type==="search"?(n(),O("div",tl,[t(V(Ie),{onAction:S})])):(n(),O(X,{key:3},[P.value.columns.length>0?(n(),O(X,{key:0},[t(Pe,{config:P.value,disabled:e.loading,onAction:J},{left:l(()=>[P.value.selectKey?(n(),O("span",ol," 已选择 "+ne(v.selectList.length)+" 条数据 ",1)):N("",!0)]),_:1},8,["config","disabled"]),t(k,{class:"f1","select-list":v.selectList,"onUpdate:selectList":a[1]||(a[1]=i=>v.selectList=i),data:v.data,columns:Y.value,actions:z.value,actionMax:P.value.actionMax,loading:e.loading,"select-key":P.value.selectKey},Ve({_:2},[ae(F.value.head,i=>({name:i,fn:l(({$index:te})=>[t(He,{column:Y.value[P.value.selectKey?te-1:te],onSort:a[0]||(a[0]=(m,c)=>H({key:"sort",prop:m,action:c}))},null,8,["column"])])})),ae(F.value.cell,i=>({name:i,fn:l(({row:te})=>[t(V(Je),{column:I(i),src:te[i],previewList:F.value.cell.map(m=>te[m])},null,8,["column","src","previewList"])])}))]),1032,["select-list","data","columns","actions","actionMax","loading","select-key"]),t(r,{disabled:e.loading,pageInfo:v.pageInfo,onChange:a[2]||(a[2]=i=>H({key:"page",...i}))},null,8,["disabled","pageInfo"])],64)):(n(),M(L,{key:1,description:"当前页面没有表格配置数据，请配置后再操作~"},{default:l(()=>[t(p,{type:"primary",onClick:a[3]||(a[3]=i=>s("table"))},{default:l(()=>[A("去配置")]),_:1})]),_:1}))],64))],2),t(Yo,{show:e.editor.show,"onUpdate:show":a[4]||(a[4]=i=>e.editor.show=i),config:T.data},null,8,["show","config"]),t(h,{show:v.formShow,"onUpdate:show":a[7]||(a[7]=i=>v.formShow=i),title:B.value.title,width:V(_e)(B.value.config.width),onClose:a[8]||(a[8]=i=>D())},{footer:l(()=>[t(V(Ce),{loading:v.formLoading,onClose:a[5]||(a[5]=i=>D()),onSubmit:a[6]||(a[6]=i=>u())},null,8,["loading"])]),default:l(()=>[t(Re,{ref_key:"formRef",ref:x,config:B.value.config,type:v.formType,disabled:v.formLoading},null,8,["config","type","disabled"])]),_:1},8,["show","title","width"]),!e.showEntrance&&!e.editor.type?(n(),M(p,{key:0,class:"the-curd-entrance",type:"primary",size:"small",onClick:a[9]||(a[9]=i=>e.showEntrance=!0)},{default:l(()=>[ll]),_:1})):N("",!0),t(h,{show:e.showEntrance,"onUpdate:show":a[13]||(a[13]=i=>e.showEntrance=i),title:"请选择配置操作",width:"600px"},{footer:l(()=>[t(p,{onClick:a[12]||(a[12]=i=>e.showEntrance=!1)},{default:l(()=>[A("关 闭")]),_:1})]),default:l(()=>[f("div",{class:"the-curd-entrance-item",onClick:a[10]||(a[10]=i=>s("search"))},[nl,t(V(_t))]),f("div",{class:"the-curd-entrance-item",onClick:a[11]||(a[11]=i=>s("table"))},[al,t(V(kt))])]),_:1},8,["show"])])}}});export{ml as _};
