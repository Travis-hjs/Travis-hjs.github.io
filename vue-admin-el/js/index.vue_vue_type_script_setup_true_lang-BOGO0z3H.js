import{d as ue,h as Q,o as Fe,b as h,e as i,f as S,k as C,B as be,p as D,F as j,c as t,g as l,C as q,t as ne,i as b,z as ee,u as V,m as xe,ax as Ce,n as se,N as we,r as ie,w as ge,q as Ne,j as he,T as Ge,H as Xe,K as Qe}from"./element-plus-CetPY_yD.js";import{S as Ye,F as We,a as Ze}from"./index-bNRKYAwc.js";import{i as Ee,f as ce,s as Je,d as _e,u as Ue,c as ye,e as qe,h as Pe,a as Te,F as $e,L as ve,j as oe,k as Se,b as fe,T as Re,E as Ie,g as de,l as Le,m as et,n as tt,o as lt,p as ot}from"./index.vue_vue_type_style_index_0_lang-DRS5iTuO.js";import{k as le,l as re,i as Ae,b as me,u as Ve,n as Be,a as pe,g as nt,f as at,c as je,p as it}from"./index-Djcm6DHg.js";import{v as st,s as rt}from"./dom-D4K-_gXQ.js";import{r as ut}from"./common-Ba4XKjbj.js";const dt=["title"],ct={name:"Field"},ke=ue({...ct,props:{fieldData:{type:Object,required:!0},editMode:Boolean,readonly:Boolean,disabled:Boolean},emits:["change"],setup(Y,{emit:A}){const o=Y,I=A;Ee(o.fieldData);function d($){let r=$||o.fieldData.value;le(r,"array")&&(r=re(r)),I("change",r)}const c=Q(()=>o.fieldData),f=Q(()=>{const $=o.fieldData.optionSetting||{};return{value:$.value||"value",label:$.label||"label"}}),g=Q(()=>{const $=o.fieldData,r=$.optionSetting;return{multiple:$.multiple,checkStrictly:$.checkStrictly,value:r.value||"value",label:r.label||"label",children:r.children||"children"}});function B($){const r=c.value.placeholder;return{disabled:o.disabled,readonly:o.readonly,clearable:!0,placeholder:le($,"number")?r[$]:r}}function J($){const r=o.fieldData;r.valueType==="number"?(r.value=Ae($,!0,!0),d(Number(r.value))):(r.value=$,d())}function O($,r){const R=o.fieldData;R.valueType==="array<number>"?(R.value[r]=Ae($,!0,!0),d(R.value.map(T=>Number(T)))):(R.value[r]=$,d())}const P=["-",".","",null,void 0];function Z(){const $=o.fieldData;$.valueType==="number"&&(P.includes($.value)?$.value="":$.value=Number($.value))}function F($){const r=o.fieldData;if(r.valueType==="array<number>"){const R=r.value[$];P.includes(R)?r.value[$]="":r.value[$]=Number(R)}}function v($){const r=$.type==="select-multiple";return{placeholder:$.placeholder,disabled:o.disabled,multiple:$.type==="select-multiple",clearable:!0,filterable:!0,collapseTags:!0,class:`field-item${r?" is-multiple-select":""}`}}function W($,r){const R=f.value;return $.joinShow?`${r[R.label]}-${r[R.value]}`:`${r[R.label]}`}let M=[];const n="the-date-shortcut-selected";function L(){const $=document.querySelector(`.${n}`);$&&$.classList.remove(n),d()}function H($){$.classList.add(n)}return Fe(function(){const $=o.fieldData;if($.type==="date"){const r=`.${$.id} .el-picker-panel__sidebar`,R=document.querySelector(r);if(!R)return console.warn("找不到日期快捷面板节点！");M=Array.from(R.children),M.forEach(G=>{G.addEventListener("click",()=>H(G))});const T=$.shortcutIndex;le(T,"number")&&T>=0&&H(M[T])}}),($,r)=>{const R=h("el-input"),T=h("el-text"),G=h("el-select-v2"),E=h("el-option"),x=h("el-select"),a=h("el-checkbox"),u=h("el-checkbox-group"),U=h("el-radio"),p=h("el-radio-group"),y=h("el-switch"),N=h("el-cascader"),s=h("el-date-picker");return i(),S("div",{class:"the-curd-form-field f-vertical short-value",style:xe({width:V(_e)(c.value.valueWidth)})},[c.value.type==="input"?(i(),C(R,be({key:0,"model-value":c.value.value},B(),{class:"the-curd-field",onInput:J,onBlur:Z}),null,16,["model-value"])):D("",!0),c.value.type==="textarea"?(i(),C(R,{key:1,modelValue:c.value.value,"onUpdate:modelValue":r[0]||(r[0]=e=>c.value.value=e),readonly:o.readonly,disabled:o.disabled,autosize:{minRows:2,maxRows:10},placeholder:c.value.placeholder,type:"textarea",class:"the-curd-field",onInput:r[1]||(r[1]=e=>d())},null,8,["modelValue","readonly","disabled","placeholder"])):D("",!0),c.value.type==="input-between"?(i(),S(j,{key:2},[t(R,be({"model-value":c.value.value[0]},B(0),{class:"f1",onInput:r[2]||(r[2]=e=>O(e,0)),onBlur:r[3]||(r[3]=e=>F(0))}),null,16,["model-value"]),t(T,{style:{padding:"0 6px"}},{default:l(()=>[q(ne(c.value.separator),1)]),_:1}),t(R,be({"model-value":c.value.value[1]},B(1),{class:"f1",onInput:r[4]||(r[4]=e=>O(e,1)),onBlur:r[5]||(r[5]=e=>F(1))}),null,16,["model-value"])],64)):D("",!0),c.value.type==="select"||c.value.type==="select-multiple"?(i(),S(j,{key:3},[c.value.options.length>50?(i(),C(G,be({key:0,modelValue:c.value.value,"onUpdate:modelValue":r[6]||(r[6]=e=>c.value.value=e),options:c.value.options,props:f.value},v(c.value),{onChange:r[7]||(r[7]=e=>d())}),{default:l(({item:e})=>[b("span",{title:W(c.value,e)},ne(W(c.value,e)),9,dt)]),_:1},16,["modelValue","options","props"])):(i(),C(x,be({key:1,modelValue:c.value.value,"onUpdate:modelValue":r[8]||(r[8]=e=>c.value.value=e)},v(c.value),{onChange:r[9]||(r[9]=e=>d())}),{default:l(()=>[(i(!0),S(j,null,ee(c.value.options,e=>(i(),C(E,{key:e[f.value.value],value:e[f.value.value],label:W(c.value,e)},null,8,["value","label"]))),128))]),_:1},16,["modelValue"]))],64)):D("",!0),c.value.type==="checkbox"?(i(),S(j,{key:4},[t(u,{modelValue:c.value.value,"onUpdate:modelValue":r[10]||(r[10]=e=>c.value.value=e),disabled:o.disabled,onChange:r[11]||(r[11]=e=>d())},{default:l(()=>[(i(!0),S(j,null,ee(c.value.options,e=>(i(),C(a,{key:e[f.value.value],value:e[f.value.value]},{default:l(()=>[q(ne(e[f.value.label]),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue","disabled"]),o.editMode&&!c.value.options.length?(i(),C(T,{key:0,type:"primary"},{default:l(()=>[q(ne(V(ce).checkbox)+"（空数据） ",1)]),_:1})):D("",!0)],64)):D("",!0),c.value.type==="radio"?(i(),S(j,{key:5},[t(p,{modelValue:c.value.value,"onUpdate:modelValue":r[12]||(r[12]=e=>c.value.value=e),disabled:o.disabled,onChange:r[13]||(r[13]=e=>d())},{default:l(()=>[(i(!0),S(j,null,ee(c.value.options,e=>(i(),C(U,{key:e[f.value.value],value:e[f.value.value]},{default:l(()=>[q(ne(e[f.value.label]),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue","disabled"]),o.editMode&&!c.value.options.length?(i(),C(T,{key:0,type:"primary"},{default:l(()=>[q(ne(V(ce).radio)+"（空数据） ",1)]),_:1})):D("",!0)],64)):D("",!0),c.value.type==="switch"?(i(),C(y,{key:6,modelValue:c.value.value,"onUpdate:modelValue":r[14]||(r[14]=e=>c.value.value=e),"inline-prompt":"","active-text":"是","inactive-text":"否",onChange:r[15]||(r[15]=e=>d())},null,8,["modelValue"])):D("",!0),c.value.type==="cascader"?(i(),C(N,{key:7,modelValue:c.value.value,"onUpdate:modelValue":r[16]||(r[16]=e=>c.value.value=e),options:c.value.options,props:g.value,placeholder:c.value.placeholder,disabled:o.disabled,clearable:"","collapse-tags":"","collapse-tags-tooltip":"",filterable:"",class:"the-curd-field",onChange:r[17]||(r[17]=e=>d())},null,8,["modelValue","options","props","placeholder","disabled"])):D("",!0),c.value.type==="date"?(i(),C(s,{key:8,modelValue:c.value.value,"onUpdate:modelValue":r[18]||(r[18]=e=>c.value.value=e),placeholder:c.value.placeholder,type:c.value.dateType,format:c.value.formatShow,shortcuts:V(Je)[c.value.dateType],disabled:o.disabled,"popper-class":c.value.id.toString(),"range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",class:"the-curd-field",onChange:L},null,8,["modelValue","placeholder","type","format","shortcuts","disabled","popper-class"])):D("",!0)],4)}}}),pt={key:0,class:"el-icon-rank el-icon--left"},ft={style:{"line-height":"1"}},mt={key:0,class:"the-curd-edit-mask f-vertical f-right"},yt=b("i",{class:"el-icon-delete el-icon--left"},null,-1),vt=b("i",{class:"el-icon-edit el-icon--left"},null,-1),gt=b("i",{class:"el-icon-plus"},null,-1),bt={name:"Search"},ht=ue({...bt,props:{data:{type:Object,required:!0}},emits:["search"],setup(Y,{emit:A}){const o=Y,I=A,d=Ue(),c=Q(()=>d.editor.type==="search"&&!d.editor.show);function f(F){const v=o.data.list[F].label||o.data.list[F].key;me({title:"操作提示",content:`是否删除【${v}】？`,cancelText:"取消",confirm(){o.data.list.splice(F,1)}})}function g(F){d.editor.index=F,d.editor.action="edit",d.editor.show=!0}function B(F){return d.editor.index===F&&d.editor.type==="search"&&d.editor.show}function J(){d.editor.index=-1,d.editor.action="add",d.editor.show=!0}const{onDragStart:O,onDragMove:P,onDropEnd:Z}=Ve({list:()=>o.data.list,key:"id",findLevel:5});return(F,v)=>{const W=h("el-button"),M=h("el-text");return i(),C(V(Ze),{class:"the-curd-search","label-right":o.data.labelRight,"label-width":V(_e)(o.data.labelWidth)||"auto"},Ce({content:l(()=>[t(we,{name:"the-group",tag:"div",class:"the-filter-content f1"},{default:l(()=>[(i(!0),S(j,null,ee(o.data.list,(n,L)=>(i(),C(V(We),{key:n.id,"data-key":n.id,class:se([{"the-curd-selected":B(L)},n.id]),label:n.label,"label-width":V(_e)(n.labelWidth),required:n.required,draggable:c.value,onDragstart:H=>V(O)(L),onDragover:H=>V(P)(H,L),onDrop:v[0]||(v[0]=H=>V(Z)())},Ce({default:l(()=>[t(ke,{"field-data":n,disabled:V(d).loading},null,8,["field-data","disabled"]),c.value?(i(),S("div",mt,[t(W,{link:"",type:"danger",onClick:H=>f(L)},{default:l(()=>[yt,q(" 删除 ")]),_:2},1032,["onClick"]),t(W,{link:"",type:"success",onClick:H=>g(L)},{default:l(()=>[vt,q(" 编辑 ")]),_:2},1032,["onClick"])])):D("",!0)]),_:2},[V(d).editor.type==="search"?{name:"label",fn:l(()=>[c.value?(i(),S("i",pt)):D("",!0),b("span",ft,ne(n.label),1)]),key:"0"}:void 0]),1032,["data-key","class","label","label-width","required","draggable","onDragstart","onDragover"]))),128)),c.value?(i(),C(V(We),{key:0},{default:l(()=>[o.data.list.length?D("",!0):(i(),C(M,{key:0,type:"info",style:{"margin-right":"12px"}},{default:l(()=>[q(" 请添加筛选条件~ ")]),_:1})),t(W,{type:"primary",circle:"",onClick:v[1]||(v[1]=n=>J())},{default:l(()=>[gt]),_:1})]),_:1})):D("",!0)]),_:1})]),_:2},[V(d).editor.type?void 0:{name:"right",fn:l(()=>[t(V(Ye),{loading:V(d).loading,onSearch:v[2]||(v[2]=n=>I("search",n))},null,8,["loading"])]),key:"0"}]),1032,["label-right","label-width"])}}}),_t={class:"w-full f-vertical mgb-10"},kt=b("div",{class:"f1"},null,-1),wt=b("i",{class:"el-icon--left el-icon-delete"},null,-1),Vt=b("i",{class:"el-icon--left el-icon-plus"},null,-1),xt=b("i",{class:"el-icon--left el-icon-download"},null,-1),$t=b("i",{class:"el-icon--left el-icon-setting"},null,-1),Dt={class:"f-vertical f-between mgb-10"},St=b("i",{class:"el-icon--left el-icon-refresh-left"},null,-1),Ct={key:0,class:"el-icon--left el-icon-rank"},Tt={class:"f1"},Et={name:"TableOperation"},ze=ue({...Et,props:{config:{type:Object,required:!0},editMode:{type:Boolean},disabled:{type:Boolean}},emits:["action"],setup(Y,{emit:A}){const o=Y,I=A;function d(M){I("action",M)}const c={on:"el-icon-success",off:"el-icon-remove-outline"},f=Q(()=>{const M=o.config;return{add:M.formAdd&&M.formAdd.fields.length>0,edit:M.formEdit&&M.formEdit.fields.length>0,delete:!!M.selectKey}}),g=Q(()=>{const M=f.value.delete,n=f.value.add,L=f.value.edit;return[{type:"delete",text:M?"修改删除":"配置删除",icon:M?c.on:c.off,style:M?"primary":"info"},{type:"add",text:n?"修改新增表单":"配置新增表单",icon:n?c.on:c.off,style:n?"primary":"info"},{type:"edit",text:L?"修改编辑表单":"配置编辑表单",icon:L?c.on:c.off,style:L?"primary":"info"}]}),B=[{label:"固定左边",value:"left"},{label:"默认",value:!1},{label:"固定右边",value:"right"}],{onDragStart:J,onDragMove:O,onDropEnd:P}=Ve({list:()=>o.config.columns,key:"prop"});function Z(M,n){const L=M.prop===ye,H=M.prop;return{"data-key":H,key:H,draggable:L?void 0:!0,title:L?"操作栏不可排序，只能显示隐藏操作":void 0,onDragstart:L?void 0:()=>J(n),onDragover:L?void 0:$=>O($,n),onDrop:L?void 0:P}}const F=ie({showFixed:!1});let v=[];function W(){o.config.columns=v}return ge(()=>o.config.columns,function(M){o.editMode||(v=re(M))},{immediate:!0}),(M,n)=>{const L=h("el-button"),H=h("el-checkbox"),$=h("el-radio-button"),r=h("el-radio-group"),R=h("el-switch"),T=h("el-empty"),G=h("el-popover");return i(),S("div",_t,[o.editMode?(i(!0),S(j,{key:0},ee(g.value,E=>(i(),C(L,{key:E.type,type:E.style,link:"",onClick:x=>d(E.type)},{default:l(()=>[b("i",{class:se(["el-icon--left",E.icon])},null,2),q(" "+ne(E.text),1)]),_:2},1032,["type","onClick"]))),128)):D("",!0),Ne(M.$slots,"left"),o.editMode?D("",!0):(i(),S(j,{key:1},[kt,Ne(M.$slots,"right"),f.value.delete?(i(),C(L,{key:0,type:"danger",link:"",disabled:o.disabled,onClick:n[0]||(n[0]=E=>d("delete"))},{default:l(()=>[wt,q(" 删除 ")]),_:1},8,["disabled"])):D("",!0),f.value.add?(i(),C(L,{key:1,type:"primary",link:"",disabled:o.disabled,onClick:n[1]||(n[1]=E=>d("add"))},{default:l(()=>[Vt,q(" 新增 ")]),_:1},8,["disabled"])):D("",!0),t(L,{type:"primary",link:"",disabled:o.disabled,onClick:n[2]||(n[2]=E=>d("export"))},{default:l(()=>[xt,q(" 导出 ")]),_:1},8,["disabled"]),t(G,{placement:"bottom-start",width:F.showFixed?500:300,transition:"el-zoom-in-top",trigger:"click"},{reference:l(()=>[t(L,{type:"primary",link:"",disabled:o.disabled},{default:l(()=>[$t,q(" 表格列设置 ")]),_:1},8,["disabled"])]),default:l(()=>[b("div",Dt,[t(H,{modelValue:F.showFixed,"onUpdate:modelValue":n[3]||(n[3]=E=>F.showFixed=E),label:"配置固定列"},null,8,["modelValue"]),t(L,{type:"primary",link:"",onClick:n[4]||(n[4]=E=>W())},{default:l(()=>[St,q(" 重置 ")]),_:1})]),t(we,{name:"the-group",tag:"div",class:"the-curd-setting-list the-curd-scrollbar"},{default:l(()=>[(i(!0),S(j,null,ee(o.config.columns,(E,x)=>(i(),S("div",be({class:"the-curd-option-item f-vertical"},Z(E,x)),[E.prop!==V(ye)?(i(),S("i",Ct)):D("",!0),b("span",Tt,ne(E.title),1),F.showFixed?(i(),C(r,{key:1,modelValue:E.fixed,"onUpdate:modelValue":a=>E.fixed=a,size:"small",class:"mgr-10"},{default:l(()=>[(i(),S(j,null,ee(B,a=>t($,{key:a.value.toString(),value:a.value},{default:l(()=>[q(ne(a.label),1)]),_:2},1032,["value"])),64))]),_:2},1032,["modelValue","onUpdate:modelValue"])):D("",!0),t(R,{modelValue:E.visible,"onUpdate:modelValue":a=>E.visible=a,"inline-prompt":"","active-text":"显示","inactive-text":"隐藏"},null,8,["modelValue","onUpdate:modelValue"])],16))),256)),o.config.columns.length?D("",!0):(i(),C(T,{key:"empty","image-size":120,description:"暂无可以设置的表格列"}))]),_:1})]),_:1},8,["width"])],64))])}}}),Ut={key:0,class:"el-icon-rank el-icon--left",style:{"line-height":"32px"}},Ot={class:"f-vertical w-full"},Mt=b("i",{class:"el-icon-edit"},null,-1),Nt=b("i",{class:"el-icon-delete"},null,-1),Wt=b("i",{class:"el-icon--left el-icon-plus"},null,-1),qt=b("i",{class:"el-icon--left el-icon-plus"},null,-1),Lt={key:"bottom-setting"},At=b("i",{class:"el-icon--left el-icon-delete"},null,-1),Bt=b("i",{class:"el-icon--left el-icon-check"},null,-1),jt={name:"TableForm"},Ke=ue({...jt,props:{config:{type:Object,default:()=>qe()},type:{type:String},editMode:{type:Boolean},disabled:{type:Boolean}},emits:["change"],setup(Y,{expose:A,emit:o}){const I=Y,d=o,c=he(),f=qe(),g=ie({config:f,form:{},rules:{}}),B=Ue(),J=Q(()=>I.type==="add"?"新增":"编辑"),O=Q(()=>B.editor.show);function P(E){n(),B.editor.action=E>=0?"edit":"add",B.editor.form=g.config,B.editor.index=E,B.editor.show=!0}function Z(E){const x=g.config.fields;n(),me({title:"操作提示",content:`是否删除【${x[E].label}】？`,cancelText:"取消",confirm(){x.splice(E,1)}})}function F(){me({title:"操作提示",content:`是否移除【${J.value}】表单？移除后将不会出现对应功能按钮。`,cancelText:"取消",confirm(){g.config.fields=[]}})}function v(){d("change")}function W(){const E=I.type==="add"?"编辑":"新增";me({title:"操作提示",content:`是否将表单数据同步到【${E}】表单？`,cancelText:"不同步",confirmText:"同步",cancel(){d("change",g.config)},confirm(){d("change",g.config,!0)}})}function M(E){var x;(x=c.value)==null||x.validate(a=>{if(a&&E){const u=T.value,U={};G.value.forEach(p=>{U[p.key]=u[p.key]}),E(u,U)}})}function n(){var E;(E=c.value)==null||E.clearValidate()}function L(){g.config.fields.forEach(Ee)}function H(E){g.config.fields.forEach(x=>{if(Object.prototype.hasOwnProperty.call(E,x.key)){const a=E[x.key];if(!a)return;switch(x.type){case"date":le(a,"array")?x.value=a.map(u=>new Date(u)):x.value=new Date(a);break;default:x.value=a;break}}})}const{onDragStart:$,onDragMove:r,onDropEnd:R}=Ve({list:()=>g.config.fields,key:"id",findLevel:10});ge(()=>I.config,function(E){E&&(g.config=re(E))},{immediate:!0}),ge(()=>g.config.fields,function(E){const x={},a={},u=["input","input-between","textarea"];E&&E.forEach(U=>{x[U.key]=U.value,U.required&&(a[U.key]=[{required:!0,validator(p,y,N){const s=[void 0,null,""];if(U.type==="input-between"&&!U.value[0]&&!U.value[1]){N(new Error("请输入两个范围字段"));return}if(U.valueType==="array"&&!U.value.length){N(new Error(U.placeholder||"请选择"));return}if(U.valueType!=="boolean"&&s.includes(U.value)){const e=u.includes(U.type)?"请输入内容":"请选择";N(new Error(U.placeholder||e));return}N()},trigger:u.includes(U.type)?"blur":"change"}])}),g.form=x,g.rules=a,setTimeout(n)},{immediate:!0});const T=Q(()=>{const E={};return g.config.fields.forEach(x=>{E[x.key]=Pe(x).value}),E}),G=Q(()=>g.config.fields.filter(E=>{const x=E.show;if(!x)return!0;if(le(x,"function"))return x(T.value);if(x.includes("return"))try{return new Function("formData",x)(T.value)}catch(a){console.warn("解析表单展示逻辑代码错误 >>",a)}return!0}));return A({clear:n,validate:M,reset:L,setFormData:H}),(E,x)=>{const a=h("el-button"),u=h("el-form-item"),U=h("el-empty"),p=h("el-form");return i(),C(p,{ref_key:"formRef",ref:c,model:g.form,rules:g.rules,labelWidth:V(_e)(g.config.labelWidth),labelPosition:g.config.labelPosition,disabled:I.disabled,style:xe(I.editMode?{width:V(_e)(g.config.width)}:null),class:se([{"is-edit-form":I.editMode}])},{default:l(()=>[I.editMode?(i(),S(j,{key:0},[t(we,{name:"the-group",tag:"div"},{default:l(()=>[(i(!0),S(j,null,ee(g.config.fields,(y,N)=>(i(),C(u,{class:se([{"the-curd-selected":V(B).editor.index===N&&O.value}]),prop:y.key,key:y.id,"data-key":y.id,draggable:g.config.fields.length>1&&!V(B).editor.show?!0:null,onDragstart:s=>V($)(N),onDragover:s=>V(r)(s,N),onDrop:V(R)},{label:l(()=>[g.config.fields.length>1&&!V(B).editor.show?(i(),S("i",Ut)):D("",!0),b("span",null,ne(y.label),1)]),default:l(()=>[b("div",Ot,[t(ke,{class:"mgr-10",fieldData:y,editMode:""},null,8,["fieldData"]),t(a,{link:"",type:"success",disabled:O.value,onClick:s=>P(N)},{default:l(()=>[Mt]),_:2},1032,["disabled","onClick"]),t(a,{link:"",type:"danger",disabled:O.value,onClick:s=>Z(N)},{default:l(()=>[Nt]),_:2},1032,["disabled","onClick"])])]),_:2},1032,["class","prop","data-key","draggable","onDragstart","onDragover","onDrop"]))),128))]),_:1}),g.config.fields.length?D("",!0):(i(),C(U,{key:0,description:`当前没有表单项，当没有表单项时【${J.value}】功能按钮不会出现~`},{default:l(()=>[O.value?D("",!0):(i(),C(a,{key:0,type:"primary",onClick:x[0]||(x[0]=y=>P(-1))},{default:l(()=>[Wt,q(" 添加表单项 ")]),_:1}))]),_:1},8,["description"])),O.value?D("",!0):(i(),S(j,{key:1},[g.config.fields.length?(i(),C(u,{key:"bottom-add"},{default:l(()=>[t(a,{type:"primary",onClick:x[1]||(x[1]=y=>P(-1))},{default:l(()=>[qt,q(" 继续添加 ")]),_:1})]),_:1})):D("",!0),b("div",Lt,[t(a,{link:"",onClick:x[2]||(x[2]=y=>v())},{default:l(()=>[q(" 退出编辑 ")]),_:1}),t(a,{type:"danger",link:"",disabled:!g.config.fields.length,onClick:x[3]||(x[3]=y=>F())},{default:l(()=>[At,q(" 清空表单 ")]),_:1},8,["disabled"]),t(a,{type:"success",link:"",onClick:x[4]||(x[4]=y=>W())},{default:l(()=>[Bt,q(" 保存表单 ")]),_:1})])],64))],64)):D("",!0),!I.editMode&&g.config&&g.config.fields?(i(!0),S(j,{key:1},ee(G.value,y=>(i(),C(u,{label:y.label,prop:y.key,key:y.id},{default:l(()=>[t(ke,{fieldData:y},null,8,["fieldData"])]),_:2},1032,["label","prop"]))),128)):D("",!0)]),_:1},8,["model","rules","labelWidth","labelPosition","disabled","style","class"])}}}),Ft={key:1,class:"f-vertical w-full"},Jt=b("i",{class:"el-icon--right el-icon-question the-tips-icon"},null,-1),Pt={key:1,class:"f1 f-right"},Rt={name:"TableHeader"},He=ue({...Rt,props:{column:{type:Object,required:!0}},emits:["sort"],setup(Y,{emit:A}){const o=Y,I=A,d=Q(()=>!o.column.sort&&!o.column.iconTips),c={true:{index:0,icon:"el-icon-sort"},asc:{index:1,icon:"el-icon-sort-up"},desc:{index:2,icon:"el-icon-sort-down"}},f=[!0,"asc","desc"];function g(){const B=o.column.sort.toString();let J=c[B].index;J++,J>=f.length&&(J=0);const O=f[J];I("sort",o.column.prop,O)}return(B,J)=>{const O=h("el-tooltip"),P=h("el-button");return d.value?(i(),S(j,{key:0},[q(ne(o.column.title),1)],64)):(i(),S("div",Ft,[b("span",null,ne(o.column.title),1),o.column.iconTips?(i(),C(O,{key:0,effect:"dark",content:o.column.iconTips,placement:"top"},{default:l(()=>[Jt]),_:1},8,["content"])):D("",!0),o.column.sort?(i(),S("div",Pt,[t(P,{link:"",onClick:g},{default:l(()=>[b("i",{class:se(["el-icon--right",c[o.column.sort.toString()].icon])},null,2)]),_:1})])):D("",!0)]))}}}),It={name:"TableColumnConfig"},zt=ue({...It,props:{show:{type:Boolean,required:!0},type:{type:String,required:!0},keys:{type:Array,required:!0},form:Object},emits:["update:show","submit"],setup(Y,{emit:A}){const o=Y,I=A,d=ie({show:!1,form:Te("","")}),c=Q(()=>({add:"新增",edit:"编辑",copy:"复制"})[o.type]+"表格列"),f=he(),g={title:{required:!0,message:"请输入表格列标题",trigger:"blur"},prop:{required:!0,validator(F,v,W){v?o.keys.includes(d.form.prop)?W(new Error("已经存在相同的值！")):W():W(new Error("输入字段不能为空！"))},trigger:"blur"},jsCode:{required:!0,validator(F,v,W){v?v.includes("return")?W():W(new Error('代码片段必须带有返回字段 "return"')):W(new Error("代码片段不能为空！"))},trigger:"blur"}},B=[{label:"默认普通文本",value:"text"},{label:"图片预览组件",value:"image"},{label:"自定义 js 代码",value:"js"}],J=[{label:"不可排序",value:!1},{label:"可排序",value:!0},{label:"默认升序",value:"asc"},{label:"默认降序",value:"desc"}],O=`
<p>函数代码片段：</p>
<p>第一个参数${oe("cellValue")}是表格值;</p>
<p>第二个参数${oe("row")}是完整对象;</p>
<p>例如：${oe("return cellValue + row.id;")};</p>
<p>也可以是HTML：${oe("return `html 标签`")};</p>
`;function P(){I("update:show",!1)}function Z(){var F;(F=f.value)==null||F.validate(v=>{if(!v)return;const W=re(d.form);["width","minWidth","imageWidth","imageHeight"].forEach(n=>{W[n]&&(W[n]=Number(W[n]))}),W.cellType==="image"&&(W.slot=W.prop),(W.sort||W.iconTips)&&(W.slotHead=`header-${W.prop}`),I("submit",W),P()})}return ge(()=>o.show,function(F){d.show=F,F&&(o.type==="add"?d.form=Te("",""):(d.form=re(o.form),o.type==="copy"&&(d.form.prop="")),setTimeout(()=>{var v;return(v=f.value)==null?void 0:v.clearValidate()}))},{immediate:!0}),(F,v)=>{const W=h("el-input"),M=h("el-form-item"),n=h("el-input-number"),L=h("el-option"),H=h("el-select"),$=h("el-switch"),r=h("el-form"),R=h("base-dialog");return i(),C(R,{show:d.show,"onUpdate:show":v[11]||(v[11]=T=>d.show=T),title:c.value,width:"580px",onClose:P},{footer:l(()=>[t(V($e),{onClose:P,onSubmit:Z})]),default:l(()=>[t(r,{ref_key:"formRef",ref:f,model:d.form,rules:g,"label-position":"right","label-width":"130px"},{default:l(()=>[t(M,{label:"表格列标题",prop:"label"},{default:l(()=>[t(W,{modelValue:d.form.title,"onUpdate:modelValue":v[0]||(v[0]=T=>d.form.title=T),clearable:"",placeholder:g.title.message},null,8,["modelValue","placeholder"])]),_:1}),t(M,{label:"表格列键值",prop:"prop"},{default:l(()=>[t(W,{modelValue:d.form.prop,"onUpdate:modelValue":v[1]||(v[1]=T=>d.form.prop=T),clearable:"",placeholder:"请输入表格列键值"},null,8,["modelValue"])]),_:1}),t(M,{label:"表格列宽度",prop:"width"},{default:l(()=>[t(n,{modelValue:d.form.width,"onUpdate:modelValue":v[2]||(v[2]=T=>d.form.width=T),class:"w-full","controls-position":"right",placeholder:"请输入表格列宽度，例如：120（默认自适应）"},null,8,["modelValue"])]),_:1}),t(M,{label:"表格列最小宽度",prop:"minWidth"},{default:l(()=>[t(n,{modelValue:d.form.minWidth,"onUpdate:modelValue":v[3]||(v[3]=T=>d.form.minWidth=T),class:"w-full","controls-position":"right",placeholder:"请输入表格列最小宽度，例如：120（默认自适应）"},null,8,["modelValue"])]),_:1}),t(M,{label:"表格列展示类型",prop:"cellType"},{default:l(()=>[t(H,{modelValue:d.form.cellType,"onUpdate:modelValue":v[4]||(v[4]=T=>d.form.cellType=T)},{default:l(()=>[(i(),S(j,null,ee(B,T=>t(L,{key:T.value,value:T.value,label:T.label},null,8,["value","label"])),64))]),_:1},8,["modelValue"])]),_:1}),d.form.cellType==="image"?(i(),S(j,{key:0},[t(M,{label:"图片宽度(像素)",prop:"imageWidth"},{default:l(()=>[t(n,{modelValue:d.form.imageWidth,"onUpdate:modelValue":v[5]||(v[5]=T=>d.form.imageWidth=T),class:"w-full","controls-position":"right",placeholder:"请输入数字（默认80px）"},null,8,["modelValue"])]),_:1}),t(M,{label:"图片高度(像素)",prop:"imageHeight"},{default:l(()=>[t(n,{modelValue:d.form.imageHeight,"onUpdate:modelValue":v[6]||(v[6]=T=>d.form.imageHeight=T),class:"w-full","controls-position":"right",placeholder:"请输入数字（默认80px）"},null,8,["modelValue"])]),_:1})],64)):D("",!0),d.form.cellType==="js"?(i(),C(M,{key:1,prop:"jsCode"},{label:l(()=>[t(V(ve),{label:"js代码",tips:O})]),default:l(()=>[t(W,{modelValue:d.form.jsCode,"onUpdate:modelValue":v[7]||(v[7]=T=>d.form.jsCode=T),type:"textarea",placeholder:"请输入代码片段"},null,8,["modelValue"])]),_:1})):D("",!0),t(M,{label:"表格列排序操作",prop:"sort"},{default:l(()=>[t(H,{modelValue:d.form.sort,"onUpdate:modelValue":v[8]||(v[8]=T=>d.form.sort=T)},{default:l(()=>[(i(),S(j,null,ee(J,T=>t(L,{key:T.value.toString(),value:T.value,label:T.label},null,8,["value","label"])),64))]),_:1},8,["modelValue"])]),_:1}),t(M,{label:"内容溢出截断",prop:"tooltip"},{default:l(()=>[t($,{modelValue:d.form.tooltip,"onUpdate:modelValue":v[9]||(v[9]=T=>d.form.tooltip=T),"inline-prompt":"","active-text":"是","inactive-text":"否"},null,8,["modelValue"])]),_:1}),t(M,{label:"表头图标提示文字",prop:"iconTips"},{default:l(()=>[t(W,{modelValue:d.form.iconTips,"onUpdate:modelValue":v[10]||(v[10]=T=>d.form.iconTips=T),clearable:"",placeholder:"请输入表头图标提示文字"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])}}}),Kt=b("p",{class:"mgb-10"},"表格数据中的字段，例如表格数：",-1),Ht=b("p",{class:"mgb-10"},"则键值可以为 id",-1),Gt=b("p",null,[b("i",{class:"el-icon-info el-icon--left"}),q(" 不填则没有删除功能 ")],-1),Xt={name:"TableDeleteConfig"},Qt=ue({...Xt,props:{show:{type:Boolean,default:!1},selectKey:{type:String,default:""}},emits:["update:show","submit"],setup(Y,{emit:A}){const o=Y,I=A,d='[{ id: 1, name: "名称", status: 2 }]',c=ie({show:!1,keyword:""});function f(){I("update:show",!1)}function g(){f(),I("submit",c.keyword)}return ge(()=>o.show,function(B){c.show=B,B&&(c.keyword=o.selectKey||"")},{immediate:!0}),(B,J)=>{const O=h("el-input"),P=h("el-form-item"),Z=h("el-form"),F=h("base-dialog");return i(),C(F,{show:c.show,"onUpdate:show":J[1]||(J[1]=v=>c.show=v),title:"配置表格删除功能",width:"400px",onClose:f},{footer:l(()=>[t(V($e),{onClose:f,onSubmit:g})]),default:l(()=>[t(Z,{labelPosition:"right",labelWidth:"120px"},{default:l(()=>[t(P,{label:"数据键值"},{default:l(()=>[t(O,{class:"mgb-10",modelValue:c.keyword,"onUpdate:modelValue":J[0]||(J[0]=v=>c.keyword=v),placeholder:"请输入数据键值",clearable:""},null,8,["modelValue"]),b("div",{class:"the-tag blue"},[Kt,b("p",{class:"mgb-10"},ne(d)),Ht,Gt])]),_:1})]),_:1})]),_:1},8,["show"])}}}),Yt={class:"flex"},Zt={class:"f1"},el={class:"f-vertical w-full"},tl={class:"f-right w-full"},ll=b("i",{class:"el-icon--left el-icon-finished"},null,-1),ol=b("i",{class:"el-icon--left el-icon-plus"},null,-1),nl=["data-key","draggable","onDragstart","onDragover"],al={key:0,class:"el-icon--left el-icon-rank"},il=b("div",{class:"f1"},null,-1),sl=b("i",{class:"el-icon-delete"},null,-1),rl=b("i",{class:"el-icon-edit"},null,-1),ul={key:1,class:"w-full f-right"},dl=b("i",{class:"el-icon--left el-icon-plus"},null,-1),cl={name:"TableActionConfig"},pl=ue({...cl,props:{show:{type:Boolean,default:!1},list:{type:Array,required:!0},columnWidth:{type:Number},actionMax:{type:Number}},emits:["update:show","submit"],setup(Y,{emit:A}){const o=Y,I=A,d=he(),c=he(),f=ie({show:!1,list:[],index:-1,hasEdit:!1,formEdit:!1}),g=ie({btn:Se(),column:{width:160,max:3}}),B={width:{required:!0,message:"请输入表格列宽度，例如：160",trigger:"blur"},max:{required:!1,message:"请输入数量，超出用“更多”下拉展示",trigger:"blur"}},J={text:{required:!0,message:"请输入按钮文字",trigger:"blur"},click:{required:!0,message:"请输入按钮操作代码",trigger:"blur"},icon:{required:!1,message:"请输入图标 class",trigger:"blur"},type:{required:!1,message:"请选择按钮类型",trigger:"change"}};function O(){I("update:show",!1)}function P(){c.value.validate(x=>{if(!x)return;O();const{width:a,max:u}=g.column;I("submit",re(f.list),a,u)})}function Z(x){d.value.validate(a=>{if(!a)return;const u=re(g.btn);x==="add"?f.list.push(u):f.list[f.index]=g.btn,F()})}function F(){f.index=-1,g.btn=Se(),f.formEdit=!1,setTimeout(()=>{var x;return(x=d.value)==null?void 0:x.clearValidate()})}function v(x){const a=f.list[x];g.btn=JSON.parse(JSON.stringify(a)),f.index=x,f.formEdit=!0}function W(x){f.list.splice(x,1)}ge(()=>o.show,function(x){f.show=x,x&&(f.list=re(o.list),f.hasEdit=f.list.some(a=>a.key===fe),f.index=-1,g.btn=Se(),g.column={width:o.columnWidth,max:o.actionMax},setTimeout(()=>{var a,u;(a=d.value)==null||a.clearValidate(),(u=c.value)==null||u.clearValidate()}))},{immediate:!0});const M=[{label:"默认（蓝色）",value:"primary"},{label:"成功（绿色）",value:"success"},{label:"警告（橙色）",value:"warning"},{label:"危险（红色）",value:"danger"},{label:"文本（灰色）",value:"info"}],n="https://element.eleme.cn/#/zh-CN/component/icon",{onDragStart:L,onDragMove:H,onDropEnd:$}=Ve({list:()=>f.list,key:"key"});function r(x){if(x.key!=fe&&f.list.length>1&&f.index===-1)return!0}function R(x){const a=x.text;if(le(a,"string")){if(!a.includes("return"))return a;let u="文字配置有误";try{u=new Function("row",a)({})}catch(U){console.warn("解析按钮文字代码错误 >>",U)}return u}return le(a,"function")?a({}):"未设置按钮"}const T=`
<p>可以输入代码片段，</p>
<p>以${oe("return")}关键字为函数标记，</p>
<p>函数第一个参数${oe("row")}是表格对象值</p>
<p>例如：${oe('return row.status === 1 ? "下架" : "上架";')}</p>
`,G=`
<p>函数代码片段，点击的时候运行</p>
<p>函数第一个参数${oe("row")}是表格对象值</p>
<p>第二个参数${oe("index")}是当前索引</p>
<p>例如：${oe("console.log(row, index);")}</p>
`,E=`
<p>可以输入代码片段，</p>
<p>以${oe("return")}关键字为函数标记，</p>
<p>函数第一个参数${oe("row")}是表格对象值</p>
<p>例如：${oe("return row.status === 1;")}返回布尔值进行判断</p>
`;return(x,a)=>{const u=h("el-text"),U=h("el-divider"),p=h("el-input-number"),y=h("el-form-item"),N=h("el-form"),s=h("el-input"),e=h("el-option"),k=h("el-select"),m=h("el-button"),X=h("el-popconfirm"),z=h("el-empty"),K=h("base-dialog");return i(),C(K,{show:f.show,"onUpdate:show":a[13]||(a[13]=_=>f.show=_),title:"配置操作列按钮功能",width:"880px",onClose:O},{footer:l(()=>[t(V($e),{disabledSubmit:f.formEdit,onClose:O,onSubmit:P},null,8,["disabledSubmit"])]),default:l(()=>[b("div",Yt,[b("section",Zt,[t(U,{"content-position":"left","border-style":"dashed"},{default:l(()=>[t(u,{type:"info"},{default:l(()=>[q("操作列配置")]),_:1})]),_:1}),t(N,{ref_key:"formColumn",ref:c,model:g.column,rules:B,labelPosition:"right",labelWidth:"128px"},{default:l(()=>[t(y,{label:"操作列宽度",prop:"width"},{default:l(()=>[t(p,{modelValue:g.column.width,"onUpdate:modelValue":a[0]||(a[0]=_=>g.column.width=_),class:"w-full","controls-position":"right",placeholder:B.width.message},null,8,["modelValue","placeholder"])]),_:1}),t(y,{label:"操作按钮限制",prop:"max"},{default:l(()=>[t(p,{modelValue:g.column.max,"onUpdate:modelValue":a[1]||(a[1]=_=>g.column.max=_),class:"w-full","controls-position":"right",min:2,placeholder:B.max.message},null,8,["modelValue","placeholder"])]),_:1})]),_:1},8,["model"]),t(U,{"content-position":"left","border-style":"dashed"},{default:l(()=>[t(u,{type:"info"},{default:l(()=>[q("操作按钮配置")]),_:1})]),_:1}),t(N,{ref_key:"formBtn",ref:d,model:g.btn,rules:J,labelPosition:"right",labelWidth:"128px",class:se({"the-filter-mask":!f.formEdit}),"data-tips":"待新增或编辑操作"},{default:l(()=>[t(y,{prop:"text"},{label:l(()=>[t(V(ve),{label:"按钮文字",tips:T})]),default:l(()=>[t(s,{modelValue:g.btn.text,"onUpdate:modelValue":a[2]||(a[2]=_=>g.btn.text=_),type:"textarea",placeholder:J.text.message},null,8,["modelValue","placeholder"])]),_:1}),t(y,{prop:"click"},{label:l(()=>[t(V(ve),{label:"按钮功能代码",tips:G})]),default:l(()=>[t(s,{modelValue:g.btn.click,"onUpdate:modelValue":a[3]||(a[3]=_=>g.btn.click=_),type:"textarea",placeholder:"请输入代码片段"},null,8,["modelValue"])]),_:1}),t(y,{prop:"show"},{label:l(()=>[t(V(ve),{label:"按钮显示条件",tips:E})]),default:l(()=>[t(s,{modelValue:g.btn.show,"onUpdate:modelValue":a[4]||(a[4]=_=>g.btn.show=_),type:"textarea",placeholder:"请输入条件代码，为空则默认显示"},null,8,["modelValue"])]),_:1}),t(y,{prop:"disabled"},{label:l(()=>[t(V(ve),{label:"按钮禁用条件",tips:E})]),default:l(()=>[t(s,{modelValue:g.btn.disabled,"onUpdate:modelValue":a[5]||(a[5]=_=>g.btn.disabled=_),type:"textarea",placeholder:"请输入条件代码，为空则默认不禁用"},null,8,["modelValue"])]),_:1}),t(y,{label:"按钮图标",prop:"icon"},{default:l(()=>[b("div",el,[t(s,{modelValue:g.btn.icon,"onUpdate:modelValue":a[6]||(a[6]=_=>g.btn.icon=_),placeholder:J.icon.message,clearable:""},null,8,["modelValue","placeholder"]),t(u,{type:"primary",style:{width:"110px","text-align":"right"}},{default:l(()=>[b("a",{href:n,target:"_blank"},"去官网复制")]),_:1})])]),_:1}),t(y,{label:"按钮类型",prop:"type"},{default:l(()=>[t(k,{modelValue:g.btn.type,"onUpdate:modelValue":a[7]||(a[7]=_=>g.btn.type=_),placeholder:J.type.message},{default:l(()=>[(i(),S(j,null,ee(M,_=>t(e,{key:_.value,value:_.value,label:_.label},null,8,["value","label"])),64))]),_:1},8,["modelValue","placeholder"])]),_:1}),t(y,null,{default:l(()=>[b("div",tl,[t(m,{onClick:a[8]||(a[8]=_=>F())},{default:l(()=>[q("取 消")]),_:1}),f.index>-1?(i(),C(m,{key:0,type:"primary",plain:"",onClick:a[9]||(a[9]=_=>Z("edit"))},{default:l(()=>[ll,q(" 确认修改 ")]),_:1})):(i(),C(m,{key:1,type:"primary",plain:"",onClick:a[10]||(a[10]=_=>Z("add"))},{default:l(()=>[ol,q(" 确认新增 ")]),_:1}))])]),_:1})]),_:1},8,["model","class"])]),t(we,{name:"the-group",tag:"div",class:"the-curd-option-list f1"},{default:l(()=>[(i(!0),S(j,null,ee(f.list,(_,ae)=>(i(),S("div",{class:se(["the-curd-option-item f-vertical",{"the-curd-selected":ae===f.index}]),key:_.key,"data-key":_.key!==V(fe)?_.key:null,draggable:r(_),onDragstart:te=>V(L)(ae),onDragover:te=>V(H)(te,ae),onDrop:a[11]||(a[11]=(...te)=>V($)&&V($)(...te))},[f.index===-1&&_.key!==V(fe)?(i(),S("i",al)):D("",!0),t(m,{type:_.type,link:""},{default:l(()=>[_.icon?(i(),S("i",{key:0,class:se(["el-icon--left",_.icon])},null,2)):D("",!0),q(" "+ne(R(_)),1)]),_:2},1032,["type"]),il,_.key===V(fe)?(i(),C(u,{key:1,type:"info",size:"small"},{default:l(()=>[q("编辑按钮不可删除、拖拽等操作，且处于首位")]),_:1})):(i(),S(j,{key:2},[t(X,{width:"186px",title:"是否删除该按钮功能？",onConfirm:te=>W(ae)},{reference:l(()=>[t(m,{link:"",type:"danger",disabled:f.index>-1},{default:l(()=>[sl]),_:1},8,["disabled"])]),_:2},1032,["onConfirm"]),t(m,{link:"",type:"success",onClick:te=>v(ae)},{default:l(()=>[rl]),_:2},1032,["onClick"])],64))],42,nl))),128)),f.list.length?D("",!0):(i(),C(z,{key:"empty","image-size":120,description:"请添加操作列功能按钮"})),f.formEdit?D("",!0):(i(),S("div",ul,[f.formEdit?D("",!0):(i(),C(m,{key:0,type:"primary",plain:"",onClick:a[12]||(a[12]=_=>f.formEdit=!0)},{default:l(()=>[dl,q(" 新增功能按钮 ")]),_:1}))]))]),_:1})])]),_:1},8,["show"])}}}),fl={class:"the-curd-table-model the-curd-scrollbar"},ml=["data-key","draggable","onDragstart","onDragover"],yl=["data-head"],vl=b("i",{class:"el-icon-rank el-icon--left"},null,-1),gl={class:"fake-table-cell operation f-vertical"},bl=b("i",{class:"el-icon-arrow-down el-icon--right"},null,-1),hl={class:"fake-table-cell f-vertical"},_l={key:1,class:"the-tag blue"},kl=b("div",{class:"fake-table-head fvc"},"操作",-1),wl={class:"fake-table-cell operation fvc"},Vl=b("i",{class:"el-icon-setting"},null,-1),xl=b("i",{class:"el-icon-delete"},null,-1),$l={class:"fake-table-cell"},Dl={class:"f-vertical",key:"right-setting"},Sl=b("i",{class:"el-icon-plus el-icon--left"},null,-1),Cl={key:0},Tl=b("i",{class:"el-icon-plus el-icon--left"},null,-1),El={key:1},Ul={key:0,class:"the-tag blue mgl-10"},Ol=b("i",{class:"el-icon--left el-icon-info"},null,-1),Ml={name:"TableModel"},Nl=ue({...Ml,props:{config:{type:Object,required:!0}},emits:["action"],setup(Y,{emit:A}){const o=Y,I=A,d="https://fuss10.elemecdn.com/e/5d/4a731a90594a4af544c0c25941171jpeg.jpeg",c=[{key:"edit",label:"编辑列",icon:"el-icon-edit",click(p){B("edit",p)}},{key:"copy",label:"复制列",icon:"el-icon-document-copy",click(p){B("copy",p)}},{key:"delete",label:"删除列",icon:"el-icon-delete",click(p){O(p)}}],f=ie({show:!1,type:"add",index:-1,form:void 0,keys:[]}),g=Q(()=>{const p=o.config.columns,y=[],N=[];for(let s=0;s<p.length;s++){const e=p[s];e.prop===ye?N.push(e):y.push(e)}return{drag:y,action:N}});function B(p,y){f.keys=o.config.columns.map(s=>s.prop),{add(){f.form=void 0},edit(){const s=o.config.columns[y];f.keys=f.keys.filter(e=>e!==s.prop),f.index=y,f.form=s},copy(){const s=o.config.columns[y];f.form=s}}[p](),f.type=p,f.show=!0}function J(p){const y=o.config;if(["add","copy"].includes(f.type)){const N=re(g.value.drag);N.push(p),y.columns=N.concat(g.value.action)}else y.columns[f.index]=p}function O(p){const y=g.value.drag[p];me({title:"操作提示",content:`是否删除【${y.title}】列？`,cancelText:"取消",confirm(){const N=o.config.columns.findIndex(s=>s.prop===y.prop);o.config.columns.splice(N,1)}})}const{onDragStart:P,onDragMove:Z,onDropEnd:F}=Ve({list:()=>o.config.columns,key:"prop",findLevel:5});function v(p){const y={};return p&&p.width&&(y.width=`${p.width}px`),p&&p.minWidth&&(y.minWidth=`${p.minWidth}px`),y}const W=Q(function(){const p=o.config.columns;if(p.length>0&&p[p.length-1].prop===ye)return p[p.length-1]});function M(){const p=Te(ye,"操作");p.minWidth=120,p.width=160,o.config.columns.push(p)}function n(){const p=o.config.columns;me({title:"操作提示",content:"是否删除操作列？删除之后需要重新配置。",cancelText:"取消",confirm(){p.splice(p.length-1,1),o.config.actions=[],o.config.formEdit&&(o.config.formEdit=void 0)}})}const L=ie({show:!1,keyword:""});function H(){const p=o.config.selectKey;L.keyword=p?p.toString():"",L.show=!0}function $(p){o.config.selectKey=p}const r=ie({show:!1,columnWidth:0,actionMax:0});function R(){r.show=!0,r.columnWidth=W.value.width,r.actionMax=o.config.actionMax}function T(p,y){o.config.actions=p;const N=o.config.columns.find(s=>s.prop===ye);N.width=y}const G=ie({show:!1,form:null,type:"add"});function E(p){G.type=p,p==="add"&&o.config.formAdd&&(G.form=o.config.formAdd),p==="edit"&&o.config.formEdit&&(G.form=o.config.formEdit),G.show=!0}function x(p,y){const N=o.config,s=N.actions;function e(){const k=s.length>0&&s[0].key===fe;p&&p.fields.length>0?(W.value||M(),k||s.unshift({key:fe,text:"编辑",type:"success",icon:"el-icon-edit"})):k&&s.splice(0,1)}p&&(G.type==="add"?(N.formAdd=p,y&&(N.formEdit=re(p),e())):(N.formEdit=p,y&&(N.formAdd=re(p)),e())),G.show=!1,G.form=null}function a(p){switch(p){case"delete":H();break;case"add":E("add");break;case"edit":E("edit");break}}const u=Q(()=>g.value.drag.some(p=>!p.width&&!p.minWidth));function U(p){if(p==="complete"&&u.value){const y=Array.from(document.querySelectorAll(".fake-table-head")),N={};y.forEach(s=>{const e=s.dataset.head||"";e&&(N[e]=Math.round(s.clientWidth))}),o.config.columns.forEach(s=>{Object.prototype.hasOwnProperty.call(N,s.prop)&&(s.minWidth=N[s.prop])})}I("action",p)}return(p,y)=>{const N=h("el-empty"),s=h("el-button"),e=h("el-dropdown-item"),k=h("el-dropdown-menu"),m=h("el-dropdown"),X=h("el-tooltip"),z=h("base-table-actions"),K=h("el-text");return i(),S(j,null,[G.show?D("",!0):(i(),C(ze,{key:0,editMode:!0,config:o.config,onAction:a},null,8,["config"])),b("div",fl,[G.show?(i(),C(Ke,{key:0,config:G.form,type:G.type,editMode:!0,onChange:x},null,8,["config","type"])):(i(),C(we,{key:1,name:"the-group",tag:"div",class:"fake-table"},{default:l(()=>[o.config.columns.length?D("",!0):(i(),C(N,{key:"empty",style:{padding:"10px 40px"},"image-size":120,description:"请添加表格列"})),(i(!0),S(j,null,ee(g.value.drag,(_,ae)=>(i(),S("div",{key:_.prop,"data-key":_.prop,class:"fake-table-item",draggable:g.value.drag.length>1,style:xe(v(_)),onDragstart:te=>V(P)(ae),onDragover:te=>V(Z)(te,ae),onDrop:y[0]||(y[0]=te=>V(F)())},[b("div",{class:"fake-table-head f-vertical","data-head":_.prop},[vl,t(He,{column:_},null,8,["column"])],8,yl),b("div",gl,[t(m,{trigger:"click"},{dropdown:l(()=>[t(k,null,{default:l(()=>[(i(),S(j,null,ee(c,te=>t(e,{key:te.key,onClick:De=>te.click(ae)},{default:l(()=>[b("i",{class:se(["el-icon--left",te.icon])},null,2),q(" "+ne(te.label),1)]),_:2},1032,["onClick"])),64))]),_:2},1024)]),default:l(()=>[t(s,{link:"",type:"primary"},{default:l(()=>[q(" 配置列 "),bl]),_:1})]),_:2},1024)]),b("div",hl,[_.cellType==="text"?(i(),S(j,{key:0},[q("文本内容")],64)):_.cellType==="js"?(i(),S("span",_l,"自定义代码")):D("",!0),t(V(Re),{column:_,src:d},null,8,["column"])])],44,ml))),128)),W.value?(i(),S("div",{style:xe(v(W.value)),key:V(ye),class:"fake-table-item"},[kl,b("div",wl,[t(X,{effect:"dark",content:"配置【操作按钮】和【操作列】的宽度",placement:"top"},{default:l(()=>[t(s,{circle:"",plain:"",type:"primary",size:"small",onClick:y[1]||(y[1]=_=>R())},{default:l(()=>[Vl]),_:1})]),_:1}),t(s,{circle:"",plain:"",type:"danger",size:"small",onClick:y[2]||(y[2]=_=>n())},{default:l(()=>[xl]),_:1})]),b("div",$l,[o.config.actions.length?(i(),C(z,{key:0,row:{},index:1,actions:o.config.actions},null,8,["actions"])):(i(),C(K,{key:1,type:"info"},{default:l(()=>[q("待添加操作~")]),_:1}))])],4)):D("",!0),b("div",Dl,[b("div",null,[b("p",null,[t(s,{type:"primary",text:"",onClick:y[3]||(y[3]=_=>B("add"))},{default:l(()=>[Sl,q(" 添加内容列 ")]),_:1})]),W.value?D("",!0):(i(),S("p",Cl,[t(s,{type:"primary",text:"",onClick:y[4]||(y[4]=_=>M())},{default:l(()=>[Tl,q(" 添加操作列 ")]),_:1})]))])])]),_:1}))]),G.show?D("",!0):(i(),S("div",El,[t(V(Ie),{type:G.type,onAction:U},null,8,["type"]),u.value?(i(),S("span",Ul,[Ol,q(" 当前表格列配置中存在没配置【宽度/最小宽度】，保存时将自动设置最小宽度，提高表格美观性。 ")])):D("",!0)])),t(zt,{show:f.show,"onUpdate:show":y[5]||(y[5]=_=>f.show=_),type:f.type,keys:f.keys,form:f.form,onSubmit:J},null,8,["show","type","keys","form"]),t(Qt,{show:L.show,"onUpdate:show":y[6]||(y[6]=_=>L.show=_),"select-key":L.keyword,onSubmit:$},null,8,["show","select-key"]),t(pl,{show:r.show,"onUpdate:show":y[7]||(y[7]=_=>r.show=_),columnWidth:r.columnWidth,actionMax:r.actionMax,list:o.config.actions,onSubmit:T},null,8,["show","columnWidth","actionMax","list"])],64)}}}),Wl={class:"the-curd-example"},ql={name:"Example"},Ll=ue({...ql,props:{selected:{type:String},type:{type:String}},emits:["choose"],setup(Y,{emit:A}){const o=Y,I=A,d=[{...de("input"),placeholder:ce.input},{...de("select"),placeholder:ce.select},{...de("select-multiple"),placeholder:ce["select-multiple"]},{...de("cascader"),placeholder:ce.cascader},{...de("date"),placeholder:ce.date},{...de("checkbox"),options:[{label:"多选-A",value:1},{label:"多选-B",value:2}],defaultValue:[1]},{...de("radio"),options:[{label:"单选-A",value:"radio-1"},{label:"单选-B",value:"radio-2"}],defaultValue:"radio-1"},{...de("switch"),defaultValue:!0},{...de("textarea"),placeholder:ce.textarea},{...de("input-between"),placeholder:["范围区间操作","范围区间操作"]}],c=["radio","checkbox","textarea","switch"],f=Q(()=>o.type==="search"?d.filter(g=>!c.includes(g.type)):d);return(g,B)=>(i(),S("div",Wl,[(i(!0),S(j,null,ee(f.value,J=>(i(),C(ke,{key:J.type,"field-data":J,class:se(["the-curd-example-item fvc",{"the-curd-selected":o.selected===J.type}]),readonly:"",onClick:O=>I("choose",J.type)},null,8,["field-data","class","onClick"]))),128))]))}}),Al={key:0,class:"the-curd-editor-content"},Bl=b("h2",{class:"the-title mgb-20"},"基础设置",-1),jl={class:"f-vertical f-between mgb-20"},Fl=b("h2",{class:"the-title"},"第1步：点击选取组件",-1),Jl={class:"f-vertical mgb-20"},Pl={class:"the-title"},Rl=b("div",{class:"f1"},null,-1),Il={key:0,class:"the-curd-target-box"},zl=b("i",{class:"el-icon-question the-tips-icon mgl-10"},null,-1),Kl=b("a",{href:"https://www.json.cn/",target:"_blank"}," JSON编辑工具 ",-1),Hl=b("span",{class:"the-tag blue mgl-10"},"例如【英雄联盟-12】",-1),Gl={class:"f-right"},Xl=b("i",{class:"el-icon--left el-icon-plus"},null,-1),Ql=b("i",{class:"el-icon--left el-icon-edit"},null,-1),Yl={name:"Editor"},Zl=ue({...Yl,props:{show:{type:Boolean,default:!1},config:{type:Object,required:!0}},emits:["update:show"],setup(Y,{emit:A}){const o=Y,I=A;function d(){I("update:show",!1)}const c=["checkbox","radio","switch"],f=["select","select-multiple","radio","checkbox","cascader"],g=["input","textarea","select","radio"],B=["input-between","select-multiple","checkbox","cascader"],J=["input","select","radio"],O=["daterange","datetimerange"],P=J.concat(B),Z=`<p>参考 src/utils/index.ts 中的${oe("formatDate")}函数</p>`,F=`
<p>动态表单项的条件显示逻辑函数；</p>
<p>返回${oe("false")}则不展示对应项；</p>
<p>函数有一个参数：${oe("formData")}为当前表单的数据值；</p>
<p>以${oe("return")}为函数代码片段标记；</p>
<p>例如：${oe("return formData.type !== 2")}</p>
`,v=Ue(),W=Q(()=>v.editor.action==="add"),M=Q(()=>{let s=[];return n.formData&&n.formData.type==="date"&&(s=Je[n.formData.dateType].map((k,m)=>({label:k.text,value:m}))),s.unshift({label:"将预览组件中的值设为默认",value:-1}),s}),n=ie({step:0,formData:void 0});function L(s){n.step=s}const H={label:{required:!0,message:"请输入功能标题",trigger:"blur"},key:{required:!0,trigger:"blur",validator(s,e,k){e?y.includes(e)?k(new Error("当前键值已经被占用！")):k():k(new Error("绑定的键值不能为空"))}},format:{required:!0,message:"格式化规则不能为空",trigger:"blur"},separator:{required:!0,message:"请输入串联符号",trigger:"blur"},defaultValue:{required:!0,trigger:"blur",validator(s,e,k){const m=G();m===!0?k():k(new Error(m)),k()}},options:{required:!0,trigger:"blur",validator(s,e,k){const m=E();m===!0?k():k(new Error(m))}}},$=he(),r=ie({options:"",defaultValue:""});function R(s){s.type!=="date"&&(r.defaultValue=JSON.stringify({value:s.defaultValue})),f.includes(s.type)&&(r.options=JSON.stringify(s.options))}function T(s){var m;const e=v.editor,k=de(s,"",e.type==="search");n.formData=k,R(k),(m=$.value)==null||m.clearValidate(),L(1)}function G(){const s='输入的格式必须为 { "value": "input value" }',e=r.defaultValue;if(!e)return s;const k=n.formData.type,m=n.formData.valueType,X=ce[k];try{const z=JSON.parse(e);if(!le(z,"object"))return s;if(k==="switch"&&!le(z.value,"boolean"))return`${X}的绑定值应该为 boolean 类型`;if(B.includes(k)){if(!le(z.value,"array"))return`${X}的绑定值应该为 array 类型`;if(m==="array<number>"&&z.value.some(K=>K!==""&&!le(K,"number")))return"数组中只能出现数字"}if(g.includes(k)&&!["string","number"].includes(Be(z.value)))return`${X}的绑定值应该为 string/number 类型`;if(k==="date"){const K=n.formData;if(O.includes(K.dateType)){if(!le(z.value,"array"))return"范围日期绑定值应该为 array 类型"}else if(!le(z.value,"string"))return"日期类型绑定值应该为 string 类型"}if(J.includes(k)&&m==="number"&&z.value!==""&&!le(z.value,"number"))return`${X}的绑定值应该为 number 类型`}catch(z){return console.warn("checkDefaultValue >>",z),s}return!0}function E(){const s=r.options;if(!s)return"选项数据不能为空！";try{const e=JSON.parse(s);if(!le(e,"array"))return"选项数据格式不正确，需要为数组类型！";const k=n.formData,m=k.optionSetting.value||"value",X=[void 0,null];for(let z=0;z<e.length;z++){const K=e[z];if(!le(K,"object"))return"数组项必须为对象！";if(X.includes(K[m]))return`数组项的值不能为${X.join("/")}`;if(["array<number>","number"].includes(k.valueType)&&!le(K[m],"number")&&K[m]!=="")return"数组项的值必须为 number 类型"}return!0}catch(e){return console.warn("checkOptions >>",e),"不合法的JSON,注意使用双引号,结尾不能为逗号等"}}function x(){E()===!0&&(n.formData.options=JSON.parse(r.options))}function a(){if(G()===!0){const e=n.formData,k=JSON.parse(r.defaultValue).value;e.type!=="date"&&(e.defaultValue=k)}}function u(s){const e=Le.find(m=>m.value===s),k=n.formData;k.shortcutIndex="",O.includes(e.value)?(k.value=[],k.valueType="array"):(k.value="",k.valueType="string"),k.formatShow=e.formatShow,k.format=e.format}function U(s){return/^[+-]?(\d|([1-9]\d+))(\.\d+)?$/.test(s)}function p(){var s;(s=$.value)==null||s.validate(e=>{if(st("#the-editor-form",e),!e)return;a(),f.includes(n.formData.type)&&x();const k=v.editor,m=JSON.parse(JSON.stringify(n.formData));if(f.includes(m.type)&&x(),m.valueType||(m.valueType=Be(m.defaultValue)),f.includes(m.type)&&["number","array<number>"].includes(m.valueType)){let z=m.optionSetting.value;z||(z="value",m.optionSetting.value=z);for(let K=0;K<m.options.length;K++){const _=m.options[K],ae=_[z];if([null,void 0].includes(ae))return pe.error("数据值字段与选项数据不匹配，请检查！");if(U(ae.toString()))_[z]=Number(ae);else{const te=_[m.optionSetting.label];return pe.error(`选项数据中【${te}】的值应该为数字！`)}}}m.type==="date"&&(m.shortcutIndex===-1&&(m.shortcutDate=m.value),m.value=m.valueType==="array"?[]:""),{search(z){z?o.config.search.list.push(m):o.config.search.list[k.index]=m},table(z){if(z){const K=JSON.parse(JSON.stringify(k.form.fields));K.push(m),k.form.fields=K}else{const K=JSON.parse(JSON.stringify(k.form.fields));K[k.index]=m,k.form.fields=K}}}[k.type](W.value),d()})}let y=[];function N(s){const e=v.editor;y=[],{search(){y=o.config.search.list.map(m=>m.key)},table(){y=e.form.fields.map(m=>m.key)}}[e.type](),s&&(y=y.filter(m=>m!==s))}return ge(()=>o.show,function(s){if(!s){n.formData=void 0;return}const e=v.editor;if(e.action==="add")n.step=0,n.formData=void 0,N();else{const k=e.index;({search(){n.formData=JSON.parse(JSON.stringify(o.config.search.list[k]))},table(){var X;n.formData=JSON.parse(JSON.stringify((X=e.form)==null?void 0:X.fields[k]))}})[e.type](),R(n.formData),N(n.formData.key),n.step=1}}),(s,e)=>{const k=h("el-input-number"),m=h("el-form-item"),X=h("el-switch"),z=h("el-form"),K=h("el-button"),_=h("el-input"),ae=h("el-text"),te=h("el-tooltip"),De=h("el-option"),Oe=h("el-select");return i(),S("section",{class:se(["the-curd-editor the-curd-scrollbar",{"is-show":o.show}])},[t(Ge,{name:"the-curd-editor-move"},{default:l(()=>{var Me;return[o.show?(i(),S("div",Al,[Bl,t(z,{"label-position":"right","label-width":"120px"},{default:l(()=>[V(v).editor.type==="search"?(i(),S(j,{key:0},[t(m,{label:"整体标题宽度"},{default:l(()=>[t(k,{modelValue:o.config.search.labelWidth,"onUpdate:modelValue":e[0]||(e[0]=w=>o.config.search.labelWidth=w),class:"w-full","controls-position":"right",placeholder:"例如：120px"},null,8,["modelValue"])]),_:1}),t(m,{label:"标题靠右对齐"},{default:l(()=>[t(X,{modelValue:o.config.search.labelRight,"onUpdate:modelValue":e[1]||(e[1]=w=>o.config.search.labelRight=w),"inline-prompt":"","active-text":"是","inactive-text":"否"},null,8,["modelValue"])]),_:1})],64)):D("",!0),V(v).editor.type==="table"&&V(v).editor.form?(i(),S(j,{key:1},[t(m,{label:"表单宽度"},{default:l(()=>[t(k,{modelValue:V(v).editor.form.width,"onUpdate:modelValue":e[2]||(e[2]=w=>V(v).editor.form.width=w),class:"w-full","controls-position":"right",placeholder:"请输入宽度(px)",clearable:""},null,8,["modelValue"])]),_:1}),t(m,{label:"文字宽度"},{default:l(()=>[t(k,{modelValue:V(v).editor.form.labelWidth,"onUpdate:modelValue":e[3]||(e[3]=w=>V(v).editor.form.labelWidth=w),class:"w-full","controls-position":"right",placeholder:"请输入标题宽度(px)",clearable:""},null,8,["modelValue"])]),_:1}),t(m,{label:"文字靠右排版"},{default:l(()=>[t(X,{modelValue:V(v).editor.form.labelPosition,"onUpdate:modelValue":e[4]||(e[4]=w=>V(v).editor.form.labelPosition=w),"inline-prompt":"","active-value":"right","inactive-value":"left","active-text":"是","inactive-text":"否"},null,8,["modelValue"])]),_:1})],64)):D("",!0)]),_:1}),n.step===0?(i(),S(j,{key:0},[b("div",jl,[Fl,t(K,{link:"",type:"primary",onClick:e[5]||(e[5]=w=>d())},{default:l(()=>[q("退出编辑")]),_:1})]),t(Ll,{selected:(Me=n.formData)==null?void 0:Me.type,type:V(v).editor.type,onChoose:T},null,8,["selected","type"])],64)):D("",!0),n.step===1?(i(),S(j,{key:1},[b("div",Jl,[b("h2",Pl,"第2步：配置"+ne(V(ce)[n.formData.type]),1),Rl,t(K,{link:"",type:"success",onClick:e[6]||(e[6]=w=>L(0))},{default:l(()=>[q("上一步")]),_:1}),t(K,{link:"",type:"primary",onClick:e[7]||(e[7]=w=>d())},{default:l(()=>[q("退出编辑")]),_:1})]),n.formData?(i(),S("div",Il,[t(ke,{"field-data":n.formData,"edit-mode":""},null,8,["field-data"])])):D("",!0),n.formData?(i(),C(z,{key:1,id:"the-editor-form",ref_key:"formRef",ref:$,model:n.formData,rules:H,"label-position":"right","label-width":"128px"},{default:l(()=>[t(m,{label:"组件标题",prop:"label"},{default:l(()=>[t(_,{modelValue:n.formData.label,"onUpdate:modelValue":e[8]||(e[8]=w=>n.formData.label=w),clearable:"",placeholder:H.label.message},null,8,["modelValue","placeholder"])]),_:1}),t(m,{label:"绑定的键值",prop:"key"},{default:l(()=>[t(_,{modelValue:n.formData.key,"onUpdate:modelValue":e[9]||(e[9]=w=>n.formData.key=w),clearable:"",placeholder:"请输入绑定的键值"},null,8,["modelValue"])]),_:1}),t(m,{label:"标题宽度",prop:"labelWidth"},{default:l(()=>[t(k,{modelValue:n.formData.labelWidth,"onUpdate:modelValue":e[10]||(e[10]=w=>n.formData.labelWidth=w),class:"w-full","controls-position":"right",placeholder:"请输入宽度，例如：120"},null,8,["modelValue"])]),_:1}),c.includes(n.formData.type)?D("",!0):(i(),C(m,{key:0,label:"组件宽度",prop:"valueWidth"},{default:l(()=>[t(k,{modelValue:n.formData.valueWidth,"onUpdate:modelValue":e[11]||(e[11]=w=>n.formData.valueWidth=w),class:"w-full","controls-position":"right",placeholder:"请输入宽度，例如：140"},null,8,["modelValue"])]),_:1})),t(m,{label:"提示/规则文字",prop:"placeholder"},{default:l(()=>[n.formData.type==="input-between"?(i(),S(j,{key:0},[t(_,{modelValue:n.formData.placeholder[0],"onUpdate:modelValue":e[12]||(e[12]=w=>n.formData.placeholder[0]=w),class:"f1",clearable:"",placeholder:"请输入提示-1"},null,8,["modelValue"]),t(ae,{style:{padding:"0 6px"}},{default:l(()=>[q("-")]),_:1}),t(_,{modelValue:n.formData.placeholder[1],"onUpdate:modelValue":e[13]||(e[13]=w=>n.formData.placeholder[1]=w),class:"f1",clearable:"",placeholder:"请输入提示-2"},null,8,["modelValue"])],64)):(i(),C(_,{key:1,modelValue:n.formData.placeholder,"onUpdate:modelValue":e[14]||(e[14]=w=>n.formData.placeholder=w),clearable:"",placeholder:"请输入规则提示/输入框提示文字"},null,8,["modelValue"]))]),_:1}),t(m,{label:"是否必填",prop:"required"},{default:l(()=>[t(X,{modelValue:n.formData.required,"onUpdate:modelValue":e[15]||(e[15]=w=>n.formData.required=w),"inline-prompt":"","active-text":"是","inactive-text":"否"},null,8,["modelValue"])]),_:1}),V(P).includes(n.formData.type)?(i(),C(m,{label:"绑定值为数字类型",key:"is-number"},{default:l(()=>[B.includes(n.formData.type)?(i(),C(X,{key:0,modelValue:n.formData.valueType,"onUpdate:modelValue":e[16]||(e[16]=w=>n.formData.valueType=w),"inline-prompt":"","active-text":"是","inactive-text":"否","active-value":"array<number>","inactive-value":"array"},null,8,["modelValue"])):(i(),C(X,{key:1,modelValue:n.formData.valueType,"onUpdate:modelValue":e[17]||(e[17]=w=>n.formData.valueType=w),"inline-prompt":"","active-text":"是","inactive-text":"否","active-value":"number","inactive-value":"string"},null,8,["modelValue"])),f.includes(n.formData.type)?(i(),C(te,{key:2,effect:"dark",content:"设为数字类型之后，将会在保存时校验选项数据",placement:"top"},{default:l(()=>[zl]),_:1})):D("",!0)]),_:1})):D("",!0),n.formData.type!=="date"?(i(),C(m,{key:2,label:"组件默认值",prop:"defaultValue"},{default:l(()=>[t(_,{modelValue:r.defaultValue,"onUpdate:modelValue":e[18]||(e[18]=w=>r.defaultValue=w),type:"textarea",clearable:"",placeholder:"请输入JSON，值为 value",onBlur:e[19]||(e[19]=w=>a())},null,8,["modelValue"])]),_:1})):D("",!0),n.formData.type==="input-between"?(i(),C(m,{key:3,label:"串联符号",prop:"separator"},{default:l(()=>[t(_,{modelValue:n.formData.separator,"onUpdate:modelValue":e[20]||(e[20]=w=>n.formData.separator=w),clearable:"",placeholder:H.separator.message},null,8,["modelValue","placeholder"])]),_:1})):D("",!0),f.includes(n.formData.type)?(i(),S(j,{key:4},[t(m,{label:"选项数据",prop:"options"},{default:l(()=>[t(_,{modelValue:r.options,"onUpdate:modelValue":e[21]||(e[21]=w=>r.options=w),type:"textarea",autosize:{minRows:2,maxRows:10},placeholder:"请输入数组JSON",style:{"margin-bottom":"4px"},onBlur:e[22]||(e[22]=w=>x())},null,8,["modelValue"]),t(K,{link:"",type:"primary"},{default:l(()=>[Kl]),_:1})]),_:1}),t(m,{label:"数据展示字段",prop:"optionSetting.label"},{default:l(()=>[t(_,{modelValue:n.formData.optionSetting.label,"onUpdate:modelValue":e[23]||(e[23]=w=>n.formData.optionSetting.label=w),clearable:"",placeholder:"不填则使用 label"},null,8,["modelValue"])]),_:1}),t(m,{label:"数据值字段",prop:"optionSetting.value"},{default:l(()=>[t(_,{modelValue:n.formData.optionSetting.value,"onUpdate:modelValue":e[24]||(e[24]=w=>n.formData.optionSetting.value=w),clearable:"",placeholder:"不填则使用 value"},null,8,["modelValue"])]),_:1}),n.formData.type==="cascader"?(i(),S(j,{key:0},[t(m,{label:"下级字段",prop:"optionSetting.children"},{default:l(()=>[t(_,{modelValue:n.formData.optionSetting.children,"onUpdate:modelValue":e[25]||(e[25]=w=>n.formData.optionSetting.children=w),clearable:"",placeholder:"不填则使用 children"},null,8,["modelValue"])]),_:1}),t(m,{label:"是否多选",prop:"multiple"},{default:l(()=>[t(X,{modelValue:n.formData.multiple,"onUpdate:modelValue":e[26]||(e[26]=w=>n.formData.multiple=w),"inline-prompt":"","active-text":"是","inactive-text":"否"},null,8,["modelValue"])]),_:1}),t(m,{label:"允许只选中某一项",prop:"checkStrictly"},{default:l(()=>[t(X,{modelValue:n.formData.checkStrictly,"onUpdate:modelValue":e[27]||(e[27]=w=>n.formData.checkStrictly=w),"inline-prompt":"","active-text":"是","inactive-text":"否"},null,8,["modelValue"])]),_:1})],64)):D("",!0),["select","select-multiple"].includes(n.formData.type)?(i(),C(m,{key:1,label:"串联显示名称",prop:"joinShow"},{default:l(()=>[t(X,{modelValue:n.formData.joinShow,"onUpdate:modelValue":e[28]||(e[28]=w=>n.formData.joinShow=w),"inline-prompt":"","active-text":"是","inactive-text":"否"},null,8,["modelValue"]),Hl]),_:1})):D("",!0)],64)):D("",!0),n.formData.type==="date"?(i(),S(j,{key:5},[t(m,{label:"日期类型",prop:"dateType"},{default:l(()=>[t(Oe,{modelValue:n.formData.dateType,"onUpdate:modelValue":e[29]||(e[29]=w=>n.formData.dateType=w),class:"w-full",onChange:u},{default:l(()=>[(i(!0),S(j,null,ee(V(Le),w=>(i(),C(De,{key:w.value,label:w.label,value:w.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(m,{label:"日期默认值",prop:"shortcutIndex"},{default:l(()=>[t(Oe,{modelValue:n.formData.shortcutIndex,"onUpdate:modelValue":e[30]||(e[30]=w=>n.formData.shortcutIndex=w),class:"w-full",placeholder:"请选择",clearable:""},{default:l(()=>[(i(!0),S(j,null,ee(M.value,w=>(i(),C(De,{key:w.value,label:w.label,value:w.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(m,{prop:"format"},{label:l(()=>[t(V(ve),{label:"格式化规则",tips:Z})]),default:l(()=>[t(_,{modelValue:n.formData.format,"onUpdate:modelValue":e[31]||(e[31]=w=>n.formData.format=w),clearable:"",placeholder:H.format.message},null,8,["modelValue","placeholder"])]),_:1})],64)):D("",!0),V(v).editor.type==="table"?(i(),C(m,{key:6,prop:"show"},{label:l(()=>[t(V(ve),{label:"表单显示逻辑",tips:F})]),default:l(()=>[t(_,{modelValue:n.formData.show,"onUpdate:modelValue":e[32]||(e[32]=w=>n.formData.show=w),type:"textarea",placeholder:"请输入条件代码，为空则默认展示"},null,8,["modelValue"])]),_:1})):D("",!0),b("div",Gl,[t(K,{onClick:e[33]||(e[33]=w=>d())},{default:l(()=>[q("关闭")]),_:1}),W.value?(i(),C(K,{key:0,type:"primary",onClick:e[34]||(e[34]=w=>p())},{default:l(()=>[Xl,q(" 新增 ")]),_:1})):(i(),C(K,{key:1,type:"success",onClick:e[35]||(e[35]=w=>p())},{default:l(()=>[Ql,q(" 确认 ")]),_:1}))])]),_:1},8,["model"])):D("",!0)],64)):D("",!0)])):D("",!0)]}),_:1})],2)}}}),eo={class:"the-curd-main-page"},to={key:0,class:"the-tag blue"},lo=b("i",{class:"el-icon-arrow-left"},null,-1),oo=b("p",{class:"mgb-10"},"配置筛选相关功能",-1),no=b("p",null,"配置表格相关功能",-1),ao={name:"Curd"},fo=ue({...ao,props:{data:{type:Object,required:!0},action:{type:Object,required:!0}},setup(Y){const A=Y,o=ie({loading:!1,editor:{show:!1,type:void 0,form:void 0,action:"add",index:-1},showEntrance:!1}),I=Q(()=>{const a=o.editor.type;return a==="search"||!a&&A.data.search.list.length>0});Qe(ot,o);let d;function c(a){o.editor.type=a,o.editor.show=!1,o.editor.index=-1,o.showEntrance=!1,d={[a]:re(A.data[a])}}function f(a){const u=o.editor.type;a&&d&&(A.data[u]=d[u]),o.editor.index=-1,o.editor.show=!1,o.editor.type=void 0,o.editor.form=void 0,d=void 0}function g(){f()}function B(){je(JSON.stringify(A.data),()=>pe.success("复制成功！"))}function J(a){a&&A.data.search.list.forEach(Ee),O.pageInfo.currentPage=1,O.selectList=[],T()}const O=ie({selectList:[],data:[],pageInfo:nt(),formShow:!1,formType:"add",formLoading:!1}),P=Q(()=>A.data.table),Z=Q(()=>P.value.columns.filter(u=>u.visible).map(u=>{const U={...u};return U.cellType==="js"&&U.jsCode&&(U.rawContent=function(p,y){let N="";try{N=new Function("cellValue","row",U.jsCode)(p,y)}catch(s){console.warn("解析 rawContent 代码错误 >>",s),N="-"}return N}),U})),F=Q(()=>P.value.actions.map(u=>{const U={...u};return U.key===fe&&(U.click=H),U})),v=Q(()=>{const a=[],u=[];return Z.value.forEach(U=>{U.slotHead&&a.push(U.slotHead),U.slot&&u.push(U.slot)}),{head:a,cell:u}});function W(a){return P.value.columns.find(U=>U.prop===a)||{}}const M=he(),n=Q(()=>{const a=P.value,u={title:"编辑表单",config:a.formEdit||{}};return O.formType==="add"&&(u.title="新增表单",u.config=a.formAdd||{}),u});let L=null;function H(a){a?(O.formType="edit",L=a):O.formType="add",O.formShow=!0,setTimeout(()=>{var u;return(u=M.value)==null?void 0:u.clear()}),Xe(()=>{var u;return L&&((u=M.value)==null?void 0:u.setFormData(L))})}function $(){var a;O.formShow=!1,(a=M.value)==null||a.reset(),L=null}function r(){var a;(a=M.value)==null||a.validate(async(u,U)=>{if(O.formType==="add"&&A.action.onAdd){O.formLoading=!0;const p=await A.action.onAdd(u,U);if(O.formLoading=!1,p.code!==1)return;$(),T()}if(O.formType==="edit"&&A.action.onEdit){O.formLoading=!0;const p=await A.action.onEdit(u,U);if(O.formLoading=!1,p.code!==1)return;$(),T()}})}function R(a){const u=A.data.search.list,U={};for(let s=0;s<u.length;s++){const e=u[s],k=Pe(e);if(e.required&&le(k.result,"string"))return rt(document.querySelector(`.${e.id}`)),pe.error(k.result),a&&a.key==="page"&&(O.pageInfo=a.before),null;k.result===!0&&(U[e.key]=k.value)}const p=P.value.columns,y=[],N=[];return a&&a.key==="sort"?p.forEach(s=>{s.sort&&(s.prop===a.prop?s.sort=a.action:s.sort=!0),s.sort==="asc"&&y.push(s.prop),s.sort==="desc"&&N.push(s.prop)}):p.forEach(s=>{s.sort==="asc"&&y.push(s.prop),s.sort==="desc"&&N.push(s.prop)}),y.length&&(U.asc=y.toString()),N.length&&(U.desc=N.toString()),U}async function T(a){const u=R(a);if(!u)return;const U=JSON.parse(JSON.stringify(O.pageInfo));o.loading=!0;const p=await A.action.getTableData(u,U);o.loading=!1,p.code===1&&(O.pageInfo.total=p.data.total,O.data=p.data.list||[])}function G(a){const u=O.selectList;switch(a){case"add":H();break;case"delete":if(!u.length)return pe.warning("请选择要删除的列表再进行操作~");me({title:"操作提示",content:`是否删除选中的 ${u.length} 条数据？`,cancelText:"取消",async confirm(){A.action.onDelete?(o.loading=!0,(await A.action.onDelete(JSON.parse(JSON.stringify(O.selectList)))).code===1?(pe.success("删除成功！"),O.selectList=[],T()):o.loading=!1):pe.info("请设置 action.onDelete 删除逻辑")}});break;case"export":A.action.onExport?A.action.onExport():pe.info("请设置 action.onExport 导出逻辑");break}}function E(a){({exit:()=>f(!0),copy:B,complete:g})[a]()}function x(a){o.loading=a}return et({formatDate:at,copyText:je,messageBox:me,message:pe,jsonToPath:it,request:ut,getData:T,setLoading:x}),Fe(function(){A.action.created&&P.value.columns.length&&A.action.created(T)}),(a,u)=>{const U=h("base-table"),p=h("base-pagination"),y=h("el-button"),N=h("el-empty"),s=h("base-dialog");return i(),S("div",eo,[b("section",{class:se([o.editor.show?"f1":"w-full"])},[I.value?(i(),C(ht,{key:0,data:A.data.search,onSearch:J},null,8,["data"])):D("",!0),o.editor.type==="table"?(i(),C(Nl,{key:1,config:P.value,onAction:E},null,8,["config"])):o.editor.type==="search"?(i(),C(V(Ie),{key:2,onAction:E})):(i(),S(j,{key:3},[P.value.columns.length>0?(i(),S(j,{key:0},[t(ze,{config:P.value,disabled:o.loading,onAction:G},{left:l(()=>[P.value.selectKey?(i(),S("span",to," 已选择 "+ne(O.selectList.length)+" 条数据 ",1)):D("",!0)]),_:1},8,["config","disabled"]),t(U,{"select-list":O.selectList,"onUpdate:selectList":u[1]||(u[1]=e=>O.selectList=e),data:O.data,columns:Z.value,actions:F.value,actionMax:P.value.actionMax,loading:o.loading,"select-key":P.value.selectKey},Ce({_:2},[ee(v.value.head,e=>({name:e,fn:l(({$index:k})=>[t(He,{column:Z.value[P.value.selectKey?k-1:k],onSort:u[0]||(u[0]=(m,X)=>T({key:"sort",prop:m,action:X}))},null,8,["column"])])})),ee(v.value.cell,e=>({name:e,fn:l(({row:k})=>[t(V(Re),{column:W(e),src:k[e],previewList:v.value.cell.map(m=>k[m])},null,8,["column","src","previewList"])])}))]),1032,["select-list","data","columns","actions","actionMax","loading","select-key"]),t(p,{disabled:o.loading,pageInfo:O.pageInfo,onChange:u[2]||(u[2]=e=>T({key:"page",...e}))},null,8,["disabled","pageInfo"])],64)):(i(),C(N,{key:1,description:"当前页面没有表格配置数据，请配置后再操作~"},{default:l(()=>[t(y,{type:"primary",onClick:u[3]||(u[3]=e=>c("table"))},{default:l(()=>[q("去配置")]),_:1})]),_:1}))],64))],2),t(Zl,{show:o.editor.show,"onUpdate:show":u[4]||(u[4]=e=>o.editor.show=e),config:A.data},null,8,["show","config"]),t(s,{show:O.formShow,"onUpdate:show":u[7]||(u[7]=e=>O.formShow=e),title:n.value.title,width:V(_e)(n.value.config.width),onClose:u[8]||(u[8]=e=>$())},{footer:l(()=>[t(V($e),{loading:O.formLoading,onClose:u[5]||(u[5]=e=>$()),onSubmit:u[6]||(u[6]=e=>r())},null,8,["loading"])]),default:l(()=>[t(Ke,{ref_key:"formRef",ref:M,config:n.value.config,type:O.formType,disabled:O.formLoading},null,8,["config","type","disabled"])]),_:1},8,["show","title","width"]),!o.showEntrance&&!o.editor.type?(i(),C(y,{key:0,class:"the-curd-entrance",type:"primary",size:"small",onClick:u[9]||(u[9]=e=>o.showEntrance=!0)},{default:l(()=>[lo]),_:1})):D("",!0),t(s,{show:o.showEntrance,"onUpdate:show":u[13]||(u[13]=e=>o.showEntrance=e),title:"请选择配置操作",width:"600px"},{footer:l(()=>[t(y,{onClick:u[12]||(u[12]=e=>o.showEntrance=!1)},{default:l(()=>[q("关 闭")]),_:1})]),default:l(()=>[b("div",{class:"the-curd-entrance-item",onClick:u[10]||(u[10]=e=>c("search"))},[oo,t(V(tt))]),b("div",{class:"the-curd-entrance-item",onClick:u[11]||(u[11]=e=>c("table"))},[no,t(V(lt))])]),_:1},8,["show"])])}}});export{fo as _};
