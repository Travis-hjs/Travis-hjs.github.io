import{H as nt,I as He,a as at,d as se,h as X,o as ze,b as h,e as i,f as S,k as T,B as he,m as M,F as I,c as e,g as l,C as L,t as oe,z as te,u as D,q as $e,ax as Te,n as re,i as k,N as Ve,r as ne,w as be,s as it,j as _e,T as rt,K as st}from"./element-plus-DnvTX0jb.js";import{b as ut,F as Ae,a as dt}from"./index-DTVl9m5C.js";import{g as ee,h as Ee,k as ae,f as Me,i as Ye,b as ye,l as De,n as ct,a as pe,u as pt,c as je,p as ft}from"./index-BHjstMsK.js";import{v as mt,s as yt}from"./dom-vtHEqTVj.js";import{r as vt}from"./common-Ck5DsC1A.js";const Ke="the-curd-state",Ne=()=>nt(Ke),ve="action-right",fe="action-edit",ce={input:"输入框",textarea:"文本域","input-between":"输入框-串联",select:"下拉框-单选","select-multiple":"下拉框-多选",checkbox:"多选复选框",radio:"单选选择框",switch:"开关切换",date:"日期选择器",cascader:"级联选择器"};let Je=0;function Ge(){return Je++,Je}function Be(u){if(u.type=="date"){const c=u.shortcutIndex,t="the-date-shortcut-selected",N=document.querySelector(`.${t}`);if(N&&N.classList.remove(t),ee(c,"number")&&c>=0){const p=We[u.dateType][c].value();u.value=p;const d=`.${u.id} .el-picker-panel__sidebar`,m=document.querySelector(d);m&&He(()=>m.children[c].classList.add(t))}!ee(u.value,"array")&&u.valueType==="array"&&(u.value=[])}else["object","array"].includes(Ee(u.defaultValue))?u.value=ae(u.defaultValue):u.value=u.defaultValue}function ue(u,c="",t){const N=Ge(),p=Date.now(),d="请输入",m="请选择",y=`field-${u}-${N}-${p}`,J={input:{key:c,id:y,type:"input",value:"",defaultValue:"",placeholder:d,valueType:"string"},textarea:{id:y,value:"",defaultValue:"",type:"textarea",placeholder:d,key:c,valueType:"string"},"input-between":{key:c,id:y,value:["",""],defaultValue:["",""],type:"input-between",placeholder:["请输入范围一","请输入范围二"],separator:"-",valueType:"array"},select:{key:c,id:y,value:"",defaultValue:"",type:"select",placeholder:m,options:[],optionSetting:{label:"",value:""},valueType:"string"},"select-multiple":{key:c,id:y,value:[],defaultValue:[],type:"select-multiple",placeholder:m,options:[],optionSetting:{label:"",value:""},valueType:"array"},checkbox:{key:c,id:y,value:[],defaultValue:[],type:"checkbox",placeholder:m,options:[],optionSetting:{label:"",value:""},valueType:"array"},radio:{key:c,id:y,value:"",defaultValue:"",type:"radio",placeholder:m,options:[],optionSetting:{label:"",value:""},valueType:"string"},switch:{key:c,id:y,value:!1,defaultValue:!1,type:"switch",placeholder:"",valueType:"boolean"},date:{key:c,id:y,value:"",type:"date",placeholder:m,dateType:"date",formatShow:"YYYY-MM-DD",format:"Y-M-D",valueType:"string",shortcutIndex:""},cascader:{key:c,id:y,value:[],defaultValue:[],type:"cascader",placeholder:m,options:[],optionSetting:{label:"",value:"",children:""},multiple:!1,checkStrictly:!1,valueType:"array"}}[u];return J.label="",J.required=!1,J}function Ue(u,c){return{label:c,prop:u,width:void 0,minWidth:void 0,tooltip:!1,cellType:"text",sort:!1,fixed:!1,iconTips:"",imageWidth:void 0,imageHeight:void 0,jsCode:"",visible:!0}}function Ie(){return{width:500,labelWidth:120,labelPosition:"left",fields:[]}}function Ce(){return{key:`action-${Ge()}-${Date.now()}`,text:"",icon:"",click:"",type:"primary"}}function Ze(u){const c={value:u.value,result:!0};if(u.type==="date"){if(!c.value)return c.result=u.placeholder,c;if(["datetimerange","daterange"].includes(u.dateType)){const d=u.value;return d.length<2?(c.result=u.placeholder,c):(c.value=d.map(m=>Me(m,u.format)),c)}return c.value=Me(u.value,u.format),c}const t=[null,void 0,""];if(u.type==="input-between"){const d=u.value;if(t.includes(d[0]))return c.result=u.placeholder[0],c;if(t.includes(d[1]))return c.result=u.placeholder[1],c;c.value=JSON.parse(JSON.stringify(d))}if(["input","textarea","radio","select"].includes(u.type)&&t.includes(u.value))return c.result=u.placeholder,c;if(["checkbox","select-multiple"].includes(u.type)){const d=u.value;if(!d.length)return c.result=u.placeholder,c;c.value=JSON.parse(JSON.stringify(d))}return c}function ke(u){if(u)return u=parseInt(u.toString()),u=Math.abs(u),`${u}px`}const Pe=[{label:"选择年份",value:"year",formatShow:"YYYY",format:"Y"},{label:"选择年份-月份",value:"month",formatShow:"YYYY-MM",format:"Y-M"},{label:"选择年份-周",value:"week",formatShow:"YYYY年 第ww周",format:"Y-M-D"},{label:"选择年份-月份-日",value:"date",formatShow:"YYYY-MM-DD",format:"Y-M-D"},{label:"选择年份-月份-日 时:分:秒",value:"datetime",formatShow:"YYYY-MM-DD HH:mm:ss",format:"Y-M-D h:m:s"},{label:"选择日期范围",value:"daterange",formatShow:"YYYY-MM-DD",format:"Y-M-D"},{label:"选择日期-时间范围",value:"datetimerange",formatShow:"YYYY-MM-DD HH:mm:ss",format:"Y-M-D h:m:s"}],Xe=3600*1e3*24;function me(u=0){const c=new Date;return c.setMonth(new Date().getMonth()-u),c}function we(u=0){const c=new Date,t=Xe*7*u;return c.setTime(c.getTime()-t),c}const Oe=[{text:"今天",value:()=>new Date},{text:"昨天",value(){const u=new Date;return u.setTime(u.getTime()-Xe),u}},{text:"一周前",value:()=>we(1)},{text:"一个月前",value:()=>me(1)},{text:"三个月前",value:()=>me(3)},{text:"半年前",value:()=>me(6)},{text:"一年前",value:()=>me(12)}],Re=Oe.map((u,c)=>{const t=c===0,N=new Date().toLocaleDateString(),p=[new Date(`${N} 00:00:00`),new Date(`${N} 23:59:59`)];return{text:t?"今天内":`${u.text}至今`,value:()=>t?p:[u.value(),new Date]}}),We={year:[{text:"今年",value:()=>new Date},{text:"去年",value:()=>new Date(new Date().setFullYear(new Date().getFullYear()-1))},{text:"前年",value:()=>new Date(new Date().setFullYear(new Date().getFullYear()-2))}],month:[{text:"当月",value:()=>new Date},{text:"上月",value:()=>me(1)},{text:"前3个月",value:()=>me(3)},{text:"前6个月",value:()=>me(6)},{text:"前12个月",value:()=>me(12)}],week:[{text:"本周",value:()=>new Date},{text:"上周",value:()=>we(1)},{text:"上2周",value:()=>we(2)},{text:"上3周",value:()=>we(3)},{text:"上4周",value:()=>we(4)}],date:Oe,datetime:Oe,daterange:Re,datetimerange:Re};function gt(u){const c=window;for(const t in u){const N=`_${t}`;c[N]=u[t]}at(function(){for(const t in u){const N=`_${t}`;c[N]=null}})}function le(u){return`<b style="color: var(--yellow)"> ${u} </b>`}const bt={name:"Field"},xe=se({...bt,props:{fieldData:{type:Object,required:!0},editMode:Boolean,readonly:Boolean,disabled:Boolean},emits:["change"],setup(u,{emit:c}){const t=u,N=c;Be(t.fieldData);function p(w){let g=w||t.fieldData.value;ee(g,"array")&&(g=ae(g)),N("change",g)}const d=X(()=>t.fieldData),m=X(()=>{const w=t.fieldData.optionSetting||{};return{value:w.value||"value",label:w.label||"label"}}),y=X(()=>{const w=t.fieldData;return{multiple:w.multiple,checkStrictly:w.checkStrictly,value:w.optionSetting.value||"value",label:w.optionSetting.label||"label",children:w.optionSetting.children||"children"}});function P(w){const g=d.value.placeholder;return{disabled:t.disabled,readonly:t.readonly,clearable:!0,placeholder:ee(w,"number")?g[w]:g}}function J(w){const g=t.fieldData;g.valueType==="number"?(g.value=Ye(w,!0,!0),p(Number(g.value))):(g.value=w,p())}function U(w,g){const Y=t.fieldData;Y.valueType==="array<number>"?(Y.value[g]=Ye(w,!0,!0),p(Y.value.map(G=>Number(G)))):(Y.value[g]=w,p())}const H=["-",".","",null,void 0];function Q(){const w=t.fieldData;w.valueType==="number"&&(H.includes(w.value)?w.value="":w.value=Number(w.value))}function R(w){const g=t.fieldData;if(g.valueType==="array<number>"){const Y=g.value[w];H.includes(Y)?g.value[w]="":g.value[w]=Number(Y)}}function _(w){const g=w.type==="select-multiple";return{placeholder:w.placeholder,disabled:t.disabled,multiple:w.type==="select-multiple",clearable:!0,filterable:!0,collapseTags:!0,class:`field-item${g?" is-multiple-select":""}`}}let F=[];const B="the-date-shortcut-selected";function n(){const w=document.querySelector(`.${B}`);w&&w.classList.remove(B),p()}function A(w){w.classList.add(B)}return ze(function(){const w=t.fieldData;if(w.type==="date"){const g=`.${w.id} .el-picker-panel__sidebar`,Y=document.querySelector(g);if(!Y)return console.warn("找不到日期快捷面板节点！");F=Array.from(Y.children),F.forEach(O=>{O.addEventListener("click",()=>A(O))});const G=w.shortcutIndex;ee(G,"number")&&G>=0&&A(F[G])}}),(w,g)=>{const Y=h("el-input"),G=h("el-text"),O=h("el-select-v2"),K=h("el-option"),C=h("el-select"),f=h("el-checkbox"),o=h("el-checkbox-group"),s=h("el-radio"),v=h("el-radio-group"),j=h("el-switch"),x=h("el-cascader"),W=h("el-date-picker");return i(),S("div",{class:"the-curd-form-field f-vertical short-value",style:$e({width:D(ke)(d.value.valueWidth)})},[d.value.type==="input"?(i(),T(Y,he({key:0,"model-value":d.value.value},P(),{class:"the-curd-field",onInput:J,onBlur:Q}),null,16,["model-value"])):M("",!0),d.value.type==="textarea"?(i(),T(Y,{key:1,modelValue:d.value.value,"onUpdate:modelValue":g[0]||(g[0]=a=>d.value.value=a),readonly:t.readonly,disabled:t.disabled,autosize:{minRows:2,maxRows:10},placeholder:d.value.placeholder,type:"textarea",class:"the-curd-field",onInput:g[1]||(g[1]=a=>p())},null,8,["modelValue","readonly","disabled","placeholder"])):M("",!0),d.value.type==="input-between"?(i(),S(I,{key:2},[e(Y,he({"model-value":d.value.value[0]},P(0),{class:"f1",onInput:g[2]||(g[2]=a=>U(a,0)),onBlur:g[3]||(g[3]=a=>R(0))}),null,16,["model-value"]),e(G,{style:{padding:"0 6px"}},{default:l(()=>[L(oe(d.value.separator),1)]),_:1}),e(Y,he({"model-value":d.value.value[1]},P(1),{class:"f1",onInput:g[4]||(g[4]=a=>U(a,1)),onBlur:g[5]||(g[5]=a=>R(1))}),null,16,["model-value"])],64)):M("",!0),d.value.type==="select"||d.value.type==="select-multiple"?(i(),S(I,{key:3},[d.value.options.length>50?(i(),T(O,he({key:0,modelValue:d.value.value,"onUpdate:modelValue":g[6]||(g[6]=a=>d.value.value=a),options:d.value.options,props:d.value.optionSetting},_(d.value),{onChange:g[7]||(g[7]=a=>p())}),null,16,["modelValue","options","props"])):(i(),T(C,he({key:1,modelValue:d.value.value,"onUpdate:modelValue":g[8]||(g[8]=a=>d.value.value=a)},_(d.value),{onChange:g[9]||(g[9]=a=>p())}),{default:l(()=>[(i(!0),S(I,null,te(d.value.options,a=>(i(),T(K,{key:a[m.value.value],value:a[m.value.value],label:a[m.value.label]},null,8,["value","label"]))),128))]),_:1},16,["modelValue"]))],64)):M("",!0),d.value.type==="checkbox"?(i(),S(I,{key:4},[e(o,{modelValue:d.value.value,"onUpdate:modelValue":g[10]||(g[10]=a=>d.value.value=a),disabled:t.disabled,onChange:g[11]||(g[11]=a=>p())},{default:l(()=>[(i(!0),S(I,null,te(d.value.options,a=>(i(),T(f,{key:a[m.value.value],value:a[m.value.value]},{default:l(()=>[L(oe(a[m.value.label]),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue","disabled"]),t.editMode&&!d.value.options.length?(i(),T(G,{key:0,type:"primary"},{default:l(()=>[L(oe(D(ce).checkbox)+"（空数据） ",1)]),_:1})):M("",!0)],64)):M("",!0),d.value.type==="radio"?(i(),S(I,{key:5},[e(v,{modelValue:d.value.value,"onUpdate:modelValue":g[12]||(g[12]=a=>d.value.value=a),disabled:t.disabled,onChange:g[13]||(g[13]=a=>p())},{default:l(()=>[(i(!0),S(I,null,te(d.value.options,a=>(i(),T(s,{key:a[m.value.value],value:a[m.value.value]},{default:l(()=>[L(oe(a[m.value.label]),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue","disabled"]),t.editMode&&!d.value.options.length?(i(),T(G,{key:0,type:"primary"},{default:l(()=>[L(oe(D(ce).radio)+"（空数据） ",1)]),_:1})):M("",!0)],64)):M("",!0),d.value.type==="switch"?(i(),T(j,{key:6,modelValue:d.value.value,"onUpdate:modelValue":g[14]||(g[14]=a=>d.value.value=a),"inline-prompt":"","active-text":"是","inactive-text":"否",onChange:g[15]||(g[15]=a=>p())},null,8,["modelValue"])):M("",!0),d.value.type==="cascader"?(i(),T(x,{key:7,modelValue:d.value.value,"onUpdate:modelValue":g[16]||(g[16]=a=>d.value.value=a),options:d.value.options,props:y.value,placeholder:d.value.placeholder,disabled:t.disabled,clearable:"","collapse-tags":"","collapse-tags-tooltip":"",filterable:"",class:"the-curd-field",onChange:g[17]||(g[17]=a=>p())},null,8,["modelValue","options","props","placeholder","disabled"])):M("",!0),d.value.type==="date"?(i(),T(W,{key:8,modelValue:d.value.value,"onUpdate:modelValue":g[18]||(g[18]=a=>d.value.value=a),placeholder:d.value.placeholder,type:d.value.dateType,format:d.value.formatShow,shortcuts:D(We)[d.value.dateType],disabled:t.disabled,"popper-class":d.value.id.toString(),"range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",class:"the-curd-field",onChange:n},null,8,["modelValue","placeholder","type","format","shortcuts","disabled","popper-class"])):M("",!0)],4)}}}),ht={key:0,class:"el-icon-rank el-icon--left"},_t={style:{"line-height":"1"}},kt={key:0,class:"the-curd-edit-mask f-vertical f-right"},wt=k("i",{class:"el-icon-delete el-icon--left"},null,-1),xt=k("i",{class:"el-icon-edit el-icon--left"},null,-1),Vt=k("i",{class:"el-icon-plus"},null,-1),Dt={name:"Search"},$t=se({...Dt,props:{data:{type:Object,required:!0}},emits:["search"],setup(u,{emit:c}){const t=u,N=c,p=Ne(),d=X(()=>p.editor.type==="search"&&!p.editor.show);function m(R){const _=t.data.list[R].label||t.data.list[R].key;ye({title:"操作提示",content:`是否删除【${_}】？`,cancelText:"取消",confirm(){t.data.list.splice(R,1)}})}function y(R){p.editor.index=R,p.editor.action="edit",p.editor.show=!0}function P(R){return p.editor.index===R&&p.editor.type==="search"&&p.editor.show}function J(){p.editor.index=-1,p.editor.action="add",p.editor.show=!0}const{onDragStart:U,onDragMove:H,onDropEnd:Q}=De({list:()=>t.data.list,key:"id",findLevel:5});return(R,_)=>{const F=h("el-button"),B=h("el-text");return i(),T(D(dt),{class:"the-curd-search","label-right":t.data.labelRight,"label-width":D(ke)(t.data.labelWidth)||"auto"},Te({content:l(()=>[e(Ve,{name:"the-group",tag:"div",class:"the-filter-content f1"},{default:l(()=>[(i(!0),S(I,null,te(t.data.list,(n,A)=>(i(),T(D(Ae),{key:n.id,"data-key":n.id,class:re([{"the-curd-selected":P(A)},n.id]),label:n.label,"label-width":D(ke)(n.labelWidth),required:n.required,draggable:d.value,onDragstart:w=>D(U)(A),onDragover:w=>D(H)(w,A),onDrop:_[0]||(_[0]=w=>D(Q)())},Te({default:l(()=>[e(xe,{"field-data":n,disabled:D(p).loading},null,8,["field-data","disabled"]),d.value?(i(),S("div",kt,[e(F,{link:"",type:"danger",onClick:w=>m(A)},{default:l(()=>[wt,L(" 删除 ")]),_:2},1032,["onClick"]),e(F,{link:"",type:"success",onClick:w=>y(A)},{default:l(()=>[xt,L(" 编辑 ")]),_:2},1032,["onClick"])])):M("",!0)]),_:2},[D(p).editor.type==="search"?{name:"label",fn:l(()=>[d.value?(i(),S("i",ht)):M("",!0),k("span",_t,oe(n.label),1)]),key:"0"}:void 0]),1032,["data-key","class","label","label-width","required","draggable","onDragstart","onDragover"]))),128)),d.value?(i(),T(D(Ae),{key:0},{default:l(()=>[t.data.list.length?M("",!0):(i(),T(B,{key:0,type:"info",style:{"margin-right":"12px"}},{default:l(()=>[L(" 请添加筛选条件~ ")]),_:1})),e(F,{type:"primary",circle:"",onClick:_[1]||(_[1]=n=>J())},{default:l(()=>[Vt]),_:1})]),_:1})):M("",!0)]),_:1})]),_:2},[D(p).editor.type?void 0:{name:"right",fn:l(()=>[e(D(ut),{loading:D(p).loading,onSearch:_[2]||(_[2]=n=>N("search",n))},null,8,["loading"])]),key:"0"}]),1032,["label-right","label-width"])}}});function Qe(u){const c=u.onAction||(()=>{});return e(I,null,[e(h("el-button"),{onClick:()=>c("exit")},{default:()=>[L("退 出")]}),e(h("el-button"),{type:"success",plain:!0,onClick:()=>c("copy")},{default:()=>[e("i",{class:"el-icon-document-copy el-icon--left"},null),L("复制JSON")]}),e(h("el-button"),{type:"primary",onClick:()=>c("complete")},{default:()=>[L("保 存")]})])}function Se(u){const c=u.onClose||(()=>{}),t=u.onSubmit||(()=>{});return e(I,null,[e(h("el-button"),{onClick:c},{default:()=>[L("取 消")]}),e(h("el-button"),{type:"primary",loading:u.loading,disabled:u.disabledSubmit,onClick:t},{default:()=>[L("确 认")]})])}function St(u){const c={};return u.imageWidth&&(c.width=`${u.imageWidth}px`),u.imageHeight&&(c.height=`${u.imageHeight}px`),c}function et(u){function c(){ct({urls:u.previewList?u.previewList:[u.src]})}return u.column.cellType==="image"?e(h("el-image"),{class:"the-table-image",style:St(u.column),src:u.src,onClick:c,fit:"cover"},null):null}function ge(u){return e(I,null,[u.label,e(h("el-tooltip"),{effect:"dark",content:u.tips,"raw-content":!0,placement:"top-start"},{default:()=>[e(h("el-button"),{type:"info",link:!0,style:"height: 32px;"},{default:()=>[e("i",{class:"el-icon-question"},null)]})]})])}function Ct(){const u=Array.from({length:6}).map((c,t)=>({id:t}));return e("div",{class:"the-thumbnail-search flex"},[e("div",{class:"the-thumbnail-search-content f1"},[u.map(c=>e("div",{key:c.id,class:"the-thumbnail-search-item"},null))]),e("div",{class:"the-thumbnail-search-btn f-vertical"},[e("i",{class:"el-icon-search"},null)])])}function Tt(){return e("section",{class:"the-thumbnail-table"},[e("svg",{width:280,height:180,viewBox:`0 0 ${280*1} ${180*1}`,fill:"none",xmlns:"http://www.w3.org/2000/svg","data-v-d2b0a988":"",class:"the-thumbnail-table-svg"},[e("rect",{width:280,height:180,fill:""},null),e("g",{filter:"url(#filter0_d_13550_224439)"},[e("path",{d:"M65 60C65 58.8954 65.8954 58 67 58H213C214.105 58 215 58.8954 215 60V132C215 133.105 214.105 134 213 134H67C65.8954 134 65 133.105 65 132V60Z",fill:"var(--el-fill-color-blank)"},null),e("path",{d:"M67 57.7C65.7297 57.7 64.7 58.7297 64.7 60V132C64.7 133.27 65.7297 134.3 67 134.3H213C214.27 134.3 215.3 133.27 215.3 132V60C215.3 58.7297 214.27 57.7 213 57.7H67Z",stroke:"var(--el-border-color-dark)","stroke-width":.6*1},null)]),[76,92,108,124].map((N,p)=>e("rect",{key:p,x:71*1,y:N*1,width:16*1,height:4*1,rx:2*1,fill:"var(--el-color-primary)"},null)),[107,143,197].map((N,p)=>[76,92,108,124].map((d,m)=>e("rect",{key:`${p}-${m}`,x:N*1,y:d*1,width:p===2?12*1:20*1,height:4*1,rx:2*1,fill:"var(--el-border-color-dark)"},null))),e("path",{d:"M65 60C65 58.8954 65.8954 58 67 58H213C214.105 58 215 58.8954 215 60V70H65V60Z",fill:"var(--el-border-color-light)"},null),[71,107,143,199].map(N=>e("rect",{key:N,x:N*1,y:63*1,width:10*1,height:2*1,rx:1*1,fill:"var(--el-border-color-dark)"},null)),[85.75,101.75,117.75].map((N,p)=>e("line",{key:p,x1:65*1,y1:N*1,x2:215*1,y2:N*1,stroke:"var(--el-border-color-light)","stroke-width":.5*1},null)),e("defs",null,[e("filter",{id:"filter0_d_13550_224439",x:"51.0666",y:"44.0671",width:177.867*1,height:103.866*1,filterUnits:"userSpaceOnUse","color-interpolation-filters":"sRGB"},[e("feFlood",{"flood-opacity":"0",result:"BackgroundImageFix"},null),e("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"},null),e("feOffset",null,null),e("feGaussianBlur",{stdDeviation:6.66667*1},null),e("feComposite",{in2:"hardAlpha",operator:"out"},null),e("feColorMatrix",{type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.05 0"},null),e("feBlend",{mode:"normal",in2:"BackgroundImageFix",result:"effect1_dropShadow_13550_224439"},null),e("feBlend",{mode:"normal",in:"SourceGraphic",in2:"effect1_dropShadow_13550_224439",result:"shape"},null)])])])])}const Et={class:"w-full f-vertical mgb-10"},Mt=k("div",{class:"f1"},null,-1),Ut=k("i",{class:"el-icon--left el-icon-delete"},null,-1),Ot=k("i",{class:"el-icon--left el-icon-plus"},null,-1),Nt=k("i",{class:"el-icon--left el-icon-download"},null,-1),Bt=k("i",{class:"el-icon--left el-icon-setting"},null,-1),Wt={class:"f-vertical f-between mgb-10"},qt=k("i",{class:"el-icon--left el-icon-refresh-left"},null,-1),Ft={key:0,class:"el-icon--left el-icon-rank"},Lt={class:"f1"},At={name:"TableOperation"},tt=se({...At,props:{config:{type:Object,required:!0},editMode:{type:Boolean},disabled:{type:Boolean}},emits:["action"],setup(u,{emit:c}){const t=u,N=c;function p(B){N("action",B)}const d={on:"el-icon-success",off:"el-icon-remove-outline"},m=X(()=>{const B=t.config;return{add:B.formAdd&&B.formAdd.fields.length>0,edit:B.formEdit&&B.formEdit.fields.length>0,delete:!!B.selectKey}}),y=X(()=>{const B=m.value.delete,n=m.value.add,A=m.value.edit;return[{type:"delete",text:B?"修改删除":"配置删除",icon:B?d.on:d.off,style:B?"primary":"info"},{type:"add",text:n?"修改新增表单":"配置新增表单",icon:n?d.on:d.off,style:n?"primary":"info"},{type:"edit",text:A?"修改编辑表单":"配置编辑表单",icon:A?d.on:d.off,style:A?"primary":"info"}]}),P=[{label:"固定左边",value:"left"},{label:"默认",value:!1},{label:"固定右边",value:"right"}],{onDragStart:J,onDragMove:U,onDropEnd:H}=De({list:()=>t.config.columns,key:"prop"});function Q(B,n){const A=B.prop===ve,w=B.key||B.prop;return{"data-key":w,key:w,draggable:A?void 0:!0,title:A?"操作栏不可排序，只能显示隐藏操作":void 0,onDragstart:A?void 0:()=>J(n),onDragover:A?void 0:g=>U(g,n),onDrop:A?void 0:H}}const R=ne({width:300,showFixed:!1});let _=[];function F(){t.config.columns=_}return be(()=>t.config.columns,function(B){t.editMode||(_=ae(B))},{immediate:!0}),(B,n)=>{const A=h("el-button"),w=h("el-checkbox"),g=h("el-radio-button"),Y=h("el-radio-group"),G=h("el-switch"),O=h("el-empty"),K=h("el-popover");return i(),S("div",Et,[t.editMode?(i(!0),S(I,{key:0},te(y.value,C=>(i(),T(A,{key:C.type,type:C.style,link:"",onClick:f=>p(C.type)},{default:l(()=>[k("i",{class:re(["el-icon--left",C.icon])},null,2),L(" "+oe(C.text),1)]),_:2},1032,["type","onClick"]))),128)):M("",!0),it(B.$slots,"default"),t.editMode?M("",!0):(i(),S(I,{key:1},[Mt,m.value.delete?(i(),T(A,{key:0,type:"danger",link:"",disabled:t.disabled,onClick:n[0]||(n[0]=C=>p("delete"))},{default:l(()=>[Ut,L(" 删除 ")]),_:1},8,["disabled"])):M("",!0),m.value.add?(i(),T(A,{key:1,type:"primary",link:"",disabled:t.disabled,onClick:n[1]||(n[1]=C=>p("add"))},{default:l(()=>[Ot,L(" 新增 ")]),_:1},8,["disabled"])):M("",!0),e(A,{type:"primary",link:"",disabled:t.disabled,onClick:n[2]||(n[2]=C=>p("export"))},{default:l(()=>[Nt,L(" 导出 ")]),_:1},8,["disabled"]),e(K,{placement:"bottom-start",width:R.showFixed?500:300,transition:"el-zoom-in-top",trigger:"click"},{reference:l(()=>[e(A,{type:"primary",link:"",disabled:t.disabled},{default:l(()=>[Bt,L(" 表格列设置 ")]),_:1},8,["disabled"])]),default:l(()=>[k("div",Wt,[e(w,{modelValue:R.showFixed,"onUpdate:modelValue":n[3]||(n[3]=C=>R.showFixed=C),label:"配置固定列"},null,8,["modelValue"]),e(A,{type:"primary",link:"",onClick:n[4]||(n[4]=C=>F())},{default:l(()=>[qt,L(" 重置 ")]),_:1})]),e(Ve,{name:"the-group",tag:"div",class:"the-curd-setting-list the-curd-scrollbar"},{default:l(()=>[(i(!0),S(I,null,te(t.config.columns,(C,f)=>(i(),S("div",he({class:"the-curd-option-item f-vertical"},Q(C,f)),[C.prop!==D(ve)?(i(),S("i",Ft)):M("",!0),k("span",Lt,oe(C.label),1),R.showFixed?(i(),T(Y,{key:1,modelValue:C.fixed,"onUpdate:modelValue":o=>C.fixed=o,size:"small",class:"mgr-10"},{default:l(()=>[(i(),S(I,null,te(P,o=>e(g,{key:o.value.toString(),value:o.value},{default:l(()=>[L(oe(o.label),1)]),_:2},1032,["value"])),64))]),_:2},1032,["modelValue","onUpdate:modelValue"])):M("",!0),e(G,{modelValue:C.visible,"onUpdate:modelValue":o=>C.visible=o,"inline-prompt":"","active-text":"显示","inactive-text":"隐藏"},null,8,["modelValue","onUpdate:modelValue"])],16))),256)),t.config.columns.length?M("",!0):(i(),T(O,{key:"empty","image-size":120,description:"暂无可以设置的表格列"}))]),_:1})]),_:1},8,["width"])],64))])}}}),Yt={key:0,class:"el-icon-rank el-icon--left",style:{"line-height":"32px"}},jt={class:"f-vertical w-full"},Jt=k("i",{class:"el-icon-edit"},null,-1),It=k("i",{class:"el-icon-delete"},null,-1),Pt={key:1},Rt=k("i",{class:"el-icon--left el-icon-delete"},null,-1),Ht=k("i",{class:"el-icon--left el-icon-finished"},null,-1),zt=k("i",{class:"el-icon--left el-icon-plus"},null,-1),Kt={name:"TableForm"},lt=se({...Kt,props:{config:{type:Object,default:()=>Ie()},type:{type:String},editMode:{type:Boolean},disabled:{type:Boolean}},emits:["change"],setup(u,{expose:c,emit:t}){const N=u,p=t,d=_e(),m=Ie(),y=ne({config:m,form:{},rules:{}}),P=Ne(),J=X(()=>N.type==="add"?"新增":"编辑"),U=X(()=>P.editor.show);function H(C){n(),P.editor.action=C>=0?"edit":"add",P.editor.form=y.config,P.editor.index=C,P.editor.show=!0}function Q(C){const f=y.config.fields;n(),ye({title:"操作提示",content:`是否删除【${f[C].label}】？`,cancelText:"取消",confirm(){f.splice(C,1)}})}function R(){ye({title:"操作提示",content:`是否移除【${J.value}】表单？移除后将不会出现对应功能按钮。`,cancelText:"取消",confirm(){y.config.fields=[]}})}function _(){p("change")}function F(){const C=N.type==="add"?"编辑":"新增";ye({title:"操作提示",content:`是否将表单数据同步到【${C}】表单？`,cancelText:"不同步",confirmText:"同步",cancel(){p("change",y.config)},confirm(){p("change",y.config,!0)}})}function B(C){var f;(f=d.value)==null||f.validate(o=>{if(o&&C){const s=O.value,v={};K.value.forEach(j=>{v[j.key]=s[j.key]}),C(s,v)}})}function n(){var C;(C=d.value)==null||C.clearValidate()}function A(){y.config.fields.forEach(Be)}function w(C){y.config.fields.forEach(f=>{if(Object.prototype.hasOwnProperty.call(C,f.key)){const o=C[f.key];if(!o)return;switch(f.type){case"date":ee(o,"array")?f.value=o.map(s=>new Date(s)):f.value=new Date(o);break;default:f.value=o;break}}})}const{onDragStart:g,onDragMove:Y,onDropEnd:G}=De({list:()=>y.config.fields,key:"id",findLevel:10});be(()=>N.config,function(C){C&&(y.config=ae(C))},{immediate:!0}),be(()=>y.config.fields,function(C){const f={},o={},s=["input","input-between","textarea"];C&&C.forEach(v=>{f[v.key]=v.value,v.required&&(o[v.key]=[{required:!0,validator(j,x,W){const a=[void 0,null,""];if(v.type==="input-between"&&!v.value[0]&&!v.value[1]){W(new Error("请输入两个范围字段"));return}if(v.valueType==="array"&&!v.value.length){W(new Error(v.placeholder||"请选择"));return}if(v.valueType!=="boolean"&&a.includes(v.value)){const r=s.includes(v.type)?"请输入内容":"请选择";W(new Error(v.placeholder||r));return}W()},trigger:s.includes(v.type)?"blur":"change"}])}),y.form=f,y.rules=o,setTimeout(n)},{immediate:!0});const O=X(()=>{const C={};return y.config.fields.forEach(f=>{C[f.key]=Ze(f).value}),C}),K=X(()=>y.config.fields.filter(C=>{const f=C.show;if(!f)return!0;if(ee(f,"function"))return f(O.value);if(f.includes("return"))try{return new Function("formData",f)(O.value)}catch(o){console.warn("解析表单展示逻辑代码错误 >>",o)}return!0}));return c({clear:n,validate:B,reset:A,setFormData:w}),(C,f)=>{const o=h("el-button"),s=h("el-form-item"),v=h("el-empty"),j=h("el-form");return i(),T(j,{ref_key:"formRef",ref:d,model:y.form,rules:y.rules,labelWidth:D(ke)(y.config.labelWidth),labelPosition:y.config.labelPosition,disabled:N.disabled,style:$e(N.editMode?{width:D(ke)(y.config.width)}:null),class:re([{"is-edit-form":N.editMode}])},{default:l(()=>[N.editMode?(i(),S(I,{key:0},[e(Ve,{name:"the-group",tag:"div"},{default:l(()=>[(i(!0),S(I,null,te(y.config.fields,(x,W)=>(i(),T(s,{class:re([{"the-curd-selected":D(P).editor.index===W&&U.value}]),prop:x.key,key:x.id,"data-key":x.id,draggable:y.config.fields.length>1&&!D(P).editor.show?!0:null,onDragstart:a=>D(g)(W),onDragover:a=>D(Y)(a,W),onDrop:D(G)},{label:l(()=>[y.config.fields.length>1&&!D(P).editor.show?(i(),S("i",Yt)):M("",!0),k("span",null,oe(x.label),1)]),default:l(()=>[k("div",jt,[e(xe,{class:"mgr-10",fieldData:x,editMode:""},null,8,["fieldData"]),e(o,{link:"",type:"success",disabled:U.value,onClick:a=>H(W)},{default:l(()=>[Jt]),_:2},1032,["disabled","onClick"]),e(o,{link:"",type:"danger",disabled:U.value,onClick:a=>Q(W)},{default:l(()=>[It]),_:2},1032,["disabled","onClick"])])]),_:2},1032,["class","prop","data-key","draggable","onDragstart","onDragover","onDrop"]))),128))]),_:1}),y.config.fields.length?M("",!0):(i(),T(v,{key:0,description:`当前没有表单项，当没有表单项时【${J.value}】功能按钮不会出现~`},null,8,["description"])),U.value?M("",!0):(i(),S("div",Pt,[e(o,{link:"",onClick:f[0]||(f[0]=x=>_())},{default:l(()=>[L(" 退出编辑 ")]),_:1}),e(o,{type:"danger",link:"",disabled:!y.config.fields.length,onClick:f[1]||(f[1]=x=>R())},{default:l(()=>[Rt,L(" 删除表单 ")]),_:1},8,["disabled"]),e(o,{type:"success",link:"",onClick:f[2]||(f[2]=x=>F())},{default:l(()=>[Ht,L(" 完成表单 ")]),_:1}),e(o,{type:"primary",link:"",onClick:f[3]||(f[3]=x=>H(-1))},{default:l(()=>[zt,L(" 添加一项 ")]),_:1})]))],64)):M("",!0),!N.editMode&&y.config&&y.config.fields?(i(!0),S(I,{key:1},te(K.value,x=>(i(),T(s,{label:x.label,prop:x.key,key:x.id},{default:l(()=>[e(xe,{fieldData:x},null,8,["fieldData"])]),_:2},1032,["label","prop"]))),128)):M("",!0)]),_:1},8,["model","rules","labelWidth","labelPosition","disabled","style","class"])}}}),Gt={key:1,class:"f-vertical w-full"},Zt=k("i",{class:"el-icon--right el-icon-question the-tips-icon"},null,-1),Xt={key:1,class:"f1 f-right"},Qt={name:"TableHeader"},ot=se({...Qt,props:{column:{type:Object,required:!0}},emits:["sort"],setup(u,{emit:c}){const t=u,N=c,p=X(()=>!t.column.sort&&!t.column.iconTips),d={true:{index:0,icon:"el-icon-sort"},asc:{index:1,icon:"el-icon-sort-up"},desc:{index:2,icon:"el-icon-sort-down"}},m=[!0,"asc","desc"];function y(){const P=t.column.sort.toString();let J=d[P].index;J++,J>=m.length&&(J=0);const U=m[J];N("sort",t.column.prop,U)}return(P,J)=>{const U=h("el-tooltip"),H=h("el-button");return p.value?(i(),S(I,{key:0},[L(oe(t.column.label),1)],64)):(i(),S("div",Gt,[k("span",null,oe(t.column.label),1),t.column.iconTips?(i(),T(U,{key:0,effect:"dark",content:t.column.iconTips,placement:"top"},{default:l(()=>[Zt]),_:1},8,["content"])):M("",!0),t.column.sort?(i(),S("div",Xt,[e(H,{link:"",onClick:y},{default:l(()=>[k("i",{class:re(["el-icon--right",d[t.column.sort.toString()].icon])},null,2)]),_:1})])):M("",!0)]))}}}),el={name:"TableColumnConfig"},tl=se({...el,props:{show:{type:Boolean,required:!0},type:{type:String,required:!0},keys:{type:Array,required:!0},form:Object},emits:["update:show","submit"],setup(u,{emit:c}){const t=u,N=c,p=ne({show:!1,form:Ue("","")}),d=X(()=>({add:"新增",edit:"编辑",copy:"复制"})[t.type]+"表格列"),m=_e(),y={label:{required:!0,message:"请输入表格列标题",trigger:"blur"},prop:{required:!0,validator(R,_,F){_?t.keys.includes(p.form.prop)?F(new Error("已经存在相同的值！")):F():F(new Error("输入字段不能为空！"))},trigger:"blur"},jsCode:{required:!0,validator(R,_,F){_?_.includes("return")?F():F(new Error('代码片段必须带有返回字段 "return"')):F(new Error("代码片段不能为空！"))},trigger:"blur"}},P=[{label:"默认普通文本",value:"text"},{label:"图片预览组件",value:"image"},{label:"自定义 js 代码",value:"js"}],J=[{label:"不可排序",value:!1},{label:"可排序",value:!0},{label:"默认升序",value:"asc"},{label:"默认降序",value:"desc"}],U=`
<p>函数代码片段：</p>
<p>第一个参数${le("cellValue")}是表格值;</p>
<p>第二个参数${le("row")}是完整对象;</p>
<p>例如：${le("return cellValue + row.id;")};</p>
<p>也可以是HTML：${le("return `html 标签`")};</p>
`;function H(){N("update:show",!1)}function Q(){var R;(R=m.value)==null||R.validate(_=>{if(!_)return;const F=ae(p.form);["width","minWidth","imageWidth","imageHeight"].forEach(n=>{F[n]&&(F[n]=Number(F[n]))}),F.cellType==="image"&&(F.slot=F.prop),(F.sort||F.iconTips)&&(F.slotHead=`header-${F.prop}`),N("submit",F),H()})}return be(()=>t.show,function(R){p.show=R,R&&(t.type==="add"?p.form=Ue("",""):(p.form=ae(t.form),t.type==="copy"&&(p.form.prop="")),setTimeout(()=>{var _;return(_=m.value)==null?void 0:_.clearValidate()}))},{immediate:!0}),(R,_)=>{const F=h("el-input"),B=h("el-form-item"),n=h("el-input-number"),A=h("el-option"),w=h("el-select"),g=h("el-switch"),Y=h("el-form"),G=h("base-dialog");return i(),T(G,{modelValue:p.show,"onUpdate:modelValue":_[11]||(_[11]=O=>p.show=O),title:d.value,width:"580px",onClose:H},{footer:l(()=>[e(D(Se),{onClose:H,onSubmit:Q})]),default:l(()=>[e(Y,{ref_key:"formRef",ref:m,model:p.form,rules:y,"label-position":"right","label-width":"130px"},{default:l(()=>[e(B,{label:"表格列标题",prop:"label"},{default:l(()=>[e(F,{modelValue:p.form.label,"onUpdate:modelValue":_[0]||(_[0]=O=>p.form.label=O),clearable:"",placeholder:y.label.message},null,8,["modelValue","placeholder"])]),_:1}),e(B,{label:"表格列键值",prop:"prop"},{default:l(()=>[e(F,{modelValue:p.form.prop,"onUpdate:modelValue":_[1]||(_[1]=O=>p.form.prop=O),clearable:"",placeholder:"请输入表格列键值"},null,8,["modelValue"])]),_:1}),e(B,{label:"表格列宽度",prop:"width"},{default:l(()=>[e(n,{modelValue:p.form.width,"onUpdate:modelValue":_[2]||(_[2]=O=>p.form.width=O),class:"w-full","controls-position":"right",placeholder:"请输入表格列宽度，例如：120（默认自适应）"},null,8,["modelValue"])]),_:1}),e(B,{label:"表格列最小宽度",prop:"minWidth"},{default:l(()=>[e(n,{modelValue:p.form.minWidth,"onUpdate:modelValue":_[3]||(_[3]=O=>p.form.minWidth=O),class:"w-full","controls-position":"right",placeholder:"请输入表格列最小宽度，例如：120（默认自适应）"},null,8,["modelValue"])]),_:1}),e(B,{label:"表格列展示类型",prop:"cellType"},{default:l(()=>[e(w,{modelValue:p.form.cellType,"onUpdate:modelValue":_[4]||(_[4]=O=>p.form.cellType=O)},{default:l(()=>[(i(),S(I,null,te(P,O=>e(A,{key:O.value,value:O.value,label:O.label},null,8,["value","label"])),64))]),_:1},8,["modelValue"])]),_:1}),p.form.cellType==="image"?(i(),S(I,{key:0},[e(B,{label:"图片宽度(像素)",prop:"imageWidth"},{default:l(()=>[e(n,{modelValue:p.form.imageWidth,"onUpdate:modelValue":_[5]||(_[5]=O=>p.form.imageWidth=O),class:"w-full","controls-position":"right",placeholder:"请输入数字（默认80px）"},null,8,["modelValue"])]),_:1}),e(B,{label:"图片高度(像素)",prop:"imageHeight"},{default:l(()=>[e(n,{modelValue:p.form.imageHeight,"onUpdate:modelValue":_[6]||(_[6]=O=>p.form.imageHeight=O),class:"w-full","controls-position":"right",placeholder:"请输入数字（默认80px）"},null,8,["modelValue"])]),_:1})],64)):M("",!0),p.form.cellType==="js"?(i(),T(B,{key:1,prop:"jsCode"},{label:l(()=>[e(D(ge),{label:"js代码",tips:U})]),default:l(()=>[e(F,{modelValue:p.form.jsCode,"onUpdate:modelValue":_[7]||(_[7]=O=>p.form.jsCode=O),type:"textarea",placeholder:"请输入代码片段"},null,8,["modelValue"])]),_:1})):M("",!0),e(B,{label:"表格列排序操作",prop:"sort"},{default:l(()=>[e(w,{modelValue:p.form.sort,"onUpdate:modelValue":_[8]||(_[8]=O=>p.form.sort=O)},{default:l(()=>[(i(),S(I,null,te(J,O=>e(A,{key:O.value.toString(),value:O.value,label:O.label},null,8,["value","label"])),64))]),_:1},8,["modelValue"])]),_:1}),e(B,{label:"内容溢出截断",prop:"tooltip"},{default:l(()=>[e(g,{modelValue:p.form.tooltip,"onUpdate:modelValue":_[9]||(_[9]=O=>p.form.tooltip=O),"inline-prompt":"","active-text":"是","inactive-text":"否"},null,8,["modelValue"])]),_:1}),e(B,{label:"表头图标提示文字",prop:"iconTips"},{default:l(()=>[e(F,{modelValue:p.form.iconTips,"onUpdate:modelValue":_[10]||(_[10]=O=>p.form.iconTips=O),clearable:"",placeholder:"请输入表头图标提示文字"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}}),ll=k("p",{class:"mgb-10"},"表格数据中的字段，例如表格数：",-1),ol=k("p",{class:"mgb-10"},"则键值可以为 id",-1),nl=k("p",null,[k("i",{class:"el-icon-info el-icon--left"}),L(" 不填则没有删除功能 ")],-1),al={name:"TableDeleteConfig"},il=se({...al,props:{show:{type:Boolean,default:!1},selectKey:{type:String,default:""}},emits:["update:show","submit"],setup(u,{emit:c}){const t=u,N=c,p='[{ id: 1, name: "名称", status: 2 }]',d=ne({show:!1,keyword:""});function m(){N("update:show",!1)}function y(){m(),N("submit",d.keyword)}return be(()=>t.show,function(P){d.show=P,P&&(d.keyword=t.selectKey||"")},{immediate:!0}),(P,J)=>{const U=h("el-input"),H=h("el-form-item"),Q=h("el-form"),R=h("base-dialog");return i(),T(R,{modelValue:d.show,"onUpdate:modelValue":J[1]||(J[1]=_=>d.show=_),title:"配置表格删除功能",width:"400px",onClose:m},{footer:l(()=>[e(D(Se),{onClose:m,onSubmit:y})]),default:l(()=>[e(Q,{labelPosition:"right",labelWidth:"120px"},{default:l(()=>[e(H,{label:"数据键值"},{default:l(()=>[e(U,{class:"mgb-10",modelValue:d.keyword,"onUpdate:modelValue":J[0]||(J[0]=_=>d.keyword=_),placeholder:"请输入数据键值",clearable:""},null,8,["modelValue"]),k("div",{class:"the-tag blue"},[ll,k("p",{class:"mgb-10"},oe(p)),ol,nl])]),_:1})]),_:1})]),_:1},8,["modelValue"])}}}),rl={class:"flex"},sl={class:"f1"},ul={class:"f-vertical w-full"},dl={class:"f-right w-full"},cl=k("i",{class:"el-icon--left el-icon-finished"},null,-1),pl=k("i",{class:"el-icon--left el-icon-plus"},null,-1),fl=["data-key","draggable","onDragstart","onDragover"],ml={key:0,class:"el-icon--left el-icon-rank"},yl=k("div",{class:"f1"},null,-1),vl=k("i",{class:"el-icon-delete"},null,-1),gl=k("i",{class:"el-icon-edit"},null,-1),bl={key:1,class:"w-full f-right"},hl=k("i",{class:"el-icon--left el-icon-plus"},null,-1),_l={name:"TableActionConfig"},kl=se({..._l,props:{show:{type:Boolean,default:!1},list:{type:Array,required:!0},columnWidth:{type:Number},actionMax:{type:Number}},emits:["update:show","submit"],setup(u,{emit:c}){const t=u,N=c,p=_e(),d=_e(),m=ne({show:!1,list:[],index:-1,hasEdit:!1,formEdit:!1}),y=ne({btn:Ce(),column:{width:160,max:3}}),P={width:{required:!0,message:"请输入表格列宽度，例如：160",trigger:"blur"},max:{required:!1,message:"请输入数量，超出用“更多”下拉展示",trigger:"blur"}},J={text:{required:!0,message:"请输入按钮文字",trigger:"blur"},click:{required:!0,message:"请输入按钮操作代码",trigger:"blur"},icon:{required:!1,message:"请输入图标 class",trigger:"blur"},type:{required:!1,message:"请选择按钮类型",trigger:"change"}};function U(){N("update:show",!1)}function H(){d.value.validate(f=>{if(!f)return;U();const{width:o,max:s}=y.column;N("submit",ae(m.list),o,s)})}function Q(f){p.value.validate(o=>{if(!o)return;const s=ae(y.btn);f==="add"?m.list.push(s):m.list[m.index]=y.btn,R()})}function R(){m.index=-1,y.btn=Ce(),m.formEdit=!1,setTimeout(()=>{var f;return(f=p.value)==null?void 0:f.clearValidate()})}function _(f){const o=m.list[f];y.btn=JSON.parse(JSON.stringify(o)),m.index=f,m.formEdit=!0}function F(f){m.list.splice(f,1)}be(()=>t.show,function(f){m.show=f,f&&(m.list=ae(t.list),m.hasEdit=m.list.some(o=>o.key===fe),m.index=-1,y.btn=Ce(),y.column={width:t.columnWidth,max:t.actionMax},setTimeout(()=>{var o,s;(o=p.value)==null||o.clearValidate(),(s=d.value)==null||s.clearValidate()}))},{immediate:!0});const B=[{label:"默认（蓝色）",value:"primary"},{label:"成功（绿色）",value:"success"},{label:"警告（橙色）",value:"warning"},{label:"危险（红色）",value:"danger"},{label:"文本（灰色）",value:"info"}],n="https://element.eleme.cn/#/zh-CN/component/icon",{onDragStart:A,onDragMove:w,onDropEnd:g}=De({list:()=>m.list,key:"key"});function Y(f){if(f.key!=fe&&m.list.length>1&&m.index===-1)return!0}function G(f){const o=f.text;if(ee(o,"string")){if(!o.includes("return"))return o;let s="文字配置有误";try{s=new Function("row",o)({})}catch(v){console.warn("解析按钮文字代码错误 >>",v)}return s}return ee(o,"function")?o({}):"未设置按钮"}const O=`
<p>可以输入代码片段，</p>
<p>以${le("return")}关键字为函数标记，</p>
<p>函数第一个参数${le("row")}是表格对象值</p>
<p>例如：${le('return row.status === 1 ? "下架" : "上架";')}</p>
`,K=`
<p>函数代码片段，点击的时候运行</p>
<p>函数第一个参数${le("row")}是表格对象值</p>
<p>第二个参数${le("index")}是当前索引</p>
<p>例如：${le("console.log(row, index);")}</p>
`,C=`
<p>可以输入代码片段，</p>
<p>以${le("return")}关键字为函数标记，</p>
<p>函数第一个参数${le("row")}是表格对象值</p>
<p>例如：${le("return row.status === 1;")}返回布尔值进行判断</p>
`;return(f,o)=>{const s=h("el-text"),v=h("el-divider"),j=h("el-input-number"),x=h("el-form-item"),W=h("el-form"),a=h("el-input"),r=h("el-option"),E=h("el-select"),b=h("el-button"),Z=h("el-popconfirm"),q=h("el-empty"),z=h("base-dialog");return i(),T(z,{modelValue:m.show,"onUpdate:modelValue":o[13]||(o[13]=$=>m.show=$),title:"配置操作列按钮功能",width:"880px",onClose:U},{footer:l(()=>[e(D(Se),{disabledSubmit:m.formEdit,onClose:U,onSubmit:H},null,8,["disabledSubmit"])]),default:l(()=>[k("div",rl,[k("section",sl,[e(v,{"content-position":"left","border-style":"dashed"},{default:l(()=>[e(s,{type:"info"},{default:l(()=>[L("操作列配置")]),_:1})]),_:1}),e(W,{ref_key:"formColumn",ref:d,model:y.column,rules:P,labelPosition:"right",labelWidth:"128px"},{default:l(()=>[e(x,{label:"操作列宽度",prop:"width"},{default:l(()=>[e(j,{modelValue:y.column.width,"onUpdate:modelValue":o[0]||(o[0]=$=>y.column.width=$),class:"w-full","controls-position":"right",placeholder:P.width.message},null,8,["modelValue","placeholder"])]),_:1}),e(x,{label:"操作按钮限制",prop:"max"},{default:l(()=>[e(j,{modelValue:y.column.max,"onUpdate:modelValue":o[1]||(o[1]=$=>y.column.max=$),class:"w-full","controls-position":"right",min:2,placeholder:P.max.message},null,8,["modelValue","placeholder"])]),_:1})]),_:1},8,["model"]),e(v,{"content-position":"left","border-style":"dashed"},{default:l(()=>[e(s,{type:"info"},{default:l(()=>[L("操作按钮配置")]),_:1})]),_:1}),e(W,{ref_key:"formBtn",ref:p,model:y.btn,rules:J,labelPosition:"right",labelWidth:"128px",class:re({"the-filter-mask":!m.formEdit}),"data-tips":"待新增或编辑操作"},{default:l(()=>[e(x,{prop:"text"},{label:l(()=>[e(D(ge),{label:"按钮文字",tips:O})]),default:l(()=>[e(a,{modelValue:y.btn.text,"onUpdate:modelValue":o[2]||(o[2]=$=>y.btn.text=$),type:"textarea",placeholder:J.text.message},null,8,["modelValue","placeholder"])]),_:1}),e(x,{prop:"click"},{label:l(()=>[e(D(ge),{label:"按钮功能代码",tips:K})]),default:l(()=>[e(a,{modelValue:y.btn.click,"onUpdate:modelValue":o[3]||(o[3]=$=>y.btn.click=$),type:"textarea",placeholder:"请输入代码片段"},null,8,["modelValue"])]),_:1}),e(x,{prop:"show"},{label:l(()=>[e(D(ge),{label:"按钮显示条件",tips:C})]),default:l(()=>[e(a,{modelValue:y.btn.show,"onUpdate:modelValue":o[4]||(o[4]=$=>y.btn.show=$),type:"textarea",placeholder:"请输入条件代码，为空则默认显示"},null,8,["modelValue"])]),_:1}),e(x,{prop:"disabled"},{label:l(()=>[e(D(ge),{label:"按钮禁用条件",tips:C})]),default:l(()=>[e(a,{modelValue:y.btn.disabled,"onUpdate:modelValue":o[5]||(o[5]=$=>y.btn.disabled=$),type:"textarea",placeholder:"请输入条件代码，为空则默认不禁用"},null,8,["modelValue"])]),_:1}),e(x,{label:"按钮图标",prop:"icon"},{default:l(()=>[k("div",ul,[e(a,{modelValue:y.btn.icon,"onUpdate:modelValue":o[6]||(o[6]=$=>y.btn.icon=$),placeholder:J.icon.message,clearable:""},null,8,["modelValue","placeholder"]),e(s,{type:"primary",style:{width:"110px","text-align":"right"}},{default:l(()=>[k("a",{href:n,target:"_blank"},"去官网复制")]),_:1})])]),_:1}),e(x,{label:"按钮类型",prop:"type"},{default:l(()=>[e(E,{modelValue:y.btn.type,"onUpdate:modelValue":o[7]||(o[7]=$=>y.btn.type=$),placeholder:J.type.message},{default:l(()=>[(i(),S(I,null,te(B,$=>e(r,{key:$.value,value:$.value,label:$.label},null,8,["value","label"])),64))]),_:1},8,["modelValue","placeholder"])]),_:1}),e(x,null,{default:l(()=>[k("div",dl,[e(b,{onClick:o[8]||(o[8]=$=>R())},{default:l(()=>[L("取 消")]),_:1}),m.index>-1?(i(),T(b,{key:0,type:"primary",plain:"",onClick:o[9]||(o[9]=$=>Q("edit"))},{default:l(()=>[cl,L(" 确认修改 ")]),_:1})):(i(),T(b,{key:1,type:"primary",plain:"",onClick:o[10]||(o[10]=$=>Q("add"))},{default:l(()=>[pl,L(" 确认新增 ")]),_:1}))])]),_:1})]),_:1},8,["model","class"])]),e(Ve,{name:"the-group",tag:"div",class:"the-curd-option-list f1"},{default:l(()=>[(i(!0),S(I,null,te(m.list,($,ie)=>(i(),S("div",{class:re(["the-curd-option-item f-vertical",{"the-curd-selected":ie===m.index}]),key:$.key,"data-key":$.key!==D(fe)?$.key:null,draggable:Y($),onDragstart:de=>D(A)(ie),onDragover:de=>D(w)(de,ie),onDrop:o[11]||(o[11]=(...de)=>D(g)&&D(g)(...de))},[m.index===-1&&$.key!==D(fe)?(i(),S("i",ml)):M("",!0),e(b,{type:$.type,link:""},{default:l(()=>[$.icon?(i(),S("i",{key:0,class:re(["el-icon--left",$.icon])},null,2)):M("",!0),L(" "+oe(G($)),1)]),_:2},1032,["type"]),yl,$.key===D(fe)?(i(),T(s,{key:1,type:"info",size:"small"},{default:l(()=>[L("编辑按钮不可删除、拖拽等操作，且处于首位")]),_:1})):(i(),S(I,{key:2},[e(Z,{width:"186px",title:"是否删除该按钮功能？",onConfirm:de=>F(ie)},{reference:l(()=>[e(b,{link:"",type:"danger",disabled:m.index>-1},{default:l(()=>[vl]),_:1},8,["disabled"])]),_:2},1032,["onConfirm"]),e(b,{link:"",type:"success",onClick:de=>_(ie)},{default:l(()=>[gl]),_:2},1032,["onClick"])],64))],42,fl))),128)),m.list.length?M("",!0):(i(),T(q,{key:"empty","image-size":120,description:"请添加操作列功能按钮"})),m.formEdit?M("",!0):(i(),S("div",bl,[m.formEdit?M("",!0):(i(),T(b,{key:0,type:"primary",plain:"",onClick:o[12]||(o[12]=$=>m.formEdit=!0)},{default:l(()=>[hl,L(" 新增功能按钮 ")]),_:1}))]))]),_:1})])]),_:1},8,["modelValue"])}}}),wl={class:"the-curd-table-model the-curd-scrollbar"},xl=["data-key","draggable","onDragstart","onDragover"],Vl={class:"fake-table-head f-vertical"},Dl=k("i",{class:"el-icon-rank el-icon--left"},null,-1),$l={class:"fake-table-cell operation f-vertical"},Sl=k("i",{class:"el-icon-arrow-down el-icon--right"},null,-1),Cl={class:"fake-table-cell f-vertical"},Tl={key:1,class:"the-tag blue"},El=k("div",{class:"fake-table-head fvc"},"操作",-1),Ml={class:"fake-table-cell operation fvc"},Ul=k("i",{class:"el-icon-setting"},null,-1),Ol=k("i",{class:"el-icon-delete"},null,-1),Nl={class:"fake-table-cell"},Bl={class:"f-vertical",key:"fixed"},Wl=k("i",{class:"el-icon-plus el-icon--left"},null,-1),ql={key:0},Fl=k("i",{class:"el-icon-plus el-icon--left"},null,-1),Ll={name:"TableModel"},Al=se({...Ll,props:{config:{type:Object,required:!0}},emits:["action"],setup(u,{emit:c}){const t=u,N=c,p="https://fuss10.elemecdn.com/e/5d/4a731a90594a4af544c0c25941171jpeg.jpeg",d=[{key:"edit",label:"编辑列",icon:"el-icon-edit",click(s){P("edit",s)}},{key:"copy",label:"复制列",icon:"el-icon-document-copy",click(s){P("copy",s)}},{key:"delete",label:"删除列",icon:"el-icon-delete",click(s){U(s)}}],m=ne({show:!1,type:"add",index:-1,form:void 0,keys:[]}),y=X(()=>{const s=t.config.columns,v=[],j=[];for(let x=0;x<s.length;x++){const W=s[x];W.prop===ve?j.push(W):v.push(W)}return{drag:v,action:j}});function P(s,v){m.keys=t.config.columns.map(x=>x.prop),{add(){m.form=void 0},edit(){const x=t.config.columns[v];m.keys=m.keys.filter(W=>W!==x.prop),m.index=v,m.form=x},copy(){const x=t.config.columns[v];m.form=x}}[s](),m.type=s,m.show=!0}function J(s){const v=t.config;if(["add","copy"].includes(m.type)){const j=ae(y.value.drag);j.push(s),v.columns=j.concat(y.value.action)}else v.columns[m.index]=s}function U(s){const v=y.value.drag[s];ye({title:"操作提示",content:`是否删除【${v.label}】列？`,cancelText:"取消",confirm(){const j=t.config.columns.findIndex(x=>x.prop===v.prop);t.config.columns.splice(j,1)}})}const{onDragStart:H,onDragMove:Q,onDropEnd:R}=De({list:()=>t.config.columns,key:"prop",findLevel:5});function _(s){const v={};return s&&s.width&&(v.width=`${s.width}px`),s&&s.minWidth&&(v.minWidth=`${s.minWidth}px`),v}const F=X(()=>{const s=t.config.columns;if(s.length>0&&s[s.length-1].prop===ve)return s[s.length-1]});function B(){const s=Ue(ve,"操作");s.minWidth=120,s.width=160,t.config.columns.push(s)}function n(){const s=t.config.columns;ye({title:"操作提示",content:"是否删除操作列？删除之后需要重新配置。",cancelText:"取消",confirm(){s.splice(s.length-1,1),t.config.actions=[],t.config.formEdit&&(t.config.formEdit=void 0)}})}const A=ne({show:!1,keyword:""});function w(){const s=t.config.selectKey;A.keyword=s?s.toString():"",A.show=!0}function g(s){t.config.selectKey=s}const Y=ne({show:!1,columnWidth:0,actionMax:0});function G(){Y.show=!0,Y.columnWidth=F.value.width,Y.actionMax=t.config.actionMax}function O(s,v){t.config.actions=s;const j=t.config.columns.find(x=>x.prop===ve);j.width=v}const K=ne({show:!1,form:null,type:"add"});function C(s){K.type=s,s==="add"&&t.config.formAdd&&(K.form=t.config.formAdd),s==="edit"&&t.config.formEdit&&(K.form=t.config.formEdit),K.show=!0}function f(s,v){const j=t.config,x=j.actions;function W(){const a=x.length>0&&x[0].key===fe;s&&s.fields.length>0?(F.value||B(),a||x.unshift({key:fe,text:"编辑",type:"success",icon:"el-icon-edit"})):a&&x.splice(0,1)}s&&(K.type==="add"?(j.formAdd=s,v&&(j.formEdit=ae(s),W())):(j.formEdit=s,v&&(j.formAdd=ae(s)),W())),K.show=!1,K.form=null}function o(s){switch(s){case"delete":w();break;case"add":C("add");break;case"edit":C("edit");break}}return(s,v)=>{const j=h("el-empty"),x=h("el-button"),W=h("el-dropdown-item"),a=h("el-dropdown-menu"),r=h("el-dropdown"),E=h("el-tooltip"),b=h("base-table-actions"),Z=h("el-text");return i(),S(I,null,[K.show?M("",!0):(i(),T(tt,{key:0,editMode:!0,config:t.config,onAction:o},null,8,["config"])),k("div",wl,[K.show?(i(),T(lt,{key:0,config:K.form,type:K.type,editMode:!0,onChange:f},null,8,["config","type"])):(i(),T(Ve,{key:1,name:"the-group",tag:"div",class:"fake-table"},{default:l(()=>[t.config.columns.length?M("",!0):(i(),T(j,{key:"empty",style:{padding:"10px 40px"},"image-size":120,description:"请添加表格列"})),(i(!0),S(I,null,te(y.value.drag,(q,z)=>(i(),S("div",{key:q.prop,"data-key":q.prop,class:"fake-table-item",draggable:y.value.drag.length>1,style:$e(_(q)),onDragstart:$=>D(H)(z),onDragover:$=>D(Q)($,z),onDrop:v[0]||(v[0]=$=>D(R)())},[k("div",Vl,[Dl,e(ot,{column:q},null,8,["column"])]),k("div",$l,[e(r,{trigger:"click"},{dropdown:l(()=>[e(a,null,{default:l(()=>[(i(),S(I,null,te(d,$=>e(W,{key:$.key,onClick:ie=>$.click(z)},{default:l(()=>[k("i",{class:re(["el-icon--left",$.icon])},null,2),L(" "+oe($.label),1)]),_:2},1032,["onClick"])),64))]),_:2},1024)]),default:l(()=>[e(x,{link:"",type:"primary"},{default:l(()=>[L(" 配置列 "),Sl]),_:1})]),_:2},1024)]),k("div",Cl,[q.cellType==="text"?(i(),S(I,{key:0},[L("文本内容")],64)):q.cellType==="js"?(i(),S("span",Tl,"自定义代码")):M("",!0),e(D(et),{column:q,src:p},null,8,["column"])])],44,xl))),128)),F.value?(i(),S("div",{style:$e(_(F.value)),key:D(ve),class:"fake-table-item"},[El,k("div",Ml,[e(E,{effect:"dark",content:"配置【操作按钮】和【操作列】的宽度",placement:"top"},{default:l(()=>[e(x,{circle:"",plain:"",type:"primary",size:"small",onClick:v[1]||(v[1]=q=>G())},{default:l(()=>[Ul]),_:1})]),_:1}),e(x,{circle:"",plain:"",type:"danger",size:"small",onClick:v[2]||(v[2]=q=>n())},{default:l(()=>[Ol]),_:1})]),k("div",Nl,[t.config.actions.length?(i(),T(b,{key:0,row:{},index:1,actions:t.config.actions},null,8,["actions"])):(i(),T(Z,{key:1,type:"info"},{default:l(()=>[L("待添加操作~")]),_:1}))])],4)):M("",!0),k("div",Bl,[k("div",null,[k("p",null,[e(x,{type:"primary",text:"",onClick:v[3]||(v[3]=q=>P("add"))},{default:l(()=>[Wl,L(" 添加内容列 ")]),_:1})]),F.value?M("",!0):(i(),S("p",ql,[e(x,{type:"primary",text:"",onClick:v[4]||(v[4]=q=>B())},{default:l(()=>[Fl,L(" 添加操作列 ")]),_:1})]))])])]),_:1}))]),K.show?M("",!0):(i(),T(D(Qe),{key:1,type:K.type,onAction:v[5]||(v[5]=q=>N("action",q))},null,8,["type"])),e(tl,{show:m.show,"onUpdate:show":v[6]||(v[6]=q=>m.show=q),type:m.type,keys:m.keys,form:m.form,onSubmit:J},null,8,["show","type","keys","form"]),e(il,{show:A.show,"onUpdate:show":v[7]||(v[7]=q=>A.show=q),"select-key":A.keyword,onSubmit:g},null,8,["show","select-key"]),e(kl,{show:Y.show,"onUpdate:show":v[8]||(v[8]=q=>Y.show=q),columnWidth:Y.columnWidth,actionMax:Y.actionMax,list:t.config.actions,onSubmit:O},null,8,["show","columnWidth","actionMax","list"])],64)}}}),Yl={class:"the-curd-example"},jl={name:"Example"},Jl=se({...jl,props:{selected:{type:String},type:{type:String}},emits:["choose"],setup(u,{emit:c}){const t=u,N=c,p=[{...ue("input"),placeholder:ce.input},{...ue("select"),placeholder:ce.select},{...ue("select-multiple"),placeholder:ce["select-multiple"]},{...ue("cascader"),placeholder:ce.cascader},{...ue("date"),placeholder:ce.date},{...ue("checkbox"),options:[{label:"多选-A",value:1},{label:"多选-B",value:2}],defaultValue:[1]},{...ue("radio"),options:[{label:"单选-A",value:"radio-1"},{label:"单选-B",value:"radio-2"}],defaultValue:"radio-1"},{...ue("switch"),defaultValue:!0},{...ue("textarea"),placeholder:ce.textarea},{...ue("input-between"),placeholder:["范围区间操作","范围区间操作"]}],d=["radio","checkbox","textarea","switch"],m=X(()=>t.type==="search"?p.filter(y=>!d.includes(y.type)):p);return(y,P)=>(i(),S("div",Yl,[(i(!0),S(I,null,te(m.value,J=>(i(),T(xe,{key:J.type,"field-data":J,class:re(["the-curd-example-item fvc",{"the-curd-selected":t.selected===J.type}]),readonly:"",onClick:U=>N("choose",J.type)},null,8,["field-data","class","onClick"]))),128))]))}}),Il={key:0,class:"the-curd-editor-content"},Pl=k("h2",{class:"the-title mgb-20"},"基础设置",-1),Rl={class:"f-vertical f-between mgb-20"},Hl=k("h2",{class:"the-title"},"第1步：点击选取组件",-1),zl={class:"f-vertical mgb-20"},Kl={class:"the-title"},Gl=k("div",{class:"f1"},null,-1),Zl={key:0,class:"the-curd-target-box"},Xl=k("i",{class:"el-icon-question the-tips-icon mgl-10"},null,-1),Ql=k("a",{href:"https://www.json.cn/",target:"_blank"}," JSON编辑工具 ",-1),eo={class:"f-right"},to=k("i",{class:"el-icon--left el-icon-plus"},null,-1),lo=k("i",{class:"el-icon--left el-icon-edit"},null,-1),oo={name:"Editor"},no=se({...oo,props:{show:{type:Boolean,default:!1},config:{type:Object,required:!0}},emits:["update:show"],setup(u,{emit:c}){const t=u,N=c;function p(){N("update:show",!1)}const d=["checkbox","radio","switch"],m=["select","select-multiple","radio","checkbox","cascader"],y=["input","textarea","select","radio"],P=["input-between","select-multiple","checkbox","cascader"],J=["input","select","radio"],U=["daterange","datetimerange"],H=J.concat(P),Q=`<p>参考 src/utils/index.ts 中的${le("formatDate")}函数</p>`,R=`
<p>动态表单项的条件显示逻辑函数；</p>
<p>返回${le("false")}则不展示对应项；</p>
<p>函数有一个参数：${le("formData")}为当前表单的数据值；</p>
<p>以${le("return")}为函数代码片段标记；</p>
<p>例如：${le("return formData.type !== 2")}</p>
`,_=Ne(),F=X(()=>_.editor.action==="add"),B=X(()=>{let a=[];return n.formData&&n.formData.type==="date"&&(a=We[n.formData.dateType].map((E,b)=>({label:E.text,value:b}))),a.unshift({label:"将预览组件中的值设为默认",value:-1}),a}),n=ne({step:0,formData:void 0});function A(a){n.step=a}const w={label:{required:!0,message:"请输入功能标题",trigger:"blur"},key:{required:!0,trigger:"blur",validator(a,r,E){r?x.includes(r)?E(new Error("当前键值已经被占用！")):E():E(new Error("绑定的键值不能为空"))}},format:{required:!0,message:"格式化规则不能为空",trigger:"blur"},separator:{required:!0,message:"请输入串联符号",trigger:"blur"},defaultValue:{required:!0,trigger:"blur",validator(a,r,E){const b=K();b===!0?E():E(new Error(b)),E()}},options:{required:!0,trigger:"blur",validator(a,r,E){const b=C();b===!0?E():E(new Error(b))}}},g=_e(),Y=ne({options:"",defaultValue:""});function G(a){a.type!=="date"&&(Y.defaultValue=JSON.stringify({value:a.defaultValue})),m.includes(a.type)&&(Y.options=JSON.stringify(a.options))}function O(a){var b;const r=_.editor,E=ue(a,"",r.type==="search");n.formData=E,G(E),(b=g.value)==null||b.clearValidate(),A(1)}function K(){const a='输入的格式必须为 { "value": "input value" }',r=Y.defaultValue;if(!r)return a;const E=n.formData.type,b=n.formData.valueType,Z=ce[E];try{const q=JSON.parse(r);if(!ee(q,"object"))return a;if(E==="switch"&&!ee(q.value,"boolean"))return`${Z}的绑定值应该为 boolean 类型`;if(P.includes(E)){if(!ee(q.value,"array"))return`${Z}的绑定值应该为 array 类型`;if(b==="array<number>"&&q.value.some(z=>z!==""&&!ee(z,"number")))return"数组中只能出现数字"}if(y.includes(E)&&!["string","number"].includes(Ee(q.value)))return`${Z}的绑定值应该为 string/number 类型`;if(E==="date"){const z=n.formData;if(U.includes(z.dateType)){if(!ee(q.value,"array"))return"范围日期绑定值应该为 array 类型"}else if(!ee(q.value,"string"))return"日期类型绑定值应该为 string 类型"}if(J.includes(E)&&b==="number"&&q.value!==""&&!ee(q.value,"number"))return`${Z}的绑定值应该为 number 类型`}catch(q){return console.warn("checkDefaultValue >>",q),a}return!0}function C(){const a=Y.options;if(!a)return"选项数据不能为空！";try{const r=JSON.parse(a);if(!ee(r,"array"))return"选项数据格式不正确，需要为数组类型！";const E=n.formData,b=E.optionSetting.value||"value",Z=[void 0,null];for(let q=0;q<r.length;q++){const z=r[q];if(!ee(z,"object"))return"数组项必须为对象！";if(Z.includes(z[b]))return`数组项的值不能为${Z.join("/")}`;if(["array<number>","number"].includes(E.valueType)&&!ee(z[b],"number")&&z[b]!=="")return"数组项的值必须为 number 类型"}return!0}catch(r){return console.warn("checkOptions >>",r),"不合法的JSON,注意使用双引号,结尾不能为逗号等"}}function f(){C()===!0&&(n.formData.options=JSON.parse(Y.options))}function o(){if(K()===!0){const r=n.formData,E=JSON.parse(Y.defaultValue).value;r.type!=="date"&&(r.defaultValue=E)}}function s(a){const r=Pe.find(b=>b.value===a),E=n.formData;E.shortcutIndex="",U.includes(r.value)?(E.value=[],E.valueType="array"):(E.value="",E.valueType="string"),E.formatShow=r.formatShow,E.format=r.format}function v(a){return/^[+-]?(\d|([1-9]\d+))(\.\d+)?$/.test(a)}function j(){var a;(a=g.value)==null||a.validate(r=>{if(mt("#the-editor-form",r),!r)return;o(),m.includes(n.formData.type)&&f();const E=_.editor,b=JSON.parse(JSON.stringify(n.formData));if(m.includes(b.type)&&f(),b.valueType||(b.valueType=Ee(b.defaultValue)),m.includes(b.type)&&["number","array<number>"].includes(b.valueType)){let q=b.optionSetting.value;q||(q="value",b.optionSetting.value=q);for(let z=0;z<b.options.length;z++){const $=b.options[z],ie=$[q];if([null,void 0].includes(ie))return pe.error("数据值字段与选项数据不匹配，请检查！");if(v(ie.toString()))$[q]=Number(ie);else{const de=$[b.optionSetting.label];return pe.error(`选项数据中【${de}】的值应该为数字！`)}}}b.type==="date"&&!ee(b.shortcutIndex,"number")&&(b.value=b.valueType==="array"?[]:""),{search(q){q?t.config.search.list.push(b):t.config.search.list[E.index]=b},table(q){if(q){const z=JSON.parse(JSON.stringify(E.form.fields));z.push(b),E.form.fields=z}else{const z=JSON.parse(JSON.stringify(E.form.fields));z[E.index]=b,E.form.fields=z}}}[E.type](F.value),p()})}let x=[];function W(a){const r=_.editor;x=[],{search(){x=t.config.search.list.map(b=>b.key)},table(){x=r.form.fields.map(b=>b.key)}}[r.type](),a&&(x=x.filter(b=>b!==a))}return be(()=>t.show,function(a){if(!a){n.formData=void 0;return}const r=_.editor;if(r.action==="add")n.step=0,n.formData=void 0,W();else{const E=r.index;({search(){n.formData=JSON.parse(JSON.stringify(t.config.search.list[E]))},table(){var Z;n.formData=JSON.parse(JSON.stringify((Z=r.form)==null?void 0:Z.fields[E]))}})[r.type](),G(n.formData),W(n.formData.key),n.step=1}}),(a,r)=>{const E=h("el-input-number"),b=h("el-form-item"),Z=h("el-switch"),q=h("el-form"),z=h("el-button"),$=h("el-input"),ie=h("el-text"),de=h("el-tooltip"),qe=h("el-option"),Fe=h("el-select");return i(),S("section",{class:re(["the-curd-editor the-curd-scrollbar",{"is-show":t.show}])},[e(rt,{name:"the-curd-editor-move"},{default:l(()=>{var Le;return[t.show?(i(),S("div",Il,[Pl,e(q,{"label-position":"right","label-width":"120px"},{default:l(()=>[D(_).editor.type==="search"?(i(),S(I,{key:0},[e(b,{label:"整体标题宽度"},{default:l(()=>[e(E,{modelValue:t.config.search.labelWidth,"onUpdate:modelValue":r[0]||(r[0]=V=>t.config.search.labelWidth=V),class:"w-full","controls-position":"right",placeholder:"例如：120px"},null,8,["modelValue"])]),_:1}),e(b,{label:"标题靠右对齐"},{default:l(()=>[e(Z,{modelValue:t.config.search.labelRight,"onUpdate:modelValue":r[1]||(r[1]=V=>t.config.search.labelRight=V),"inline-prompt":"","active-text":"是","inactive-text":"否"},null,8,["modelValue"])]),_:1})],64)):M("",!0),D(_).editor.type==="table"&&D(_).editor.form?(i(),S(I,{key:1},[e(b,{label:"表单宽度"},{default:l(()=>[e(E,{modelValue:D(_).editor.form.width,"onUpdate:modelValue":r[2]||(r[2]=V=>D(_).editor.form.width=V),class:"w-full","controls-position":"right",placeholder:"请输入宽度(px)",clearable:""},null,8,["modelValue"])]),_:1}),e(b,{label:"文字宽度"},{default:l(()=>[e(E,{modelValue:D(_).editor.form.labelWidth,"onUpdate:modelValue":r[3]||(r[3]=V=>D(_).editor.form.labelWidth=V),class:"w-full","controls-position":"right",placeholder:"请输入标题宽度(px)",clearable:""},null,8,["modelValue"])]),_:1}),e(b,{label:"文字靠右排版"},{default:l(()=>[e(Z,{modelValue:D(_).editor.form.labelPosition,"onUpdate:modelValue":r[4]||(r[4]=V=>D(_).editor.form.labelPosition=V),"inline-prompt":"","active-value":"right","inactive-value":"left","active-text":"是","inactive-text":"否"},null,8,["modelValue"])]),_:1})],64)):M("",!0)]),_:1}),n.step===0?(i(),S(I,{key:0},[k("div",Rl,[Hl,e(z,{link:"",type:"primary",onClick:r[5]||(r[5]=V=>p())},{default:l(()=>[L("退出编辑")]),_:1})]),e(Jl,{selected:(Le=n.formData)==null?void 0:Le.type,type:D(_).editor.type,onChoose:O},null,8,["selected","type"])],64)):M("",!0),n.step===1?(i(),S(I,{key:1},[k("div",zl,[k("h2",Kl,"第2步：配置"+oe(D(ce)[n.formData.type]),1),Gl,e(z,{link:"",type:"success",onClick:r[6]||(r[6]=V=>A(0))},{default:l(()=>[L("上一步")]),_:1}),e(z,{link:"",type:"primary",onClick:r[7]||(r[7]=V=>p())},{default:l(()=>[L("退出编辑")]),_:1})]),n.formData?(i(),S("div",Zl,[e(xe,{"field-data":n.formData,"edit-mode":""},null,8,["field-data"])])):M("",!0),n.formData?(i(),T(q,{key:1,id:"the-editor-form",ref_key:"formRef",ref:g,model:n.formData,rules:w,"label-position":"right","label-width":"128px"},{default:l(()=>[e(b,{label:"组件标题",prop:"label"},{default:l(()=>[e($,{modelValue:n.formData.label,"onUpdate:modelValue":r[8]||(r[8]=V=>n.formData.label=V),clearable:"",placeholder:w.label.message},null,8,["modelValue","placeholder"])]),_:1}),e(b,{label:"绑定的键值",prop:"key"},{default:l(()=>[e($,{modelValue:n.formData.key,"onUpdate:modelValue":r[9]||(r[9]=V=>n.formData.key=V),clearable:"",placeholder:"请输入绑定的键值"},null,8,["modelValue"])]),_:1}),e(b,{label:"标题宽度",prop:"labelWidth"},{default:l(()=>[e(E,{modelValue:n.formData.labelWidth,"onUpdate:modelValue":r[10]||(r[10]=V=>n.formData.labelWidth=V),class:"w-full","controls-position":"right",placeholder:"请输入宽度，例如：120"},null,8,["modelValue"])]),_:1}),d.includes(n.formData.type)?M("",!0):(i(),T(b,{key:0,label:"组件宽度",prop:"valueWidth"},{default:l(()=>[e(E,{modelValue:n.formData.valueWidth,"onUpdate:modelValue":r[11]||(r[11]=V=>n.formData.valueWidth=V),class:"w-full","controls-position":"right",placeholder:"请输入宽度，例如：140"},null,8,["modelValue"])]),_:1})),e(b,{label:"提示/规则文字",prop:"placeholder"},{default:l(()=>[n.formData.type==="input-between"?(i(),S(I,{key:0},[e($,{modelValue:n.formData.placeholder[0],"onUpdate:modelValue":r[12]||(r[12]=V=>n.formData.placeholder[0]=V),class:"f1",clearable:"",placeholder:"请输入提示-1"},null,8,["modelValue"]),e(ie,{style:{padding:"0 6px"}},{default:l(()=>[L("-")]),_:1}),e($,{modelValue:n.formData.placeholder[1],"onUpdate:modelValue":r[13]||(r[13]=V=>n.formData.placeholder[1]=V),class:"f1",clearable:"",placeholder:"请输入提示-2"},null,8,["modelValue"])],64)):(i(),T($,{key:1,modelValue:n.formData.placeholder,"onUpdate:modelValue":r[14]||(r[14]=V=>n.formData.placeholder=V),clearable:"",placeholder:"请输入规则提示/输入框提示文字"},null,8,["modelValue"]))]),_:1}),e(b,{label:"是否必填",prop:"required"},{default:l(()=>[e(Z,{modelValue:n.formData.required,"onUpdate:modelValue":r[15]||(r[15]=V=>n.formData.required=V),"inline-prompt":"","active-text":"是","inactive-text":"否"},null,8,["modelValue"])]),_:1}),D(H).includes(n.formData.type)?(i(),T(b,{label:"绑定值为数字类型",key:"is-number"},{default:l(()=>[P.includes(n.formData.type)?(i(),T(Z,{key:0,modelValue:n.formData.valueType,"onUpdate:modelValue":r[16]||(r[16]=V=>n.formData.valueType=V),"inline-prompt":"","active-text":"是","inactive-text":"否","active-value":"array<number>","inactive-value":"array"},null,8,["modelValue"])):(i(),T(Z,{key:1,modelValue:n.formData.valueType,"onUpdate:modelValue":r[17]||(r[17]=V=>n.formData.valueType=V),"inline-prompt":"","active-text":"是","inactive-text":"否","active-value":"number","inactive-value":"string"},null,8,["modelValue"])),m.includes(n.formData.type)?(i(),T(de,{key:2,effect:"dark",content:"设为数字类型之后，将会在保存时校验选项数据",placement:"top"},{default:l(()=>[Xl]),_:1})):M("",!0)]),_:1})):M("",!0),n.formData.type!=="date"?(i(),T(b,{key:2,label:"组件默认值",prop:"defaultValue"},{default:l(()=>[e($,{modelValue:Y.defaultValue,"onUpdate:modelValue":r[18]||(r[18]=V=>Y.defaultValue=V),type:"textarea",clearable:"",placeholder:"请输入JSON，值为 value",onBlur:r[19]||(r[19]=V=>o())},null,8,["modelValue"])]),_:1})):M("",!0),n.formData.type==="input-between"?(i(),T(b,{key:3,label:"串联符号",prop:"separator"},{default:l(()=>[e($,{modelValue:n.formData.separator,"onUpdate:modelValue":r[20]||(r[20]=V=>n.formData.separator=V),clearable:"",placeholder:w.separator.message},null,8,["modelValue","placeholder"])]),_:1})):M("",!0),m.includes(n.formData.type)?(i(),S(I,{key:4},[e(b,{label:"选项数据",prop:"options"},{default:l(()=>[e($,{modelValue:Y.options,"onUpdate:modelValue":r[21]||(r[21]=V=>Y.options=V),type:"textarea",autosize:{minRows:2,maxRows:10},placeholder:"请输入数组JSON",style:{"margin-bottom":"4px"},onBlur:r[22]||(r[22]=V=>f())},null,8,["modelValue"]),e(z,{link:"",type:"primary"},{default:l(()=>[Ql]),_:1})]),_:1}),e(b,{label:"数据展示字段",prop:"optionSetting.label"},{default:l(()=>[e($,{modelValue:n.formData.optionSetting.label,"onUpdate:modelValue":r[23]||(r[23]=V=>n.formData.optionSetting.label=V),clearable:"",placeholder:"不填则使用 label"},null,8,["modelValue"])]),_:1}),e(b,{label:"数据值字段",prop:"optionSetting.value"},{default:l(()=>[e($,{modelValue:n.formData.optionSetting.value,"onUpdate:modelValue":r[24]||(r[24]=V=>n.formData.optionSetting.value=V),clearable:"",placeholder:"不填则使用 value"},null,8,["modelValue"])]),_:1}),n.formData.type==="cascader"?(i(),S(I,{key:0},[e(b,{label:"下级字段",prop:"optionSetting.children"},{default:l(()=>[e($,{modelValue:n.formData.optionSetting.children,"onUpdate:modelValue":r[25]||(r[25]=V=>n.formData.optionSetting.children=V),clearable:"",placeholder:"不填则使用 children"},null,8,["modelValue"])]),_:1}),e(b,{label:"是否多选",prop:"multiple"},{default:l(()=>[e(Z,{modelValue:n.formData.multiple,"onUpdate:modelValue":r[26]||(r[26]=V=>n.formData.multiple=V),"inline-prompt":"","active-text":"是","inactive-text":"否"},null,8,["modelValue"])]),_:1}),e(b,{label:"允许只选中某一项",prop:"checkStrictly"},{default:l(()=>[e(Z,{modelValue:n.formData.checkStrictly,"onUpdate:modelValue":r[27]||(r[27]=V=>n.formData.checkStrictly=V),"inline-prompt":"","active-text":"是","inactive-text":"否"},null,8,["modelValue"])]),_:1})],64)):M("",!0)],64)):M("",!0),n.formData.type==="date"?(i(),S(I,{key:5},[e(b,{label:"日期类型",prop:"dateType"},{default:l(()=>[e(Fe,{modelValue:n.formData.dateType,"onUpdate:modelValue":r[28]||(r[28]=V=>n.formData.dateType=V),class:"w-full",onChange:s},{default:l(()=>[(i(!0),S(I,null,te(D(Pe),V=>(i(),T(qe,{key:V.value,label:V.label,value:V.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(b,{label:"日期默认值",prop:"shortcutIndex"},{default:l(()=>[e(Fe,{modelValue:n.formData.shortcutIndex,"onUpdate:modelValue":r[29]||(r[29]=V=>n.formData.shortcutIndex=V),class:"w-full",placeholder:"请选择",clearable:""},{default:l(()=>[(i(!0),S(I,null,te(B.value,V=>(i(),T(qe,{key:V.value,label:V.label,value:V.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(b,{prop:"format"},{label:l(()=>[e(D(ge),{label:"格式化规则",tips:Q})]),default:l(()=>[e($,{modelValue:n.formData.format,"onUpdate:modelValue":r[30]||(r[30]=V=>n.formData.format=V),clearable:"",placeholder:w.format.message},null,8,["modelValue","placeholder"])]),_:1})],64)):M("",!0),D(_).editor.type==="table"?(i(),T(b,{key:6,prop:"show"},{label:l(()=>[e(D(ge),{label:"表单显示逻辑",tips:R})]),default:l(()=>[e($,{modelValue:n.formData.show,"onUpdate:modelValue":r[31]||(r[31]=V=>n.formData.show=V),type:"textarea",placeholder:"请输入条件代码，为空则默认展示"},null,8,["modelValue"])]),_:1})):M("",!0),k("div",eo,[e(z,{onClick:r[32]||(r[32]=V=>p())},{default:l(()=>[L("关闭")]),_:1}),F.value?(i(),T(z,{key:0,type:"primary",onClick:r[33]||(r[33]=V=>j())},{default:l(()=>[to,L(" 新增 ")]),_:1})):(i(),T(z,{key:1,type:"success",onClick:r[34]||(r[34]=V=>j())},{default:l(()=>[lo,L(" 确认 ")]),_:1}))])]),_:1},8,["model"])):M("",!0)],64)):M("",!0)])):M("",!0)]}),_:1})],2)}}}),ao={class:"the-curd-main-page"},io={key:0,class:"the-tag blue"},ro=k("i",{class:"el-icon-arrow-left"},null,-1),so=k("p",{class:"mgb-10"},"配置筛选相关功能",-1),uo=k("p",null,"配置表格相关功能",-1),co={name:"Curd"},go=se({...co,props:{data:{type:Object,required:!0},action:{type:Object,required:!0}},setup(u){const c=u,t=ne({loading:!1,editor:{show:!1,type:void 0,form:void 0,action:"add",index:-1},showEntrance:!1}),N=X(()=>{const f=t.editor.type;return f==="search"||!f&&c.data.search.list.length>0});st(Ke,t);let p;function d(f){t.editor.type=f,t.editor.show=!1,t.editor.index=-1,t.showEntrance=!1,p={[f]:ae(c.data[f])}}function m(f){const o=t.editor.type;f&&p&&(c.data[o]=p[o]),t.editor.index=-1,t.editor.show=!1,t.editor.type=void 0,t.editor.form=void 0,p=void 0}function y(){m()}function P(){je(JSON.stringify(c.data),()=>pe.success("复制成功！"))}function J(f){f==="reset"&&c.data.search.list.forEach(Be),U.pageInfo.currentPage=1,U.selectList=[],O()}const U=ne({selectList:[],data:[],pageInfo:pt(),formShow:!1,formType:"add",formLoading:!1}),H=X(()=>c.data.table),Q=X(()=>H.value.columns.filter(o=>o.visible).map(o=>{const s={...o};return s.cellType==="js"&&s.jsCode&&(s.rawContent=function(v,j){let x="";try{x=new Function("cellValue","row",s.jsCode)(v,j)}catch(W){console.warn("解析 rawContent 代码错误 >>",W),x="-"}return x}),s})),R=X(()=>H.value.actions.map(o=>{const s={...o};return s.key===fe&&(s.click=w),s})),_=X(()=>{const f=[],o=[];return Q.value.forEach(s=>{s.slotHead&&f.push(s.slotHead),s.slot&&o.push(s.slot)}),{head:f,cell:o}});function F(f){return H.value.columns.find(s=>s.prop===f)||{}}const B=_e(),n=X(()=>{const f=H.value,o={title:"编辑表单",config:f.formEdit||{}};return U.formType==="add"&&(o.title="新增表单",o.config=f.formAdd||{}),o});let A=null;function w(f){f?(U.formType="edit",A=f):U.formType="add",U.formShow=!0,setTimeout(()=>{var o;return(o=B.value)==null?void 0:o.clear()}),He(()=>{var o;return A&&((o=B.value)==null?void 0:o.setFormData(A))})}function g(){var f;U.formShow=!1,(f=B.value)==null||f.reset(),A=null}function Y(){var f;(f=B.value)==null||f.validate(async(o,s)=>{if(U.formType==="add"&&c.action.onAdd){U.formLoading=!0;const v=await c.action.onAdd(o,s);if(U.formLoading=!1,v.code!==1)return;g(),O()}if(U.formType==="edit"&&c.action.onEdit){U.formLoading=!0;const v=await c.action.onEdit(o,s);if(U.formLoading=!1,v.code!==1)return;g(),O()}})}function G(f){const o=c.data.search.list,s={};for(let W=0;W<o.length;W++){const a=o[W],r=Ze(a);if(a.required&&ee(r.result,"string"))return yt(document.querySelector(`.${a.id}`)),pe.error(r.result),f&&f.key==="page"&&(U.pageInfo=f.before),null;r.result===!0&&(s[a.key]=r.value)}const v=H.value.columns,j=[],x=[];return f&&f.key==="sort"?v.forEach(W=>{W.sort&&(W.prop===f.prop?W.sort=f.action:W.sort=!0),W.sort==="asc"&&j.push(W.prop),W.sort==="desc"&&x.push(W.prop)}):v.forEach(W=>{W.sort==="asc"&&j.push(W.prop),W.sort==="desc"&&x.push(W.prop)}),j.length&&(s.asc=j.toString()),x.length&&(s.desc=x.toString()),s}async function O(f){const o=G(f);if(!o)return;const s=JSON.parse(JSON.stringify(U.pageInfo));t.loading=!0;const v=await c.action.getTableData(o,s);t.loading=!1,v.code===1&&(U.pageInfo.total=v.data.total,U.data=v.data.list||[])}function K(f){const o=U.selectList;switch(f){case"add":w();break;case"delete":if(!o.length)return pe.error("请选择要删除的列表再进行操作~");ye({title:"操作提示",content:`是否删除选中的 ${o.length} 条数据？`,cancelText:"取消",async confirm(){c.action.onDelete?(t.loading=!0,(await c.action.onDelete(JSON.parse(JSON.stringify(U.selectList)))).code===1?(pe.success("删除成功！"),U.selectList=[],O()):t.loading=!1):pe.info("请设置 action.onDelete 删除逻辑")}});break;case"export":c.action.onExport?c.action.onExport():pe.info("请设置 action.onExport 导出逻辑");break}}function C(f){({exit:()=>m(!0),copy:P,complete:y})[f]()}return gt({formatDate:Me,copyText:je,messageBox:ye,message:pe,jsonToPath:ft,request:vt,getData:O,state:t}),ze(function(){c.action.created&&H.value.columns.length&&c.action.created(O)}),(f,o)=>{const s=h("base-table"),v=h("base-pagination"),j=h("el-button"),x=h("el-empty"),W=h("base-dialog");return i(),S("div",ao,[k("section",{class:re([t.editor.show?"f1":"w-full"])},[N.value?(i(),T($t,{key:0,data:c.data.search,onSearch:J},null,8,["data"])):M("",!0),t.editor.type==="table"?(i(),T(Al,{key:1,config:H.value,onAction:C},null,8,["config"])):t.editor.type==="search"?(i(),T(D(Qe),{key:2,onAction:C})):(i(),S(I,{key:3},[H.value.columns.length>0?(i(),S(I,{key:0},[e(tt,{config:H.value,disabled:t.loading,onAction:K},{default:l(()=>[H.value.selectKey?(i(),S("span",io," 已选择 "+oe(U.selectList.length)+" 条数据 ",1)):M("",!0)]),_:1},8,["config","disabled"]),e(s,{"select-list":U.selectList,"onUpdate:selectList":o[1]||(o[1]=a=>U.selectList=a),data:U.data,columns:Q.value,actions:R.value,actionMax:H.value.actionMax,loading:t.loading,"select-key":H.value.selectKey},Te({_:2},[te(_.value.head,a=>({name:a,fn:l(({$index:r})=>[e(ot,{column:Q.value[H.value.selectKey?r-1:r],onSort:o[0]||(o[0]=(E,b)=>O({key:"sort",prop:E,action:b}))},null,8,["column"])])})),te(_.value.cell,a=>({name:a,fn:l(({row:r})=>[e(D(et),{column:F(a),src:r[a],previewList:_.value.cell.map(E=>r[E])},null,8,["column","src","previewList"])])}))]),1032,["select-list","data","columns","actions","actionMax","loading","select-key"]),e(v,{disabled:t.loading,pageInfo:U.pageInfo,onChange:o[2]||(o[2]=a=>O({key:"page",...a}))},null,8,["disabled","pageInfo"])],64)):(i(),T(x,{key:1,description:"当前页面没有表格配置数据，请配置后再操作~"},{default:l(()=>[e(j,{type:"primary",onClick:o[3]||(o[3]=a=>d("table"))},{default:l(()=>[L("去配置")]),_:1})]),_:1}))],64))],2),e(no,{show:t.editor.show,"onUpdate:show":o[4]||(o[4]=a=>t.editor.show=a),config:c.data},null,8,["show","config"]),e(W,{modelValue:U.formShow,"onUpdate:modelValue":o[7]||(o[7]=a=>U.formShow=a),title:n.value.title,width:D(ke)(n.value.config.width),onClose:o[8]||(o[8]=a=>g())},{footer:l(()=>[e(D(Se),{loading:U.formLoading,onClose:o[5]||(o[5]=a=>g()),onSubmit:o[6]||(o[6]=a=>Y())},null,8,["loading"])]),default:l(()=>[e(lt,{ref_key:"formRef",ref:B,config:n.value.config,type:U.formType,disabled:U.formLoading},null,8,["config","type","disabled"])]),_:1},8,["modelValue","title","width"]),!t.showEntrance&&!t.editor.type?(i(),T(j,{key:0,class:"the-curd-entrance",type:"primary",size:"small",onClick:o[9]||(o[9]=a=>t.showEntrance=!0)},{default:l(()=>[ro]),_:1})):M("",!0),e(W,{modelValue:t.showEntrance,"onUpdate:modelValue":o[13]||(o[13]=a=>t.showEntrance=a),title:"请选择配置操作",width:"600px"},{footer:l(()=>[e(j,{onClick:o[12]||(o[12]=a=>t.showEntrance=!1)},{default:l(()=>[L("关 闭")]),_:1})]),default:l(()=>[k("div",{class:"the-curd-entrance-item",onClick:o[10]||(o[10]=a=>d("search"))},[so,e(D(Ct))]),k("div",{class:"the-curd-entrance-item",onClick:o[11]||(o[11]=a=>d("table"))},[uo,e(D(Tt))])]),_:1},8,["modelValue"])])}}});export{go as _,Ue as a,fe as b,ve as c,ue as g};
