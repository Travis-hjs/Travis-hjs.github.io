import{d as se,h as Q,o as We,b,e as n,f as N,k as O,B as ge,p as M,F as X,c as t,g as l,C as A,t as ne,i as f,z as ae,u as S,m as xe,ax as Ve,n as re,N as we,r as ie,w as he,q as Ne,j as be,T as Ke,H as Ge,K as Ze}from"./element-plus-CDxRwxN6.js";import{S as Xe,F as Me,a as Qe}from"./index-CXQMX0x5.js";import{i as Ee,f as de,s as je,d as _e,u as Oe,c as ye,e as Be,h as Ue,a as Te,_ as ve,j as le,k as Se,b as fe,g as ce,l as Ae,m as Ye,p as et}from"./index.vue_vue_type_style_index_0_lang-BpPEtq1Y.js";import{k as oe,l as ue,i as Fe,b as me,u as $e,e as tt,n as qe,a as pe,g as ot,f as lt,c as Le,p as nt}from"./index-DaG8q1li.js";import{v as at,s as it}from"./dom-D4K-_gXQ.js";import{r as st}from"./common-CRYXLZBA.js";const rt=["title"],ut={name:"Field"},ke=se({...ut,props:{fieldData:{type:Object,required:!0},editMode:Boolean,readonly:Boolean,disabled:Boolean},emits:["change"],setup(L,{emit:V}){const e=L,j=V;Ee(e.fieldData);function c(C){let u=C||e.fieldData.value;oe(u,"array")&&(u=ue(u)),j("change",u)}const s=Q(()=>e.fieldData),_=Q(()=>{const C=e.fieldData.optionSetting||{};return{value:C.value||"value",label:C.label||"label"}}),E=Q(()=>{const C=e.fieldData,u=C.optionSetting;return{multiple:C.multiple,checkStrictly:C.checkStrictly,value:u.value||"value",label:u.label||"label",children:u.children||"children"}});function U(C){const u=s.value.placeholder;return{disabled:e.disabled,readonly:e.readonly,clearable:!0,placeholder:oe(C,"number")?u[C]:u}}function k(C){const u=e.fieldData;u.valueType==="number"?(u.value=Fe(C,!0,!0),c(Number(u.value))):(u.value=C,c())}function h(C,u){const K=e.fieldData;K.valueType==="array<number>"?(K.value[u]=Fe(C,!0,!0),c(K.value.map(H=>Number(H)))):(K.value[u]=C,c())}const J=["-",".","",null,void 0];function Y(){const C=e.fieldData;C.valueType==="number"&&(J.includes(C.value)?C.value="":C.value=Number(C.value))}function z(C){const u=e.fieldData;if(u.valueType==="array<number>"){const K=u.value[C];J.includes(K)?u.value[C]="":u.value[C]=Number(K)}}function F(C){const u=C.type==="select-multiple";return{placeholder:C.placeholder,disabled:e.disabled,multiple:C.type==="select-multiple",clearable:!0,filterable:!0,collapseTags:!0,class:`field-item${u?" is-multiple-select":""}`}}function I(C,u){const K=_.value;return C.joinShow?`${u[K.label]}-${u[K.value]}`:`${u[K.label]}`}let x=[];const B="the-date-shortcut-selected";function W(){const C=document.querySelector(`.${B}`);C&&C.classList.remove(B),c()}function $(C){C.classList.add(B)}return We(function(){const C=e.fieldData;if(C.type==="date"){const u=`.${C.id} .el-picker-panel__sidebar`,K=document.querySelector(u);if(!K)return console.warn("找不到日期快捷面板节点！");x=Array.from(K.children),x.forEach(P=>{P.addEventListener("click",()=>$(P))});const H=C.shortcutIndex;oe(H,"number")&&H>=0&&$(x[H])}}),(C,u)=>{const K=b("el-input"),H=b("el-text"),P=b("el-select-v2"),D=b("el-option"),v=b("el-select"),o=b("el-checkbox"),a=b("el-checkbox-group"),w=b("el-radio"),r=b("el-radio-group"),p=b("el-switch"),q=b("el-cascader"),g=b("el-date-picker");return n(),N("div",{class:"the-curd-form-field f-vertical short-value",style:xe({width:S(_e)(s.value.valueWidth)})},[s.value.type==="input"?(n(),O(K,ge({key:0,"model-value":s.value.value},U(),{class:"the-curd-field",onInput:k,onBlur:Y}),null,16,["model-value"])):M("",!0),s.value.type==="textarea"?(n(),O(K,{key:1,modelValue:s.value.value,"onUpdate:modelValue":u[0]||(u[0]=i=>s.value.value=i),readonly:e.readonly,disabled:e.disabled,placeholder:s.value.placeholder,type:"textarea",class:"the-curd-field",onInput:u[1]||(u[1]=i=>c())},null,8,["modelValue","readonly","disabled","placeholder"])):M("",!0),s.value.type==="input-between"?(n(),N(X,{key:2},[t(K,ge({"model-value":s.value.value[0]},U(0),{class:"f1",onInput:u[2]||(u[2]=i=>h(i,0)),onBlur:u[3]||(u[3]=i=>z(0))}),null,16,["model-value"]),t(H,{style:{padding:"0 6px"}},{default:l(()=>[A(ne(s.value.separator),1)]),_:1}),t(K,ge({"model-value":s.value.value[1]},U(1),{class:"f1",onInput:u[4]||(u[4]=i=>h(i,1)),onBlur:u[5]||(u[5]=i=>z(1))}),null,16,["model-value"])],64)):M("",!0),s.value.type==="select"||s.value.type==="select-multiple"?(n(),N(X,{key:3},[s.value.options.length>50?(n(),O(P,ge({key:0,modelValue:s.value.value,"onUpdate:modelValue":u[6]||(u[6]=i=>s.value.value=i),options:s.value.options,props:_.value},F(s.value),{onChange:u[7]||(u[7]=i=>c())}),{default:l(({item:i})=>[f("span",{title:I(s.value,i)},ne(I(s.value,i)),9,rt)]),_:1},16,["modelValue","options","props"])):(n(),O(v,ge({key:1,modelValue:s.value.value,"onUpdate:modelValue":u[8]||(u[8]=i=>s.value.value=i)},F(s.value),{onChange:u[9]||(u[9]=i=>c())}),{default:l(()=>[(n(!0),N(X,null,ae(s.value.options,i=>(n(),O(D,{key:i[_.value.value],value:i[_.value.value],label:I(s.value,i)},null,8,["value","label"]))),128))]),_:1},16,["modelValue"]))],64)):M("",!0),s.value.type==="checkbox"?(n(),N(X,{key:4},[t(a,{modelValue:s.value.value,"onUpdate:modelValue":u[10]||(u[10]=i=>s.value.value=i),disabled:e.disabled,onChange:u[11]||(u[11]=i=>c())},{default:l(()=>[(n(!0),N(X,null,ae(s.value.options,i=>(n(),O(o,{key:i[_.value.value],value:i[_.value.value]},{default:l(()=>[A(ne(i[_.value.label]),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue","disabled"]),e.editMode&&!s.value.options.length?(n(),O(H,{key:0,type:"primary"},{default:l(()=>[A(ne(S(de).checkbox)+"（空数据） ",1)]),_:1})):M("",!0)],64)):M("",!0),s.value.type==="radio"?(n(),N(X,{key:5},[t(r,{modelValue:s.value.value,"onUpdate:modelValue":u[12]||(u[12]=i=>s.value.value=i),disabled:e.disabled,onChange:u[13]||(u[13]=i=>c())},{default:l(()=>[(n(!0),N(X,null,ae(s.value.options,i=>(n(),O(w,{key:i[_.value.value],value:i[_.value.value]},{default:l(()=>[A(ne(i[_.value.label]),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue","disabled"]),e.editMode&&!s.value.options.length?(n(),O(H,{key:0,type:"primary"},{default:l(()=>[A(ne(S(de).radio)+"（空数据） ",1)]),_:1})):M("",!0)],64)):M("",!0),s.value.type==="switch"?(n(),O(p,{key:6,modelValue:s.value.value,"onUpdate:modelValue":u[14]||(u[14]=i=>s.value.value=i),"inline-prompt":"","active-text":"是","inactive-text":"否",onChange:u[15]||(u[15]=i=>c())},null,8,["modelValue"])):M("",!0),s.value.type==="cascader"?(n(),O(q,{key:7,modelValue:s.value.value,"onUpdate:modelValue":u[16]||(u[16]=i=>s.value.value=i),options:s.value.options,props:E.value,placeholder:s.value.placeholder,disabled:e.disabled,clearable:"","collapse-tags":"","collapse-tags-tooltip":"",filterable:"",class:"the-curd-field",onChange:u[17]||(u[17]=i=>c())},null,8,["modelValue","options","props","placeholder","disabled"])):M("",!0),s.value.type==="date"?(n(),O(g,{key:8,modelValue:s.value.value,"onUpdate:modelValue":u[18]||(u[18]=i=>s.value.value=i),placeholder:s.value.placeholder,type:s.value.dateType,format:s.value.formatShow,shortcuts:S(je)[s.value.dateType],disabled:e.disabled,"popper-class":s.value.id.toString(),"range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",class:"the-curd-field",onChange:W},null,8,["modelValue","placeholder","type","format","shortcuts","disabled","popper-class"])):M("",!0)],4)}}}),ct={key:0,class:"el-icon-rank el-icon--left"},dt={style:{"line-height":"1"}},pt={key:0,class:"the-curd-edit-mask f-vertical f-right"},ft=f("i",{class:"el-icon-delete el-icon--left"},null,-1),mt=f("i",{class:"el-icon-edit el-icon--left"},null,-1),yt=f("i",{class:"el-icon-plus"},null,-1),ht={name:"Search"},gt=se({...ht,props:{data:{type:Object,required:!0}},emits:["search"],setup(L,{emit:V}){const e=L,j=V,c=Oe(),s=Q(()=>c.editor.type==="search"&&!c.editor.show);function _(z){const F=e.data.list[z].label||e.data.list[z].key;me({title:"操作提示",content:`是否删除【${F}】？`,cancelText:"取消",confirm(){e.data.list.splice(z,1)}})}function E(z){c.editor.index=z,c.editor.action="edit",c.editor.show=!0}function U(z){return c.editor.index===z&&c.editor.type==="search"&&c.editor.show}function k(){c.editor.index=-1,c.editor.action="add",c.editor.show=!0}const{onDragStart:h,onDragMove:J,onDropEnd:Y}=$e({list:()=>e.data.list,key:"id",findLevel:5});return(z,F)=>{const I=b("el-button"),x=b("el-text");return n(),O(S(Qe),{class:"the-curd-search","label-right":e.data.labelRight,"label-width":S(_e)(e.data.labelWidth)||"auto"},Ve({content:l(()=>[t(we,{name:"the-group",tag:"div",class:"the-filter-content f1"},{default:l(()=>[(n(!0),N(X,null,ae(e.data.list,(B,W)=>(n(),O(S(Me),{key:B.id,"data-key":B.id,class:re([{"the-curd-selected":U(W)},B.id]),label:B.label,"label-width":S(_e)(B.labelWidth),required:B.required,draggable:s.value,onDragstart:$=>S(h)(W),onDragover:$=>S(J)($,W),onDrop:F[0]||(F[0]=$=>S(Y)())},Ve({default:l(()=>[t(ke,{"field-data":B,disabled:S(c).loading},null,8,["field-data","disabled"]),s.value?(n(),N("div",pt,[t(I,{link:"",type:"danger",onClick:$=>_(W)},{default:l(()=>[ft,A(" 删除 ")]),_:2},1032,["onClick"]),t(I,{link:"",type:"success",onClick:$=>E(W)},{default:l(()=>[mt,A(" 编辑 ")]),_:2},1032,["onClick"])])):M("",!0)]),_:2},[S(c).editor.type==="search"?{name:"label",fn:l(()=>[s.value?(n(),N("i",ct)):M("",!0),f("span",dt,ne(B.label),1)]),key:"0"}:void 0]),1032,["data-key","class","label","label-width","required","draggable","onDragstart","onDragover"]))),128)),s.value?(n(),O(S(Me),{key:0},{default:l(()=>[e.data.list.length?M("",!0):(n(),O(x,{key:0,type:"info",style:{"margin-right":"12px"}},{default:l(()=>[A(" 请添加筛选条件~ ")]),_:1})),t(I,{type:"primary",circle:"",onClick:F[1]||(F[1]=B=>k())},{default:l(()=>[yt]),_:1})]),_:1})):M("",!0)]),_:1})]),_:2},[S(c).editor.type?void 0:{name:"right",fn:l(()=>[t(S(Xe),{loading:S(c).loading,onSearch:F[2]||(F[2]=B=>j("search",B))},null,8,["loading"])]),key:"0"}]),1032,["label-right","label-width"])}}});function Ie(L){const V=L.onAction||(()=>{});return t(X,null,[t(b("el-button"),{onClick:()=>V("exit")},{default:()=>[A("退 出")]}),t(b("el-button"),{type:"success",plain:!0,onClick:()=>V("copy")},{default:()=>[t("i",{class:"el-icon-document-copy el-icon--left"},null),A("复制JSON")]}),t(b("el-button"),{type:"primary",onClick:()=>V("complete")},{default:()=>[A("保 存")]})])}function Ce(L){const V=L.onClose||(()=>{}),e=L.onSubmit||(()=>{});return t(X,null,[t(b("el-button"),{onClick:V},{default:()=>[A("取 消")]}),t(b("el-button"),{type:"primary",loading:L.loading,disabled:L.disabledSubmit,onClick:e},{default:()=>[A("确 认")]})])}function vt(L){const V={};return L.imageWidth&&(V.width=`${L.imageWidth}px`),L.imageHeight&&(V.height=`${L.imageHeight}px`),V}function Je(L){function V(){tt({urls:L.previewList?L.previewList:[L.src]})}return L.column.cellType==="image"?t(b("el-image"),{class:"the-table-image",style:vt(L.column),src:L.src,onClick:V,fit:"cover"},null):null}const bt=se({props:{value:{type:[String,Function],default:""}},emits:["update:value"],setup(L,{emit:V}){const e=Q({get(){return typeof L.value=="function"?"":L.value},set(c){V("update:value",c)}}),j="https://element.eleme.cn/#/zh-CN/component/icon";return()=>t("div",{class:"f-vertical w-full"},[t(b("el-input"),{modelValue:e.value,"onUpdate:modelValue":c=>e.value=c,placeholder:"请输入图标 class",class:"mgr-10",clearable:!0},null),t(b("el-button"),{type:"primary",link:!0},{default:()=>[t("a",{href:j,target:"_blank"},[A("去官网复制")])]})])}});function _t(){const L=Array.from({length:6}).map((V,e)=>({id:e}));return t("div",{class:"the-thumbnail-search flex"},[t("div",{class:"the-thumbnail-search-content f1"},[L.map(V=>t("div",{key:V.id,class:"the-thumbnail-search-item"},null))]),t("div",{class:"the-thumbnail-search-btn f-vertical"},[t("i",{class:"el-icon-search"},null)])])}function kt(){return t("section",{class:"the-thumbnail-table"},[t("svg",{width:280,height:180,viewBox:`0 0 ${280*1} ${180*1}`,fill:"none",xmlns:"http://www.w3.org/2000/svg","data-v-d2b0a988":"",class:"the-thumbnail-table-svg"},[t("rect",{width:280,height:180,fill:""},null),t("g",{filter:"url(#filter0_d_13550_224439)"},[t("path",{d:"M65 60C65 58.8954 65.8954 58 67 58H213C214.105 58 215 58.8954 215 60V132C215 133.105 214.105 134 213 134H67C65.8954 134 65 133.105 65 132V60Z",fill:"var(--el-fill-color-blank)"},null),t("path",{d:"M67 57.7C65.7297 57.7 64.7 58.7297 64.7 60V132C64.7 133.27 65.7297 134.3 67 134.3H213C214.27 134.3 215.3 133.27 215.3 132V60C215.3 58.7297 214.27 57.7 213 57.7H67Z",stroke:"var(--el-border-color-dark)","stroke-width":.6*1},null)]),[76,92,108,124].map((j,c)=>t("rect",{key:c,x:71*1,y:j*1,width:16*1,height:4*1,rx:2*1,fill:"var(--el-color-primary)"},null)),[107,143,197].map((j,c)=>[76,92,108,124].map((s,_)=>t("rect",{key:`${c}-${_}`,x:j*1,y:s*1,width:c===2?12*1:20*1,height:4*1,rx:2*1,fill:"var(--el-border-color-dark)"},null))),t("path",{d:"M65 60C65 58.8954 65.8954 58 67 58H213C214.105 58 215 58.8954 215 60V70H65V60Z",fill:"var(--el-border-color-light)"},null),[71,107,143,199].map(j=>t("rect",{key:j,x:j*1,y:63*1,width:10*1,height:2*1,rx:1*1,fill:"var(--el-border-color-dark)"},null)),[85.75,101.75,117.75].map((j,c)=>t("line",{key:c,x1:65*1,y1:j*1,x2:215*1,y2:j*1,stroke:"var(--el-border-color-light)","stroke-width":.5*1},null)),t("defs",null,[t("filter",{id:"filter0_d_13550_224439",x:"51.0666",y:"44.0671",width:177.867*1,height:103.866*1,filterUnits:"userSpaceOnUse","color-interpolation-filters":"sRGB"},[t("feFlood",{"flood-opacity":"0",result:"BackgroundImageFix"},null),t("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"},null),t("feOffset",null,null),t("feGaussianBlur",{stdDeviation:6.66667*1},null),t("feComposite",{in2:"hardAlpha",operator:"out"},null),t("feColorMatrix",{type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.05 0"},null),t("feBlend",{mode:"normal",in2:"BackgroundImageFix",result:"effect1_dropShadow_13550_224439"},null),t("feBlend",{mode:"normal",in:"SourceGraphic",in2:"effect1_dropShadow_13550_224439",result:"shape"},null)])])])])}const wt={class:"w-full f-vertical mgb-10"},$t=f("div",{class:"f1"},null,-1),xt=f("i",{class:"el-icon--left el-icon-delete"},null,-1),Ct=f("i",{class:"el-icon--left el-icon-plus"},null,-1),Dt=f("i",{class:"el-icon--left el-icon-download"},null,-1),St=f("i",{class:"el-icon--left el-icon-setting"},null,-1),Vt={class:"f-vertical f-between mgb-10"},Tt=f("i",{class:"el-icon--left el-icon-refresh-left"},null,-1),Et={key:0,class:"el-icon--left el-icon-rank"},Ot={class:"f1"},Nt={name:"TableOperation"},Pe=se({...Nt,props:{config:{type:Object,required:!0},editMode:{type:Boolean},disabled:{type:Boolean}},emits:["action"],setup(L,{emit:V}){const e=L,j=V;function c(x){j("action",x)}const s={on:"el-icon-success",off:"el-icon-remove-outline"},_=Q(()=>{const x=e.config;return{add:x.formAdd&&x.formAdd.fields.length>0,edit:x.formEdit&&x.formEdit.fields.length>0,delete:!!x.selectKey}}),E=Q(()=>{const x=_.value.delete,B=_.value.add,W=_.value.edit;return[{type:"delete",text:x?"修改删除":"配置删除",icon:x?s.on:s.off,style:x?"primary":"info"},{type:"add",text:B?"修改新增表单":"配置新增表单",icon:B?s.on:s.off,style:B?"primary":"info"},{type:"edit",text:W?"修改编辑表单":"配置编辑表单",icon:W?s.on:s.off,style:W?"primary":"info"}]}),U=[{label:"固定左边",value:"left"},{label:"默认",value:!1},{label:"固定右边",value:"right"}],{onDragStart:k,onDragMove:h,onDropEnd:J}=$e({list:()=>e.config.columns,key:"prop"});function Y(x,B){const W=x.prop===ye,$=x.prop;return{"data-key":$,key:$,draggable:W?void 0:!0,title:W?"操作栏不可排序，只能显示隐藏操作":void 0,onDragstart:W?void 0:()=>k(B),onDragover:W?void 0:C=>h(C,B),onDrop:W?void 0:J}}const z=ie({showFixed:!1});let F=[];function I(){e.config.columns=F}return he(()=>e.config.columns,function(x){e.editMode||(F=ue(x))},{immediate:!0}),(x,B)=>{const W=b("el-button"),$=b("el-checkbox"),C=b("el-radio-button"),u=b("el-radio-group"),K=b("el-switch"),H=b("el-empty"),P=b("el-popover");return n(),N("div",wt,[e.editMode?(n(!0),N(X,{key:0},ae(E.value,D=>(n(),O(W,{key:D.type,type:D.style,link:"",onClick:v=>c(D.type)},{default:l(()=>[f("i",{class:re(["el-icon--left",D.icon])},null,2),A(" "+ne(D.text),1)]),_:2},1032,["type","onClick"]))),128)):M("",!0),Ne(x.$slots,"left"),e.editMode?M("",!0):(n(),N(X,{key:1},[$t,Ne(x.$slots,"right"),_.value.delete?(n(),O(W,{key:0,type:"danger",link:"",disabled:e.disabled,onClick:B[0]||(B[0]=D=>c("delete"))},{default:l(()=>[xt,A(" 删除 ")]),_:1},8,["disabled"])):M("",!0),_.value.add?(n(),O(W,{key:1,type:"primary",link:"",disabled:e.disabled,onClick:B[1]||(B[1]=D=>c("add"))},{default:l(()=>[Ct,A(" 新增 ")]),_:1},8,["disabled"])):M("",!0),t(W,{type:"primary",link:"",disabled:e.disabled,onClick:B[2]||(B[2]=D=>c("export"))},{default:l(()=>[Dt,A(" 导出 ")]),_:1},8,["disabled"]),t(P,{placement:"bottom-start",width:z.showFixed?500:300,transition:"el-zoom-in-top",trigger:"click"},{reference:l(()=>[t(W,{type:"primary",link:"",disabled:e.disabled},{default:l(()=>[St,A(" 表格列设置 ")]),_:1},8,["disabled"])]),default:l(()=>[f("div",Vt,[t($,{modelValue:z.showFixed,"onUpdate:modelValue":B[3]||(B[3]=D=>z.showFixed=D),label:"配置固定列"},null,8,["modelValue"]),t(W,{type:"primary",link:"",onClick:B[4]||(B[4]=D=>I())},{default:l(()=>[Tt,A(" 重置 ")]),_:1})]),t(we,{name:"the-group",tag:"div",class:"the-curd-setting-list the-curd-scrollbar"},{default:l(()=>[(n(!0),N(X,null,ae(e.config.columns,(D,v)=>(n(),N("div",ge({class:"the-curd-option-item f-vertical"},Y(D,v)),[D.prop!==S(ye)?(n(),N("i",Et)):M("",!0),f("span",Ot,ne(D.title),1),z.showFixed?(n(),O(u,{key:1,modelValue:D.fixed,"onUpdate:modelValue":o=>D.fixed=o,size:"small",class:"mgr-10"},{default:l(()=>[(n(),N(X,null,ae(U,o=>t(C,{key:o.value.toString(),value:o.value},{default:l(()=>[A(ne(o.label),1)]),_:2},1032,["value"])),64))]),_:2},1032,["modelValue","onUpdate:modelValue"])):M("",!0),t(K,{modelValue:D.visible,"onUpdate:modelValue":o=>D.visible=o,"inline-prompt":"","active-text":"显示","inactive-text":"隐藏"},null,8,["modelValue","onUpdate:modelValue"])],16))),256)),e.config.columns.length?M("",!0):(n(),O(H,{key:"empty","image-size":120,description:"暂无可以设置的表格列"}))]),_:1})]),_:1},8,["width"])],64))])}}}),Mt={key:0,class:"el-icon-rank el-icon--left",style:{"line-height":"32px"}},Bt={class:"f-vertical w-full"},At=f("i",{class:"el-icon-edit"},null,-1),Ft=f("i",{class:"el-icon-delete"},null,-1),qt=f("i",{class:"el-icon--left el-icon-plus"},null,-1),Lt=f("i",{class:"el-icon--left el-icon-plus"},null,-1),Wt={key:"bottom-setting"},jt=f("i",{class:"el-icon--left el-icon-delete"},null,-1),Ut=f("i",{class:"el-icon--left el-icon-check"},null,-1),It={name:"TableForm"},Re=se({...It,props:{config:{type:Object,default:()=>Be()},type:{type:String},editMode:{type:Boolean},disabled:{type:Boolean}},emits:["change"],setup(L,{expose:V,emit:e}){const j=L,c=e,s=be(),_=Be(),E=ie({config:_,form:{},rules:{}}),U=Oe(),k=Q(()=>j.type==="add"?"新增":"编辑"),h=Q(()=>U.editor.show);function J(D){B(),U.editor.action=D>=0?"edit":"add",U.editor.form=E.config,U.editor.index=D,U.editor.show=!0}function Y(D){const v=E.config.fields;B(),me({title:"操作提示",content:`是否删除【${v[D].label}】？`,cancelText:"取消",confirm(){v.splice(D,1)}})}function z(){me({title:"操作提示",content:`是否移除【${k.value}】表单？移除后将不会出现对应功能按钮。`,cancelText:"取消",confirm(){E.config.fields=[]}})}function F(){c("change")}function I(){const D=j.type==="add"?"编辑":"新增";me({title:"操作提示",content:`是否将表单数据同步到【${D}】表单？`,cancelText:"不同步",confirmText:"同步",cancel(){c("change",E.config)},confirm(){c("change",E.config,!0)}})}function x(D){var v;(v=s.value)==null||v.validate(o=>{if(o&&D){const a=H.value,w={};P.value.forEach(r=>{w[r.key]=a[r.key]}),D(a,w)}})}function B(){var D;(D=s.value)==null||D.clearValidate()}function W(){E.config.fields.forEach(Ee)}function $(D){E.config.fields.forEach(v=>{if(Object.prototype.hasOwnProperty.call(D,v.key)){const o=D[v.key];if(!o)return;switch(v.type){case"date":oe(o,"array")?v.value=o.map(a=>new Date(a)):v.value=new Date(o);break;default:v.value=o;break}}})}const{onDragStart:C,onDragMove:u,onDropEnd:K}=$e({list:()=>E.config.fields,key:"id",findLevel:10});he(()=>j.config,function(D){D&&(E.config=ue(D))},{immediate:!0}),he(()=>E.config.fields,function(D){const v={},o={},a=["input","input-between","textarea"];D&&D.forEach(w=>{v[w.key]=w.value,w.required&&(o[w.key]=[{required:!0,validator(r,p,q){const g=[void 0,null,""];if(w.type==="input-between"&&!w.value[0]&&!w.value[1]){q(new Error("请输入两个范围字段"));return}if(w.valueType==="array"&&!w.value.length){q(new Error(w.placeholder||"请选择"));return}if(w.valueType!=="boolean"&&g.includes(w.value)){const i=a.includes(w.type)?"请输入内容":"请选择";q(new Error(w.placeholder||i));return}q()},trigger:a.includes(w.type)?"blur":"change"}])}),E.form=v,E.rules=o,setTimeout(B)},{immediate:!0});const H=Q(()=>{const D={};return E.config.fields.forEach(v=>{D[v.key]=Ue(v).value}),D}),P=Q(()=>E.config.fields.filter(D=>{const v=D.show;if(!v)return!0;if(oe(v,"function"))return v(H.value);if(v.includes("return"))try{return new Function("formData",v)(H.value)}catch(o){console.warn("解析表单展示逻辑代码错误 >>",o)}return!0}));return V({clear:B,validate:x,reset:W,setFormData:$}),(D,v)=>{const o=b("el-button"),a=b("el-form-item"),w=b("el-empty"),r=b("el-form");return n(),O(r,{ref_key:"formRef",ref:s,model:E.form,rules:E.rules,labelWidth:S(_e)(E.config.labelWidth),labelPosition:E.config.labelPosition,disabled:j.disabled,style:xe(j.editMode?{width:S(_e)(E.config.width)}:null),class:re([{"is-edit-form":j.editMode}])},{default:l(()=>[j.editMode?(n(),N(X,{key:0},[t(we,{name:"the-group",tag:"div"},{default:l(()=>[(n(!0),N(X,null,ae(E.config.fields,(p,q)=>(n(),O(a,{class:re([{"the-curd-selected":S(U).editor.index===q&&h.value}]),prop:p.key,key:p.id,"data-key":p.id,draggable:E.config.fields.length>1&&!S(U).editor.show?!0:null,onDragstart:g=>S(C)(q),onDragover:g=>S(u)(g,q),onDrop:S(K)},{label:l(()=>[E.config.fields.length>1&&!S(U).editor.show?(n(),N("i",Mt)):M("",!0),f("span",null,ne(p.label),1)]),default:l(()=>[f("div",Bt,[t(ke,{class:"mgr-10",fieldData:p,editMode:""},null,8,["fieldData"]),t(o,{link:"",type:"success",disabled:h.value,onClick:g=>J(q)},{default:l(()=>[At]),_:2},1032,["disabled","onClick"]),t(o,{link:"",type:"danger",disabled:h.value,onClick:g=>Y(q)},{default:l(()=>[Ft]),_:2},1032,["disabled","onClick"])])]),_:2},1032,["class","prop","data-key","draggable","onDragstart","onDragover","onDrop"]))),128))]),_:1}),E.config.fields.length?M("",!0):(n(),O(w,{key:0,description:`当前没有表单项，当没有表单项时【${k.value}】功能按钮不会出现~`},{default:l(()=>[h.value?M("",!0):(n(),O(o,{key:0,type:"primary",onClick:v[0]||(v[0]=p=>J(-1))},{default:l(()=>[qt,A(" 添加表单项 ")]),_:1}))]),_:1},8,["description"])),h.value?M("",!0):(n(),N(X,{key:1},[E.config.fields.length?(n(),O(a,{key:"bottom-add"},{default:l(()=>[t(o,{type:"primary",onClick:v[1]||(v[1]=p=>J(-1))},{default:l(()=>[Lt,A(" 继续添加 ")]),_:1})]),_:1})):M("",!0),f("div",Wt,[t(o,{link:"",onClick:v[2]||(v[2]=p=>F())},{default:l(()=>[A(" 退出编辑 ")]),_:1}),t(o,{type:"danger",link:"",disabled:!E.config.fields.length,onClick:v[3]||(v[3]=p=>z())},{default:l(()=>[jt,A(" 清空表单 ")]),_:1},8,["disabled"]),t(o,{type:"success",link:"",onClick:v[4]||(v[4]=p=>I())},{default:l(()=>[Ut,A(" 保存表单 ")]),_:1})])],64))],64)):M("",!0),!j.editMode&&E.config&&E.config.fields?(n(!0),N(X,{key:1},ae(P.value,p=>(n(),O(a,{label:p.label,prop:p.key,key:p.id},{default:l(()=>[t(ke,{fieldData:p},null,8,["fieldData"])]),_:2},1032,["label","prop"]))),128)):M("",!0)]),_:1},8,["model","rules","labelWidth","labelPosition","disabled","style","class"])}}}),Jt={key:1,class:"f-vertical w-full"},Pt=f("i",{class:"el-icon--right el-icon-question the-tips-icon"},null,-1),Rt={key:1,class:"f1 f-right"},Ht={name:"TableHeader"},He=se({...Ht,props:{column:{type:Object,required:!0}},emits:["sort"],setup(L,{emit:V}){const e=L,j=V,c=Q(()=>!e.column.sort&&!e.column.iconTips),s={true:{index:0,icon:"el-icon-sort"},asc:{index:1,icon:"el-icon-sort-up"},desc:{index:2,icon:"el-icon-sort-down"}},_=[!0,"asc","desc"];function E(){const U=e.column.sort.toString();let k=s[U].index;k++,k>=_.length&&(k=0);const h=_[k];j("sort",e.column.prop,h)}return(U,k)=>{const h=b("el-tooltip"),J=b("el-button");return c.value?(n(),N(X,{key:0},[A(ne(e.column.title),1)],64)):(n(),N("div",Jt,[f("span",null,ne(e.column.title),1),e.column.iconTips?(n(),O(h,{key:0,effect:"dark",content:e.column.iconTips,placement:"top"},{default:l(()=>[Pt]),_:1},8,["content"])):M("",!0),e.column.sort?(n(),N("div",Rt,[t(J,{link:"",onClick:E},{default:l(()=>[f("i",{class:re(["el-icon--right",s[e.column.sort.toString()].icon])},null,2)]),_:1})])):M("",!0)]))}}}),zt={name:"TableColumnConfig"},Kt=se({...zt,props:{show:{type:Boolean,required:!0},type:{type:String,required:!0},keys:{type:Array,required:!0},form:Object},emits:["update:show","submit"],setup(L,{emit:V}){const e=L,j=V,c=ie({show:!1,form:Te("","")}),s=Q(()=>({add:"新增",edit:"编辑",copy:"复制"})[e.type]+"表格列"),_=be(),E={title:{required:!0,message:"请输入表格列标题",trigger:"blur"},prop:{required:!0,validator(F,I,x){I?e.keys.includes(c.form.prop)?x(new Error("已经存在相同的值！")):x():x(new Error("输入字段不能为空！"))},trigger:"blur"},cellType:{required:!0,message:"请选择展示类型",trigger:"change"},sort:{required:!0,message:"请选择排序操作",trigger:"change"},jsCode:{required:!0,validator(F,I,x){I?I.includes("return")?x():x(new Error('代码片段必须带有返回字段 "return"')):x(new Error("代码片段不能为空！"))},trigger:"blur"}},U=[{label:"默认普通文本",value:"text"},{label:"图片预览组件",value:"image"},{label:"自定义 js 代码",value:"js"}],k=[{label:"不可排序",value:!1},{label:"可排序",value:!0},{label:"默认升序",value:"asc"},{label:"默认降序",value:"desc"}],h=`
<p>函数代码片段：</p>
<p>第一个参数${le("cellValue")}是表格值;</p>
<p>第二个参数${le("row")}是完整对象;</p>
<p>例如：${le("return cellValue + row.id;")};</p>
<p>也可以是HTML：${le("return `html 标签`")};</p>
`,J=[{label:"表格列标题",prop:"title",type:"input",placeholder:E.title.message},{label:"表格列键值",prop:"prop",type:"input",placeholder:"请输入表格列键值"},{label:"表格列宽度",prop:"width",type:"number",placeholder:"请输入表格列宽度，例如：120（默认自适应）"},{label:"表格列最小宽度",prop:"minWidth",type:"number",placeholder:"请输入表格列最小宽度，例如：120（默认自适应）"},{label:"表格列展示类型",prop:"cellType",type:"select",options:U},{label:"图片宽度",prop:"imageWidth",type:"number",placeholder:"请输入数字（默认80px）",show:()=>c.form.cellType==="image"},{label:"图片高度",prop:"imageHeight",type:"number",placeholder:"请输入数字（默认80px）",show:()=>c.form.cellType==="image"},{label:"js代码",prop:"jsCode",type:"textarea",placeholder:"请输入代码片段",tooltip:h,tips:'例如：return `<span class="the-tag blue">${cellValue || "-"}<span>`;',show:()=>c.form.cellType==="js"},{label:"表格列排序操作",prop:"sort",type:"select",options:k},{label:"内容溢出截断",prop:"tooltip",type:"switch"},{label:"表头提示文字",prop:"iconTips",type:"input",placeholder:"请输入提示文字"}];function Y(){j("update:show",!1)}function z(){var F;(F=_.value)==null||F.validate(I=>{if(!I)return;const x=ue(c.form);["width","minWidth","imageWidth","imageHeight"].forEach(W=>{x[W]&&(x[W]=Number(x[W]))}),x.cellType==="image"&&(x.slot=x.prop),(x.sort||x.iconTips)&&(x.slotHead=`header-${x.prop}`),j("submit",x),Y()})}return he(()=>e.show,function(F){c.show=F,F&&(e.type==="add"?c.form=Te("",""):(c.form=ue(e.form),e.type==="copy"&&(c.form.prop="")),setTimeout(()=>{var I;return(I=_.value)==null?void 0:I.clearValidate()}))},{immediate:!0}),(F,I)=>{const x=b("el-form"),B=b("base-dialog");return n(),O(B,{show:c.show,"onUpdate:show":I[0]||(I[0]=W=>c.show=W),title:s.value,width:"580px",onClose:Y},{footer:l(()=>[t(S(Ce),{onClose:Y,onSubmit:z})]),default:l(()=>[t(x,{ref_key:"formRef",ref:_,model:c.form,rules:E,"label-position":"right","label-width":"130px"},{default:l(()=>[t(S(ve),{data:c.form,list:J},null,8,["data"])]),_:1},8,["model"])]),_:1},8,["show","title"])}}}),Gt=f("p",{class:"mgb-10"},"表格数据中的字段，例如表格数：",-1),Zt=f("p",{class:"mgb-10"},"则键值可以为 id",-1),Xt=f("p",null,[f("i",{class:"el-icon-info el-icon--left"}),A(" 不填则没有删除功能 ")],-1),Qt={name:"TableDeleteConfig"},Yt=se({...Qt,props:{show:{type:Boolean,default:!1},selectKey:{type:String,default:""}},emits:["update:show","submit"],setup(L,{emit:V}){const e=L,j=V,c='[{ id: 1, name: "名称", status: 2 }]',s=ie({show:!1,keyword:""});function _(){j("update:show",!1)}function E(){_(),j("submit",s.keyword)}return he(()=>e.show,function(U){s.show=U,U&&(s.keyword=e.selectKey||"")},{immediate:!0}),(U,k)=>{const h=b("el-input"),J=b("el-form-item"),Y=b("el-form"),z=b("base-dialog");return n(),O(z,{show:s.show,"onUpdate:show":k[1]||(k[1]=F=>s.show=F),title:"配置表格删除功能",width:"400px",onClose:_},{footer:l(()=>[t(S(Ce),{onClose:_,onSubmit:E})]),default:l(()=>[t(Y,{labelPosition:"right",labelWidth:"120px"},{default:l(()=>[t(J,{label:"数据键值"},{default:l(()=>[t(h,{class:"mgb-10",modelValue:s.keyword,"onUpdate:modelValue":k[0]||(k[0]=F=>s.keyword=F),placeholder:"请输入数据键值",clearable:""},null,8,["modelValue"]),f("div",{class:"the-tag blue"},[Gt,f("p",{class:"mgb-10"},ne(c)),Zt,Xt])]),_:1})]),_:1})]),_:1},8,["show"])}}}),eo={class:"flex"},to={class:"f1"},oo={class:"f-right w-full"},lo=f("i",{class:"el-icon--left el-icon-finished"},null,-1),no=f("i",{class:"el-icon--left el-icon-plus"},null,-1),ao=["data-key","draggable","onDragstart","onDragover"],io={key:0,class:"el-icon--left el-icon-rank"},so=f("div",{class:"f1"},null,-1),ro=f("i",{class:"el-icon-delete"},null,-1),uo=f("i",{class:"el-icon-edit"},null,-1),co={key:1,class:"w-full f-right"},po=f("i",{class:"el-icon--left el-icon-plus"},null,-1),fo={name:"TableActionConfig"},mo=se({...fo,props:{show:{type:Boolean,default:!1},list:{type:Array,required:!0},columnWidth:{type:Number},actionMax:{type:Number}},emits:["update:show","submit"],setup(L,{emit:V}){const e=L,j=V,c=`
<p>可以输入代码片段，</p>
<p>以${le("return")}关键字为函数标记，</p>
<p>函数第一个参数${le("row")}是表格对象值</p>
<p>例如：${le('return row.status === 1 ? "下架" : "上架";')}</p>
`,s=`
<p>函数代码片段，点击的时候运行</p>
<p>函数第一个参数${le("row")}是表格对象值</p>
<p>第二个参数${le("index")}是当前索引</p>
<p>例如：${le("console.log(row, index);")}</p>
`,_=`
<p>可以输入代码片段，</p>
<p>以${le("return")}关键字为函数标记，</p>
<p>函数第一个参数${le("row")}是表格对象值</p>
<p>例如：${le("return row.status === 1;")}返回布尔值进行判断</p>
`,E=be(),U=be(),k=ie({show:!1,list:[],index:-1,hasEdit:!1,formEdit:!1}),h=ie({btn:Se(),column:{width:160,max:3}}),J={width:{required:!0,message:"请输入表格列宽度，例如：160",trigger:"blur"},max:{required:!1,message:"请输入数量，超出用“更多”下拉展示",trigger:"blur"}},Y=[{label:"操作列宽度",prop:"width",type:"number",placeholder:J.width.message},{label:"操作按钮限制",prop:"max",type:"number",min:2,placeholder:J.max.message}],z={text:{required:!0,message:"请输入按钮文字",trigger:"blur"},click:{required:!0,message:"请输入按钮操作代码",trigger:"blur"},icon:{required:!1,message:"请输入图标 class",trigger:"blur"},type:{required:!1,message:"请选择按钮类型",trigger:"change"}},F=[{label:"按钮文字",prop:"text",type:"textarea",placeholder:z.text.message,tooltip:c},{label:"按钮功能代码",prop:"click",type:"textarea",placeholder:"请输入代码片段",tooltip:s},{label:"按钮显示条件",prop:"show",type:"textarea",placeholder:"请输入条件代码，为空则默认显示",tooltip:_},{label:"按钮禁用条件",prop:"disabled",type:"textarea",placeholder:"请输入条件代码，为空则默认不禁用",tooltip:_},{label:"按钮图标",prop:"icon",type:"slot",slotName:"iconInput"},{label:"按钮类型",prop:"type",type:"select",options:[{label:"默认（蓝色）",value:"primary"},{label:"成功（绿色）",value:"success"},{label:"警告（橙色）",value:"warning"},{label:"危险（红色）",value:"danger"},{label:"文本（灰色）",value:"info"}]}];function I(){j("update:show",!1)}function x(){U.value.validate(v=>{if(!v)return;I();const{width:o,max:a}=h.column;j("submit",ue(k.list),o,a)})}function B(v){E.value.validate(o=>{if(!o)return;const a=ue(h.btn);v==="add"?k.list.push(a):k.list[k.index]=h.btn,W()})}function W(){k.index=-1,h.btn=Se(),k.formEdit=!1,setTimeout(()=>{var v;return(v=E.value)==null?void 0:v.clearValidate()})}function $(v){const o=k.list[v];h.btn=JSON.parse(JSON.stringify(o)),k.index=v,k.formEdit=!0}function C(v){k.list.splice(v,1)}he(()=>e.show,function(v){k.show=v,v&&(k.list=ue(e.list),k.hasEdit=k.list.some(o=>o.key===fe),k.index=-1,h.btn=Se(),h.column={width:e.columnWidth,max:e.actionMax},setTimeout(()=>{var o,a;(o=E.value)==null||o.clearValidate(),(a=U.value)==null||a.clearValidate()}))},{immediate:!0});const{onDragStart:u,onDragMove:K,onDropEnd:H}=$e({list:()=>k.list,key:"key"});function P(v){if(v.key!=fe&&k.list.length>1&&k.index===-1)return!0}function D(v){const o=v.text;if(oe(o,"string")){if(!o.includes("return"))return o;let a="文字配置有误";try{a=new Function("row",o)({})}catch(w){console.warn("解析按钮文字代码错误 >>",w)}return a}return oe(o,"function")?o({}):"未设置按钮"}return(v,o)=>{const a=b("el-text"),w=b("el-divider"),r=b("el-form"),p=b("el-button"),q=b("el-form-item"),g=b("el-popconfirm"),i=b("el-empty"),te=b("base-dialog");return n(),O(te,{show:k.show,"onUpdate:show":o[6]||(o[6]=m=>k.show=m),title:"配置操作列按钮功能",width:"880px",onClose:I},{footer:l(()=>[t(S(Ce),{disabledSubmit:k.formEdit,onClose:I,onSubmit:x},null,8,["disabledSubmit"])]),default:l(()=>[f("div",eo,[f("section",to,[t(w,{"content-position":"left","border-style":"dashed"},{default:l(()=>[t(a,{type:"info"},{default:l(()=>[A("操作列配置")]),_:1})]),_:1}),t(r,{ref_key:"formColumn",ref:U,model:h.column,rules:J,labelPosition:"right",labelWidth:"128px"},{default:l(()=>[t(S(ve),{data:h.column,list:Y},null,8,["data"])]),_:1},8,["model"]),t(w,{"content-position":"left","border-style":"dashed"},{default:l(()=>[t(a,{type:"info"},{default:l(()=>[A("操作按钮配置")]),_:1})]),_:1}),t(r,{ref_key:"formBtn",ref:E,model:h.btn,rules:z,labelPosition:"right",labelWidth:"128px",class:re({"the-filter-mask":!k.formEdit}),"data-tips":"待新增或编辑操作"},{default:l(()=>[t(S(ve),{data:h.btn,list:F},{iconInput:l(()=>[t(S(bt),{value:h.btn.icon,"onUpdate:value":o[0]||(o[0]=m=>h.btn.icon=m)},null,8,["value"])]),_:1},8,["data"]),t(q,null,{default:l(()=>[f("div",oo,[t(p,{onClick:o[1]||(o[1]=m=>W())},{default:l(()=>[A("取 消")]),_:1}),k.index>-1?(n(),O(p,{key:0,type:"primary",plain:"",onClick:o[2]||(o[2]=m=>B("edit"))},{default:l(()=>[lo,A(" 确认修改 ")]),_:1})):(n(),O(p,{key:1,type:"primary",plain:"",onClick:o[3]||(o[3]=m=>B("add"))},{default:l(()=>[no,A(" 确认新增 ")]),_:1}))])]),_:1})]),_:1},8,["model","class"])]),t(we,{name:"the-group",tag:"div",class:"the-curd-option-list f1"},{default:l(()=>[(n(!0),N(X,null,ae(k.list,(m,d)=>(n(),N("div",{class:re(["the-curd-option-item f-vertical",{"the-curd-selected":d===k.index}]),key:m.key,"data-key":m.key!==S(fe)?m.key:null,draggable:P(m),onDragstart:y=>S(u)(d),onDragover:y=>S(K)(y,d),onDrop:o[4]||(o[4]=(...y)=>S(H)&&S(H)(...y))},[k.index===-1&&m.key!==S(fe)?(n(),N("i",io)):M("",!0),t(p,{type:m.type,link:""},{default:l(()=>[m.icon?(n(),N("i",{key:0,class:re(["el-icon--left",m.icon])},null,2)):M("",!0),A(" "+ne(D(m)),1)]),_:2},1032,["type"]),so,m.key===S(fe)?(n(),O(a,{key:1,type:"info",size:"small"},{default:l(()=>[A("编辑按钮不可删除、拖拽等操作，且处于首位")]),_:1})):(n(),N(X,{key:2},[t(g,{width:"186px",title:"是否删除该按钮功能？",onConfirm:y=>C(d)},{reference:l(()=>[t(p,{link:"",type:"danger",disabled:k.index>-1},{default:l(()=>[ro]),_:1},8,["disabled"])]),_:2},1032,["onConfirm"]),t(p,{link:"",type:"success",onClick:y=>$(d)},{default:l(()=>[uo]),_:2},1032,["onClick"])],64))],42,ao))),128)),k.list.length?M("",!0):(n(),O(i,{key:"empty","image-size":120,description:"请添加操作列功能按钮"})),k.formEdit?M("",!0):(n(),N("div",co,[k.formEdit?M("",!0):(n(),O(p,{key:0,type:"primary",plain:"",onClick:o[5]||(o[5]=m=>k.formEdit=!0)},{default:l(()=>[po,A(" 新增功能按钮 ")]),_:1}))]))]),_:1})])]),_:1},8,["show"])}}}),yo={class:"the-curd-table-model the-curd-scrollbar"},ho=["data-key","draggable","onDragstart","onDragover"],go=["data-head"],vo=f("i",{class:"el-icon-rank el-icon--left"},null,-1),bo={class:"fake-table-cell operation f-vertical"},_o=f("i",{class:"el-icon-arrow-down el-icon--right"},null,-1),ko={class:"fake-table-cell f-vertical"},wo={key:1,class:"the-tag blue"},$o=f("div",{class:"fake-table-head fvc"},"操作",-1),xo={class:"fake-table-cell operation fvc"},Co=f("i",{class:"el-icon-setting"},null,-1),Do=f("i",{class:"el-icon-delete"},null,-1),So={class:"fake-table-cell"},Vo={class:"f-vertical",key:"right-setting"},To=f("i",{class:"el-icon-plus el-icon--left"},null,-1),Eo={key:0},Oo=f("i",{class:"el-icon-plus el-icon--left"},null,-1),No={key:1},Mo={key:0,class:"the-tag blue mgl-10"},Bo=f("i",{class:"el-icon--left el-icon-info"},null,-1),Ao={name:"TableModel"},Fo=se({...Ao,props:{config:{type:Object,required:!0}},emits:["action"],setup(L,{emit:V}){const e=L,j=V,c="https://fuss10.elemecdn.com/e/5d/4a731a90594a4af544c0c25941171jpeg.jpeg",s=[{key:"edit",label:"编辑列",icon:"el-icon-edit",click(r){U("edit",r)}},{key:"copy",label:"复制列",icon:"el-icon-document-copy",click(r){U("copy",r)}},{key:"delete",label:"删除列",icon:"el-icon-delete",click(r){h(r)}}],_=ie({show:!1,type:"add",index:-1,form:void 0,keys:[]}),E=Q(()=>{const r=e.config.columns,p=[],q=[];for(let g=0;g<r.length;g++){const i=r[g];i.prop===ye?q.push(i):p.push(i)}return{drag:p,action:q}});function U(r,p){_.keys=e.config.columns.map(g=>g.prop),{add(){_.form=void 0},edit(){const g=e.config.columns[p];_.keys=_.keys.filter(i=>i!==g.prop),_.index=p,_.form=g},copy(){const g=e.config.columns[p];_.form=g}}[r](),_.type=r,_.show=!0}function k(r){const p=e.config;if(["add","copy"].includes(_.type)){const q=ue(E.value.drag);q.push(r),p.columns=q.concat(E.value.action)}else p.columns[_.index]=r}function h(r){const p=E.value.drag[r];me({title:"操作提示",content:`是否删除【${p.title}】列？`,cancelText:"取消",confirm(){const q=e.config.columns.findIndex(g=>g.prop===p.prop);e.config.columns.splice(q,1)}})}const{onDragStart:J,onDragMove:Y,onDropEnd:z}=$e({list:()=>e.config.columns,key:"prop",findLevel:5});function F(r){const p={};return r&&r.width&&(p.width=`${r.width}px`),r&&r.minWidth&&(p.minWidth=`${r.minWidth}px`),p}const I=Q(function(){const r=e.config.columns;if(r.length>0&&r[r.length-1].prop===ye)return r[r.length-1]});function x(){const r=Te(ye,"操作");r.minWidth=120,r.width=160,e.config.columns.push(r)}function B(){const r=e.config.columns;me({title:"操作提示",content:"是否删除操作列？删除之后需要重新配置。",cancelText:"取消",confirm(){r.splice(r.length-1,1),e.config.actions=[],e.config.formEdit&&(e.config.formEdit=void 0)}})}const W=ie({show:!1,keyword:""});function $(){const r=e.config.selectKey;W.keyword=r?r.toString():"",W.show=!0}function C(r){e.config.selectKey=r}const u=ie({show:!1,columnWidth:0,actionMax:0});function K(){u.show=!0,u.columnWidth=I.value.width,u.actionMax=e.config.actionMax}function H(r,p){e.config.actions=r;const q=e.config.columns.find(g=>g.prop===ye);q.width=p}const P=ie({show:!1,form:null,type:"add"});function D(r){P.type=r,r==="add"&&e.config.formAdd&&(P.form=e.config.formAdd),r==="edit"&&e.config.formEdit&&(P.form=e.config.formEdit),P.show=!0}function v(r,p){const q=e.config,g=q.actions;function i(){const te=g.length>0&&g[0].key===fe;r&&r.fields.length>0?(I.value||x(),te||g.unshift({key:fe,text:"编辑",type:"success",icon:"el-icon-edit"})):te&&g.splice(0,1)}r&&(P.type==="add"?(q.formAdd=r,p&&(q.formEdit=ue(r),i())):(q.formEdit=r,p&&(q.formAdd=ue(r)),i())),P.show=!1,P.form=null}function o(r){switch(r){case"delete":$();break;case"add":D("add");break;case"edit":D("edit");break}}const a=Q(()=>E.value.drag.some(r=>!r.width&&!r.minWidth));function w(r){if(r==="complete"&&a.value){const p=Array.from(document.querySelectorAll(".fake-table-head")),q={};p.forEach(g=>{const i=g.dataset.head||"";i&&(q[i]=Math.round(g.clientWidth))}),e.config.columns.forEach(g=>{Object.prototype.hasOwnProperty.call(q,g.prop)&&(g.minWidth=q[g.prop])})}j("action",r)}return(r,p)=>{const q=b("el-empty"),g=b("el-button"),i=b("el-dropdown-item"),te=b("el-dropdown-menu"),m=b("el-dropdown"),d=b("el-tooltip"),y=b("base-table-actions"),T=b("el-text");return n(),N(X,null,[P.show?M("",!0):(n(),O(Pe,{key:0,editMode:!0,config:e.config,onAction:o},null,8,["config"])),f("div",yo,[P.show?(n(),O(Re,{key:0,config:P.form,type:P.type,editMode:!0,onChange:v},null,8,["config","type"])):(n(),O(we,{key:1,name:"the-group",tag:"div",class:"fake-table"},{default:l(()=>[e.config.columns.length?M("",!0):(n(),O(q,{key:"empty",style:{padding:"10px 40px"},"image-size":120,description:"请添加表格列"})),(n(!0),N(X,null,ae(E.value.drag,(R,G)=>(n(),N("div",{key:R.prop,"data-key":R.prop,class:"fake-table-item",draggable:E.value.drag.length>1,style:xe(F(R)),onDragstart:Z=>S(J)(G),onDragover:Z=>S(Y)(Z,G),onDrop:p[0]||(p[0]=Z=>S(z)())},[f("div",{class:"fake-table-head f-vertical","data-head":R.prop},[vo,t(He,{column:R},null,8,["column"])],8,go),f("div",bo,[t(m,{trigger:"click"},{dropdown:l(()=>[t(te,null,{default:l(()=>[(n(),N(X,null,ae(s,Z=>t(i,{key:Z.key,onClick:ee=>Z.click(G)},{default:l(()=>[f("i",{class:re(["el-icon--left",Z.icon])},null,2),A(" "+ne(Z.label),1)]),_:2},1032,["onClick"])),64))]),_:2},1024)]),default:l(()=>[t(g,{link:"",type:"primary"},{default:l(()=>[A(" 配置列 "),_o]),_:1})]),_:2},1024)]),f("div",ko,[R.cellType==="text"?(n(),N(X,{key:0},[A("文本内容")],64)):R.cellType==="js"?(n(),N("span",wo,"自定义代码")):M("",!0),t(S(Je),{column:R,src:c},null,8,["column"])])],44,ho))),128)),I.value?(n(),N("div",{style:xe(F(I.value)),key:S(ye),class:"fake-table-item"},[$o,f("div",xo,[t(d,{effect:"dark",content:"配置【操作按钮】和【操作列】的宽度",placement:"top"},{default:l(()=>[t(g,{circle:"",plain:"",type:"primary",size:"small",onClick:p[1]||(p[1]=R=>K())},{default:l(()=>[Co]),_:1})]),_:1}),t(g,{circle:"",plain:"",type:"danger",size:"small",onClick:p[2]||(p[2]=R=>B())},{default:l(()=>[Do]),_:1})]),f("div",So,[e.config.actions.length?(n(),O(y,{key:0,row:{},index:1,actions:e.config.actions},null,8,["actions"])):(n(),O(T,{key:1,type:"info"},{default:l(()=>[A("待添加操作~")]),_:1}))])],4)):M("",!0),f("div",Vo,[f("div",null,[f("p",null,[t(g,{type:"primary",text:"",onClick:p[3]||(p[3]=R=>U("add"))},{default:l(()=>[To,A(" 添加内容列 ")]),_:1})]),I.value?M("",!0):(n(),N("p",Eo,[t(g,{type:"primary",text:"",onClick:p[4]||(p[4]=R=>x())},{default:l(()=>[Oo,A(" 添加操作列 ")]),_:1})]))])])]),_:1}))]),P.show?M("",!0):(n(),N("div",No,[t(S(Ie),{type:P.type,onAction:w},null,8,["type"]),a.value?(n(),N("span",Mo,[Bo,A(" 当前表格列配置中存在没配置【宽度/最小宽度】，保存时将自动设置最小宽度，提高表格美观性。 ")])):M("",!0)])),t(Kt,{show:_.show,"onUpdate:show":p[5]||(p[5]=R=>_.show=R),type:_.type,keys:_.keys,form:_.form,onSubmit:k},null,8,["show","type","keys","form"]),t(Yt,{show:W.show,"onUpdate:show":p[6]||(p[6]=R=>W.show=R),"select-key":W.keyword,onSubmit:C},null,8,["show","select-key"]),t(mo,{show:u.show,"onUpdate:show":p[7]||(p[7]=R=>u.show=R),columnWidth:u.columnWidth,actionMax:u.actionMax,list:e.config.actions,onSubmit:H},null,8,["show","columnWidth","actionMax","list"])],64)}}}),qo={class:"the-curd-example"},Lo={name:"Example"},Wo=se({...Lo,props:{selected:{type:String},type:{type:String}},emits:["choose"],setup(L,{emit:V}){const e=L,j=V,c=[{...ce("input"),placeholder:de.input},{...ce("select"),placeholder:de.select},{...ce("select-multiple"),placeholder:de["select-multiple"]},{...ce("cascader"),placeholder:de.cascader},{...ce("date"),placeholder:de.date},{...ce("checkbox"),options:[{label:"多选-A",value:1},{label:"多选-B",value:2}],defaultValue:[1]},{...ce("radio"),options:[{label:"单选-A",value:"radio-1"},{label:"单选-B",value:"radio-2"}],defaultValue:"radio-1"},{...ce("switch"),defaultValue:!0},{...ce("textarea"),placeholder:de.textarea},{...ce("input-between"),placeholder:["范围区间操作","范围区间操作"]}],s=["radio","checkbox","textarea","switch"],_=Q(()=>e.type==="search"?c.filter(E=>!s.includes(E.type)):c);return(E,U)=>(n(),N("div",qo,[(n(!0),N(X,null,ae(_.value,k=>(n(),O(ke,{key:k.type,"field-data":k,class:re(["the-curd-example-item fvc",{"the-curd-selected":e.selected===k.type}]),readonly:"",onClick:h=>j("choose",k.type)},null,8,["field-data","class","onClick"]))),128))]))}}),jo={key:0,class:"the-curd-editor-content"},Uo=f("h2",{class:"the-title mgb-20"},"基础设置",-1),Io={class:"f-vertical f-between mgb-20"},Jo=f("h2",{class:"the-title"},"第1步：点击选取组件",-1),Po={class:"f-vertical mgb-20"},Ro={class:"the-title"},Ho=f("div",{class:"f1"},null,-1),zo={key:0,class:"the-curd-target-box"},Ko=f("a",{href:"https://www.json.cn/",target:"_blank"}," JSON编辑工具 ",-1),Go={class:"f-right"},Zo=f("i",{class:"el-icon--left el-icon-plus"},null,-1),Xo=f("i",{class:"el-icon--left el-icon-edit"},null,-1),Qo={name:"Editor"},Yo=se({...Qo,props:{show:{type:Boolean,default:!1},config:{type:Object,required:!0}},emits:["update:show"],setup(L,{emit:V}){const e=L,j=V;function c(){j("update:show",!1)}const s=["checkbox","radio","switch"],_=["select","select-multiple","radio","checkbox","cascader"],E=["input","textarea","select","radio"],U=["input-between","select-multiple","checkbox","cascader"],k=["input","select","radio"],h=["daterange","datetimerange"],J=k.concat(U),Y=`<p>参考 src/utils/index.ts 中的${le("formatDate")}函数</p>`,z=`
<p>动态表单项的条件显示逻辑函数；</p>
<p>返回${le("false")}则不展示对应项；</p>
<p>函数有一个参数：${le("formData")}为当前表单的数据值；</p>
<p>以${le("return")}为函数代码片段标记；</p>
<p>例如：${le("return formData.type !== 2")}</p>
`,F=Oe(),I=Q(()=>F.editor.action==="add"),x=Q(()=>{let m=[];return $.formData&&$.formData.type==="date"&&(m=je[$.formData.dateType].map((y,T)=>({label:y.text,value:T}))),m.unshift({label:"将预览组件中的值设为默认",value:-1}),m}),B=[{label:"整体文字宽度",prop:"labelWidth",type:"number",placeholder:"例如：120(px)"},{label:"文字靠右对齐",prop:"labelRight",type:"switch"}],W=[{label:"表单宽度",prop:"width",type:"number",placeholder:"例如：500(px)"},{label:"文字宽度",prop:"labelWidth",type:"number",placeholder:"例如：140(px)"},{label:"文字靠右排版",prop:"labelPosition",type:"switch",inactiveValue:"left",activeValue:"right"}],$=ie({step:0,formData:void 0});function C(m){$.step=m}const u={label:{required:!0,message:"请输入功能标题",trigger:"blur"},key:{required:!0,trigger:"blur",validator(m,d,y){d?i.includes(d)?y(new Error("当前键值已经被占用！")):y():y(new Error("绑定的键值不能为空"))}},format:{required:!0,message:"格式化规则不能为空",trigger:"blur"},separator:{required:!0,message:"请输入串联符号",trigger:"blur"},defaultValue:{required:!0,trigger:"blur",validator(m,d,y){const T=o();T===!0?y():y(new Error(T)),y()}},options:{required:!0,trigger:"blur",validator(m,d,y){const T=a();T===!0?y():y(new Error(T))}},show:{trigger:"blur",validator(m,d,y){if(d&&!d.includes("return")){y(new Error("逻辑代码必须包含 return 关键字"));return}y()}}},K=Q(()=>{const m=$.formData?$.formData.type:"",d=[{label:"组件标题",prop:"label",type:"input",placeholder:u.label.message},{label:"绑定的键值",prop:"key",type:"input",placeholder:"请输入绑定的键值"},{label:"标题宽度",prop:"labelWidth",type:"number",placeholder:"例如：120(px)"},{label:"组件宽度",prop:"valueWidth",type:"number",placeholder:"例如：140(px)",show:()=>!s.includes(m)},{label:"提示/规则文字",prop:"placeholder",type:"slot",slotName:"ruleText"},{label:"是否必填",prop:"required",type:"switch"}];if(J.includes(m)){const y={label:"绑定值为数字类型",prop:"valueType",type:"switch",activeValue:"number",inactiveValue:"string"};U.includes(m)&&(y.activeValue="array<number>",y.inactiveValue="array"),_.includes(m)&&(y.tips="设为数字类型之后，将会在保存时校验选项数据"),d.push(y)}if(m!=="date"&&d.push({label:"组件默认值",prop:"defaultValue",type:"slot",slotName:"defaultValue"}),m==="input-between"&&d.push({label:"串联符号",prop:"separator",type:"input",placeholder:u.separator.message}),_.includes(m)){const y=[{label:"选项数据",prop:"options",type:"slot",slotName:"options"},{label:"数据展示字段",prop:"optionSetting.label",type:"input",placeholder:"不填则使用 label"},{label:"数据值字段",prop:"optionSetting.value",type:"input",placeholder:"不填则使用 value"}];if(m==="cascader"){const T=[{label:"下级字段",prop:"optionSetting.children",type:"input",placeholder:"不填则使用 children"},{label:"是否多选",prop:"multiple",type:"switch"},{label:"允许只选中某一项",prop:"checkStrictly",type:"switch"}];y.push(...T)}["select","select-multiple"].includes(m)&&y.push({label:"串联显示名称",prop:"joinShow",type:"switch",tips:"例如【英雄联盟-12】"}),d.push(...y)}if(m==="date"){const y=[{label:"日期类型",prop:"dateType",type:"select",options:Ae,noClear:!0,onChange:p},{label:"日期默认值",prop:"shortcutIndex",type:"select",options:x.value,placeholder:"请选择"},{label:"格式化规则",prop:"format",type:"input",tooltip:Y}];d.push(...y)}return F.editor.type==="table"&&d.push({label:"表单显示逻辑",prop:"show",type:"textarea",placeholder:"请输入条件代码，为空则默认展示",tooltip:z}),d}),H=be(),P=ie({options:"",defaultValue:""});function D(m){m.type!=="date"&&(P.defaultValue=JSON.stringify({value:m.defaultValue})),_.includes(m.type)&&(P.options=JSON.stringify(m.options))}function v(m){var T;const d=F.editor,y=ce(m,"",d.type==="search");$.formData=y,D(y),(T=H.value)==null||T.clearValidate(),C(1)}function o(){const m='输入的格式必须为 { "value": "input value" }',d=P.defaultValue;if(!d)return m;const y=$.formData.type,T=$.formData.valueType,R=de[y];try{const G=JSON.parse(d);if(!oe(G,"object"))return m;if(y==="switch"&&!oe(G.value,"boolean"))return`${R}的绑定值应该为 boolean 类型`;if(U.includes(y)){if(!oe(G.value,"array"))return`${R}的绑定值应该为 array 类型`;if(T==="array<number>"&&G.value.some(Z=>Z!==""&&!oe(Z,"number")))return"数组中只能出现数字"}if(E.includes(y)&&!["string","number"].includes(qe(G.value)))return`${R}的绑定值应该为 string/number 类型`;if(y==="date"){const Z=$.formData;if(h.includes(Z.dateType)){if(!oe(G.value,"array"))return"范围日期绑定值应该为 array 类型"}else if(!oe(G.value,"string"))return"日期类型绑定值应该为 string 类型"}if(k.includes(y)&&T==="number"&&G.value!==""&&!oe(G.value,"number"))return`${R}的绑定值应该为 number 类型`}catch(G){return console.warn("checkDefaultValue >>",G),m}return!0}function a(){const m=P.options;if(!m)return"选项数据不能为空！";try{const d=JSON.parse(m);if(!oe(d,"array"))return"选项数据格式不正确，需要为数组类型！";const y=$.formData,T=y.optionSetting.value||"value",R=[void 0,null];for(let G=0;G<d.length;G++){const Z=d[G];if(!oe(Z,"object"))return"数组项必须为对象！";if(R.includes(Z[T]))return`数组项的值不能为${R.join("/")}`;if(["array<number>","number"].includes(y.valueType)&&!oe(Z[T],"number")&&Z[T]!=="")return"数组项的值必须为 number 类型"}return!0}catch(d){return console.warn("checkOptions >>",d),"不合法的JSON,注意使用双引号,结尾不能为逗号等"}}function w(){a()===!0&&($.formData.options=JSON.parse(P.options))}function r(){if(o()===!0){const d=$.formData,y=JSON.parse(P.defaultValue).value;d.type!=="date"&&(d.defaultValue=y)}}function p(m){const d=Ae.find(T=>T.value===m),y=$.formData;y.shortcutIndex="",h.includes(d.value)?(y.value=[],y.valueType="array"):(y.value="",y.valueType="string"),y.formatShow=d.formatShow,y.format=d.format}function q(m){return/^[+-]?(\d|([1-9]\d+))(\.\d+)?$/.test(m)}function g(){var m;(m=H.value)==null||m.validate(d=>{if(at("#the-editor-form",d),!d)return;r(),_.includes($.formData.type)&&w();const y=F.editor,T=JSON.parse(JSON.stringify($.formData));if(_.includes(T.type)&&w(),T.valueType||(T.valueType=qe(T.defaultValue)),_.includes(T.type)&&["number","array<number>"].includes(T.valueType)){let G=T.optionSetting.value;G||(G="value",T.optionSetting.value=G);for(let Z=0;Z<T.options.length;Z++){const ee=T.options[Z],De=ee[G];if([null,void 0].includes(De))return pe.error("数据值字段与选项数据不匹配，请检查！");if(q(De.toString()))ee[G]=Number(De);else{const ze=ee[T.optionSetting.label];return pe.error(`选项数据中【${ze}】的值应该为数字！`)}}}T.type==="date"&&(T.shortcutIndex===-1&&(T.shortcutDate=T.value),T.value=T.valueType==="array"?[]:""),{search(G){G?e.config.search.list.push(T):e.config.search.list[y.index]=T},table(G){if(G){const Z=JSON.parse(JSON.stringify(y.form.fields));Z.push(T),y.form.fields=Z}else{const Z=JSON.parse(JSON.stringify(y.form.fields));Z[y.index]=T,y.form.fields=Z}}}[y.type](I.value),c()})}let i=[];function te(m){const d=F.editor;i=[],{search(){i=e.config.search.list.map(T=>T.key)},table(){i=d.form.fields.map(T=>T.key)}}[d.type](),m&&(i=i.filter(T=>T!==m))}return he(()=>e.show,function(m){if(!m){$.formData=void 0;return}const d=F.editor;if(d.action==="add")$.step=0,$.formData=void 0,te();else{const y=d.index;({search(){$.formData=JSON.parse(JSON.stringify(e.config.search.list[y]))},table(){var R;$.formData=JSON.parse(JSON.stringify((R=d.form)==null?void 0:R.fields[y]))}})[d.type](),D($.formData),te($.formData.key),$.step=1}}),(m,d)=>{const y=b("el-form"),T=b("el-button"),R=b("el-input"),G=b("el-text");return n(),N("section",{class:re(["the-curd-editor the-curd-scrollbar",{"is-show":e.show}])},[t(Ke,{name:"the-curd-editor-move"},{default:l(()=>{var Z;return[e.show?(n(),N("div",jo,[Uo,t(y,{"label-position":"right","label-width":"120px"},{default:l(()=>[S(F).editor.type==="search"?(n(),O(S(ve),{key:0,data:e.config.search,list:B},null,8,["data"])):M("",!0),S(F).editor.type==="table"&&S(F).editor.form?(n(),O(S(ve),{key:1,data:S(F).editor.form,list:W},null,8,["data"])):M("",!0)]),_:1}),$.step===0?(n(),N(X,{key:0},[f("div",Io,[Jo,t(T,{link:"",type:"primary",onClick:d[0]||(d[0]=ee=>c())},{default:l(()=>[A("退出编辑")]),_:1})]),t(Wo,{selected:(Z=$.formData)==null?void 0:Z.type,type:S(F).editor.type,onChoose:v},null,8,["selected","type"])],64)):M("",!0),$.step===1?(n(),N(X,{key:1},[f("div",Po,[f("h2",Ro,"第2步：配置"+ne(S(de)[$.formData.type]),1),Ho,t(T,{link:"",type:"success",onClick:d[1]||(d[1]=ee=>C(0))},{default:l(()=>[A("上一步")]),_:1}),t(T,{link:"",type:"primary",onClick:d[2]||(d[2]=ee=>c())},{default:l(()=>[A("退出编辑")]),_:1})]),$.formData?(n(),N("div",zo,[t(ke,{"field-data":$.formData,"edit-mode":""},null,8,["field-data"])])):M("",!0),$.formData?(n(),O(y,{key:1,id:"the-editor-form",ref_key:"formRef",ref:H,model:$.formData,rules:u,"label-position":"right","label-width":"128px"},{default:l(()=>[t(S(ve),{data:$.formData,list:K.value},{ruleText:l(()=>[$.formData.type==="input-between"?(n(),N(X,{key:0},[t(R,{modelValue:$.formData.placeholder[0],"onUpdate:modelValue":d[3]||(d[3]=ee=>$.formData.placeholder[0]=ee),class:"f1",clearable:"",placeholder:"请输入提示-1"},null,8,["modelValue"]),t(G,{style:{padding:"0 6px"}},{default:l(()=>[A("-")]),_:1}),t(R,{modelValue:$.formData.placeholder[1],"onUpdate:modelValue":d[4]||(d[4]=ee=>$.formData.placeholder[1]=ee),class:"f1",clearable:"",placeholder:"请输入提示-2"},null,8,["modelValue"])],64)):(n(),O(R,{key:1,modelValue:$.formData.placeholder,"onUpdate:modelValue":d[5]||(d[5]=ee=>$.formData.placeholder=ee),clearable:"",placeholder:"请输入规则提示/输入框提示文字"},null,8,["modelValue"]))]),defaultValue:l(()=>[t(R,{modelValue:P.defaultValue,"onUpdate:modelValue":d[6]||(d[6]=ee=>P.defaultValue=ee),type:"textarea",clearable:"",placeholder:"请输入JSON，值为 value",onBlur:d[7]||(d[7]=ee=>r())},null,8,["modelValue"])]),options:l(()=>[t(R,{modelValue:P.options,"onUpdate:modelValue":d[8]||(d[8]=ee=>P.options=ee),type:"textarea",placeholder:"请输入数组JSON",style:{"margin-bottom":"4px"},onBlur:d[9]||(d[9]=ee=>w())},null,8,["modelValue"]),t(T,{link:"",type:"primary"},{default:l(()=>[Ko]),_:1})]),_:1},8,["data","list"]),f("div",Go,[t(T,{onClick:d[10]||(d[10]=ee=>c())},{default:l(()=>[A("关闭")]),_:1}),I.value?(n(),O(T,{key:0,type:"primary",onClick:d[11]||(d[11]=ee=>g())},{default:l(()=>[Zo,A(" 新增 ")]),_:1})):(n(),O(T,{key:1,type:"success",onClick:d[12]||(d[12]=ee=>g())},{default:l(()=>[Xo,A(" 确认 ")]),_:1}))])]),_:1},8,["model"])):M("",!0)],64)):M("",!0)])):M("",!0)]}),_:1})],2)}}}),el={class:"the-curd-main-page"},tl={key:0,class:"the-tag blue"},ol=f("i",{class:"el-icon-arrow-left"},null,-1),ll=f("p",{class:"mgb-10"},"配置筛选相关功能",-1),nl=f("p",null,"配置表格相关功能",-1),al={name:"Curd"},pl=se({...al,props:{data:{type:Object,required:!0},action:{type:Object,required:!0}},setup(L){const V=L,e=ie({loading:!1,editor:{show:!1,type:void 0,form:void 0,action:"add",index:-1},showEntrance:!1}),j=Q(()=>{const o=e.editor.type;return o==="search"||!o&&V.data.search.list.length>0});Ze(et,e);let c;function s(o){e.editor.type=o,e.editor.show=!1,e.editor.index=-1,e.showEntrance=!1,c={[o]:ue(V.data[o])}}function _(o){const a=e.editor.type;o&&c&&(V.data[a]=c[a]),e.editor.index=-1,e.editor.show=!1,e.editor.type=void 0,e.editor.form=void 0,c=void 0}function E(){_()}function U(){Le(JSON.stringify(V.data),()=>pe.success("复制成功！"))}function k(o){o&&V.data.search.list.forEach(Ee),h.pageInfo.currentPage=1,h.selectList=[],H()}const h=ie({selectList:[],data:[],pageInfo:ot(),formShow:!1,formType:"add",formLoading:!1}),J=Q(()=>V.data.table),Y=Q(()=>J.value.columns.filter(a=>a.visible).map(a=>{const w={...a};return w.cellType==="js"&&w.jsCode&&(w.rawContent=function(r,p){let q="";try{q=new Function("cellValue","row",w.jsCode)(r,p)}catch(g){console.warn("解析 rawContent 代码错误 >>",g),q="-"}return q}),w})),z=Q(()=>J.value.actions.map(a=>{const w={...a};return w.key===fe&&(w.click=$),w})),F=Q(()=>{const o=[],a=[];return Y.value.forEach(w=>{w.slotHead&&o.push(w.slotHead),w.slot&&a.push(w.slot)}),{head:o,cell:a}});function I(o){return J.value.columns.find(w=>w.prop===o)||{}}const x=be(),B=Q(()=>{const o=J.value,a={title:"编辑表单",config:o.formEdit||{}};return h.formType==="add"&&(a.title="新增表单",a.config=o.formAdd||{}),a});let W=null;function $(o){o?(h.formType="edit",W=o):h.formType="add",h.formShow=!0,setTimeout(()=>{var a;return(a=x.value)==null?void 0:a.clear()}),Ge(()=>{var a;return W&&((a=x.value)==null?void 0:a.setFormData(W))})}function C(){var o;h.formShow=!1,(o=x.value)==null||o.reset(),W=null}function u(){var o;(o=x.value)==null||o.validate(async(a,w)=>{if(h.formType==="add"&&V.action.onAdd){h.formLoading=!0;const r=await V.action.onAdd(a,w);if(h.formLoading=!1,r.code!==1)return;C(),H()}if(h.formType==="edit"&&V.action.onEdit){h.formLoading=!0;const r=await V.action.onEdit(a,w);if(h.formLoading=!1,r.code!==1)return;C(),H()}})}function K(o){const a=V.data.search.list,w={};for(let g=0;g<a.length;g++){const i=a[g],te=Ue(i);if(i.required&&oe(te.result,"string"))return it(document.querySelector(`.${i.id}`)),pe.error(te.result),o&&o.key==="page"&&(h.pageInfo=o.before),null;te.result===!0&&(w[i.key]=te.value)}const r=J.value.columns,p=[],q=[];return o&&o.key==="sort"?r.forEach(g=>{g.sort&&(g.prop===o.prop?g.sort=o.action:g.sort=!0),g.sort==="asc"&&p.push(g.prop),g.sort==="desc"&&q.push(g.prop)}):r.forEach(g=>{g.sort==="asc"&&p.push(g.prop),g.sort==="desc"&&q.push(g.prop)}),p.length&&(w.asc=p.toString()),q.length&&(w.desc=q.toString()),w}async function H(o){const a=K(o);if(!a)return;const w=JSON.parse(JSON.stringify(h.pageInfo));e.loading=!0;const r=await V.action.getTableData(a,w);e.loading=!1,r.code===1&&(h.pageInfo.total=r.data.total,h.data=r.data.list||[])}function P(o){const a=h.selectList;switch(o){case"add":$();break;case"delete":if(!a.length)return pe.warning("请选择要删除的列表再进行操作~");me({title:"操作提示",content:`是否删除选中的 ${a.length} 条数据？`,cancelText:"取消",async confirm(){V.action.onDelete?(e.loading=!0,(await V.action.onDelete(JSON.parse(JSON.stringify(h.selectList)))).code===1?(pe.success("删除成功！"),h.selectList=[],H()):e.loading=!1):pe.info("请设置 action.onDelete 删除逻辑")}});break;case"export":V.action.onExport?V.action.onExport():pe.info("请设置 action.onExport 导出逻辑");break}}function D(o){({exit:()=>_(!0),copy:U,complete:E})[o]()}function v(o){e.loading=o}return Ye({formatDate:lt,copyText:Le,messageBox:me,message:pe,jsonToPath:nt,request:st,getData:H,setLoading:v}),We(function(){V.action.created&&J.value.columns.length&&V.action.created(H)}),(o,a)=>{const w=b("base-table"),r=b("base-pagination"),p=b("el-button"),q=b("el-empty"),g=b("base-dialog");return n(),N("div",el,[f("section",{class:re([e.editor.show?"f1":"w-full"])},[j.value?(n(),O(gt,{key:0,data:V.data.search,onSearch:k},null,8,["data"])):M("",!0),e.editor.type==="table"?(n(),O(Fo,{key:1,config:J.value,onAction:D},null,8,["config"])):e.editor.type==="search"?(n(),O(S(Ie),{key:2,onAction:D})):(n(),N(X,{key:3},[J.value.columns.length>0?(n(),N(X,{key:0},[t(Pe,{config:J.value,disabled:e.loading,onAction:P},{left:l(()=>[J.value.selectKey?(n(),N("span",tl," 已选择 "+ne(h.selectList.length)+" 条数据 ",1)):M("",!0)]),_:1},8,["config","disabled"]),t(w,{"select-list":h.selectList,"onUpdate:selectList":a[1]||(a[1]=i=>h.selectList=i),data:h.data,columns:Y.value,actions:z.value,actionMax:J.value.actionMax,loading:e.loading,"select-key":J.value.selectKey},Ve({_:2},[ae(F.value.head,i=>({name:i,fn:l(({$index:te})=>[t(He,{column:Y.value[J.value.selectKey?te-1:te],onSort:a[0]||(a[0]=(m,d)=>H({key:"sort",prop:m,action:d}))},null,8,["column"])])})),ae(F.value.cell,i=>({name:i,fn:l(({row:te})=>[t(S(Je),{column:I(i),src:te[i],previewList:F.value.cell.map(m=>te[m])},null,8,["column","src","previewList"])])}))]),1032,["select-list","data","columns","actions","actionMax","loading","select-key"]),t(r,{disabled:e.loading,pageInfo:h.pageInfo,onChange:a[2]||(a[2]=i=>H({key:"page",...i}))},null,8,["disabled","pageInfo"])],64)):(n(),O(q,{key:1,description:"当前页面没有表格配置数据，请配置后再操作~"},{default:l(()=>[t(p,{type:"primary",onClick:a[3]||(a[3]=i=>s("table"))},{default:l(()=>[A("去配置")]),_:1})]),_:1}))],64))],2),t(Yo,{show:e.editor.show,"onUpdate:show":a[4]||(a[4]=i=>e.editor.show=i),config:V.data},null,8,["show","config"]),t(g,{show:h.formShow,"onUpdate:show":a[7]||(a[7]=i=>h.formShow=i),title:B.value.title,width:S(_e)(B.value.config.width),onClose:a[8]||(a[8]=i=>C())},{footer:l(()=>[t(S(Ce),{loading:h.formLoading,onClose:a[5]||(a[5]=i=>C()),onSubmit:a[6]||(a[6]=i=>u())},null,8,["loading"])]),default:l(()=>[t(Re,{ref_key:"formRef",ref:x,config:B.value.config,type:h.formType,disabled:h.formLoading},null,8,["config","type","disabled"])]),_:1},8,["show","title","width"]),!e.showEntrance&&!e.editor.type?(n(),O(p,{key:0,class:"the-curd-entrance",type:"primary",size:"small",onClick:a[9]||(a[9]=i=>e.showEntrance=!0)},{default:l(()=>[ol]),_:1})):M("",!0),t(g,{show:e.showEntrance,"onUpdate:show":a[13]||(a[13]=i=>e.showEntrance=i),title:"请选择配置操作",width:"600px"},{footer:l(()=>[t(p,{onClick:a[12]||(a[12]=i=>e.showEntrance=!1)},{default:l(()=>[A("关 闭")]),_:1})]),default:l(()=>[f("div",{class:"the-curd-entrance-item",onClick:a[10]||(a[10]=i=>s("search"))},[ll,t(S(_t))]),f("div",{class:"the-curd-entrance-item",onClick:a[11]||(a[11]=i=>s("table"))},[nl,t(S(kt))])]),_:1},8,["show"])])}}});export{pl as _};
